var ss=Object.defineProperty;var is=(u,h,_)=>h in u?ss(u,h,{enumerable:!0,configurable:!0,writable:!0,value:_}):u[h]=_;var Q=(u,h,_)=>is(u,typeof h!="symbol"?h+"":h,_);(function(){const h=document.createElement("link").relList;if(h&&h.supports&&h.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))b(w);new MutationObserver(w=>{for(const O of w)if(O.type==="childList")for(const x of O.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&b(x)}).observe(document,{childList:!0,subtree:!0});function _(w){const O={};return w.integrity&&(O.integrity=w.integrity),w.referrerPolicy&&(O.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?O.credentials="include":w.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function b(w){if(w.ep)return;w.ep=!0;const O=_(w);fetch(w.href,O)}})();var it={exports:{}},Ct;function rs(){return Ct||(Ct=1,function(u,h){(function(_,b){u.exports=b()})(globalThis,()=>(()=>{var _={4567:function(x,i,n){var c=this&&this.__decorate||function(e,t,a,m){var v,y=arguments.length,d=y<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,a):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,a,m);else for(var C=e.length-1;C>=0;C--)(v=e[C])&&(d=(y<3?v(d):y>3?v(t,a,d):v(t,a))||d);return y>3&&d&&Object.defineProperty(t,a,d),d},p=this&&this.__param||function(e,t){return function(a,m){t(a,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibilityManager=void 0;const o=n(9042),f=n(9924),g=n(844),S=n(4725),l=n(2585),s=n(3656);let r=i.AccessibilityManager=class extends g.Disposable{constructor(e,t,a,m){super(),this._terminal=e,this._coreBrowserService=a,this._renderService=m,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let v=0;v<this._terminal.rows;v++)this._rowElements[v]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[v]);if(this._topBoundaryFocusListener=v=>this._handleBoundaryFocus(v,0),this._bottomBoundaryFocusListener=v=>this._handleBoundaryFocus(v,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new f.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(v=>this._handleResize(v.rows))),this.register(this._terminal.onRender(v=>this._refreshRows(v.start,v.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(v=>this._handleChar(v))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(v=>this._handleTab(v))),this.register(this._terminal.onKey(v=>this._handleKey(v.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,s.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,g.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=o.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const a=this._terminal.buffer,m=a.lines.length.toString();for(let v=e;v<=t;v++){const y=a.lines.get(a.ydisp+v),d=[],C=(y==null?void 0:y.translateToString(!0,void 0,void 0,d))||"",D=(a.ydisp+v+1).toString(),T=this._rowElements[v];T&&(C.length===0?(T.innerText="Â ",this._rowColumns.set(T,[0,1])):(T.textContent=C,this._rowColumns.set(T,d)),T.setAttribute("aria-posinset",D),T.setAttribute("aria-setsize",m))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const a=e.target,m=this._rowElements[t===0?1:this._rowElements.length-2];if(a.getAttribute("aria-posinset")===(t===0?"1":`${this._terminal.buffer.lines.length}`)||e.relatedTarget!==m)return;let v,y;if(t===0?(v=a,y=this._rowElements.pop(),this._rowContainer.removeChild(y)):(v=this._rowElements.shift(),y=a,this._rowContainer.removeChild(v)),v.removeEventListener("focus",this._topBoundaryFocusListener),y.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){const d=this._createAccessibilityTreeNode();this._rowElements.unshift(d),this._rowContainer.insertAdjacentElement("afterbegin",d)}else{const d=this._createAccessibilityTreeNode();this._rowElements.push(d),this._rowContainer.appendChild(d)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var C;if(this._rowElements.length===0)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let t={node:e.anchorNode,offset:e.anchorOffset},a={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===a.node&&t.offset>a.offset)&&([t,a]=[a,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;const m=this._rowElements.slice(-1)[0];if(a.node.compareDocumentPosition(m)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(a={node:m,offset:((C=m.textContent)==null?void 0:C.length)??0}),!this._rowContainer.contains(a.node))return;const v=({node:D,offset:T})=>{const M=D instanceof Text?D.parentNode:D;let L=parseInt(M==null?void 0:M.getAttribute("aria-posinset"),10)-1;if(isNaN(L))return console.warn("row is invalid. Race condition?"),null;const H=this._rowColumns.get(M);if(!H)return console.warn("columns is null. Race condition?"),null;let $=T<H.length?H[T]:H.slice(-1)[0]+1;return $>=this._terminal.cols&&(++L,$=0),{row:L,column:$}},y=v(t),d=v(a);if(y&&d){if(y.row>d.row||y.row===d.row&&y.column>=d.column)throw new Error("invalid range");this._terminal.select(y.column,y.row,(d.row-y.row)*this._terminal.cols-y.column+d.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};i.AccessibilityManager=r=c([p(1,l.IInstantiationService),p(2,S.ICoreBrowserService),p(3,S.IRenderService)],r)},3614:(x,i)=>{function n(f){return f.replace(/\r?\n/g,"\r")}function c(f,g){return g?"\x1B[200~"+f+"\x1B[201~":f}function p(f,g,S,l){f=c(f=n(f),S.decPrivateModes.bracketedPasteMode&&l.rawOptions.ignoreBracketedPasteMode!==!0),S.triggerDataEvent(f,!0),g.value=""}function o(f,g,S){const l=S.getBoundingClientRect(),s=f.clientX-l.left-10,r=f.clientY-l.top-10;g.style.width="20px",g.style.height="20px",g.style.left=`${s}px`,g.style.top=`${r}px`,g.style.zIndex="1000",g.focus()}Object.defineProperty(i,"__esModule",{value:!0}),i.rightClickHandler=i.moveTextAreaUnderMouseCursor=i.paste=i.handlePasteEvent=i.copyHandler=i.bracketTextForPaste=i.prepareTextForTerminal=void 0,i.prepareTextForTerminal=n,i.bracketTextForPaste=c,i.copyHandler=function(f,g){f.clipboardData&&f.clipboardData.setData("text/plain",g.selectionText),f.preventDefault()},i.handlePasteEvent=function(f,g,S,l){f.stopPropagation(),f.clipboardData&&p(f.clipboardData.getData("text/plain"),g,S,l)},i.paste=p,i.moveTextAreaUnderMouseCursor=o,i.rightClickHandler=function(f,g,S,l,s){o(f,g,S),s&&l.rightClickSelect(f),g.value=l.selectionText,g.select()}},7239:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorContrastCache=void 0;const c=n(1505);i.ColorContrastCache=class{constructor(){this._color=new c.TwoKeyMap,this._css=new c.TwoKeyMap}setCss(p,o,f){this._css.set(p,o,f)}getCss(p,o){return this._css.get(p,o)}setColor(p,o,f){this._color.set(p,o,f)}getColor(p,o){return this._color.get(p,o)}clear(){this._color.clear(),this._css.clear()}}},3656:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(n,c,p,o){n.addEventListener(c,p,o);let f=!1;return{dispose:()=>{f||(f=!0,n.removeEventListener(c,p,o))}}}},3551:function(x,i,n){var c=this&&this.__decorate||function(r,e,t,a){var m,v=arguments.length,y=v<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,t):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(r,e,t,a);else for(var d=r.length-1;d>=0;d--)(m=r[d])&&(y=(v<3?m(y):v>3?m(e,t,y):m(e,t))||y);return v>3&&y&&Object.defineProperty(e,t,y),y},p=this&&this.__param||function(r,e){return function(t,a){e(t,a,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Linkifier=void 0;const o=n(3656),f=n(8460),g=n(844),S=n(2585),l=n(4725);let s=i.Linkifier=class extends g.Disposable{get currentLink(){return this._currentLink}constructor(r,e,t,a,m){super(),this._element=r,this._mouseService=e,this._renderService=t,this._bufferService=a,this._linkProviderService=m,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new f.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new f.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,g.toDisposable)(()=>{var v;this._lastMouseEvent=void 0,(v=this._activeProviderReplies)==null||v.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,o.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,o.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,o.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(r){this._lastMouseEvent=r;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;const t=r.composedPath();for(let a=0;a<t.length;a++){const m=t[a];if(m.classList.contains("xterm"))break;if(m.classList.contains("xterm-hover"))return}this._lastBufferCell&&e.x===this._lastBufferCell.x&&e.y===this._lastBufferCell.y||(this._handleHover(e),this._lastBufferCell=e)}_handleHover(r){if(this._activeLine!==r.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(r,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,r)||(this._clearCurrentLink(),this._askForLink(r,!0))}_askForLink(r,e){var a,m;this._activeProviderReplies&&e||((a=this._activeProviderReplies)==null||a.forEach(v=>{v==null||v.forEach(y=>{y.link.dispose&&y.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=r.y);let t=!1;for(const[v,y]of this._linkProviderService.linkProviders.entries())e?(m=this._activeProviderReplies)!=null&&m.get(v)&&(t=this._checkLinkProviderResult(v,r,t)):y.provideLinks(r.y,d=>{var D,T;if(this._isMouseOut)return;const C=d==null?void 0:d.map(M=>({link:M}));(D=this._activeProviderReplies)==null||D.set(v,C),t=this._checkLinkProviderResult(v,r,t),((T=this._activeProviderReplies)==null?void 0:T.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(r.y,this._activeProviderReplies)})}_removeIntersectingLinks(r,e){const t=new Set;for(let a=0;a<e.size;a++){const m=e.get(a);if(m)for(let v=0;v<m.length;v++){const y=m[v],d=y.link.range.start.y<r?0:y.link.range.start.x,C=y.link.range.end.y>r?this._bufferService.cols:y.link.range.end.x;for(let D=d;D<=C;D++){if(t.has(D)){m.splice(v--,1);break}t.add(D)}}}}_checkLinkProviderResult(r,e,t){var v;if(!this._activeProviderReplies)return t;const a=this._activeProviderReplies.get(r);let m=!1;for(let y=0;y<r;y++)this._activeProviderReplies.has(y)&&!this._activeProviderReplies.get(y)||(m=!0);if(!m&&a){const y=a.find(d=>this._linkAtPosition(d.link,e));y&&(t=!0,this._handleNewLink(y))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!t)for(let y=0;y<this._activeProviderReplies.size;y++){const d=(v=this._activeProviderReplies.get(y))==null?void 0:v.find(C=>this._linkAtPosition(C.link,e));if(d){t=!0,this._handleNewLink(d);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(r){if(!this._currentLink)return;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);e&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(r,this._currentLink.link.text)}_clearCurrentLink(r,e){this._currentLink&&this._lastMouseEvent&&(!r||!e||this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(r){if(!this._lastMouseEvent)return;const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(r.link,e)&&(this._currentLink=r,this._currentLink.state={decorations:{underline:r.link.decorations===void 0||r.link.decorations.underline,pointerCursor:r.link.decorations===void 0||r.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,r.link,this._lastMouseEvent),r.link.decorations={},Object.defineProperties(r.link.decorations,{pointerCursor:{get:()=>{var t,a;return(a=(t=this._currentLink)==null?void 0:t.state)==null?void 0:a.decorations.pointerCursor},set:t=>{var a;(a=this._currentLink)!=null&&a.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",t))}},underline:{get:()=>{var t,a;return(a=(t=this._currentLink)==null?void 0:t.state)==null?void 0:a.decorations.underline},set:t=>{var a,m,v;(a=this._currentLink)!=null&&a.state&&((v=(m=this._currentLink)==null?void 0:m.state)==null?void 0:v.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(r.link,t))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;const a=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,m=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=a&&this._currentLink.link.range.end.y<=m&&(this._clearCurrentLink(a,m),this._lastMouseEvent)){const v=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);v&&this._askForLink(v,!1)}})))}_linkHover(r,e,t){var a;(a=this._currentLink)!=null&&a.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&r.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(t,e.text)}_fireUnderlineEvent(r,e){const t=r.range,a=this._bufferService.buffer.ydisp,m=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-a-1,t.end.x,t.end.y-a-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(m)}_linkLeave(r,e,t){var a;(a=this._currentLink)!=null&&a.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&r.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(t,e.text)}_linkAtPosition(r,e){const t=r.range.start.y*this._bufferService.cols+r.range.start.x,a=r.range.end.y*this._bufferService.cols+r.range.end.x,m=e.y*this._bufferService.cols+e.x;return t<=m&&m<=a}_positionFromMouseEvent(r,e,t){const a=t.getCoords(r,e,this._bufferService.cols,this._bufferService.rows);if(a)return{x:a[0],y:a[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(r,e,t,a,m){return{x1:r,y1:e,x2:t,y2:a,cols:this._bufferService.cols,fg:m}}};i.Linkifier=s=c([p(1,l.IMouseService),p(2,l.IRenderService),p(3,S.IBufferService),p(4,l.ILinkProviderService)],s)},9042:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tooMuchOutput=i.promptLabel=void 0,i.promptLabel="Terminal input",i.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(x,i,n){var c=this&&this.__decorate||function(l,s,r,e){var t,a=arguments.length,m=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(l,s,r,e);else for(var v=l.length-1;v>=0;v--)(t=l[v])&&(m=(a<3?t(m):a>3?t(s,r,m):t(s,r))||m);return a>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkProvider=void 0;const o=n(511),f=n(2585);let g=i.OscLinkProvider=class{constructor(l,s,r){this._bufferService=l,this._optionsService=s,this._oscLinkService=r}provideLinks(l,s){var C;const r=this._bufferService.buffer.lines.get(l-1);if(!r)return void s(void 0);const e=[],t=this._optionsService.rawOptions.linkHandler,a=new o.CellData,m=r.getTrimmedLength();let v=-1,y=-1,d=!1;for(let D=0;D<m;D++)if(y!==-1||r.hasContent(D)){if(r.loadCell(D,a),a.hasExtendedAttrs()&&a.extended.urlId){if(y===-1){y=D,v=a.extended.urlId;continue}d=a.extended.urlId!==v}else y!==-1&&(d=!0);if(d||y!==-1&&D===m-1){const T=(C=this._oscLinkService.getLinkData(v))==null?void 0:C.uri;if(T){const M={start:{x:y+1,y:l},end:{x:D+(d||D!==m-1?0:1),y:l}};let L=!1;if(!(t!=null&&t.allowNonHttpProtocols))try{const H=new URL(T);["http:","https:"].includes(H.protocol)||(L=!0)}catch{L=!0}L||e.push({text:T,range:M,activate:(H,$)=>t?t.activate(H,$,M):S(0,$),hover:(H,$)=>{var U;return(U=t==null?void 0:t.hover)==null?void 0:U.call(t,H,$,M)},leave:(H,$)=>{var U;return(U=t==null?void 0:t.leave)==null?void 0:U.call(t,H,$,M)}})}d=!1,a.hasExtendedAttrs()&&a.extended.urlId?(y=D,v=a.extended.urlId):(y=-1,v=-1)}}s(e)}};function S(l,s){if(confirm(`Do you want to navigate to ${s}?

WARNING: This link could potentially be dangerous`)){const r=window.open();if(r){try{r.opener=null}catch{}r.location.href=s}else console.warn("Opening link blocked as opener could not be cleared")}}i.OscLinkProvider=g=c([p(0,f.IBufferService),p(1,f.IOptionsService),p(2,f.IOscLinkService)],g)},6193:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderDebouncer=void 0,i.RenderDebouncer=class{constructor(n,c){this._renderCallback=n,this._coreBrowserService=c,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(n){return this._refreshCallbacks.push(n),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(n,c,p){this._rowCount=p,n=n!==void 0?n:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const n=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,c),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const n of this._refreshCallbacks)n(0);this._refreshCallbacks=[]}}},3236:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Terminal=void 0;const c=n(3614),p=n(3656),o=n(3551),f=n(9042),g=n(3730),S=n(1680),l=n(3107),s=n(5744),r=n(2950),e=n(1296),t=n(428),a=n(4269),m=n(5114),v=n(8934),y=n(3230),d=n(9312),C=n(4725),D=n(6731),T=n(8055),M=n(8969),L=n(8460),H=n(844),$=n(6114),U=n(8437),K=n(2584),j=n(7399),k=n(5941),R=n(9074),A=n(2585),I=n(5435),W=n(4567),z=n(779);class J extends M.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(P={}){super(P),this.browser=$,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new H.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(A.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(z.LinkProviderService),this._instantiationService.setService(C.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(g.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((E,N)=>this.refresh(E,N))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(E=>this._reportWindowsOptions(E))),this.register(this._inputHandler.onColor(E=>this._handleColorEvent(E))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(E=>this._afterResize(E.cols,E.rows))),this.register((0,H.toDisposable)(()=>{var E,N;this._customKeyEventHandler=void 0,(N=(E=this.element)==null?void 0:E.parentNode)==null||N.removeChild(this.element)}))}_handleColorEvent(P){if(this._themeService)for(const E of P){let N,F="";switch(E.index){case 256:N="foreground",F="10";break;case 257:N="background",F="11";break;case 258:N="cursor",F="12";break;default:N="ansi",F="4;"+E.index}switch(E.type){case 0:const V=T.color.toColorRGB(N==="ansi"?this._themeService.colors.ansi[E.index]:this._themeService.colors[N]);this.coreService.triggerDataEvent(`${K.C0.ESC}]${F};${(0,k.toRgbString)(V)}${K.C1_ESCAPED.ST}`);break;case 1:if(N==="ansi")this._themeService.modifyColors(q=>q.ansi[E.index]=T.channels.toColor(...E.color));else{const q=N;this._themeService.modifyColors(ee=>ee[q]=T.channels.toColor(...E.color))}break;case 2:this._themeService.restoreColor(E.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(P){P?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(W.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(P){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(K.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var P;return(P=this.textarea)==null?void 0:P.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(K.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const P=this.buffer.ybase+this.buffer.y,E=this.buffer.lines.get(P);if(!E)return;const N=Math.min(this.buffer.x,this.cols-1),F=this._renderService.dimensions.css.cell.height,V=E.getWidth(N),q=this._renderService.dimensions.css.cell.width*V,ee=this.buffer.y*this._renderService.dimensions.css.cell.height,ie=N*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ie+"px",this.textarea.style.top=ee+"px",this.textarea.style.width=q+"px",this.textarea.style.height=F+"px",this.textarea.style.lineHeight=F+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,p.addDisposableDomListener)(this.element,"copy",E=>{this.hasSelection()&&(0,c.copyHandler)(E,this._selectionService)}));const P=E=>(0,c.handlePasteEvent)(E,this.textarea,this.coreService,this.optionsService);this.register((0,p.addDisposableDomListener)(this.textarea,"paste",P)),this.register((0,p.addDisposableDomListener)(this.element,"paste",P)),$.isFirefox?this.register((0,p.addDisposableDomListener)(this.element,"mousedown",E=>{E.button===2&&(0,c.rightClickHandler)(E,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,p.addDisposableDomListener)(this.element,"contextmenu",E=>{(0,c.rightClickHandler)(E,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),$.isLinux&&this.register((0,p.addDisposableDomListener)(this.element,"auxclick",E=>{E.button===1&&(0,c.moveTextAreaUnderMouseCursor)(E,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,p.addDisposableDomListener)(this.textarea,"keyup",P=>this._keyUp(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keydown",P=>this._keyDown(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keypress",P=>this._keyPress(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionupdate",P=>this._compositionHelper.compositionupdate(P))),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,p.addDisposableDomListener)(this.textarea,"input",P=>this._inputEvent(P),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(P){var N;if(!P)throw new Error("Terminal requires a parent element.");if(P.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((N=this.element)==null?void 0:N.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=P.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),P.appendChild(this.element);const E=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),E.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,p.addDisposableDomListener)(this.screenElement,"mousemove",F=>this.updateCursorStyle(F))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),E.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",f.promptLabel),$.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,P.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(C.ICoreBrowserService,this._coreBrowserService),this.register((0,p.addDisposableDomListener)(this.textarea,"focus",F=>this._handleTextAreaFocus(F))),this.register((0,p.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(t.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(C.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(D.ThemeService),this._instantiationService.setService(C.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(a.CharacterJoinerService),this._instantiationService.setService(C.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(y.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(C.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(F=>this._onRender.fire(F))),this.onResize(F=>this._renderService.resize(F.cols,F.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(v.MouseService),this._instantiationService.setService(C.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(o.Linkifier,this.screenElement)),this.element.appendChild(E);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(S.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(d.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(C.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(F=>this._renderService.handleSelectionChanged(F.start,F.end,F.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(F=>{this.textarea.value=F,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(F=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,p.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(l.BufferDecorationRenderer,this.screenElement)),this.register((0,p.addDisposableDomListener)(this.element,"mousedown",F=>this._selectionService.handleMouseDown(F))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(W.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",F=>this._handleScreenReaderModeOptionChange(F))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",F=>{!this._overviewRulerRenderer&&F&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(e.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const P=this,E=this.element;function N(q){const ee=P._mouseService.getMouseReportCoords(q,P.screenElement);if(!ee)return!1;let ie,re;switch(q.overrideType||q.type){case"mousemove":re=32,q.buttons===void 0?(ie=3,q.button!==void 0&&(ie=q.button<3?q.button:3)):ie=1&q.buttons?0:4&q.buttons?1:2&q.buttons?2:3;break;case"mouseup":re=0,ie=q.button<3?q.button:3;break;case"mousedown":re=1,ie=q.button<3?q.button:3;break;case"wheel":if(P._customWheelEventHandler&&P._customWheelEventHandler(q)===!1||P.viewport.getLinesScrolled(q)===0)return!1;re=q.deltaY<0?0:1,ie=4;break;default:return!1}return!(re===void 0||ie===void 0||ie>4)&&P.coreMouseService.triggerMouseEvent({col:ee.col,row:ee.row,x:ee.x,y:ee.y,button:ie,action:re,ctrl:q.ctrlKey,alt:q.altKey,shift:q.shiftKey})}const F={mouseup:null,wheel:null,mousedrag:null,mousemove:null},V={mouseup:q=>(N(q),q.buttons||(this._document.removeEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.removeEventListener("mousemove",F.mousedrag)),this.cancel(q)),wheel:q=>(N(q),this.cancel(q,!0)),mousedrag:q=>{q.buttons&&N(q)},mousemove:q=>{q.buttons||N(q)}};this.register(this.coreMouseService.onProtocolChange(q=>{q?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(q)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&q?F.mousemove||(E.addEventListener("mousemove",V.mousemove),F.mousemove=V.mousemove):(E.removeEventListener("mousemove",F.mousemove),F.mousemove=null),16&q?F.wheel||(E.addEventListener("wheel",V.wheel,{passive:!1}),F.wheel=V.wheel):(E.removeEventListener("wheel",F.wheel),F.wheel=null),2&q?F.mouseup||(F.mouseup=V.mouseup):(this._document.removeEventListener("mouseup",F.mouseup),F.mouseup=null),4&q?F.mousedrag||(F.mousedrag=V.mousedrag):(this._document.removeEventListener("mousemove",F.mousedrag),F.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,p.addDisposableDomListener)(E,"mousedown",q=>{if(q.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(q))return N(q),F.mouseup&&this._document.addEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.addEventListener("mousemove",F.mousedrag),this.cancel(q)})),this.register((0,p.addDisposableDomListener)(E,"wheel",q=>{if(!F.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(q)===!1)return!1;if(!this.buffer.hasScrollback){const ee=this.viewport.getLinesScrolled(q);if(ee===0)return;const ie=K.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(q.deltaY<0?"A":"B");let re="";for(let le=0;le<Math.abs(ee);le++)re+=ie;return this.coreService.triggerDataEvent(re,!0),this.cancel(q,!0)}return this.viewport.handleWheel(q)?this.cancel(q):void 0}},{passive:!1})),this.register((0,p.addDisposableDomListener)(E,"touchstart",q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(q),this.cancel(q)},{passive:!0})),this.register((0,p.addDisposableDomListener)(E,"touchmove",q=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(q)?void 0:this.cancel(q)},{passive:!1}))}refresh(P,E){var N;(N=this._renderService)==null||N.refreshRows(P,E)}updateCursorStyle(P){var E;(E=this._selectionService)!=null&&E.shouldColumnSelect(P)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(P,E,N=0){var F;N===1?(super.scrollLines(P,E,N),this.refresh(0,this.rows-1)):(F=this.viewport)==null||F.scrollLines(P)}paste(P){(0,c.paste)(P,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(P){this._customKeyEventHandler=P}attachCustomWheelEventHandler(P){this._customWheelEventHandler=P}registerLinkProvider(P){return this._linkProviderService.registerLinkProvider(P)}registerCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const E=this._characterJoinerService.register(P);return this.refresh(0,this.rows-1),E}deregisterCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(P)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(P){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+P)}registerDecoration(P){return this._decorationService.registerDecoration(P)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(P,E,N){this._selectionService.setSelection(P,E,N)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var P;(P=this._selectionService)==null||P.clearSelection()}selectAll(){var P;(P=this._selectionService)==null||P.selectAll()}selectLines(P,E){var N;(N=this._selectionService)==null||N.selectLines(P,E)}_keyDown(P){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;const E=this.browser.isMac&&this.options.macOptionIsMeta&&P.altKey;if(!E&&!this._compositionHelper.keydown(P))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;E||P.key!=="Dead"&&P.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const N=(0,j.evaluateKeyboardEvent)(P,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(P),N.type===3||N.type===2){const F=this.rows-1;return this.scrollLines(N.type===2?-F:F),this.cancel(P,!0)}return N.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,P)||(N.cancel&&this.cancel(P,!0),!N.key||!!(P.key&&!P.ctrlKey&&!P.altKey&&!P.metaKey&&P.key.length===1&&P.key.charCodeAt(0)>=65&&P.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(N.key!==K.C0.ETX&&N.key!==K.C0.CR||(this.textarea.value=""),this._onKey.fire({key:N.key,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(N.key,!0),!this.optionsService.rawOptions.screenReaderMode||P.altKey||P.ctrlKey?this.cancel(P,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(P,E){const N=P.isMac&&!this.options.macOptionIsMeta&&E.altKey&&!E.ctrlKey&&!E.metaKey||P.isWindows&&E.altKey&&E.ctrlKey&&!E.metaKey||P.isWindows&&E.getModifierState("AltGraph");return E.type==="keypress"?N:N&&(!E.keyCode||E.keyCode>47)}_keyUp(P){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1||(function(E){return E.keyCode===16||E.keyCode===17||E.keyCode===18}(P)||this.focus(),this.updateCursorStyle(P),this._keyPressHandled=!1)}_keyPress(P){let E;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;if(this.cancel(P),P.charCode)E=P.charCode;else if(P.which===null||P.which===void 0)E=P.keyCode;else{if(P.which===0||P.charCode===0)return!1;E=P.which}return!(!E||(P.altKey||P.ctrlKey||P.metaKey)&&!this._isThirdLevelShift(this.browser,P)||(E=String.fromCharCode(E),this._onKey.fire({key:E,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(E,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(P){if(P.data&&P.inputType==="insertText"&&(!P.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const E=P.data;return this.coreService.triggerDataEvent(E,!0),this.cancel(P),!0}return!1}resize(P,E){P!==this.cols||E!==this.rows?super.resize(P,E):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(P,E){var N,F;(N=this._charSizeService)==null||N.measure(),(F=this.viewport)==null||F.syncScrollArea(!0)}clear(){var P;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let E=1;E<this.rows;E++)this.buffer.lines.push(this.buffer.getBlankLine(U.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(P=this.viewport)==null||P.reset(),this.refresh(0,this.rows-1)}}reset(){var E,N;this.options.rows=this.rows,this.options.cols=this.cols;const P=this._customKeyEventHandler;this._setup(),super.reset(),(E=this._selectionService)==null||E.reset(),this._decorationService.reset(),(N=this.viewport)==null||N.reset(),this._customKeyEventHandler=P,this.refresh(0,this.rows-1)}clearTextureAtlas(){var P;(P=this._renderService)==null||P.clearTextureAtlas()}_reportFocus(){var P;(P=this.element)!=null&&P.classList.contains("focus")?this.coreService.triggerDataEvent(K.C0.ESC+"[I"):this.coreService.triggerDataEvent(K.C0.ESC+"[O")}_reportWindowsOptions(P){if(this._renderService)switch(P){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const E=this._renderService.dimensions.css.canvas.width.toFixed(0),N=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${K.C0.ESC}[4;${N};${E}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const F=this._renderService.dimensions.css.cell.width.toFixed(0),V=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${K.C0.ESC}[6;${V};${F}t`)}}cancel(P,E){if(this.options.cancelEvents||E)return P.preventDefault(),P.stopPropagation(),!1}}i.Terminal=J},9924:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TimeBasedDebouncer=void 0,i.TimeBasedDebouncer=class{constructor(n,c=1e3){this._renderCallback=n,this._debounceThresholdMS=c,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(n,c,p){this._rowCount=p,n=n!==void 0?n:0,c=c!==void 0?c:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,n):n,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,c):c;const o=Date.now();if(o-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=o,this._innerRefresh();else if(!this._additionalRefreshRequested){const f=o-this._lastRefreshMs,g=this._debounceThresholdMS-f;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},g)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const n=Math.max(this._rowStart,0),c=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(n,c)}}},1680:function(x,i,n){var c=this&&this.__decorate||function(r,e,t,a){var m,v=arguments.length,y=v<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,t):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(r,e,t,a);else for(var d=r.length-1;d>=0;d--)(m=r[d])&&(y=(v<3?m(y):v>3?m(e,t,y):m(e,t))||y);return v>3&&y&&Object.defineProperty(e,t,y),y},p=this&&this.__param||function(r,e){return function(t,a){e(t,a,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Viewport=void 0;const o=n(3656),f=n(4725),g=n(8460),S=n(844),l=n(2585);let s=i.Viewport=class extends S.Disposable{constructor(r,e,t,a,m,v,y,d){super(),this._viewportElement=r,this._scrollArea=e,this._bufferService=t,this._optionsService=a,this._charSizeService=m,this._renderService=v,this._coreBrowserService=y,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new g.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,o.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(C=>this._activeBuffer=C.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(C=>this._renderDimensions=C)),this._handleThemeChange(d.colors),this.register(d.onChangeColors(C=>this._handleThemeChange(C))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(r){this._viewportElement.style.backgroundColor=r.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(r){if(r)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const r=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==r&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=r),this._refreshAnimationFrame=null}syncScrollArea(r=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(r);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(r)}_handleScroll(r){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const r=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(r*(this._smoothScrollState.target-this._smoothScrollState.origin)),r<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(r,e){const t=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&this._viewportElement.scrollTop!==0||e>0&&t<this._lastRecordedBufferHeight)||(r.cancelable&&r.preventDefault(),!1)}handleWheel(r){const e=this._getPixelsScrolled(r);return e!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+e:this._smoothScrollState.target+=e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}scrollLines(r){if(r!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const e=r*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:r,suppressScrollEvent:!1})}_getPixelsScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e}getBufferElements(r,e){var d;let t,a="";const m=[],v=e??this._bufferService.buffer.lines.length,y=this._bufferService.buffer.lines;for(let C=r;C<v;C++){const D=y.get(C);if(!D)continue;const T=(d=y.get(C+1))==null?void 0:d.isWrapped;if(a+=D.translateToString(!T),!T||C===y.length-1){const M=document.createElement("div");M.textContent=a,m.push(M),a.length>0&&(t=M),a=""}}return{bufferElements:m,cursorElement:t}}getLinesScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e}_applyScrollModifier(r,e){const t=this._optionsService.rawOptions.fastScrollModifier;return t==="alt"&&e.altKey||t==="ctrl"&&e.ctrlKey||t==="shift"&&e.shiftKey?r*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:r*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(r){this._lastTouchY=r.touches[0].pageY}handleTouchMove(r){const e=this._lastTouchY-r.touches[0].pageY;return this._lastTouchY=r.touches[0].pageY,e!==0&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}};i.Viewport=s=c([p(2,l.IBufferService),p(3,l.IOptionsService),p(4,f.ICharSizeService),p(5,f.IRenderService),p(6,f.ICoreBrowserService),p(7,f.IThemeService)],s)},3107:function(x,i,n){var c=this&&this.__decorate||function(l,s,r,e){var t,a=arguments.length,m=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(l,s,r,e);else for(var v=l.length-1;v>=0;v--)(t=l[v])&&(m=(a<3?t(m):a>3?t(s,r,m):t(s,r))||m);return a>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferDecorationRenderer=void 0;const o=n(4725),f=n(844),g=n(2585);let S=i.BufferDecorationRenderer=class extends f.Disposable{constructor(l,s,r,e,t){super(),this._screenElement=l,this._bufferService=s,this._coreBrowserService=r,this._decorationService=e,this._renderService=t,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(a=>this._removeDecoration(a))),this.register((0,f.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const l of this._decorationService.decorations)this._renderDecoration(l);this._dimensionsChanged=!1}_renderDecoration(l){this._refreshStyle(l),this._dimensionsChanged&&this._refreshXPosition(l)}_createElement(l){var e;const s=this._coreBrowserService.mainDocument.createElement("div");s.classList.add("xterm-decoration"),s.classList.toggle("xterm-decoration-top-layer",((e=l==null?void 0:l.options)==null?void 0:e.layer)==="top"),s.style.width=`${Math.round((l.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=(l.options.height||1)*this._renderService.dimensions.css.cell.height+"px",s.style.top=(l.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const r=l.options.x??0;return r&&r>this._bufferService.cols&&(s.style.display="none"),this._refreshXPosition(l,s),s}_refreshStyle(l){const s=l.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)l.element&&(l.element.style.display="none",l.onRenderEmitter.fire(l.element));else{let r=this._decorationElements.get(l);r||(r=this._createElement(l),l.element=r,this._decorationElements.set(l,r),this._container.appendChild(r),l.onDispose(()=>{this._decorationElements.delete(l),r.remove()})),r.style.top=s*this._renderService.dimensions.css.cell.height+"px",r.style.display=this._altBufferIsActive?"none":"block",l.onRenderEmitter.fire(r)}}_refreshXPosition(l,s=l.element){if(!s)return;const r=l.options.x??0;(l.options.anchor||"left")==="right"?s.style.right=r?r*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=r?r*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(l){var s;(s=this._decorationElements.get(l))==null||s.remove(),this._decorationElements.delete(l),l.dispose()}};i.BufferDecorationRenderer=S=c([p(1,g.IBufferService),p(2,o.ICoreBrowserService),p(3,g.IDecorationService),p(4,o.IRenderService)],S)},5871:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorZoneStore=void 0,i.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(n){if(n.options.overviewRulerOptions){for(const c of this._zones)if(c.color===n.options.overviewRulerOptions.color&&c.position===n.options.overviewRulerOptions.position){if(this._lineIntersectsZone(c,n.marker.line))return;if(this._lineAdjacentToZone(c,n.marker.line,n.options.overviewRulerOptions.position))return void this._addLineToZone(c,n.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=n.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=n.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=n.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=n.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:n.options.overviewRulerOptions.color,position:n.options.overviewRulerOptions.position,startBufferLine:n.marker.line,endBufferLine:n.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(n){this._linePadding=n}_lineIntersectsZone(n,c){return c>=n.startBufferLine&&c<=n.endBufferLine}_lineAdjacentToZone(n,c,p){return c>=n.startBufferLine-this._linePadding[p||"full"]&&c<=n.endBufferLine+this._linePadding[p||"full"]}_addLineToZone(n,c){n.startBufferLine=Math.min(n.startBufferLine,c),n.endBufferLine=Math.max(n.endBufferLine,c)}}},5744:function(x,i,n){var c=this&&this.__decorate||function(t,a,m,v){var y,d=arguments.length,C=d<3?a:v===null?v=Object.getOwnPropertyDescriptor(a,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(t,a,m,v);else for(var D=t.length-1;D>=0;D--)(y=t[D])&&(C=(d<3?y(C):d>3?y(a,m,C):y(a,m))||C);return d>3&&C&&Object.defineProperty(a,m,C),C},p=this&&this.__param||function(t,a){return function(m,v){a(m,v,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OverviewRulerRenderer=void 0;const o=n(5871),f=n(4725),g=n(844),S=n(2585),l={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},r={full:0,left:0,center:0,right:0};let e=i.OverviewRulerRenderer=class extends g.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(t,a,m,v,y,d,C){var T;super(),this._viewportElement=t,this._screenElement=a,this._bufferService=m,this._decorationService=v,this._renderService=y,this._optionsService=d,this._coreBrowserService=C,this._colorZoneStore=new o.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(T=this._viewportElement.parentElement)==null||T.insertBefore(this._canvas,this._viewportElement);const D=this._canvas.getContext("2d");if(!D)throw new Error("Ctx cannot be null");this._ctx=D,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,g.toDisposable)(()=>{var M;(M=this._canvas)==null||M.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const t=Math.floor(this._canvas.width/3),a=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=t,s.center=a,s.right=t,this._refreshDrawHeightConstants(),r.full=0,r.left=0,r.center=s.left,r.right=s.left+s.center}_refreshDrawHeightConstants(){l.full=Math.round(2*this._coreBrowserService.dpr);const t=this._canvas.height/this._bufferService.buffer.lines.length,a=Math.round(Math.max(Math.min(t,12),6)*this._coreBrowserService.dpr);l.left=a,l.center=a,l.right=a}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*l.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const a of this._decorationService.decorations)this._colorZoneStore.addDecoration(a);this._ctx.lineWidth=1;const t=this._colorZoneStore.zones;for(const a of t)a.position!=="full"&&this._renderColorZone(a);for(const a of t)a.position==="full"&&this._renderColorZone(a);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(t){this._ctx.fillStyle=t.color,this._ctx.fillRect(r[t.position||"full"],Math.round((this._canvas.height-1)*(t.startBufferLine/this._bufferService.buffers.active.lines.length)-l[t.position||"full"]/2),s[t.position||"full"],Math.round((this._canvas.height-1)*((t.endBufferLine-t.startBufferLine)/this._bufferService.buffers.active.lines.length)+l[t.position||"full"]))}_queueRefresh(t,a){this._shouldUpdateDimensions=t||this._shouldUpdateDimensions,this._shouldUpdateAnchor=a||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};i.OverviewRulerRenderer=e=c([p(2,S.IBufferService),p(3,S.IDecorationService),p(4,f.IRenderService),p(5,S.IOptionsService),p(6,f.ICoreBrowserService)],e)},2950:function(x,i,n){var c=this&&this.__decorate||function(l,s,r,e){var t,a=arguments.length,m=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(l,s,r,e);else for(var v=l.length-1;v>=0;v--)(t=l[v])&&(m=(a<3?t(m):a>3?t(s,r,m):t(s,r))||m);return a>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(l,s){return function(r,e){s(r,e,l)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CompositionHelper=void 0;const o=n(4725),f=n(2585),g=n(2584);let S=i.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(l,s,r,e,t,a){this._textarea=l,this._compositionView=s,this._bufferService=r,this._optionsService=e,this._coreService=t,this._renderService=a,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(l){this._compositionView.textContent=l.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(l){if(this._isComposing||this._isSendingComposition){if(l.keyCode===229||l.keyCode===16||l.keyCode===17||l.keyCode===18)return!1;this._finalizeComposition(!1)}return l.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(l){if(this._compositionView.classList.remove("active"),this._isComposing=!1,l){const s={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let r;this._isSendingComposition=!1,s.start+=this._dataAlreadySent.length,r=this._isComposing?this._textarea.value.substring(s.start,s.end):this._textarea.value.substring(s.start),r.length>0&&this._coreService.triggerDataEvent(r,!0)}},0)}else{this._isSendingComposition=!1;const s=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(s,!0)}}_handleAnyTextareaChanges(){const l=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const s=this._textarea.value,r=s.replace(l,"");this._dataAlreadySent=r,s.length>l.length?this._coreService.triggerDataEvent(r,!0):s.length<l.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):s.length===l.length&&s!==l&&this._coreService.triggerDataEvent(s,!0)}},0)}updateCompositionElements(l){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const s=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),r=this._renderService.dimensions.css.cell.height,e=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,t=s*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=t+"px",this._compositionView.style.top=e+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const a=this._compositionView.getBoundingClientRect();this._textarea.style.left=t+"px",this._textarea.style.top=e+"px",this._textarea.style.width=Math.max(a.width,1)+"px",this._textarea.style.height=Math.max(a.height,1)+"px",this._textarea.style.lineHeight=a.height+"px"}l||setTimeout(()=>this.updateCompositionElements(!0),0)}}};i.CompositionHelper=S=c([p(2,f.IBufferService),p(3,f.IOptionsService),p(4,f.ICoreService),p(5,o.IRenderService)],S)},9806:(x,i)=>{function n(c,p,o){const f=o.getBoundingClientRect(),g=c.getComputedStyle(o),S=parseInt(g.getPropertyValue("padding-left")),l=parseInt(g.getPropertyValue("padding-top"));return[p.clientX-f.left-S,p.clientY-f.top-l]}Object.defineProperty(i,"__esModule",{value:!0}),i.getCoords=i.getCoordsRelativeToElement=void 0,i.getCoordsRelativeToElement=n,i.getCoords=function(c,p,o,f,g,S,l,s,r){if(!S)return;const e=n(c,p,o);return e?(e[0]=Math.ceil((e[0]+(r?l/2:0))/l),e[1]=Math.ceil(e[1]/s),e[0]=Math.min(Math.max(e[0],1),f+(r?1:0)),e[1]=Math.min(Math.max(e[1],1),g),e):void 0}},9504:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.moveToCellSequence=void 0;const c=n(2584);function p(s,r,e,t){const a=s-o(s,e),m=r-o(r,e),v=Math.abs(a-m)-function(y,d,C){let D=0;const T=y-o(y,C),M=d-o(d,C);for(let L=0;L<Math.abs(T-M);L++){const H=f(y,d)==="A"?-1:1,$=C.buffer.lines.get(T+H*L);$!=null&&$.isWrapped&&D++}return D}(s,r,e);return l(v,S(f(s,r),t))}function o(s,r){let e=0,t=r.buffer.lines.get(s),a=t==null?void 0:t.isWrapped;for(;a&&s>=0&&s<r.rows;)e++,t=r.buffer.lines.get(--s),a=t==null?void 0:t.isWrapped;return e}function f(s,r){return s>r?"A":"B"}function g(s,r,e,t,a,m){let v=s,y=r,d="";for(;v!==e||y!==t;)v+=a?1:-1,a&&v>m.cols-1?(d+=m.buffer.translateBufferLineToString(y,!1,s,v),v=0,s=0,y++):!a&&v<0&&(d+=m.buffer.translateBufferLineToString(y,!1,0,s+1),v=m.cols-1,s=v,y--);return d+m.buffer.translateBufferLineToString(y,!1,s,v)}function S(s,r){const e=r?"O":"[";return c.C0.ESC+e+s}function l(s,r){s=Math.floor(s);let e="";for(let t=0;t<s;t++)e+=r;return e}i.moveToCellSequence=function(s,r,e,t){const a=e.buffer.x,m=e.buffer.y;if(!e.buffer.hasScrollback)return function(d,C,D,T,M,L){return p(C,T,M,L).length===0?"":l(g(d,C,d,C-o(C,M),!1,M).length,S("D",L))}(a,m,0,r,e,t)+p(m,r,e,t)+function(d,C,D,T,M,L){let H;H=p(C,T,M,L).length>0?T-o(T,M):C;const $=T,U=function(K,j,k,R,A,I){let W;return W=p(k,R,A,I).length>0?R-o(R,A):j,K<k&&W<=R||K>=k&&W<R?"C":"D"}(d,C,D,T,M,L);return l(g(d,H,D,$,U==="C",M).length,S(U,L))}(a,m,s,r,e,t);let v;if(m===r)return v=a>s?"D":"C",l(Math.abs(a-s),S(v,t));v=m>r?"D":"C";const y=Math.abs(m-r);return l(function(d,C){return C.cols-d}(m>r?s:a,e)+(y-1)*e.cols+1+((m>r?a:s)-1),S(v,t))}},1296:function(x,i,n){var c=this&&this.__decorate||function(L,H,$,U){var K,j=arguments.length,k=j<3?H:U===null?U=Object.getOwnPropertyDescriptor(H,$):U;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(L,H,$,U);else for(var R=L.length-1;R>=0;R--)(K=L[R])&&(k=(j<3?K(k):j>3?K(H,$,k):K(H,$))||k);return j>3&&k&&Object.defineProperty(H,$,k),k},p=this&&this.__param||function(L,H){return function($,U){H($,U,L)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRenderer=void 0;const o=n(3787),f=n(2550),g=n(2223),S=n(6171),l=n(6052),s=n(4725),r=n(8055),e=n(8460),t=n(844),a=n(2585),m="xterm-dom-renderer-owner-",v="xterm-rows",y="xterm-fg-",d="xterm-bg-",C="xterm-focus",D="xterm-selection";let T=1,M=i.DomRenderer=class extends t.Disposable{constructor(L,H,$,U,K,j,k,R,A,I,W,z,J){super(),this._terminal=L,this._document=H,this._element=$,this._screenElement=U,this._viewportElement=K,this._helperContainer=j,this._linkifier2=k,this._charSizeService=A,this._optionsService=I,this._bufferService=W,this._coreBrowserService=z,this._themeService=J,this._terminalClass=T++,this._rowElements=[],this._selectionRenderModel=(0,l.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new e.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(v),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(D),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,S.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(Y=>this._injectCss(Y))),this._injectCss(this._themeService.colors),this._rowFactory=R.createInstance(o.DomRendererRowFactory,document),this._element.classList.add(m+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(Y=>this._handleLinkHover(Y))),this.register(this._linkifier2.onHideLinkUnderline(Y=>this._handleLinkLeave(Y))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(m+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new f.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const $ of this._rowElements)$.style.width=`${this.dimensions.css.canvas.width}px`,$.style.height=`${this.dimensions.css.cell.height}px`,$.style.lineHeight=`${this.dimensions.css.cell.height}px`,$.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const H=`${this._terminalSelector} .${v} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=H,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let H=`${this._terminalSelector} .${v} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;H+=`${this._terminalSelector} .${v} .xterm-dim { color: ${r.color.multiplyOpacity(L.foreground,.5).css};}`,H+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const $=`blink_underline_${this._terminalClass}`,U=`blink_bar_${this._terminalClass}`,K=`blink_block_${this._terminalClass}`;H+=`@keyframes ${$} { 50% {  border-bottom-style: hidden; }}`,H+=`@keyframes ${U} { 50% {  box-shadow: none; }}`,H+=`@keyframes ${K} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,H+=`${this._terminalSelector} .${v}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${v}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${U} 1s step-end infinite;}${this._terminalSelector} .${v}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${K} 1s step-end infinite;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,H+=`${this._terminalSelector} .${D} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${D} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${D} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[j,k]of L.ansi.entries())H+=`${this._terminalSelector} .${y}${j} { color: ${k.css}; }${this._terminalSelector} .${y}${j}.xterm-dim { color: ${r.color.multiplyOpacity(k,.5).css}; }${this._terminalSelector} .${d}${j} { background-color: ${k.css}; }`;H+=`${this._terminalSelector} .${y}${g.INVERTED_DEFAULT_COLOR} { color: ${r.color.opaque(L.background).css}; }${this._terminalSelector} .${y}${g.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${r.color.multiplyOpacity(r.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${d}${g.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=H}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,H){for(let $=this._rowElements.length;$<=H;$++){const U=this._document.createElement("div");this._rowContainer.appendChild(U),this._rowElements.push(U)}for(;this._rowElements.length>H;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,H){this._refreshRowElements(L,H),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(C),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(C),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,H,$){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,H,$),this.renderRows(0,this._bufferService.rows-1),!L||!H)return;this._selectionRenderModel.update(this._terminal,L,H,$);const U=this._selectionRenderModel.viewportStartRow,K=this._selectionRenderModel.viewportEndRow,j=this._selectionRenderModel.viewportCappedStartRow,k=this._selectionRenderModel.viewportCappedEndRow;if(j>=this._bufferService.rows||k<0)return;const R=this._document.createDocumentFragment();if($){const A=L[0]>H[0];R.appendChild(this._createSelectionElement(j,A?H[0]:L[0],A?L[0]:H[0],k-j+1))}else{const A=U===j?L[0]:0,I=j===K?H[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(j,A,I));const W=k-j-1;if(R.appendChild(this._createSelectionElement(j+1,0,this._bufferService.cols,W)),j!==k){const z=K===k?H[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(k,0,z))}}this._selectionContainer.appendChild(R)}_createSelectionElement(L,H,$,U=1){const K=this._document.createElement("div"),j=H*this.dimensions.css.cell.width;let k=this.dimensions.css.cell.width*($-H);return j+k>this.dimensions.css.canvas.width&&(k=this.dimensions.css.canvas.width-j),K.style.height=U*this.dimensions.css.cell.height+"px",K.style.top=L*this.dimensions.css.cell.height+"px",K.style.left=`${j}px`,K.style.width=`${k}px`,K}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,H){const $=this._bufferService.buffer,U=$.ybase+$.y,K=Math.min($.x,this._bufferService.cols-1),j=this._optionsService.rawOptions.cursorBlink,k=this._optionsService.rawOptions.cursorStyle,R=this._optionsService.rawOptions.cursorInactiveStyle;for(let A=L;A<=H;A++){const I=A+$.ydisp,W=this._rowElements[A],z=$.lines.get(I);if(!W||!z)break;W.replaceChildren(...this._rowFactory.createRow(z,I,I===U,k,R,K,j,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${m}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,H,$,U,K,j){$<0&&(L=0),U<0&&(H=0);const k=this._bufferService.rows-1;$=Math.max(Math.min($,k),0),U=Math.max(Math.min(U,k),0),K=Math.min(K,this._bufferService.cols);const R=this._bufferService.buffer,A=R.ybase+R.y,I=Math.min(R.x,K-1),W=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,J=this._optionsService.rawOptions.cursorInactiveStyle;for(let Y=$;Y<=U;++Y){const P=Y+R.ydisp,E=this._rowElements[Y],N=R.lines.get(P);if(!E||!N)break;E.replaceChildren(...this._rowFactory.createRow(N,P,P===A,z,J,I,W,this.dimensions.css.cell.width,this._widthCache,j?Y===$?L:0:-1,j?(Y===U?H:K)-1:-1))}}};i.DomRenderer=M=c([p(7,a.IInstantiationService),p(8,s.ICharSizeService),p(9,a.IOptionsService),p(10,a.IBufferService),p(11,s.ICoreBrowserService),p(12,s.IThemeService)],M)},3787:function(x,i,n){var c=this&&this.__decorate||function(v,y,d,C){var D,T=arguments.length,M=T<3?y:C===null?C=Object.getOwnPropertyDescriptor(y,d):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,y,d,C);else for(var L=v.length-1;L>=0;L--)(D=v[L])&&(M=(T<3?D(M):T>3?D(y,d,M):D(y,d))||M);return T>3&&M&&Object.defineProperty(y,d,M),M},p=this&&this.__param||function(v,y){return function(d,C){y(d,C,v)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRendererRowFactory=void 0;const o=n(2223),f=n(643),g=n(511),S=n(2585),l=n(8055),s=n(4725),r=n(4269),e=n(6171),t=n(3734);let a=i.DomRendererRowFactory=class{constructor(v,y,d,C,D,T,M){this._document=v,this._characterJoinerService=y,this._optionsService=d,this._coreBrowserService=C,this._coreService=D,this._decorationService=T,this._themeService=M,this._workCell=new g.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(v,y,d){this._selectionStart=v,this._selectionEnd=y,this._columnSelectMode=d}createRow(v,y,d,C,D,T,M,L,H,$,U){const K=[],j=this._characterJoinerService.getJoinedCharacters(y),k=this._themeService.colors;let R,A=v.getNoBgTrimmedLength();d&&A<T+1&&(A=T+1);let I=0,W="",z=0,J=0,Y=0,P=!1,E=0,N=!1,F=0;const V=[],q=$!==-1&&U!==-1;for(let ee=0;ee<A;ee++){v.loadCell(ee,this._workCell);let ie=this._workCell.getWidth();if(ie===0)continue;let re=!1,le=ee,Z=this._workCell;if(j.length>0&&ee===j[0][0]){re=!0;const se=j.shift();Z=new r.JoinedCellData(this._workCell,v.translateToString(!0,se[0],se[1]),se[1]-se[0]),le=se[1]-1,ie=Z.getWidth()}const Oe=this._isCellInSelection(ee,y),Qe=d&&ee===T,et=q&&ee>=$&&ee<=U;let tt=!1;this._decorationService.forEachDecorationAtCell(ee,y,void 0,se=>{tt=!0});let We=Z.getChars()||f.WHITESPACE_CELL_CHAR;if(We===" "&&(Z.isUnderline()||Z.isOverline())&&(We="Â "),F=ie*L-H.get(We,Z.isBold(),Z.isItalic()),R){if(I&&(Oe&&N||!Oe&&!N&&Z.bg===z)&&(Oe&&N&&k.selectionForeground||Z.fg===J)&&Z.extended.ext===Y&&et===P&&F===E&&!Qe&&!re&&!tt){Z.isInvisible()?W+=f.WHITESPACE_CELL_CHAR:W+=We,I++;continue}I&&(R.textContent=W),R=this._document.createElement("span"),I=0,W=""}else R=this._document.createElement("span");if(z=Z.bg,J=Z.fg,Y=Z.extended.ext,P=et,E=F,N=Oe,re&&T>=ee&&T<=le&&(T=ee),!this._coreService.isCursorHidden&&Qe&&this._coreService.isCursorInitialized){if(V.push("xterm-cursor"),this._coreBrowserService.isFocused)M&&V.push("xterm-cursor-blink"),V.push(C==="bar"?"xterm-cursor-bar":C==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(D)switch(D){case"outline":V.push("xterm-cursor-outline");break;case"block":V.push("xterm-cursor-block");break;case"bar":V.push("xterm-cursor-bar");break;case"underline":V.push("xterm-cursor-underline")}}if(Z.isBold()&&V.push("xterm-bold"),Z.isItalic()&&V.push("xterm-italic"),Z.isDim()&&V.push("xterm-dim"),W=Z.isInvisible()?f.WHITESPACE_CELL_CHAR:Z.getChars()||f.WHITESPACE_CELL_CHAR,Z.isUnderline()&&(V.push(`xterm-underline-${Z.extended.underlineStyle}`),W===" "&&(W="Â "),!Z.isUnderlineColorDefault()))if(Z.isUnderlineColorRGB())R.style.textDecorationColor=`rgb(${t.AttributeData.toColorRGB(Z.getUnderlineColor()).join(",")})`;else{let se=Z.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Z.isBold()&&se<8&&(se+=8),R.style.textDecorationColor=k.ansi[se].css}Z.isOverline()&&(V.push("xterm-overline"),W===" "&&(W="Â ")),Z.isStrikethrough()&&V.push("xterm-strikethrough"),et&&(R.style.textDecoration="underline");let _e=Z.getFgColor(),Me=Z.getFgColorMode(),ge=Z.getBgColor(),Ie=Z.getBgColorMode();const st=!!Z.isInverse();if(st){const se=_e;_e=ge,ge=se;const ts=Me;Me=Ie,Ie=ts}let we,Ne,ke,Pe=!1;switch(this._decorationService.forEachDecorationAtCell(ee,y,void 0,se=>{se.options.layer!=="top"&&Pe||(se.backgroundColorRGB&&(Ie=50331648,ge=se.backgroundColorRGB.rgba>>8&16777215,we=se.backgroundColorRGB),se.foregroundColorRGB&&(Me=50331648,_e=se.foregroundColorRGB.rgba>>8&16777215,Ne=se.foregroundColorRGB),Pe=se.options.layer==="top")}),!Pe&&Oe&&(we=this._coreBrowserService.isFocused?k.selectionBackgroundOpaque:k.selectionInactiveBackgroundOpaque,ge=we.rgba>>8&16777215,Ie=50331648,Pe=!0,k.selectionForeground&&(Me=50331648,_e=k.selectionForeground.rgba>>8&16777215,Ne=k.selectionForeground)),Pe&&V.push("xterm-decoration-top"),Ie){case 16777216:case 33554432:ke=k.ansi[ge],V.push(`xterm-bg-${ge}`);break;case 50331648:ke=l.channels.toColor(ge>>16,ge>>8&255,255&ge),this._addStyle(R,`background-color:#${m((ge>>>0).toString(16),"0",6)}`);break;default:st?(ke=k.foreground,V.push(`xterm-bg-${o.INVERTED_DEFAULT_COLOR}`)):ke=k.background}switch(we||Z.isDim()&&(we=l.color.multiplyOpacity(ke,.5)),Me){case 16777216:case 33554432:Z.isBold()&&_e<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(_e+=8),this._applyMinimumContrast(R,ke,k.ansi[_e],Z,we,void 0)||V.push(`xterm-fg-${_e}`);break;case 50331648:const se=l.channels.toColor(_e>>16&255,_e>>8&255,255&_e);this._applyMinimumContrast(R,ke,se,Z,we,Ne)||this._addStyle(R,`color:#${m(_e.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(R,ke,k.foreground,Z,we,Ne)||st&&V.push(`xterm-fg-${o.INVERTED_DEFAULT_COLOR}`)}V.length&&(R.className=V.join(" "),V.length=0),Qe||re||tt?R.textContent=W:I++,F!==this.defaultSpacing&&(R.style.letterSpacing=`${F}px`),K.push(R),ee=le}return R&&I&&(R.textContent=W),K}_applyMinimumContrast(v,y,d,C,D,T){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,e.treatGlyphAsBackgroundColor)(C.getCode()))return!1;const M=this._getContrastCache(C);let L;if(D||T||(L=M.getColor(y.rgba,d.rgba)),L===void 0){const H=this._optionsService.rawOptions.minimumContrastRatio/(C.isDim()?2:1);L=l.color.ensureContrastRatio(D||y,T||d,H),M.setColor((D||y).rgba,(T||d).rgba,L??null)}return!!L&&(this._addStyle(v,`color:${L.css}`),!0)}_getContrastCache(v){return v.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(v,y){v.setAttribute("style",`${v.getAttribute("style")||""}${y};`)}_isCellInSelection(v,y){const d=this._selectionStart,C=this._selectionEnd;return!(!d||!C)&&(this._columnSelectMode?d[0]<=C[0]?v>=d[0]&&y>=d[1]&&v<C[0]&&y<=C[1]:v<d[0]&&y>=d[1]&&v>=C[0]&&y<=C[1]:y>d[1]&&y<C[1]||d[1]===C[1]&&y===d[1]&&v>=d[0]&&v<C[0]||d[1]<C[1]&&y===C[1]&&v<C[0]||d[1]<C[1]&&y===d[1]&&v>=d[0])}};function m(v,y,d){for(;v.length<d;)v=y+v;return v}i.DomRendererRowFactory=a=c([p(1,s.ICharacterJoinerService),p(2,S.IOptionsService),p(3,s.ICoreBrowserService),p(4,S.ICoreService),p(5,S.IDecorationService),p(6,s.IThemeService)],a)},2550:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WidthCache=void 0,i.WidthCache=class{constructor(n,c){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=n.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const p=n.createElement("span");p.classList.add("xterm-char-measure-element");const o=n.createElement("span");o.classList.add("xterm-char-measure-element"),o.style.fontWeight="bold";const f=n.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontStyle="italic";const g=n.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontWeight="bold",g.style.fontStyle="italic",this._measureElements=[p,o,f,g],this._container.appendChild(p),this._container.appendChild(o),this._container.appendChild(f),this._container.appendChild(g),c.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(n,c,p,o){n===this._font&&c===this._fontSize&&p===this._weight&&o===this._weightBold||(this._font=n,this._fontSize=c,this._weight=p,this._weightBold=o,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${p}`,this._measureElements[1].style.fontWeight=`${o}`,this._measureElements[2].style.fontWeight=`${p}`,this._measureElements[3].style.fontWeight=`${o}`,this.clear())}get(n,c,p){let o=0;if(!c&&!p&&n.length===1&&(o=n.charCodeAt(0))<256){if(this._flat[o]!==-9999)return this._flat[o];const S=this._measure(n,0);return S>0&&(this._flat[o]=S),S}let f=n;c&&(f+="B"),p&&(f+="I");let g=this._holey.get(f);if(g===void 0){let S=0;c&&(S|=1),p&&(S|=2),g=this._measure(n,S),g>0&&this._holey.set(f,g)}return g}_measure(n,c){const p=this._measureElements[c];return p.textContent=n.repeat(32),p.offsetWidth/32}}},2223:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;const c=n(6114);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=c.isFirefox||c.isLegacyEdge?"bottom":"ideographic"},6171:(x,i)=>{function n(p){return 57508<=p&&p<=57558}function c(p){return p>=128512&&p<=128591||p>=127744&&p<=128511||p>=128640&&p<=128767||p>=9728&&p<=9983||p>=9984&&p<=10175||p>=65024&&p<=65039||p>=129280&&p<=129535||p>=127462&&p<=127487}Object.defineProperty(i,"__esModule",{value:!0}),i.computeNextVariantOffset=i.createRenderDimensions=i.treatGlyphAsBackgroundColor=i.allowRescaling=i.isEmoji=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(p){if(!p)throw new Error("value must not be falsy");return p},i.isPowerlineGlyph=n,i.isRestrictedPowerlineGlyph=function(p){return 57520<=p&&p<=57527},i.isEmoji=c,i.allowRescaling=function(p,o,f,g){return o===1&&f>Math.ceil(1.5*g)&&p!==void 0&&p>255&&!c(p)&&!n(p)&&!function(S){return 57344<=S&&S<=63743}(p)},i.treatGlyphAsBackgroundColor=function(p){return n(p)||function(o){return 9472<=o&&o<=9631}(p)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},i.computeNextVariantOffset=function(p,o,f=0){return(p-(2*Math.round(o)-f))%(2*Math.round(o))}},6052:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class n{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(p,o,f,g=!1){if(this.selectionStart=o,this.selectionEnd=f,!o||!f||o[0]===f[0]&&o[1]===f[1])return void this.clear();const S=p.buffers.active.ydisp,l=o[1]-S,s=f[1]-S,r=Math.max(l,0),e=Math.min(s,p.rows-1);r>=p.rows||e<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=l,this.viewportEndRow=s,this.viewportCappedStartRow=r,this.viewportCappedEndRow=e,this.startCol=o[0],this.endCol=f[0])}isCellSelected(p,o,f){return!!this.hasSelection&&(f-=p.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?o>=this.startCol&&f>=this.viewportCappedStartRow&&o<this.endCol&&f<=this.viewportCappedEndRow:o<this.startCol&&f>=this.viewportCappedStartRow&&o>=this.endCol&&f<=this.viewportCappedEndRow:f>this.viewportStartRow&&f<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&f===this.viewportStartRow&&o>=this.startCol&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportEndRow&&o<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportStartRow&&o>=this.startCol)}}i.createSelectionRenderModel=function(){return new n}},456:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionModel=void 0,i.SelectionModel=class{constructor(n){this._bufferService=n,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?n%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)-1]:[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[n,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const n=this.selectionStart[0]+this.selectionStartLength;return n>this._bufferService.cols?[n%this._bufferService.cols,this.selectionStart[1]+Math.floor(n/this._bufferService.cols)]:[Math.max(n,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const n=this.selectionStart,c=this.selectionEnd;return!(!n||!c)&&(n[1]>c[1]||n[1]===c[1]&&n[0]>c[0])}handleTrim(n){return this.selectionStart&&(this.selectionStart[1]-=n),this.selectionEnd&&(this.selectionEnd[1]-=n),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(x,i,n){var c=this&&this.__decorate||function(e,t,a,m){var v,y=arguments.length,d=y<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,a):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,a,m);else for(var C=e.length-1;C>=0;C--)(v=e[C])&&(d=(y<3?v(d):y>3?v(t,a,d):v(t,a))||d);return y>3&&d&&Object.defineProperty(t,a,d),d},p=this&&this.__param||function(e,t){return function(a,m){t(a,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharSizeService=void 0;const o=n(2585),f=n(8460),g=n(844);let S=i.CharSizeService=class extends g.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,a){super(),this._optionsService=a,this.width=0,this.height=0,this._onCharSizeChange=this.register(new f.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new r(this._optionsService))}catch{this._measureStrategy=this.register(new s(e,t,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};i.CharSizeService=S=c([p(2,o.IOptionsService)],S);class l extends g.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(t,a){t!==void 0&&t>0&&a!==void 0&&a>0&&(this._result.width=t,this._result.height=a)}}class s extends l{constructor(t,a,m){super(),this._document=t,this._parentElement=a,this._optionsService=m,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class r extends l{constructor(t){super(),this._optionsService=t,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const a=this._ctx.measureText("W");if(!("width"in a&&"fontBoundingBoxAscent"in a&&"fontBoundingBoxDescent"in a))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const t=this._ctx.measureText("W");return this._validateAndSet(t.width,t.fontBoundingBoxAscent+t.fontBoundingBoxDescent),this._result}}},4269:function(x,i,n){var c=this&&this.__decorate||function(r,e,t,a){var m,v=arguments.length,y=v<3?e:a===null?a=Object.getOwnPropertyDescriptor(e,t):a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(r,e,t,a);else for(var d=r.length-1;d>=0;d--)(m=r[d])&&(y=(v<3?m(y):v>3?m(e,t,y):m(e,t))||y);return v>3&&y&&Object.defineProperty(e,t,y),y},p=this&&this.__param||function(r,e){return function(t,a){e(t,a,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharacterJoinerService=i.JoinedCellData=void 0;const o=n(3734),f=n(643),g=n(511),S=n(2585);class l extends o.AttributeData{constructor(e,t,a){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=a}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.JoinedCellData=l;let s=i.CharacterJoinerService=class $t{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];const a=[],m=t.translateToString(!0);let v=0,y=0,d=0,C=t.getFg(0),D=t.getBg(0);for(let T=0;T<t.getTrimmedLength();T++)if(t.loadCell(T,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==D){if(T-v>1){const M=this._getJoinedRanges(m,d,y,t,v);for(let L=0;L<M.length;L++)a.push(M[L])}v=T,d=y,C=this._workCell.fg,D=this._workCell.bg}y+=this._workCell.getChars().length||f.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-v>1){const T=this._getJoinedRanges(m,d,y,t,v);for(let M=0;M<T.length;M++)a.push(T[M])}return a}_getJoinedRanges(e,t,a,m,v){const y=e.substring(t,a);let d=[];try{d=this._characterJoiners[0].handler(y)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{const D=this._characterJoiners[C].handler(y);for(let T=0;T<D.length;T++)$t._mergeRanges(d,D[T])}catch(D){console.error(D)}return this._stringRangesToCellRanges(d,m,v),d}_stringRangesToCellRanges(e,t,a){let m=0,v=!1,y=0,d=e[m];if(d){for(let C=a;C<this._bufferService.cols;C++){const D=t.getWidth(C),T=t.getString(C).length||f.WHITESPACE_CELL_CHAR.length;if(D!==0){if(!v&&d[0]<=y&&(d[0]=C,v=!0),d[1]<=y){if(d[1]=C,d=e[++m],!d)break;d[0]<=y?(d[0]=C,v=!0):v=!1}y+=T}}d&&(d[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let a=!1;for(let m=0;m<e.length;m++){const v=e[m];if(a){if(t[1]<=v[0])return e[m-1][1]=t[1],e;if(t[1]<=v[1])return e[m-1][1]=Math.max(t[1],v[1]),e.splice(m,1),e;e.splice(m,1),m--}else{if(t[1]<=v[0])return e.splice(m,0,t),e;if(t[1]<=v[1])return v[0]=Math.min(t[0],v[0]),e;t[0]<v[1]&&(v[0]=Math.min(t[0],v[0]),a=!0)}}return a?e[e.length-1][1]=t[1]:e.push(t),e}};i.CharacterJoinerService=s=c([p(0,S.IBufferService)],s)},5114:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreBrowserService=void 0;const c=n(844),p=n(8460),o=n(3656);class f extends c.Disposable{constructor(l,s,r){super(),this._textarea=l,this._window=s,this.mainDocument=r,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new g(this._window),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new p.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(e=>this._screenDprMonitor.setWindow(e))),this.register((0,p.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(l){this._window!==l&&(this._window=l,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}i.CoreBrowserService=f;class g extends c.Disposable{constructor(l){super(),this._parentWindow=l,this._windowResizeListener=this.register(new c.MutableDisposable),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,c.toDisposable)(()=>this.clearListener()))}setWindow(l){this._parentWindow=l,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,o.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var l;this._outerListener&&((l=this._resolutionMediaMatchList)==null||l.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkProviderService=void 0;const c=n(844);class p extends c.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,c.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(f){return this.linkProviders.push(f),{dispose:()=>{const g=this.linkProviders.indexOf(f);g!==-1&&this.linkProviders.splice(g,1)}}}}i.LinkProviderService=p},8934:function(x,i,n){var c=this&&this.__decorate||function(S,l,s,r){var e,t=arguments.length,a=t<3?l:r===null?r=Object.getOwnPropertyDescriptor(l,s):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(S,l,s,r);else for(var m=S.length-1;m>=0;m--)(e=S[m])&&(a=(t<3?e(a):t>3?e(l,s,a):e(l,s))||a);return t>3&&a&&Object.defineProperty(l,s,a),a},p=this&&this.__param||function(S,l){return function(s,r){l(s,r,S)}};Object.defineProperty(i,"__esModule",{value:!0}),i.MouseService=void 0;const o=n(4725),f=n(9806);let g=i.MouseService=class{constructor(S,l){this._renderService=S,this._charSizeService=l}getCoords(S,l,s,r,e){return(0,f.getCoords)(window,S,l,s,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,e)}getMouseReportCoords(S,l){const s=(0,f.getCoordsRelativeToElement)(window,S,l);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};i.MouseService=g=c([p(0,o.IRenderService),p(1,o.ICharSizeService)],g)},3230:function(x,i,n){var c=this&&this.__decorate||function(e,t,a,m){var v,y=arguments.length,d=y<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,a):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,a,m);else for(var C=e.length-1;C>=0;C--)(v=e[C])&&(d=(y<3?v(d):y>3?v(t,a,d):v(t,a))||d);return y>3&&d&&Object.defineProperty(t,a,d),d},p=this&&this.__param||function(e,t){return function(a,m){t(a,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.RenderService=void 0;const o=n(6193),f=n(4725),g=n(8460),S=n(844),l=n(7226),s=n(2585);let r=i.RenderService=class extends S.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,a,m,v,y,d,C){super(),this._rowCount=e,this._charSizeService=m,this._renderer=this.register(new S.MutableDisposable),this._pausedResizeTask=new l.DebouncedIdleTask,this._observerDisposable=this.register(new S.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new o.RenderDebouncer((D,T)=>this._renderRows(D,T),d),this.register(this._renderDebouncer),this.register(d.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(y.onResize(()=>this._fullRefresh())),this.register(y.buffers.onBufferActivate(()=>{var D;return(D=this._renderer.value)==null?void 0:D.clear()})),this.register(a.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(v.onDecorationRegistered(()=>this._fullRefresh())),this.register(v.onDecorationRemoved(()=>this._fullRefresh())),this.register(a.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(y.cols,y.rows),this._fullRefresh()})),this.register(a.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(y.buffer.y,y.buffer.y,!0))),this.register(C.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(d.window,t),this.register(d.onWindowChange(D=>this._registerIntersectionObserver(D,t)))}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){const a=new e.IntersectionObserver(m=>this._handleIntersectionChange(m[m.length-1]),{threshold:0});a.observe(t),this._observerDisposable.value=(0,S.toDisposable)(()=>a.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,a=!1){this._isPaused?this._needsFullRefresh=!0:(a||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&((t=(e=this._renderer.value).clearTextureAtlas)==null||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var a;return(a=this._renderer.value)==null?void 0:a.handleResize(e,t)}):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,t,a){var m;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=a,(m=this._renderer.value)==null||m.handleSelectionChanged(e,t,a)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};i.RenderService=r=c([p(2,s.IOptionsService),p(3,f.ICharSizeService),p(4,s.IDecorationService),p(5,s.IBufferService),p(6,f.ICoreBrowserService),p(7,f.IThemeService)],r)},9312:function(x,i,n){var c=this&&this.__decorate||function(d,C,D,T){var M,L=arguments.length,H=L<3?C:T===null?T=Object.getOwnPropertyDescriptor(C,D):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(d,C,D,T);else for(var $=d.length-1;$>=0;$--)(M=d[$])&&(H=(L<3?M(H):L>3?M(C,D,H):M(C,D))||H);return L>3&&H&&Object.defineProperty(C,D,H),H},p=this&&this.__param||function(d,C){return function(D,T){C(D,T,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionService=void 0;const o=n(9806),f=n(9504),g=n(456),S=n(4725),l=n(8460),s=n(844),r=n(6114),e=n(4841),t=n(511),a=n(2585),m="Â ",v=new RegExp(m,"g");let y=i.SelectionService=class extends s.Disposable{constructor(d,C,D,T,M,L,H,$,U){super(),this._element=d,this._screenElement=C,this._linkifier=D,this._bufferService=T,this._coreService=M,this._mouseService=L,this._optionsService=H,this._renderService=$,this._coreBrowserService=U,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new t.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new l.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new l.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new l.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new l.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=K=>this._handleMouseMove(K),this._mouseUpListener=K=>this._handleMouseUp(K),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(K=>this._handleTrim(K)),this.register(this._bufferService.buffers.onBufferActivate(K=>this._handleBufferActivate(K))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,s.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;return!(!d||!C||d[0]===C[0]&&d[1]===C[1])}get selectionText(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd;if(!d||!C)return"";const D=this._bufferService.buffer,T=[];if(this._activeSelectionMode===3){if(d[0]===C[0])return"";const M=d[0]<C[0]?d[0]:C[0],L=d[0]<C[0]?C[0]:d[0];for(let H=d[1];H<=C[1];H++){const $=D.translateBufferLineToString(H,!0,M,L);T.push($)}}else{const M=d[1]===C[1]?C[0]:void 0;T.push(D.translateBufferLineToString(d[1],!0,d[0],M));for(let L=d[1]+1;L<=C[1]-1;L++){const H=D.lines.get(L),$=D.translateBufferLineToString(L,!0);H!=null&&H.isWrapped?T[T.length-1]+=$:T.push($)}if(d[1]!==C[1]){const L=D.lines.get(C[1]),H=D.translateBufferLineToString(C[1],!0,0,C[0]);L&&L.isWrapped?T[T.length-1]+=H:T.push(H)}}return T.map(M=>M.replace(v," ")).join(r.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(d){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),r.isLinux&&d&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(d){const C=this._getMouseBufferCoords(d),D=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!!(D&&T&&C)&&this._areCoordsInSelection(C,D,T)}isCellInSelection(d,C){const D=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!(!D||!T)&&this._areCoordsInSelection([d,C],D,T)}_areCoordsInSelection(d,C,D){return d[1]>C[1]&&d[1]<D[1]||C[1]===D[1]&&d[1]===C[1]&&d[0]>=C[0]&&d[0]<D[0]||C[1]<D[1]&&d[1]===D[1]&&d[0]<D[0]||C[1]<D[1]&&d[1]===C[1]&&d[0]>=C[0]}_selectWordAtCursor(d,C){var M,L;const D=(L=(M=this._linkifier.currentLink)==null?void 0:M.link)==null?void 0:L.range;if(D)return this._model.selectionStart=[D.start.x-1,D.start.y-1],this._model.selectionStartLength=(0,e.getRangeLength)(D,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const T=this._getMouseBufferCoords(d);return!!T&&(this._selectWordAt(T,C),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(d,C){this._model.clearSelection(),d=Math.max(d,0),C=Math.min(C,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,d],this._model.selectionEnd=[this._bufferService.cols,C],this.refresh(),this._onSelectionChange.fire()}_handleTrim(d){this._model.handleTrim(d)&&this.refresh()}_getMouseBufferCoords(d){const C=this._mouseService.getCoords(d,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(C)return C[0]--,C[1]--,C[1]+=this._bufferService.buffer.ydisp,C}_getMouseEventScrollAmount(d){let C=(0,o.getCoordsRelativeToElement)(this._coreBrowserService.window,d,this._screenElement)[1];const D=this._renderService.dimensions.css.canvas.height;return C>=0&&C<=D?0:(C>D&&(C-=D),C=Math.min(Math.max(C,-50),50),C/=50,C/Math.abs(C)+Math.round(14*C))}shouldForceSelection(d){return r.isMac?d.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:d.shiftKey}handleMouseDown(d){if(this._mouseDownTimeStamp=d.timeStamp,(d.button!==2||!this.hasSelection)&&d.button===0){if(!this._enabled){if(!this.shouldForceSelection(d))return;d.stopPropagation()}d.preventDefault(),this._dragScrollAmount=0,this._enabled&&d.shiftKey?this._handleIncrementalClick(d):d.detail===1?this._handleSingleClick(d):d.detail===2?this._handleDoubleClick(d):d.detail===3&&this._handleTripleClick(d),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(d){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(d))}_handleSingleClick(d){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(d)?3:0,this._model.selectionStart=this._getMouseBufferCoords(d),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const C=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);C&&C.length!==this._model.selectionStart[0]&&C.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(d){this._selectWordAtCursor(d,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(d){const C=this._getMouseBufferCoords(d);C&&(this._activeSelectionMode=2,this._selectLineAt(C[1]))}shouldColumnSelect(d){return d.altKey&&!(r.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(d){if(d.stopImmediatePropagation(),!this._model.selectionStart)return;const C=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(d),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(d),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const D=this._bufferService.buffer;if(this._model.selectionEnd[1]<D.lines.length){const T=D.lines.get(this._model.selectionEnd[1]);T&&T.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}C&&C[0]===this._model.selectionEnd[0]&&C[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const d=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(d.ydisp+this._bufferService.rows,d.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=d.ydisp),this.refresh()}}_handleMouseUp(d){const C=d.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&C<500&&d.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const D=this._mouseService.getCoords(d,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(D&&D[0]!==void 0&&D[1]!==void 0){const T=(0,f.moveToCellSequence)(D[0]-1,D[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(T,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const d=this._model.finalSelectionStart,C=this._model.finalSelectionEnd,D=!(!d||!C||d[0]===C[0]&&d[1]===C[1]);D?d&&C&&(this._oldSelectionStart&&this._oldSelectionEnd&&d[0]===this._oldSelectionStart[0]&&d[1]===this._oldSelectionStart[1]&&C[0]===this._oldSelectionEnd[0]&&C[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(d,C,D)):this._oldHasSelection&&this._fireOnSelectionChange(d,C,D)}_fireOnSelectionChange(d,C,D){this._oldSelectionStart=d,this._oldSelectionEnd=C,this._oldHasSelection=D,this._onSelectionChange.fire()}_handleBufferActivate(d){this.clearSelection(),this._trimListener.dispose(),this._trimListener=d.activeBuffer.lines.onTrim(C=>this._handleTrim(C))}_convertViewportColToCharacterIndex(d,C){let D=C;for(let T=0;C>=T;T++){const M=d.loadCell(T,this._workCell).getChars().length;this._workCell.getWidth()===0?D--:M>1&&C!==T&&(D+=M-1)}return D}setSelection(d,C,D){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[d,C],this._model.selectionStartLength=D,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(d){this._isClickInSelection(d)||(this._selectWordAtCursor(d,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(d,C,D=!0,T=!0){if(d[0]>=this._bufferService.cols)return;const M=this._bufferService.buffer,L=M.lines.get(d[1]);if(!L)return;const H=M.translateBufferLineToString(d[1],!1);let $=this._convertViewportColToCharacterIndex(L,d[0]),U=$;const K=d[0]-$;let j=0,k=0,R=0,A=0;if(H.charAt($)===" "){for(;$>0&&H.charAt($-1)===" ";)$--;for(;U<H.length&&H.charAt(U+1)===" ";)U++}else{let z=d[0],J=d[0];L.getWidth(z)===0&&(j++,z--),L.getWidth(J)===2&&(k++,J++);const Y=L.getString(J).length;for(Y>1&&(A+=Y-1,U+=Y-1);z>0&&$>0&&!this._isCharWordSeparator(L.loadCell(z-1,this._workCell));){L.loadCell(z-1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===0?(j++,z--):P>1&&(R+=P-1,$-=P-1),$--,z--}for(;J<L.length&&U+1<H.length&&!this._isCharWordSeparator(L.loadCell(J+1,this._workCell));){L.loadCell(J+1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===2?(k++,J++):P>1&&(A+=P-1,U+=P-1),U++,J++}}U++;let I=$+K-j+R,W=Math.min(this._bufferService.cols,U-$+j+k-R-A);if(C||H.slice($,U).trim()!==""){if(D&&I===0&&L.getCodePoint(0)!==32){const z=M.lines.get(d[1]-1);if(z&&L.isWrapped&&z.getCodePoint(this._bufferService.cols-1)!==32){const J=this._getWordAt([this._bufferService.cols-1,d[1]-1],!1,!0,!1);if(J){const Y=this._bufferService.cols-J.start;I-=Y,W+=Y}}}if(T&&I+W===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const z=M.lines.get(d[1]+1);if(z!=null&&z.isWrapped&&z.getCodePoint(0)!==32){const J=this._getWordAt([0,d[1]+1],!1,!1,!0);J&&(W+=J.length)}}return{start:I,length:W}}}_selectWordAt(d,C){const D=this._getWordAt(d,C);if(D){for(;D.start<0;)D.start+=this._bufferService.cols,d[1]--;this._model.selectionStart=[D.start,d[1]],this._model.selectionStartLength=D.length}}_selectToWordAt(d){const C=this._getWordAt(d,!0);if(C){let D=d[1];for(;C.start<0;)C.start+=this._bufferService.cols,D--;if(!this._model.areSelectionValuesReversed())for(;C.start+C.length>this._bufferService.cols;)C.length-=this._bufferService.cols,D++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?C.start:C.start+C.length,D]}}_isCharWordSeparator(d){return d.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(d.getChars())>=0}_selectLineAt(d){const C=this._bufferService.buffer.getWrappedRangeForLine(d),D={start:{x:0,y:C.first},end:{x:this._bufferService.cols-1,y:C.last}};this._model.selectionStart=[0,C.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,e.getRangeLength)(D,this._bufferService.cols)}};i.SelectionService=y=c([p(3,a.IBufferService),p(4,a.ICoreService),p(5,S.IMouseService),p(6,a.IOptionsService),p(7,S.IRenderService),p(8,S.ICoreBrowserService)],y)},4725:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ILinkProviderService=i.IThemeService=i.ICharacterJoinerService=i.ISelectionService=i.IRenderService=i.IMouseService=i.ICoreBrowserService=i.ICharSizeService=void 0;const c=n(8343);i.ICharSizeService=(0,c.createDecorator)("CharSizeService"),i.ICoreBrowserService=(0,c.createDecorator)("CoreBrowserService"),i.IMouseService=(0,c.createDecorator)("MouseService"),i.IRenderService=(0,c.createDecorator)("RenderService"),i.ISelectionService=(0,c.createDecorator)("SelectionService"),i.ICharacterJoinerService=(0,c.createDecorator)("CharacterJoinerService"),i.IThemeService=(0,c.createDecorator)("ThemeService"),i.ILinkProviderService=(0,c.createDecorator)("LinkProviderService")},6731:function(x,i,n){var c=this&&this.__decorate||function(y,d,C,D){var T,M=arguments.length,L=M<3?d:D===null?D=Object.getOwnPropertyDescriptor(d,C):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(y,d,C,D);else for(var H=y.length-1;H>=0;H--)(T=y[H])&&(L=(M<3?T(L):M>3?T(d,C,L):T(d,C))||L);return M>3&&L&&Object.defineProperty(d,C,L),L},p=this&&this.__param||function(y,d){return function(C,D){d(C,D,y)}};Object.defineProperty(i,"__esModule",{value:!0}),i.ThemeService=i.DEFAULT_ANSI_COLORS=void 0;const o=n(7239),f=n(8055),g=n(8460),S=n(844),l=n(2585),s=f.css.toColor("#ffffff"),r=f.css.toColor("#000000"),e=f.css.toColor("#ffffff"),t=f.css.toColor("#000000"),a={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};i.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const y=[f.css.toColor("#2e3436"),f.css.toColor("#cc0000"),f.css.toColor("#4e9a06"),f.css.toColor("#c4a000"),f.css.toColor("#3465a4"),f.css.toColor("#75507b"),f.css.toColor("#06989a"),f.css.toColor("#d3d7cf"),f.css.toColor("#555753"),f.css.toColor("#ef2929"),f.css.toColor("#8ae234"),f.css.toColor("#fce94f"),f.css.toColor("#729fcf"),f.css.toColor("#ad7fa8"),f.css.toColor("#34e2e2"),f.css.toColor("#eeeeec")],d=[0,95,135,175,215,255];for(let C=0;C<216;C++){const D=d[C/36%6|0],T=d[C/6%6|0],M=d[C%6];y.push({css:f.channels.toCss(D,T,M),rgba:f.channels.toRgba(D,T,M)})}for(let C=0;C<24;C++){const D=8+10*C;y.push({css:f.channels.toCss(D,D,D),rgba:f.channels.toRgba(D,D,D)})}return y})());let m=i.ThemeService=class extends S.Disposable{get colors(){return this._colors}constructor(y){super(),this._optionsService=y,this._contrastCache=new o.ColorContrastCache,this._halfContrastCache=new o.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:s,background:r,cursor:e,cursorAccent:t,selectionForeground:void 0,selectionBackgroundTransparent:a,selectionBackgroundOpaque:f.color.blend(r,a),selectionInactiveBackgroundTransparent:a,selectionInactiveBackgroundOpaque:f.color.blend(r,a),ansi:i.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(y={}){const d=this._colors;if(d.foreground=v(y.foreground,s),d.background=v(y.background,r),d.cursor=v(y.cursor,e),d.cursorAccent=v(y.cursorAccent,t),d.selectionBackgroundTransparent=v(y.selectionBackground,a),d.selectionBackgroundOpaque=f.color.blend(d.background,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundTransparent=v(y.selectionInactiveBackground,d.selectionBackgroundTransparent),d.selectionInactiveBackgroundOpaque=f.color.blend(d.background,d.selectionInactiveBackgroundTransparent),d.selectionForeground=y.selectionForeground?v(y.selectionForeground,f.NULL_COLOR):void 0,d.selectionForeground===f.NULL_COLOR&&(d.selectionForeground=void 0),f.color.isOpaque(d.selectionBackgroundTransparent)&&(d.selectionBackgroundTransparent=f.color.opacity(d.selectionBackgroundTransparent,.3)),f.color.isOpaque(d.selectionInactiveBackgroundTransparent)&&(d.selectionInactiveBackgroundTransparent=f.color.opacity(d.selectionInactiveBackgroundTransparent,.3)),d.ansi=i.DEFAULT_ANSI_COLORS.slice(),d.ansi[0]=v(y.black,i.DEFAULT_ANSI_COLORS[0]),d.ansi[1]=v(y.red,i.DEFAULT_ANSI_COLORS[1]),d.ansi[2]=v(y.green,i.DEFAULT_ANSI_COLORS[2]),d.ansi[3]=v(y.yellow,i.DEFAULT_ANSI_COLORS[3]),d.ansi[4]=v(y.blue,i.DEFAULT_ANSI_COLORS[4]),d.ansi[5]=v(y.magenta,i.DEFAULT_ANSI_COLORS[5]),d.ansi[6]=v(y.cyan,i.DEFAULT_ANSI_COLORS[6]),d.ansi[7]=v(y.white,i.DEFAULT_ANSI_COLORS[7]),d.ansi[8]=v(y.brightBlack,i.DEFAULT_ANSI_COLORS[8]),d.ansi[9]=v(y.brightRed,i.DEFAULT_ANSI_COLORS[9]),d.ansi[10]=v(y.brightGreen,i.DEFAULT_ANSI_COLORS[10]),d.ansi[11]=v(y.brightYellow,i.DEFAULT_ANSI_COLORS[11]),d.ansi[12]=v(y.brightBlue,i.DEFAULT_ANSI_COLORS[12]),d.ansi[13]=v(y.brightMagenta,i.DEFAULT_ANSI_COLORS[13]),d.ansi[14]=v(y.brightCyan,i.DEFAULT_ANSI_COLORS[14]),d.ansi[15]=v(y.brightWhite,i.DEFAULT_ANSI_COLORS[15]),y.extendedAnsi){const C=Math.min(d.ansi.length-16,y.extendedAnsi.length);for(let D=0;D<C;D++)d.ansi[D+16]=v(y.extendedAnsi[D],i.DEFAULT_ANSI_COLORS[D+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(y){this._restoreColor(y),this._onChangeColors.fire(this.colors)}_restoreColor(y){if(y!==void 0)switch(y){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[y]=this._restoreColors.ansi[y]}else for(let d=0;d<this._restoreColors.ansi.length;++d)this._colors.ansi[d]=this._restoreColors.ansi[d]}modifyColors(y){y(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function v(y,d){if(y!==void 0)try{return f.css.toColor(y)}catch{}return d}i.ThemeService=m=c([p(0,l.IOptionsService)],m)},6349:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CircularList=void 0;const c=n(8460),p=n(844);class o extends p.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new c.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new c.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new c.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;const S=new Array(g);for(let l=0;l<Math.min(g,this.length);l++)S[l]=this._array[this._getCyclicIndex(l)];this._array=S,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let S=this._length;S<g;S++)this._array[S]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,S){this._array[this._getCyclicIndex(g)]=S}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,S,...l){if(S){for(let s=g;s<this._length-S;s++)this._array[this._getCyclicIndex(s)]=this._array[this._getCyclicIndex(s+S)];this._length-=S,this.onDeleteEmitter.fire({index:g,amount:S})}for(let s=this._length-1;s>=g;s--)this._array[this._getCyclicIndex(s+l.length)]=this._array[this._getCyclicIndex(s)];for(let s=0;s<l.length;s++)this._array[this._getCyclicIndex(g+s)]=l[s];if(l.length&&this.onInsertEmitter.fire({index:g,amount:l.length}),this._length+l.length>this._maxLength){const s=this._length+l.length-this._maxLength;this._startIndex+=s,this._length=this._maxLength,this.onTrimEmitter.fire(s)}else this._length+=l.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,S,l){if(!(S<=0)){if(g<0||g>=this._length)throw new Error("start argument out of range");if(g+l<0)throw new Error("Cannot shift elements in list beyond index 0");if(l>0){for(let r=S-1;r>=0;r--)this.set(g+r+l,this.get(g+r));const s=g+S+l-this._length;if(s>0)for(this._length+=s;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let s=0;s<S;s++)this.set(g+s+l,this.get(g+s))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}}i.CircularList=o},1439:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.clone=void 0,i.clone=function n(c,p=5){if(typeof c!="object")return c;const o=Array.isArray(c)?[]:{};for(const f in c)o[f]=p<=1?c[f]:c[f]&&n(c[f],p-1);return o}},8055:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;let n=0,c=0,p=0,o=0;var f,g,S,l,s;function r(t){const a=t.toString(16);return a.length<2?"0"+a:a}function e(t,a){return t<a?(a+.05)/(t+.05):(t+.05)/(a+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},function(t){t.toCss=function(a,m,v,y){return y!==void 0?`#${r(a)}${r(m)}${r(v)}${r(y)}`:`#${r(a)}${r(m)}${r(v)}`},t.toRgba=function(a,m,v,y=255){return(a<<24|m<<16|v<<8|y)>>>0},t.toColor=function(a,m,v,y){return{css:t.toCss(a,m,v,y),rgba:t.toRgba(a,m,v,y)}}}(f||(i.channels=f={})),function(t){function a(m,v){return o=Math.round(255*v),[n,c,p]=s.toChannels(m.rgba),{css:f.toCss(n,c,p,o),rgba:f.toRgba(n,c,p,o)}}t.blend=function(m,v){if(o=(255&v.rgba)/255,o===1)return{css:v.css,rgba:v.rgba};const y=v.rgba>>24&255,d=v.rgba>>16&255,C=v.rgba>>8&255,D=m.rgba>>24&255,T=m.rgba>>16&255,M=m.rgba>>8&255;return n=D+Math.round((y-D)*o),c=T+Math.round((d-T)*o),p=M+Math.round((C-M)*o),{css:f.toCss(n,c,p),rgba:f.toRgba(n,c,p)}},t.isOpaque=function(m){return(255&m.rgba)==255},t.ensureContrastRatio=function(m,v,y){const d=s.ensureContrastRatio(m.rgba,v.rgba,y);if(d)return f.toColor(d>>24&255,d>>16&255,d>>8&255)},t.opaque=function(m){const v=(255|m.rgba)>>>0;return[n,c,p]=s.toChannels(v),{css:f.toCss(n,c,p),rgba:v}},t.opacity=a,t.multiplyOpacity=function(m,v){return o=255&m.rgba,a(m,o*v/255)},t.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}}(g||(i.color=g={})),function(t){let a,m;try{const v=document.createElement("canvas");v.width=1,v.height=1;const y=v.getContext("2d",{willReadFrequently:!0});y&&(a=y,a.globalCompositeOperation="copy",m=a.createLinearGradient(0,0,1,1))}catch{}t.toColor=function(v){if(v.match(/#[\da-f]{3,8}/i))switch(v.length){case 4:return n=parseInt(v.slice(1,2).repeat(2),16),c=parseInt(v.slice(2,3).repeat(2),16),p=parseInt(v.slice(3,4).repeat(2),16),f.toColor(n,c,p);case 5:return n=parseInt(v.slice(1,2).repeat(2),16),c=parseInt(v.slice(2,3).repeat(2),16),p=parseInt(v.slice(3,4).repeat(2),16),o=parseInt(v.slice(4,5).repeat(2),16),f.toColor(n,c,p,o);case 7:return{css:v,rgba:(parseInt(v.slice(1),16)<<8|255)>>>0};case 9:return{css:v,rgba:parseInt(v.slice(1),16)>>>0}}const y=v.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(y)return n=parseInt(y[1]),c=parseInt(y[2]),p=parseInt(y[3]),o=Math.round(255*(y[5]===void 0?1:parseFloat(y[5]))),f.toColor(n,c,p,o);if(!a||!m)throw new Error("css.toColor: Unsupported css format");if(a.fillStyle=m,a.fillStyle=v,typeof a.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(a.fillRect(0,0,1,1),[n,c,p,o]=a.getImageData(0,0,1,1).data,o!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(n,c,p,o),css:v}}}(S||(i.css=S={})),function(t){function a(m,v,y){const d=m/255,C=v/255,D=y/255;return .2126*(d<=.03928?d/12.92:Math.pow((d+.055)/1.055,2.4))+.7152*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.0722*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))}t.relativeLuminance=function(m){return a(m>>16&255,m>>8&255,255&m)},t.relativeLuminance2=a}(l||(i.rgb=l={})),function(t){function a(v,y,d){const C=v>>24&255,D=v>>16&255,T=v>>8&255;let M=y>>24&255,L=y>>16&255,H=y>>8&255,$=e(l.relativeLuminance2(M,L,H),l.relativeLuminance2(C,D,T));for(;$<d&&(M>0||L>0||H>0);)M-=Math.max(0,Math.ceil(.1*M)),L-=Math.max(0,Math.ceil(.1*L)),H-=Math.max(0,Math.ceil(.1*H)),$=e(l.relativeLuminance2(M,L,H),l.relativeLuminance2(C,D,T));return(M<<24|L<<16|H<<8|255)>>>0}function m(v,y,d){const C=v>>24&255,D=v>>16&255,T=v>>8&255;let M=y>>24&255,L=y>>16&255,H=y>>8&255,$=e(l.relativeLuminance2(M,L,H),l.relativeLuminance2(C,D,T));for(;$<d&&(M<255||L<255||H<255);)M=Math.min(255,M+Math.ceil(.1*(255-M))),L=Math.min(255,L+Math.ceil(.1*(255-L))),H=Math.min(255,H+Math.ceil(.1*(255-H))),$=e(l.relativeLuminance2(M,L,H),l.relativeLuminance2(C,D,T));return(M<<24|L<<16|H<<8|255)>>>0}t.blend=function(v,y){if(o=(255&y)/255,o===1)return y;const d=y>>24&255,C=y>>16&255,D=y>>8&255,T=v>>24&255,M=v>>16&255,L=v>>8&255;return n=T+Math.round((d-T)*o),c=M+Math.round((C-M)*o),p=L+Math.round((D-L)*o),f.toRgba(n,c,p)},t.ensureContrastRatio=function(v,y,d){const C=l.relativeLuminance(v>>8),D=l.relativeLuminance(y>>8);if(e(C,D)<d){if(D<C){const L=a(v,y,d),H=e(C,l.relativeLuminance(L>>8));if(H<d){const $=m(v,y,d);return H>e(C,l.relativeLuminance($>>8))?L:$}return L}const T=m(v,y,d),M=e(C,l.relativeLuminance(T>>8));if(M<d){const L=a(v,y,d);return M>e(C,l.relativeLuminance(L>>8))?T:L}return T}},t.reduceLuminance=a,t.increaseLuminance=m,t.toChannels=function(v){return[v>>24&255,v>>16&255,v>>8&255,255&v]}}(s||(i.rgba=s={})),i.toPaddedHex=r,i.contrastRatio=e},8969:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreTerminal=void 0;const c=n(844),p=n(2585),o=n(4348),f=n(7866),g=n(744),S=n(7302),l=n(6975),s=n(8460),r=n(1753),e=n(1480),t=n(7994),a=n(9282),m=n(5435),v=n(5981),y=n(2660);let d=!1;class C extends c.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new s.EventEmitter),this._onScroll.event(T=>{var M;(M=this._onScrollApi)==null||M.fire(T.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(T){for(const M in T)this.optionsService.options[M]=T[M]}constructor(T){super(),this._windowsWrappingHeuristics=this.register(new c.MutableDisposable),this._onBinary=this.register(new s.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new s.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new s.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new s.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new s.EventEmitter),this._instantiationService=new o.InstantiationService,this.optionsService=this.register(new S.OptionsService(T)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(l.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(r.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(e.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(t.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(y.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new m.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,s.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,s.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,s.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,s.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new v.WriteBuffer((M,L)=>this._inputHandler.parse(M,L))),this.register((0,s.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(T,M){this._writeBuffer.write(T,M)}writeSync(T,M){this._logService.logLevel<=p.LogLevelEnum.WARN&&!d&&(this._logService.warn("writeSync is unreliable and will be removed soon."),d=!0),this._writeBuffer.writeSync(T,M)}input(T,M=!0){this.coreService.triggerDataEvent(T,M)}resize(T,M){isNaN(T)||isNaN(M)||(T=Math.max(T,g.MINIMUM_COLS),M=Math.max(M,g.MINIMUM_ROWS),this._bufferService.resize(T,M))}scroll(T,M=!1){this._bufferService.scroll(T,M)}scrollLines(T,M,L){this._bufferService.scrollLines(T,M,L)}scrollPages(T){this.scrollLines(T*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(T){const M=T-this._bufferService.buffer.ydisp;M!==0&&this.scrollLines(M)}registerEscHandler(T,M){return this._inputHandler.registerEscHandler(T,M)}registerDcsHandler(T,M){return this._inputHandler.registerDcsHandler(T,M)}registerCsiHandler(T,M){return this._inputHandler.registerCsiHandler(T,M)}registerOscHandler(T,M){return this._inputHandler.registerOscHandler(T,M)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let T=!1;const M=this.optionsService.rawOptions.windowsPty;M&&M.buildNumber!==void 0&&M.buildNumber!==void 0?T=M.backend==="conpty"&&M.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(T=!0),T?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const T=[];T.push(this.onLineFeed(a.updateWindowsModeWrappedState.bind(null,this._bufferService))),T.push(this.registerCsiHandler({final:"H"},()=>((0,a.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,c.toDisposable)(()=>{for(const M of T)M.dispose()})}}}i.CoreTerminal=C},8460:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.runAndSubscribe=i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=n=>(this._listeners.push(n),{dispose:()=>{if(!this._disposed){for(let c=0;c<this._listeners.length;c++)if(this._listeners[c]===n)return void this._listeners.splice(c,1)}}})),this._event}fire(n,c){const p=[];for(let o=0;o<this._listeners.length;o++)p.push(this._listeners[o]);for(let o=0;o<p.length;o++)p[o].call(void 0,n,c)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(n,c){return n(p=>c.fire(p))},i.runAndSubscribe=function(n,c){return c(void 0),n(p=>c(p))}},5435:function(x,i,n){var c=this&&this.__decorate||function(j,k,R,A){var I,W=arguments.length,z=W<3?k:A===null?A=Object.getOwnPropertyDescriptor(k,R):A;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(j,k,R,A);else for(var J=j.length-1;J>=0;J--)(I=j[J])&&(z=(W<3?I(z):W>3?I(k,R,z):I(k,R))||z);return W>3&&z&&Object.defineProperty(k,R,z),z},p=this&&this.__param||function(j,k){return function(R,A){k(R,A,j)}};Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=i.WindowsOptionsReportType=void 0;const o=n(2584),f=n(7116),g=n(2015),S=n(844),l=n(482),s=n(8437),r=n(8460),e=n(643),t=n(511),a=n(3734),m=n(2585),v=n(1480),y=n(6242),d=n(6351),C=n(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},T=131072;function M(j,k){if(j>24)return k.setWinLines||!1;switch(j){case 1:return!!k.restoreWin;case 2:return!!k.minimizeWin;case 3:return!!k.setWinPosition;case 4:return!!k.setWinSizePixels;case 5:return!!k.raiseWin;case 6:return!!k.lowerWin;case 7:return!!k.refreshWin;case 8:return!!k.setWinSizeChars;case 9:return!!k.maximizeWin;case 10:return!!k.fullscreenWin;case 11:return!!k.getWinState;case 13:return!!k.getWinPosition;case 14:return!!k.getWinSizePixels;case 15:return!!k.getScreenSizePixels;case 16:return!!k.getCellSizePixels;case 18:return!!k.getWinSizeChars;case 19:return!!k.getScreenSizeChars;case 20:return!!k.getIconTitle;case 21:return!!k.getWinTitle;case 22:return!!k.pushTitle;case 23:return!!k.popTitle;case 24:return!!k.setWinLines}return!1}var L;(function(j){j[j.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",j[j.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(i.WindowsOptionsReportType=L={}));let H=0;class $ extends S.Disposable{getAttrData(){return this._curAttrData}constructor(k,R,A,I,W,z,J,Y,P=new g.EscapeSequenceParser){super(),this._bufferService=k,this._charsetService=R,this._coreService=A,this._logService=I,this._optionsService=W,this._oscLinkService=z,this._coreMouseService=J,this._unicodeService=Y,this._parser=P,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new l.StringToUtf32,this._utf8Decoder=new l.Utf8ToUtf32,this._workCell=new t.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new r.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new r.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new r.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new r.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new r.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new r.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new r.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new r.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new r.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new r.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new r.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new r.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new r.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new U(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(E=>this._activeBuffer=E.activeBuffer)),this._parser.setCsiHandlerFallback((E,N)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(E),params:N.toArray()})}),this._parser.setEscHandlerFallback(E=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(E)})}),this._parser.setExecuteHandlerFallback(E=>{this._logService.debug("Unknown EXECUTE code: ",{code:E})}),this._parser.setOscHandlerFallback((E,N,F)=>{this._logService.debug("Unknown OSC code: ",{identifier:E,action:N,data:F})}),this._parser.setDcsHandlerFallback((E,N,F)=>{N==="HOOK"&&(F=F.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(E),action:N,payload:F})}),this._parser.setPrintHandler((E,N,F)=>this.print(E,N,F)),this._parser.registerCsiHandler({final:"@"},E=>this.insertChars(E)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},E=>this.scrollLeft(E)),this._parser.registerCsiHandler({final:"A"},E=>this.cursorUp(E)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},E=>this.scrollRight(E)),this._parser.registerCsiHandler({final:"B"},E=>this.cursorDown(E)),this._parser.registerCsiHandler({final:"C"},E=>this.cursorForward(E)),this._parser.registerCsiHandler({final:"D"},E=>this.cursorBackward(E)),this._parser.registerCsiHandler({final:"E"},E=>this.cursorNextLine(E)),this._parser.registerCsiHandler({final:"F"},E=>this.cursorPrecedingLine(E)),this._parser.registerCsiHandler({final:"G"},E=>this.cursorCharAbsolute(E)),this._parser.registerCsiHandler({final:"H"},E=>this.cursorPosition(E)),this._parser.registerCsiHandler({final:"I"},E=>this.cursorForwardTab(E)),this._parser.registerCsiHandler({final:"J"},E=>this.eraseInDisplay(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},E=>this.eraseInDisplay(E,!0)),this._parser.registerCsiHandler({final:"K"},E=>this.eraseInLine(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},E=>this.eraseInLine(E,!0)),this._parser.registerCsiHandler({final:"L"},E=>this.insertLines(E)),this._parser.registerCsiHandler({final:"M"},E=>this.deleteLines(E)),this._parser.registerCsiHandler({final:"P"},E=>this.deleteChars(E)),this._parser.registerCsiHandler({final:"S"},E=>this.scrollUp(E)),this._parser.registerCsiHandler({final:"T"},E=>this.scrollDown(E)),this._parser.registerCsiHandler({final:"X"},E=>this.eraseChars(E)),this._parser.registerCsiHandler({final:"Z"},E=>this.cursorBackwardTab(E)),this._parser.registerCsiHandler({final:"`"},E=>this.charPosAbsolute(E)),this._parser.registerCsiHandler({final:"a"},E=>this.hPositionRelative(E)),this._parser.registerCsiHandler({final:"b"},E=>this.repeatPrecedingCharacter(E)),this._parser.registerCsiHandler({final:"c"},E=>this.sendDeviceAttributesPrimary(E)),this._parser.registerCsiHandler({prefix:">",final:"c"},E=>this.sendDeviceAttributesSecondary(E)),this._parser.registerCsiHandler({final:"d"},E=>this.linePosAbsolute(E)),this._parser.registerCsiHandler({final:"e"},E=>this.vPositionRelative(E)),this._parser.registerCsiHandler({final:"f"},E=>this.hVPosition(E)),this._parser.registerCsiHandler({final:"g"},E=>this.tabClear(E)),this._parser.registerCsiHandler({final:"h"},E=>this.setMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"h"},E=>this.setModePrivate(E)),this._parser.registerCsiHandler({final:"l"},E=>this.resetMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"l"},E=>this.resetModePrivate(E)),this._parser.registerCsiHandler({final:"m"},E=>this.charAttributes(E)),this._parser.registerCsiHandler({final:"n"},E=>this.deviceStatus(E)),this._parser.registerCsiHandler({prefix:"?",final:"n"},E=>this.deviceStatusPrivate(E)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},E=>this.softReset(E)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},E=>this.setCursorStyle(E)),this._parser.registerCsiHandler({final:"r"},E=>this.setScrollRegion(E)),this._parser.registerCsiHandler({final:"s"},E=>this.saveCursor(E)),this._parser.registerCsiHandler({final:"t"},E=>this.windowOptions(E)),this._parser.registerCsiHandler({final:"u"},E=>this.restoreCursor(E)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},E=>this.insertColumns(E)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},E=>this.deleteColumns(E)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},E=>this.selectProtected(E)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},E=>this.requestMode(E,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},E=>this.requestMode(E,!1)),this._parser.setExecuteHandler(o.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(o.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(o.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(o.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(o.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(o.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(o.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(o.C1.IND,()=>this.index()),this._parser.setExecuteHandler(o.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(o.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new y.OscHandler(E=>(this.setTitle(E),this.setIconName(E),!0))),this._parser.registerOscHandler(1,new y.OscHandler(E=>this.setIconName(E))),this._parser.registerOscHandler(2,new y.OscHandler(E=>this.setTitle(E))),this._parser.registerOscHandler(4,new y.OscHandler(E=>this.setOrReportIndexedColor(E))),this._parser.registerOscHandler(8,new y.OscHandler(E=>this.setHyperlink(E))),this._parser.registerOscHandler(10,new y.OscHandler(E=>this.setOrReportFgColor(E))),this._parser.registerOscHandler(11,new y.OscHandler(E=>this.setOrReportBgColor(E))),this._parser.registerOscHandler(12,new y.OscHandler(E=>this.setOrReportCursorColor(E))),this._parser.registerOscHandler(104,new y.OscHandler(E=>this.restoreIndexedColor(E))),this._parser.registerOscHandler(110,new y.OscHandler(E=>this.restoreFgColor(E))),this._parser.registerOscHandler(111,new y.OscHandler(E=>this.restoreBgColor(E))),this._parser.registerOscHandler(112,new y.OscHandler(E=>this.restoreCursorColor(E))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const E in f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:E},()=>this.selectCharset("("+E)),this._parser.registerEscHandler({intermediates:")",final:E},()=>this.selectCharset(")"+E)),this._parser.registerEscHandler({intermediates:"*",final:E},()=>this.selectCharset("*"+E)),this._parser.registerEscHandler({intermediates:"+",final:E},()=>this.selectCharset("+"+E)),this._parser.registerEscHandler({intermediates:"-",final:E},()=>this.selectCharset("-"+E)),this._parser.registerEscHandler({intermediates:".",final:E},()=>this.selectCharset("."+E)),this._parser.registerEscHandler({intermediates:"/",final:E},()=>this.selectCharset("/"+E));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(E=>(this._logService.error("Parsing error: ",E),E)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new d.DcsHandler((E,N)=>this.requestStatusString(E,N)))}_preserveStack(k,R,A,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=k,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=A,this._parseStack.position=I}_logSlowResolvingAsync(k){this._logService.logLevel<=m.LogLevelEnum.WARN&&Promise.race([k,new Promise((R,A)=>setTimeout(()=>A("#SLOW_TIMEOUT"),5e3))]).catch(R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(k,R){let A,I=this._activeBuffer.x,W=this._activeBuffer.y,z=0;const J=this._parseStack.paused;if(J){if(A=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(A),A;I=this._parseStack.cursorStartX,W=this._parseStack.cursorStartY,this._parseStack.paused=!1,k.length>T&&(z=this._parseStack.position+T)}if(this._logService.logLevel<=m.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof k=="string"?` "${k}"`:` "${Array.prototype.map.call(k,E=>String.fromCharCode(E)).join("")}"`),typeof k=="string"?k.split("").map(E=>E.charCodeAt(0)):k),this._parseBuffer.length<k.length&&this._parseBuffer.length<T&&(this._parseBuffer=new Uint32Array(Math.min(k.length,T))),J||this._dirtyRowTracker.clearRange(),k.length>T)for(let E=z;E<k.length;E+=T){const N=E+T<k.length?E+T:k.length,F=typeof k=="string"?this._stringDecoder.decode(k.substring(E,N),this._parseBuffer):this._utf8Decoder.decode(k.subarray(E,N),this._parseBuffer);if(A=this._parser.parse(this._parseBuffer,F))return this._preserveStack(I,W,F,E),this._logSlowResolvingAsync(A),A}else if(!J){const E=typeof k=="string"?this._stringDecoder.decode(k,this._parseBuffer):this._utf8Decoder.decode(k,this._parseBuffer);if(A=this._parser.parse(this._parseBuffer,E))return this._preserveStack(I,W,E,0),this._logSlowResolvingAsync(A),A}this._activeBuffer.x===I&&this._activeBuffer.y===W||this._onCursorMove.fire();const Y=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),P=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);P<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(P,this._bufferService.rows-1),Math.min(Y,this._bufferService.rows-1))}print(k,R,A){let I,W;const z=this._charsetService.charset,J=this._optionsService.rawOptions.screenReaderMode,Y=this._bufferService.cols,P=this._coreService.decPrivateModes.wraparound,E=this._coreService.modes.insertMode,N=this._curAttrData;let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&A-R>0&&F.getWidth(this._activeBuffer.x-1)===2&&F.setCellFromCodepoint(this._activeBuffer.x-1,0,1,N);let V=this._parser.precedingJoinState;for(let q=R;q<A;++q){if(I=k[q],I<127&&z){const le=z[String.fromCharCode(I)];le&&(I=le.charCodeAt(0))}const ee=this._unicodeService.charProperties(I,V);W=v.UnicodeService.extractWidth(ee);const ie=v.UnicodeService.extractShouldJoin(ee),re=ie?v.UnicodeService.extractWidth(V):0;if(V=ee,J&&this._onA11yChar.fire((0,l.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+W-re>Y){if(P){const le=F;let Z=this._activeBuffer.x-re;for(this._activeBuffer.x=re,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),F=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),re>0&&F instanceof s.BufferLine&&F.copyCellsFrom(le,Z,0,re,!1);Z<Y;)le.setCellFromCodepoint(Z++,0,1,N)}else if(this._activeBuffer.x=Y-1,W===2)continue}if(ie&&this._activeBuffer.x){const le=F.getWidth(this._activeBuffer.x-1)?1:2;F.addCodepointToCell(this._activeBuffer.x-le,I,W);for(let Z=W-re;--Z>=0;)F.setCellFromCodepoint(this._activeBuffer.x++,0,0,N)}else if(E&&(F.insertCells(this._activeBuffer.x,W-re,this._activeBuffer.getNullCell(N)),F.getWidth(Y-1)===2&&F.setCellFromCodepoint(Y-1,e.NULL_CELL_CODE,e.NULL_CELL_WIDTH,N)),F.setCellFromCodepoint(this._activeBuffer.x++,I,W,N),W>0)for(;--W;)F.setCellFromCodepoint(this._activeBuffer.x++,0,0,N)}this._parser.precedingJoinState=V,this._activeBuffer.x<Y&&A-R>0&&F.getWidth(this._activeBuffer.x)===0&&!F.hasContent(this._activeBuffer.x)&&F.setCellFromCodepoint(this._activeBuffer.x,0,1,N),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(k,R){return k.final!=="t"||k.prefix||k.intermediates?this._parser.registerCsiHandler(k,R):this._parser.registerCsiHandler(k,A=>!M(A.params[0],this._optionsService.rawOptions.windowOptions)||R(A))}registerDcsHandler(k,R){return this._parser.registerDcsHandler(k,new d.DcsHandler(R))}registerEscHandler(k,R){return this._parser.registerEscHandler(k,R)}registerOscHandler(k,R){return this._parser.registerOscHandler(k,new y.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var k;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&k.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const k=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-k),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(k=this._bufferService.cols-1){this._activeBuffer.x=Math.min(k,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(k,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=k,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=k,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(k,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+k,this._activeBuffer.y+R)}cursorUp(k){const R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,k.params[0]||1)):this._moveCursor(0,-(k.params[0]||1)),!0}cursorDown(k){const R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,k.params[0]||1)):this._moveCursor(0,k.params[0]||1),!0}cursorForward(k){return this._moveCursor(k.params[0]||1,0),!0}cursorBackward(k){return this._moveCursor(-(k.params[0]||1),0),!0}cursorNextLine(k){return this.cursorDown(k),this._activeBuffer.x=0,!0}cursorPrecedingLine(k){return this.cursorUp(k),this._activeBuffer.x=0,!0}cursorCharAbsolute(k){return this._setCursor((k.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(k){return this._setCursor(k.length>=2?(k.params[1]||1)-1:0,(k.params[0]||1)-1),!0}charPosAbsolute(k){return this._setCursor((k.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(k){return this._moveCursor(k.params[0]||1,0),!0}linePosAbsolute(k){return this._setCursor(this._activeBuffer.x,(k.params[0]||1)-1),!0}vPositionRelative(k){return this._moveCursor(0,k.params[0]||1),!0}hVPosition(k){return this.cursorPosition(k),!0}tabClear(k){const R=k.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(k){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=k.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(k){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=k.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(k){const R=k.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(k,R,A,I=!1,W=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);z.replaceCells(R,A,this._activeBuffer.getNullCell(this._eraseAttrData()),W),I&&(z.isWrapped=!1)}_resetBufferLine(k,R=!1){const A=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);A&&(A.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+k),A.isWrapped=!1)}eraseInDisplay(k,R=!1){let A;switch(this._restrictCursor(this._bufferService.cols),k.params[0]){case 0:for(A=this._activeBuffer.y,this._dirtyRowTracker.markDirty(A),this._eraseInBufferLine(A++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);A<this._bufferService.rows;A++)this._resetBufferLine(A,R);this._dirtyRowTracker.markDirty(A);break;case 1:for(A=this._activeBuffer.y,this._dirtyRowTracker.markDirty(A),this._eraseInBufferLine(A,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(A+1).isWrapped=!1);A--;)this._resetBufferLine(A,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(A=this._bufferService.rows,this._dirtyRowTracker.markDirty(A-1);A--;)this._resetBufferLine(A,R);this._dirtyRowTracker.markDirty(0);break;case 3:const I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(k,R=!1){switch(this._restrictCursor(this._bufferService.cols),k.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(k){this._restrictCursor();let R=k.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const A=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,W=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;R--;)this._activeBuffer.lines.splice(W-1,1),this._activeBuffer.lines.splice(A,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(k){this._restrictCursor();let R=k.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const A=this._activeBuffer.ybase+this._activeBuffer.y;let I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;R--;)this._activeBuffer.lines.splice(A,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,k.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,k.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(k){let R=k.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(k){let R=k.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(s.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let A=this._activeBuffer.scrollTop;A<=this._activeBuffer.scrollBottom;++A){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+A);I.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(k.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(k){const R=this._parser.precedingJoinState;if(!R)return!0;const A=k.params[0]||1,I=v.UnicodeService.extractWidth(R),W=this._activeBuffer.x-I,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(W),J=new Uint32Array(z.length*A);let Y=0;for(let E=0;E<z.length;){const N=z.codePointAt(E)||0;J[Y++]=N,E+=N>65535?2:1}let P=Y;for(let E=1;E<A;++E)J.copyWithin(P,0,Y),P+=Y;return this.print(J,0,P),!0}sendDeviceAttributesPrimary(k){return k.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(o.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(o.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(k){return k.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(o.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(o.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(k.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(o.C0.ESC+"[>83;40003;0c")),!0}_is(k){return(this._optionsService.rawOptions.termName+"").indexOf(k)===0}setMode(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),k.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(k,R){const A=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:W}=this._coreMouseService,z=this._coreService,{buffers:J,cols:Y}=this._bufferService,{active:P,alt:E}=J,N=this._optionsService.rawOptions,F=ie=>ie?1:2,V=k.params[0];return q=V,ee=R?V===2?4:V===4?F(z.modes.insertMode):V===12?3:V===20?F(N.convertEol):0:V===1?F(A.applicationCursorKeys):V===3?N.windowOptions.setWinLines?Y===80?2:Y===132?1:0:0:V===6?F(A.origin):V===7?F(A.wraparound):V===8?3:V===9?F(I==="X10"):V===12?F(N.cursorBlink):V===25?F(!z.isCursorHidden):V===45?F(A.reverseWraparound):V===66?F(A.applicationKeypad):V===67?4:V===1e3?F(I==="VT200"):V===1002?F(I==="DRAG"):V===1003?F(I==="ANY"):V===1004?F(A.sendFocus):V===1005?4:V===1006?F(W==="SGR"):V===1015?4:V===1016?F(W==="SGR_PIXELS"):V===1048?1:V===47||V===1047||V===1049?F(P===E):V===2004?F(A.bracketedPasteMode):0,z.triggerDataEvent(`${o.C0.ESC}[${R?"":"?"}${q};${ee}$y`),!0;var q,ee}_updateAttrColor(k,R,A,I,W){return R===2?(k|=50331648,k&=-16777216,k|=a.AttributeData.fromColorRGB([A,I,W])):R===5&&(k&=-50331904,k|=33554432|255&A),k}_extractColor(k,R,A){const I=[0,0,-1,0,0,0];let W=0,z=0;do{if(I[z+W]=k.params[R+z],k.hasSubParams(R+z)){const J=k.getSubParams(R+z);let Y=0;do I[1]===5&&(W=1),I[z+Y+1+W]=J[Y];while(++Y<J.length&&Y+z+1+W<I.length);break}if(I[1]===5&&z+W>=2||I[1]===2&&z+W>=5)break;I[1]&&(W=1)}while(++z+R<k.length&&z+W<I.length);for(let J=2;J<I.length;++J)I[J]===-1&&(I[J]=0);switch(I[0]){case 38:A.fg=this._updateAttrColor(A.fg,I[1],I[3],I[4],I[5]);break;case 48:A.bg=this._updateAttrColor(A.bg,I[1],I[3],I[4],I[5]);break;case 58:A.extended=A.extended.clone(),A.extended.underlineColor=this._updateAttrColor(A.extended.underlineColor,I[1],I[3],I[4],I[5])}return z}_processUnderline(k,R){R.extended=R.extended.clone(),(!~k||k>5)&&(k=1),R.extended.underlineStyle=k,R.fg|=268435456,k===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(k){k.fg=s.DEFAULT_ATTR_DATA.fg,k.bg=s.DEFAULT_ATTR_DATA.bg,k.extended=k.extended.clone(),k.extended.underlineStyle=0,k.extended.underlineColor&=-67108864,k.updateExtended()}charAttributes(k){if(k.length===1&&k.params[0]===0)return this._processSGR0(this._curAttrData),!0;const R=k.length;let A;const I=this._curAttrData;for(let W=0;W<R;W++)A=k.params[W],A>=30&&A<=37?(I.fg&=-50331904,I.fg|=16777216|A-30):A>=40&&A<=47?(I.bg&=-50331904,I.bg|=16777216|A-40):A>=90&&A<=97?(I.fg&=-50331904,I.fg|=16777224|A-90):A>=100&&A<=107?(I.bg&=-50331904,I.bg|=16777224|A-100):A===0?this._processSGR0(I):A===1?I.fg|=134217728:A===3?I.bg|=67108864:A===4?(I.fg|=268435456,this._processUnderline(k.hasSubParams(W)?k.getSubParams(W)[0]:1,I)):A===5?I.fg|=536870912:A===7?I.fg|=67108864:A===8?I.fg|=1073741824:A===9?I.fg|=2147483648:A===2?I.bg|=134217728:A===21?this._processUnderline(2,I):A===22?(I.fg&=-134217729,I.bg&=-134217729):A===23?I.bg&=-67108865:A===24?(I.fg&=-268435457,this._processUnderline(0,I)):A===25?I.fg&=-536870913:A===27?I.fg&=-67108865:A===28?I.fg&=-1073741825:A===29?I.fg&=2147483647:A===39?(I.fg&=-67108864,I.fg|=16777215&s.DEFAULT_ATTR_DATA.fg):A===49?(I.bg&=-67108864,I.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):A===38||A===48||A===58?W+=this._extractColor(k,W,I):A===53?I.bg|=1073741824:A===55?I.bg&=-1073741825:A===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):A===100?(I.fg&=-67108864,I.fg|=16777215&s.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",A);return!0}deviceStatus(k){switch(k.params[0]){case 5:this._coreService.triggerDataEvent(`${o.C0.ESC}[0n`);break;case 6:const R=this._activeBuffer.y+1,A=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[${R};${A}R`)}return!0}deviceStatusPrivate(k){if(k.params[0]===6){const R=this._activeBuffer.y+1,A=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${o.C0.ESC}[?${R};${A}R`)}return!0}softReset(k){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(k){const R=k.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const A=R%2==1;return this._optionsService.options.cursorBlink=A,!0}setScrollRegion(k){const R=k.params[0]||1;let A;return(k.length<2||(A=k.params[1])>this._bufferService.rows||A===0)&&(A=this._bufferService.rows),A>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=A-1,this._setCursor(0,0)),!0}windowOptions(k){if(!M(k.params[0],this._optionsService.rawOptions.windowOptions))return!0;const R=k.length>1?k.params[1]:0;switch(k.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${o.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(k){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(k){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(k){return this._windowTitle=k,this._onTitleChange.fire(k),!0}setIconName(k){return this._iconName=k,!0}setOrReportIndexedColor(k){const R=[],A=k.split(";");for(;A.length>1;){const I=A.shift(),W=A.shift();if(/^\d+$/.exec(I)){const z=parseInt(I);if(K(z))if(W==="?")R.push({type:0,index:z});else{const J=(0,C.parseColor)(W);J&&R.push({type:1,index:z,color:J})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(k){const R=k.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(k,R){this._getCurrentLinkId()&&this._finishHyperlink();const A=k.split(":");let I;const W=A.findIndex(z=>z.startsWith("id="));return W!==-1&&(I=A[W].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(k,R){const A=k.split(";");for(let I=0;I<A.length&&!(R>=this._specialColors.length);++I,++R)if(A[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{const W=(0,C.parseColor)(A[I]);W&&this._onColor.fire([{type:1,index:this._specialColors[R],color:W}])}return!0}setOrReportFgColor(k){return this._setOrReportSpecialColor(k,0)}setOrReportBgColor(k){return this._setOrReportSpecialColor(k,1)}setOrReportCursorColor(k){return this._setOrReportSpecialColor(k,2)}restoreIndexedColor(k){if(!k)return this._onColor.fire([{type:2}]),!0;const R=[],A=k.split(";");for(let I=0;I<A.length;++I)if(/^\d+$/.exec(A[I])){const W=parseInt(A[I]);K(W)&&R.push({type:2,index:W})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(k){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(k){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(k){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(k){return k.length!==2?(this.selectDefaultCharset(),!0):(k[0]==="/"||this._charsetService.setgCharset(D[k[0]],f.CHARSETS[k[1]]||f.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const k=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,k,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(k){return this._charsetService.setgLevel(k),!0}screenAlignmentPattern(){const k=new t.CellData;k.content=4194373,k.fg=this._curAttrData.fg,k.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){const A=this._activeBuffer.ybase+this._activeBuffer.y+R,I=this._activeBuffer.lines.get(A);I&&(I.fill(k),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(k,R){const A=this._bufferService.buffer,I=this._optionsService.rawOptions;return(W=>(this._coreService.triggerDataEvent(`${o.C0.ESC}${W}${o.C0.ESC}\\`),!0))(k==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:k==='"p'?'P1$r61;1"p':k==="r"?`P1$r${A.scrollTop+1};${A.scrollBottom+1}r`:k==="m"?"P1$r0m":k===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(k,R){this._dirtyRowTracker.markRangeDirty(k,R)}}i.InputHandler=$;let U=class{constructor(j){this._bufferService=j,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(j){j<this.start?this.start=j:j>this.end&&(this.end=j)}markRangeDirty(j,k){j>k&&(H=j,j=k,k=H),j<this.start&&(this.start=j),k>this.end&&(this.end=k)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function K(j){return 0<=j&&j<256}U=c([p(0,m.IBufferService)],U)},844:(x,i)=>{function n(c){for(const p of c)p.dispose();c.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const c of this._disposables)c.dispose();this._disposables.length=0}register(c){return this._disposables.push(c),c}unregister(c){const p=this._disposables.indexOf(c);p!==-1&&this._disposables.splice(p,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(c){var p;this._isDisposed||c===this._value||((p=this._value)==null||p.dispose(),this._value=c)}clear(){this.value=void 0}dispose(){var c;this._isDisposed=!0,(c=this._value)==null||c.dispose(),this._value=void 0}},i.toDisposable=function(c){return{dispose:c}},i.disposeArray=n,i.getDisposeArrayDisposable=function(c){return{dispose:()=>n(c)}}},1505:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class n{constructor(){this._data={}}set(p,o,f){this._data[p]||(this._data[p]={}),this._data[p][o]=f}get(p,o){return this._data[p]?this._data[p][o]:void 0}clear(){this._data={}}}i.TwoKeyMap=n,i.FourKeyMap=class{constructor(){this._data=new n}set(c,p,o,f,g){this._data.get(c,p)||this._data.set(c,p,new n),this._data.get(c,p).set(o,f,g)}get(c,p,o,f){var g;return(g=this._data.get(c,p))==null?void 0:g.get(o,f)}clear(){this._data.clear()}}},6114:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof process<"u"&&"title"in process;const n=i.isNode?"node":navigator.userAgent,c=i.isNode?"node":navigator.platform;i.isFirefox=n.includes("Firefox"),i.isLegacyEdge=n.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(n),i.getSafariVersion=function(){if(!i.isSafari)return 0;const p=n.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(c),i.isIpad=c==="iPad",i.isIphone=c==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(c),i.isLinux=c.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(n)},6106:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SortedList=void 0;let n=0;i.SortedList=class{constructor(c){this._getKey=c,this._array=[]}clear(){this._array.length=0}insert(c){this._array.length!==0?(n=this._search(this._getKey(c)),this._array.splice(n,0,c)):this._array.push(c)}delete(c){if(this._array.length===0)return!1;const p=this._getKey(c);if(p===void 0||(n=this._search(p),n===-1)||this._getKey(this._array[n])!==p)return!1;do if(this._array[n]===c)return this._array.splice(n,1),!0;while(++n<this._array.length&&this._getKey(this._array[n])===p);return!1}*getKeyIterator(c){if(this._array.length!==0&&(n=this._search(c),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===c))do yield this._array[n];while(++n<this._array.length&&this._getKey(this._array[n])===c)}forEachByKey(c,p){if(this._array.length!==0&&(n=this._search(c),!(n<0||n>=this._array.length)&&this._getKey(this._array[n])===c))do p(this._array[n]);while(++n<this._array.length&&this._getKey(this._array[n])===c)}values(){return[...this._array].values()}_search(c){let p=0,o=this._array.length-1;for(;o>=p;){let f=p+o>>1;const g=this._getKey(this._array[f]);if(g>c)o=f-1;else{if(!(g<c)){for(;f>0&&this._getKey(this._array[f-1])===c;)f--;return f}p=f+1}}return p}}},7226:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;const c=n(6114);class p{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let S=0,l=0,s=g.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(S=Date.now(),this._tasks[this._i]()||this._i++,S=Math.max(1,Date.now()-S),l=Math.max(S,l),r=g.timeRemaining(),1.5*l>r)return s-S<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(s-S))}ms`),void this._start();s=r}this.clear()}}class o extends p{_requestCallback(g){return setTimeout(()=>g(this._createDeadline(16)))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const S=Date.now()+g;return{timeRemaining:()=>Math.max(0,S-Date.now())}}}i.PriorityTaskQueue=o,i.IdleTaskQueue=!c.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:o,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},9282:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.updateWindowsModeWrappedState=void 0;const c=n(643);i.updateWindowsModeWrappedState=function(p){const o=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),f=o==null?void 0:o.get(p.cols-1),g=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);g&&f&&(g.isWrapped=f[c.CHAR_DATA_CODE_INDEX]!==c.NULL_CELL_CODE&&f[c.CHAR_DATA_CODE_INDEX]!==c.WHITESPACE_CELL_CODE)}},3734:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class n{constructor(){this.fg=0,this.bg=0,this.extended=new c}static toColorRGB(o){return[o>>>16&255,o>>>8&255,255&o]}static fromColorRGB(o){return(255&o[0])<<16|(255&o[1])<<8|255&o[2]}clone(){const o=new n;return o.fg=this.fg,o.bg=this.bg,o.extended=this.extended.clone(),o}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}i.AttributeData=n;class c{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(o){this._ext=o}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(o){this._ext&=-469762049,this._ext|=o<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(o){this._ext&=-67108864,this._ext|=67108863&o}get urlId(){return this._urlId}set urlId(o){this._urlId=o}get underlineVariantOffset(){const o=(3758096384&this._ext)>>29;return o<0?4294967288^o:o}set underlineVariantOffset(o){this._ext&=536870911,this._ext|=o<<29&3758096384}constructor(o=0,f=0){this._ext=0,this._urlId=0,this._ext=o,this._urlId=f}clone(){return new c(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=c},9092:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Buffer=i.MAX_BUFFER_SIZE=void 0;const c=n(6349),p=n(7226),o=n(3734),f=n(8437),g=n(4634),S=n(511),l=n(643),s=n(4863),r=n(7116);i.MAX_BUFFER_SIZE=4294967295,i.Buffer=class{constructor(e,t,a){this._hasScrollback=e,this._optionsService=t,this._bufferService=a,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=r.DEFAULT_CHARSET,this.markers=[],this._nullCell=S.CellData.fromCharData([0,l.NULL_CELL_CHAR,l.NULL_CELL_WIDTH,l.NULL_CELL_CODE]),this._whitespaceCell=S.CellData.fromCharData([0,l.WHITESPACE_CELL_CHAR,l.WHITESPACE_CELL_WIDTH,l.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new p.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new o.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new o.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new f.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const t=e+this._optionsService.rawOptions.scrollback;return t>i.MAX_BUFFER_SIZE?i.MAX_BUFFER_SIZE:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=f.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new c.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const a=this.getNullCell(f.DEFAULT_ATTR_DATA);let m=0;const v=this._getCorrectBufferLength(t);if(v>this.lines.maxLength&&(this.lines.maxLength=v),this.lines.length>0){if(this._cols<e)for(let d=0;d<this.lines.length;d++)m+=+this.lines.get(d).resize(e,a);let y=0;if(this._rows<t)for(let d=this._rows;d<t;d++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(e,a)):this.ybase>0&&this.lines.length<=this.ybase+this.y+y+1?(this.ybase--,y++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(e,a)));else for(let d=this._rows;d>t;d--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(v<this.lines.maxLength){const d=this.lines.length-v;d>0&&(this.lines.trimStart(d),this.ybase=Math.max(this.ybase-d,0),this.ydisp=Math.max(this.ydisp-d,0),this.savedY=Math.max(this.savedY-d,0)),this.lines.maxLength=v}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),y&&(this.y+=y),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let y=0;y<this.lines.length;y++)m+=+this.lines.get(y).resize(e,a);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),m>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const a=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(a.length>0){const m=(0,g.reflowLargerCreateNewLayout)(this.lines,a);(0,g.reflowLargerApplyNewLayout)(this.lines,m.layout),this._reflowLargerAdjustViewport(e,t,m.countRemoved)}}_reflowLargerAdjustViewport(e,t,a){const m=this.getNullCell(f.DEFAULT_ATTR_DATA);let v=a;for(;v-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new f.BufferLine(e,m))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-a,0)}_reflowSmaller(e,t){const a=this.getNullCell(f.DEFAULT_ATTR_DATA),m=[];let v=0;for(let y=this.lines.length-1;y>=0;y--){let d=this.lines.get(y);if(!d||!d.isWrapped&&d.getTrimmedLength()<=e)continue;const C=[d];for(;d.isWrapped&&y>0;)d=this.lines.get(--y),C.unshift(d);const D=this.ybase+this.y;if(D>=y&&D<y+C.length)continue;const T=C[C.length-1].getTrimmedLength(),M=(0,g.reflowSmallerGetNewLineLengths)(C,this._cols,e),L=M.length-C.length;let H;H=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const $=[];for(let A=0;A<L;A++){const I=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);$.push(I)}$.length>0&&(m.push({start:y+C.length+v,newLines:$}),v+=$.length),C.push(...$);let U=M.length-1,K=M[U];K===0&&(U--,K=M[U]);let j=C.length-L-1,k=T;for(;j>=0;){const A=Math.min(k,K);if(C[U]===void 0)break;if(C[U].copyCellsFrom(C[j],k-A,K-A,A,!0),K-=A,K===0&&(U--,K=M[U]),k-=A,k===0){j--;const I=Math.max(j,0);k=(0,g.getWrappedLineTrimmedLength)(C,I,this._cols)}}for(let A=0;A<C.length;A++)M[A]<e&&C[A].setCell(M[A],a);let R=L-H;for(;R-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+v)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+t-1)}if(m.length>0){const y=[],d=[];for(let U=0;U<this.lines.length;U++)d.push(this.lines.get(U));const C=this.lines.length;let D=C-1,T=0,M=m[T];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+v);let L=0;for(let U=Math.min(this.lines.maxLength-1,C+v-1);U>=0;U--)if(M&&M.start>D+L){for(let K=M.newLines.length-1;K>=0;K--)this.lines.set(U--,M.newLines[K]);U++,y.push({index:D+1,amount:M.newLines.length}),L+=M.newLines.length,M=m[++T]}else this.lines.set(U,d[D--]);let H=0;for(let U=y.length-1;U>=0;U--)y[U].index+=H,this.lines.onInsertEmitter.fire(y[U]),H+=y[U].amount;const $=Math.max(0,C+v-this.lines.maxLength);$>0&&this.lines.onTrimEmitter.fire($)}}translateBufferLineToString(e,t,a=0,m){const v=this.lines.get(e);return v?v.translateToString(t,a,m):""}getWrappedRangeForLine(e){let t=e,a=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;a+1<this.lines.length&&this.lines.get(a+1).isWrapped;)a++;return{first:t,last:a}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new s.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim(a=>{t.line-=a,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(a=>{t.line>=a.index&&(t.line+=a.amount)})),t.register(this.lines.onDelete(a=>{t.line>=a.index&&t.line<a.index+a.amount&&t.dispose(),t.line>a.index&&(t.line-=a.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLine=i.DEFAULT_ATTR_DATA=void 0;const c=n(3734),p=n(511),o=n(643),f=n(482);i.DEFAULT_ATTR_DATA=Object.freeze(new c.AttributeData);let g=0;class S{constructor(s,r,e=!1){this.isWrapped=e,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*s);const t=r||p.CellData.fromCharData([0,o.NULL_CELL_CHAR,o.NULL_CELL_WIDTH,o.NULL_CELL_CODE]);for(let a=0;a<s;++a)this.setCell(a,t);this.length=s}get(s){const r=this._data[3*s+0],e=2097151&r;return[this._data[3*s+1],2097152&r?this._combined[s]:e?(0,f.stringFromCodePoint)(e):"",r>>22,2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):e]}set(s,r){this._data[3*s+1]=r[o.CHAR_DATA_ATTR_INDEX],r[o.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[s]=r[1],this._data[3*s+0]=2097152|s|r[o.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*s+0]=r[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|r[o.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(s){return this._data[3*s+0]>>22}hasWidth(s){return 12582912&this._data[3*s+0]}getFg(s){return this._data[3*s+1]}getBg(s){return this._data[3*s+2]}hasContent(s){return 4194303&this._data[3*s+0]}getCodePoint(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):2097151&r}isCombined(s){return 2097152&this._data[3*s+0]}getString(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s]:2097151&r?(0,f.stringFromCodePoint)(2097151&r):""}isProtected(s){return 536870912&this._data[3*s+2]}loadCell(s,r){return g=3*s,r.content=this._data[g+0],r.fg=this._data[g+1],r.bg=this._data[g+2],2097152&r.content&&(r.combinedData=this._combined[s]),268435456&r.bg&&(r.extended=this._extendedAttrs[s]),r}setCell(s,r){2097152&r.content&&(this._combined[s]=r.combinedData),268435456&r.bg&&(this._extendedAttrs[s]=r.extended),this._data[3*s+0]=r.content,this._data[3*s+1]=r.fg,this._data[3*s+2]=r.bg}setCellFromCodepoint(s,r,e,t){268435456&t.bg&&(this._extendedAttrs[s]=t.extended),this._data[3*s+0]=r|e<<22,this._data[3*s+1]=t.fg,this._data[3*s+2]=t.bg}addCodepointToCell(s,r,e){let t=this._data[3*s+0];2097152&t?this._combined[s]+=(0,f.stringFromCodePoint)(r):2097151&t?(this._combined[s]=(0,f.stringFromCodePoint)(2097151&t)+(0,f.stringFromCodePoint)(r),t&=-2097152,t|=2097152):t=r|4194304,e&&(t&=-12582913,t|=e<<22),this._data[3*s+0]=t}insertCells(s,r,e){if((s%=this.length)&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length-s){const t=new p.CellData;for(let a=this.length-s-r-1;a>=0;--a)this.setCell(s+r+a,this.loadCell(s+a,t));for(let a=0;a<r;++a)this.setCell(s+a,e)}else for(let t=s;t<this.length;++t)this.setCell(t,e);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,e)}deleteCells(s,r,e){if(s%=this.length,r<this.length-s){const t=new p.CellData;for(let a=0;a<this.length-s-r;++a)this.setCell(s+a,this.loadCell(s+r+a,t));for(let a=this.length-r;a<this.length;++a)this.setCell(a,e)}else for(let t=s;t<this.length;++t)this.setCell(t,e);s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),this.getWidth(s)!==0||this.hasContent(s)||this.setCellFromCodepoint(s,0,1,e)}replaceCells(s,r,e,t=!1){if(t)for(s&&this.getWidth(s-1)===2&&!this.isProtected(s-1)&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&!this.isProtected(r)&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.isProtected(s)||this.setCell(s,e),s++;else for(s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.setCell(s++,e)}resize(s,r){if(s===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const e=3*s;if(s>this.length){if(this._data.buffer.byteLength>=4*e)this._data=new Uint32Array(this._data.buffer,0,e);else{const t=new Uint32Array(e);t.set(this._data),this._data=t}for(let t=this.length;t<s;++t)this.setCell(t,r)}else{this._data=this._data.subarray(0,e);const t=Object.keys(this._combined);for(let m=0;m<t.length;m++){const v=parseInt(t[m],10);v>=s&&delete this._combined[v]}const a=Object.keys(this._extendedAttrs);for(let m=0;m<a.length;m++){const v=parseInt(a[m],10);v>=s&&delete this._extendedAttrs[v]}}return this.length=s,4*e*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const s=new Uint32Array(this._data.length);return s.set(this._data),this._data=s,1}return 0}fill(s,r=!1){if(r)for(let e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,s);else{this._combined={},this._extendedAttrs={};for(let e=0;e<this.length;++e)this.setCell(e,s)}}copyFrom(s){this.length!==s.length?this._data=new Uint32Array(s._data):this._data.set(s._data),this.length=s.length,this._combined={};for(const r in s._combined)this._combined[r]=s._combined[r];this._extendedAttrs={};for(const r in s._extendedAttrs)this._extendedAttrs[r]=s._extendedAttrs[r];this.isWrapped=s.isWrapped}clone(){const s=new S(0);s._data=new Uint32Array(this._data),s.length=this.length;for(const r in this._combined)s._combined[r]=this._combined[r];for(const r in this._extendedAttrs)s._extendedAttrs[r]=this._extendedAttrs[r];return s.isWrapped=this.isWrapped,s}getTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0])return s+(this._data[3*s+0]>>22);return 0}getNoBgTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0]||50331648&this._data[3*s+2])return s+(this._data[3*s+0]>>22);return 0}copyCellsFrom(s,r,e,t,a){const m=s._data;if(a)for(let y=t-1;y>=0;y--){for(let d=0;d<3;d++)this._data[3*(e+y)+d]=m[3*(r+y)+d];268435456&m[3*(r+y)+2]&&(this._extendedAttrs[e+y]=s._extendedAttrs[r+y])}else for(let y=0;y<t;y++){for(let d=0;d<3;d++)this._data[3*(e+y)+d]=m[3*(r+y)+d];268435456&m[3*(r+y)+2]&&(this._extendedAttrs[e+y]=s._extendedAttrs[r+y])}const v=Object.keys(s._combined);for(let y=0;y<v.length;y++){const d=parseInt(v[y],10);d>=r&&(this._combined[d-r+e]=s._combined[d])}}translateToString(s,r,e,t){r=r??0,e=e??this.length,s&&(e=Math.min(e,this.getTrimmedLength())),t&&(t.length=0);let a="";for(;r<e;){const m=this._data[3*r+0],v=2097151&m,y=2097152&m?this._combined[r]:v?(0,f.stringFromCodePoint)(v):o.WHITESPACE_CELL_CHAR;if(a+=y,t)for(let d=0;d<y.length;++d)t.push(r);r+=m>>22||1}return t&&t.push(r),a}}i.BufferLine=S},4841:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getRangeLength=void 0,i.getRangeLength=function(n,c){if(n.start.y>n.end.y)throw new Error(`Buffer range end (${n.end.x}, ${n.end.y}) cannot be before start (${n.start.x}, ${n.start.y})`);return c*(n.end.y-n.start.y)+(n.end.x-n.start.x+1)}},4634:(x,i)=>{function n(c,p,o){if(p===c.length-1)return c[p].getTrimmedLength();const f=!c[p].hasContent(o-1)&&c[p].getWidth(o-1)===1,g=c[p+1].getWidth(0)===2;return f&&g?o-1:o}Object.defineProperty(i,"__esModule",{value:!0}),i.getWrappedLineTrimmedLength=i.reflowSmallerGetNewLineLengths=i.reflowLargerApplyNewLayout=i.reflowLargerCreateNewLayout=i.reflowLargerGetLinesToRemove=void 0,i.reflowLargerGetLinesToRemove=function(c,p,o,f,g){const S=[];for(let l=0;l<c.length-1;l++){let s=l,r=c.get(++s);if(!r.isWrapped)continue;const e=[c.get(l)];for(;s<c.length&&r.isWrapped;)e.push(r),r=c.get(++s);if(f>=l&&f<s){l+=e.length-1;continue}let t=0,a=n(e,t,p),m=1,v=0;for(;m<e.length;){const d=n(e,m,p),C=d-v,D=o-a,T=Math.min(C,D);e[t].copyCellsFrom(e[m],v,a,T,!1),a+=T,a===o&&(t++,a=0),v+=T,v===d&&(m++,v=0),a===0&&t!==0&&e[t-1].getWidth(o-1)===2&&(e[t].copyCellsFrom(e[t-1],o-1,a++,1,!1),e[t-1].setCell(o-1,g))}e[t].replaceCells(a,o,g);let y=0;for(let d=e.length-1;d>0&&(d>t||e[d].getTrimmedLength()===0);d--)y++;y>0&&(S.push(l+e.length-y),S.push(y)),l+=e.length-1}return S},i.reflowLargerCreateNewLayout=function(c,p){const o=[];let f=0,g=p[f],S=0;for(let l=0;l<c.length;l++)if(g===l){const s=p[++f];c.onDeleteEmitter.fire({index:l-S,amount:s}),l+=s-1,S+=s,g=p[++f]}else o.push(l);return{layout:o,countRemoved:S}},i.reflowLargerApplyNewLayout=function(c,p){const o=[];for(let f=0;f<p.length;f++)o.push(c.get(p[f]));for(let f=0;f<o.length;f++)c.set(f,o[f]);c.length=p.length},i.reflowSmallerGetNewLineLengths=function(c,p,o){const f=[],g=c.map((r,e)=>n(c,e,p)).reduce((r,e)=>r+e);let S=0,l=0,s=0;for(;s<g;){if(g-s<o){f.push(g-s);break}S+=o;const r=n(c,l,p);S>r&&(S-=r,l++);const e=c[l].getWidth(S-1)===2;e&&S--;const t=e?o-1:o;f.push(t),s+=t}return f},i.getWrappedLineTrimmedLength=n},5295:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferSet=void 0;const c=n(8460),p=n(844),o=n(9092);class f extends p.Disposable{constructor(S,l){super(),this._optionsService=S,this._bufferService=l,this._onBufferActivate=this.register(new c.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new o.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new o.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(S){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(S),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(S,l){this._normal.resize(S,l),this._alt.resize(S,l),this.setupTabStops(S)}setupTabStops(S){this._normal.setupTabStops(S),this._alt.setupTabStops(S)}}i.BufferSet=f},511:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;const c=n(482),p=n(643),o=n(3734);class f extends o.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new o.ExtendedAttrs,this.combinedData=""}static fromCharData(S){const l=new f;return l.setFromCharData(S),l}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,c.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(S){this.fg=S[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let l=!1;if(S[p.CHAR_DATA_CHAR_INDEX].length>2)l=!0;else if(S[p.CHAR_DATA_CHAR_INDEX].length===2){const s=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=s&&s<=56319){const r=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(s-55296)+r-56320+65536|S[p.CHAR_DATA_WIDTH_INDEX]<<22:l=!0}else l=!0}else this.content=S[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|S[p.CHAR_DATA_WIDTH_INDEX]<<22;l&&(this.combinedData=S[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|S[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=f},643:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},4863:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Marker=void 0;const c=n(8460),p=n(844);class o{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=o._nextId++,this._onDispose=this.register(new c.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}}i.Marker=o,o._nextId=1},7116:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_CHARSET=i.CHARSETS=void 0,i.CHARSETS={},i.DEFAULT_CHARSET=i.CHARSETS.B,i.CHARSETS[0]={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â·"},i.CHARSETS.A={"#":"Â£"},i.CHARSETS.B=void 0,i.CHARSETS[4]={"#":"Â£","@":"Â¾","[":"ij","\\":"Â½","]":"|","{":"Â¨","|":"f","}":"Â¼","~":"Â´"},i.CHARSETS.C=i.CHARSETS[5]={"[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},i.CHARSETS.R={"#":"Â£","@":"Ã ","[":"Â°","\\":"Ã§","]":"Â§","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Â¨"},i.CHARSETS.Q={"@":"Ã ","[":"Ã¢","\\":"Ã§","]":"Ãª","^":"Ã®","`":"Ã´","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Ã»"},i.CHARSETS.K={"@":"Â§","[":"Ã","\\":"Ã","]":"Ã","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã"},i.CHARSETS.Y={"#":"Â£","@":"Â§","[":"Â°","\\":"Ã§","]":"Ã©","`":"Ã¹","{":"Ã ","|":"Ã²","}":"Ã¨","~":"Ã¬"},i.CHARSETS.E=i.CHARSETS[6]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã¤","{":"Ã¦","|":"Ã¸","}":"Ã¥","~":"Ã¼"},i.CHARSETS.Z={"#":"Â£","@":"Â§","[":"Â¡","\\":"Ã","]":"Â¿","{":"Â°","|":"Ã±","}":"Ã§"},i.CHARSETS.H=i.CHARSETS[7]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},i.CHARSETS["="]={"#":"Ã¹","@":"Ã ","[":"Ã©","\\":"Ã§","]":"Ãª","^":"Ã®",_:"Ã¨","`":"Ã´","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã»"}},2584:(x,i)=>{var n,c,p;Object.defineProperty(i,"__esModule",{value:!0}),i.C1_ESCAPED=i.C1=i.C0=void 0,function(o){o.NUL="\0",o.SOH="",o.STX="",o.ETX="",o.EOT="",o.ENQ="",o.ACK="",o.BEL="\x07",o.BS="\b",o.HT="	",o.LF=`
`,o.VT="\v",o.FF="\f",o.CR="\r",o.SO="",o.SI="",o.DLE="",o.DC1="",o.DC2="",o.DC3="",o.DC4="",o.NAK="",o.SYN="",o.ETB="",o.CAN="",o.EM="",o.SUB="",o.ESC="\x1B",o.FS="",o.GS="",o.RS="",o.US="",o.SP=" ",o.DEL=""}(n||(i.C0=n={})),function(o){o.PAD="Â",o.HOP="Â",o.BPH="Â",o.NBH="Â",o.IND="Â",o.NEL="Â",o.SSA="Â",o.ESA="Â",o.HTS="Â",o.HTJ="Â",o.VTS="Â",o.PLD="Â",o.PLU="Â",o.RI="Â",o.SS2="Â",o.SS3="Â",o.DCS="Â",o.PU1="Â",o.PU2="Â",o.STS="Â",o.CCH="Â",o.MW="Â",o.SPA="Â",o.EPA="Â",o.SOS="Â",o.SGCI="Â",o.SCI="Â",o.CSI="Â",o.ST="Â",o.OSC="Â",o.PM="Â",o.APC="Â"}(c||(i.C1=c={})),function(o){o.ST=`${n.ESC}\\`}(p||(i.C1_ESCAPED=p={}))},7399:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateKeyboardEvent=void 0;const c=n(2584),p={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};i.evaluateKeyboardEvent=function(o,f,g,S){const l={type:0,cancel:!1,key:void 0},s=(o.shiftKey?1:0)|(o.altKey?2:0)|(o.ctrlKey?4:0)|(o.metaKey?8:0);switch(o.keyCode){case 0:o.key==="UIKeyInputUpArrow"?l.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A":o.key==="UIKeyInputLeftArrow"?l.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D":o.key==="UIKeyInputRightArrow"?l.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C":o.key==="UIKeyInputDownArrow"&&(l.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B");break;case 8:l.key=o.ctrlKey?"\b":c.C0.DEL,o.altKey&&(l.key=c.C0.ESC+l.key);break;case 9:if(o.shiftKey){l.key=c.C0.ESC+"[Z";break}l.key=c.C0.HT,l.cancel=!0;break;case 13:l.key=o.altKey?c.C0.ESC+c.C0.CR:c.C0.CR,l.cancel=!0;break;case 27:l.key=c.C0.ESC,o.altKey&&(l.key=c.C0.ESC+c.C0.ESC),l.cancel=!0;break;case 37:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"D",l.key===c.C0.ESC+"[1;3D"&&(l.key=c.C0.ESC+(g?"b":"[1;5D"))):l.key=f?c.C0.ESC+"OD":c.C0.ESC+"[D";break;case 39:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"C",l.key===c.C0.ESC+"[1;3C"&&(l.key=c.C0.ESC+(g?"f":"[1;5C"))):l.key=f?c.C0.ESC+"OC":c.C0.ESC+"[C";break;case 38:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"A",g||l.key!==c.C0.ESC+"[1;3A"||(l.key=c.C0.ESC+"[1;5A")):l.key=f?c.C0.ESC+"OA":c.C0.ESC+"[A";break;case 40:if(o.metaKey)break;s?(l.key=c.C0.ESC+"[1;"+(s+1)+"B",g||l.key!==c.C0.ESC+"[1;3B"||(l.key=c.C0.ESC+"[1;5B")):l.key=f?c.C0.ESC+"OB":c.C0.ESC+"[B";break;case 45:o.shiftKey||o.ctrlKey||(l.key=c.C0.ESC+"[2~");break;case 46:l.key=s?c.C0.ESC+"[3;"+(s+1)+"~":c.C0.ESC+"[3~";break;case 36:l.key=s?c.C0.ESC+"[1;"+(s+1)+"H":f?c.C0.ESC+"OH":c.C0.ESC+"[H";break;case 35:l.key=s?c.C0.ESC+"[1;"+(s+1)+"F":f?c.C0.ESC+"OF":c.C0.ESC+"[F";break;case 33:o.shiftKey?l.type=2:o.ctrlKey?l.key=c.C0.ESC+"[5;"+(s+1)+"~":l.key=c.C0.ESC+"[5~";break;case 34:o.shiftKey?l.type=3:o.ctrlKey?l.key=c.C0.ESC+"[6;"+(s+1)+"~":l.key=c.C0.ESC+"[6~";break;case 112:l.key=s?c.C0.ESC+"[1;"+(s+1)+"P":c.C0.ESC+"OP";break;case 113:l.key=s?c.C0.ESC+"[1;"+(s+1)+"Q":c.C0.ESC+"OQ";break;case 114:l.key=s?c.C0.ESC+"[1;"+(s+1)+"R":c.C0.ESC+"OR";break;case 115:l.key=s?c.C0.ESC+"[1;"+(s+1)+"S":c.C0.ESC+"OS";break;case 116:l.key=s?c.C0.ESC+"[15;"+(s+1)+"~":c.C0.ESC+"[15~";break;case 117:l.key=s?c.C0.ESC+"[17;"+(s+1)+"~":c.C0.ESC+"[17~";break;case 118:l.key=s?c.C0.ESC+"[18;"+(s+1)+"~":c.C0.ESC+"[18~";break;case 119:l.key=s?c.C0.ESC+"[19;"+(s+1)+"~":c.C0.ESC+"[19~";break;case 120:l.key=s?c.C0.ESC+"[20;"+(s+1)+"~":c.C0.ESC+"[20~";break;case 121:l.key=s?c.C0.ESC+"[21;"+(s+1)+"~":c.C0.ESC+"[21~";break;case 122:l.key=s?c.C0.ESC+"[23;"+(s+1)+"~":c.C0.ESC+"[23~";break;case 123:l.key=s?c.C0.ESC+"[24;"+(s+1)+"~":c.C0.ESC+"[24~";break;default:if(!o.ctrlKey||o.shiftKey||o.altKey||o.metaKey)if(g&&!S||!o.altKey||o.metaKey)!g||o.altKey||o.ctrlKey||o.shiftKey||!o.metaKey?o.key&&!o.ctrlKey&&!o.altKey&&!o.metaKey&&o.keyCode>=48&&o.key.length===1?l.key=o.key:o.key&&o.ctrlKey&&(o.key==="_"&&(l.key=c.C0.US),o.key==="@"&&(l.key=c.C0.NUL)):o.keyCode===65&&(l.type=1);else{const r=p[o.keyCode],e=r==null?void 0:r[o.shiftKey?1:0];if(e)l.key=c.C0.ESC+e;else if(o.keyCode>=65&&o.keyCode<=90){const t=o.ctrlKey?o.keyCode-64:o.keyCode+32;let a=String.fromCharCode(t);o.shiftKey&&(a=a.toUpperCase()),l.key=c.C0.ESC+a}else if(o.keyCode===32)l.key=c.C0.ESC+(o.ctrlKey?c.C0.NUL:" ");else if(o.key==="Dead"&&o.code.startsWith("Key")){let t=o.code.slice(3,4);o.shiftKey||(t=t.toLowerCase()),l.key=c.C0.ESC+t,l.cancel=!0}}else o.keyCode>=65&&o.keyCode<=90?l.key=String.fromCharCode(o.keyCode-64):o.keyCode===32?l.key=c.C0.NUL:o.keyCode>=51&&o.keyCode<=55?l.key=String.fromCharCode(o.keyCode-51+27):o.keyCode===56?l.key=c.C0.DEL:o.keyCode===219?l.key=c.C0.ESC:o.keyCode===220?l.key=c.C0.FS:o.keyCode===221&&(l.key=c.C0.GS)}return l}},482:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(n){return n>65535?(n-=65536,String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):String.fromCharCode(n)},i.utf32ToString=function(n,c=0,p=n.length){let o="";for(let f=c;f<p;++f){let g=n[f];g>65535?(g-=65536,o+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):o+=String.fromCharCode(g)}return o},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(n,c){const p=n.length;if(!p)return 0;let o=0,f=0;if(this._interim){const g=n.charCodeAt(f++);56320<=g&&g<=57343?c[o++]=1024*(this._interim-55296)+g-56320+65536:(c[o++]=this._interim,c[o++]=g),this._interim=0}for(let g=f;g<p;++g){const S=n.charCodeAt(g);if(55296<=S&&S<=56319){if(++g>=p)return this._interim=S,o;const l=n.charCodeAt(g);56320<=l&&l<=57343?c[o++]=1024*(S-55296)+l-56320+65536:(c[o++]=S,c[o++]=l)}else S!==65279&&(c[o++]=S)}return o}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(n,c){const p=n.length;if(!p)return 0;let o,f,g,S,l=0,s=0,r=0;if(this.interim[0]){let a=!1,m=this.interim[0];m&=(224&m)==192?31:(240&m)==224?15:7;let v,y=0;for(;(v=63&this.interim[++y])&&y<4;)m<<=6,m|=v;const d=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=d-y;for(;r<C;){if(r>=p)return 0;if(v=n[r++],(192&v)!=128){r--,a=!0;break}this.interim[y++]=v,m<<=6,m|=63&v}a||(d===2?m<128?r--:c[l++]=m:d===3?m<2048||m>=55296&&m<=57343||m===65279||(c[l++]=m):m<65536||m>1114111||(c[l++]=m)),this.interim.fill(0)}const e=p-4;let t=r;for(;t<p;){for(;!(!(t<e)||128&(o=n[t])||128&(f=n[t+1])||128&(g=n[t+2])||128&(S=n[t+3]));)c[l++]=o,c[l++]=f,c[l++]=g,c[l++]=S,t+=4;if(o=n[t++],o<128)c[l++]=o;else if((224&o)==192){if(t>=p)return this.interim[0]=o,l;if(f=n[t++],(192&f)!=128){t--;continue}if(s=(31&o)<<6|63&f,s<128){t--;continue}c[l++]=s}else if((240&o)==224){if(t>=p)return this.interim[0]=o,l;if(f=n[t++],(192&f)!=128){t--;continue}if(t>=p)return this.interim[0]=o,this.interim[1]=f,l;if(g=n[t++],(192&g)!=128){t--;continue}if(s=(15&o)<<12|(63&f)<<6|63&g,s<2048||s>=55296&&s<=57343||s===65279)continue;c[l++]=s}else if((248&o)==240){if(t>=p)return this.interim[0]=o,l;if(f=n[t++],(192&f)!=128){t--;continue}if(t>=p)return this.interim[0]=o,this.interim[1]=f,l;if(g=n[t++],(192&g)!=128){t--;continue}if(t>=p)return this.interim[0]=o,this.interim[1]=f,this.interim[2]=g,l;if(S=n[t++],(192&S)!=128){t--;continue}if(s=(7&o)<<18|(63&f)<<12|(63&g)<<6|63&S,s<65536||s>1114111)continue;c[l++]=s}}return l}}},225:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeV6=void 0;const c=n(1480),p=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],o=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let f;i.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let g=0;g<p.length;++g)f.fill(0,p[g][0],p[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?f[g]:function(S,l){let s,r=0,e=l.length-1;if(S<l[0][0]||S>l[e][1])return!1;for(;e>=r;)if(s=r+e>>1,S>l[s][1])r=s+1;else{if(!(S<l[s][0]))return!0;e=s-1}return!1}(g,o)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,S){let l=this.wcwidth(g),s=l===0&&S!==0;if(s){const r=c.UnicodeService.extractWidth(S);r===0?s=!1:r>l&&(l=r)}return c.UnicodeService.createPropertyValue(0,l,s)}}},5981:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WriteBuffer=void 0;const c=n(8460),p=n(844);class o extends p.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new c.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,S){if(S!==void 0&&this._syncCalls>S)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let l;for(this._isSyncWriting=!0;l=this._writeBuffer.shift();){this._action(l);const s=this._callbacks.shift();s&&s()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(g,S){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(S),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(S)}_innerWrite(g=0,S=!0){const l=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const s=this._writeBuffer[this._bufferOffset],r=this._action(s,S);if(r){const t=a=>Date.now()-l>=12?setTimeout(()=>this._innerWrite(0,a)):this._innerWrite(l,a);return void r.catch(a=>(queueMicrotask(()=>{throw a}),Promise.resolve(!1))).then(t)}const e=this._callbacks[this._bufferOffset];if(e&&e(),this._bufferOffset++,this._pendingData-=s.length,Date.now()-l>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}i.WriteBuffer=o},5941:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.toRgbString=i.parseColor=void 0;const n=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,c=/^[\da-f]+$/;function p(o,f){const g=o.toString(16),S=g.length<2?"0"+g:g;switch(f){case 4:return g[0];case 8:return S;case 12:return(S+S).slice(0,3);default:return S+S}}i.parseColor=function(o){if(!o)return;let f=o.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);const g=n.exec(f);if(g){const S=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/S*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/S*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/S*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),c.exec(f)&&[3,6,9,12].includes(f.length))){const g=f.length/3,S=[0,0,0];for(let l=0;l<3;++l){const s=parseInt(f.slice(g*l,g*l+g),16);S[l]=g===1?s<<4:g===2?s:g===3?s>>4:s>>8}return S}},i.toRgbString=function(o,f=16){const[g,S,l]=o;return`rgb:${p(g,f)}/${p(S,f)}/${p(l,f)}`}},5770:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PAYLOAD_LIMIT=void 0,i.PAYLOAD_LIMIT=1e7},6351:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DcsHandler=i.DcsParser=void 0;const c=n(482),p=n(8742),o=n(5770),f=[];i.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(S,l){this._handlers[S]===void 0&&(this._handlers[S]=[]);const s=this._handlers[S];return s.push(l),{dispose:()=>{const r=s.indexOf(l);r!==-1&&s.splice(r,1)}}}clearHandler(S){this._handlers[S]&&delete this._handlers[S]}setHandlerFallback(S){this._handlerFb=S}reset(){if(this._active.length)for(let S=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;S>=0;--S)this._active[S].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(S,l){if(this.reset(),this._ident=S,this._active=this._handlers[S]||f,this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(l);else this._handlerFb(this._ident,"HOOK",l)}put(S,l,s){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(S,l,s);else this._handlerFb(this._ident,"PUT",(0,c.utf32ToString)(S,l,s))}unhook(S,l=!0){if(this._active.length){let s=!1,r=this._active.length-1,e=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,s=l,e=this._stack.fallThrough,this._stack.paused=!1),!e&&s===!1){for(;r>=0&&(s=this._active[r].unhook(S),s!==!0);r--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,s;r--}for(;r>=0;r--)if(s=this._active[r].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,s}else this._handlerFb(this._ident,"UNHOOK",S);this._active=f,this._ident=0}};const g=new p.Params;g.addParam(0),i.DcsHandler=class{constructor(S){this._handler=S,this._data="",this._params=g,this._hitLimit=!1}hook(S){this._params=S.length>1||S.params[0]?S.clone():g,this._data="",this._hitLimit=!1}put(S,l,s){this._hitLimit||(this._data+=(0,c.utf32ToString)(S,l,s),this._data.length>o.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(S){let l=!1;if(this._hitLimit)l=!1;else if(S&&(l=this._handler(this._data,this._params),l instanceof Promise))return l.then(s=>(this._params=g,this._data="",this._hitLimit=!1,s));return this._params=g,this._data="",this._hitLimit=!1,l}}},2015:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.EscapeSequenceParser=i.VT500_TRANSITION_TABLE=i.TransitionTable=void 0;const c=n(844),p=n(8742),o=n(6242),f=n(6351);class g{constructor(r){this.table=new Uint8Array(r)}setDefault(r,e){this.table.fill(r<<4|e)}add(r,e,t,a){this.table[e<<8|r]=t<<4|a}addMany(r,e,t,a){for(let m=0;m<r.length;m++)this.table[e<<8|r[m]]=t<<4|a}}i.TransitionTable=g;const S=160;i.VT500_TRANSITION_TABLE=function(){const s=new g(4095),r=Array.apply(null,Array(256)).map((y,d)=>d),e=(y,d)=>r.slice(y,d),t=e(32,127),a=e(0,24);a.push(25),a.push.apply(a,e(28,32));const m=e(0,14);let v;for(v in s.setDefault(1,0),s.addMany(t,0,2,0),m)s.addMany([24,26,153,154],v,3,0),s.addMany(e(128,144),v,3,0),s.addMany(e(144,152),v,3,0),s.add(156,v,0,0),s.add(27,v,11,1),s.add(157,v,4,8),s.addMany([152,158,159],v,0,7),s.add(155,v,11,3),s.add(144,v,11,9);return s.addMany(a,0,3,0),s.addMany(a,1,3,1),s.add(127,1,0,1),s.addMany(a,8,0,8),s.addMany(a,3,3,3),s.add(127,3,0,3),s.addMany(a,4,3,4),s.add(127,4,0,4),s.addMany(a,6,3,6),s.addMany(a,5,3,5),s.add(127,5,0,5),s.addMany(a,2,3,2),s.add(127,2,0,2),s.add(93,1,4,8),s.addMany(t,8,5,8),s.add(127,8,5,8),s.addMany([156,27,24,26,7],8,6,0),s.addMany(e(28,32),8,0,8),s.addMany([88,94,95],1,0,7),s.addMany(t,7,0,7),s.addMany(a,7,0,7),s.add(156,7,0,0),s.add(127,7,0,7),s.add(91,1,11,3),s.addMany(e(64,127),3,7,0),s.addMany(e(48,60),3,8,4),s.addMany([60,61,62,63],3,9,4),s.addMany(e(48,60),4,8,4),s.addMany(e(64,127),4,7,0),s.addMany([60,61,62,63],4,0,6),s.addMany(e(32,64),6,0,6),s.add(127,6,0,6),s.addMany(e(64,127),6,0,0),s.addMany(e(32,48),3,9,5),s.addMany(e(32,48),5,9,5),s.addMany(e(48,64),5,0,6),s.addMany(e(64,127),5,7,0),s.addMany(e(32,48),4,9,5),s.addMany(e(32,48),1,9,2),s.addMany(e(32,48),2,9,2),s.addMany(e(48,127),2,10,0),s.addMany(e(48,80),1,10,0),s.addMany(e(81,88),1,10,0),s.addMany([89,90,92],1,10,0),s.addMany(e(96,127),1,10,0),s.add(80,1,11,9),s.addMany(a,9,0,9),s.add(127,9,0,9),s.addMany(e(28,32),9,0,9),s.addMany(e(32,48),9,9,12),s.addMany(e(48,60),9,8,10),s.addMany([60,61,62,63],9,9,10),s.addMany(a,11,0,11),s.addMany(e(32,128),11,0,11),s.addMany(e(28,32),11,0,11),s.addMany(a,10,0,10),s.add(127,10,0,10),s.addMany(e(28,32),10,0,10),s.addMany(e(48,60),10,8,10),s.addMany([60,61,62,63],10,0,11),s.addMany(e(32,48),10,9,12),s.addMany(a,12,0,12),s.add(127,12,0,12),s.addMany(e(28,32),12,0,12),s.addMany(e(32,48),12,9,12),s.addMany(e(48,64),12,0,11),s.addMany(e(64,127),12,12,13),s.addMany(e(64,127),10,12,13),s.addMany(e(64,127),9,12,13),s.addMany(a,13,13,13),s.addMany(t,13,13,13),s.add(127,13,0,13),s.addMany([27,156,24,26],13,14,0),s.add(S,0,2,0),s.add(S,8,5,8),s.add(S,6,0,6),s.add(S,11,0,11),s.add(S,13,13,13),s}();class l extends c.Disposable{constructor(r=i.VT500_TRANSITION_TABLE){super(),this._transitions=r,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,t,a)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,c.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new o.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(r,e=[64,126]){let t=0;if(r.prefix){if(r.prefix.length>1)throw new Error("only one byte as prefix supported");if(t=r.prefix.charCodeAt(0),t&&60>t||t>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(r.intermediates){if(r.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let m=0;m<r.intermediates.length;++m){const v=r.intermediates.charCodeAt(m);if(32>v||v>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");t<<=8,t|=v}}if(r.final.length!==1)throw new Error("final must be a single byte");const a=r.final.charCodeAt(0);if(e[0]>a||a>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return t<<=8,t|=a,t}identToString(r){const e=[];for(;r;)e.push(String.fromCharCode(255&r)),r>>=8;return e.reverse().join("")}setPrintHandler(r){this._printHandler=r}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(r,e){const t=this._identifier(r,[48,126]);this._escHandlers[t]===void 0&&(this._escHandlers[t]=[]);const a=this._escHandlers[t];return a.push(e),{dispose:()=>{const m=a.indexOf(e);m!==-1&&a.splice(m,1)}}}clearEscHandler(r){this._escHandlers[this._identifier(r,[48,126])]&&delete this._escHandlers[this._identifier(r,[48,126])]}setEscHandlerFallback(r){this._escHandlerFb=r}setExecuteHandler(r,e){this._executeHandlers[r.charCodeAt(0)]=e}clearExecuteHandler(r){this._executeHandlers[r.charCodeAt(0)]&&delete this._executeHandlers[r.charCodeAt(0)]}setExecuteHandlerFallback(r){this._executeHandlerFb=r}registerCsiHandler(r,e){const t=this._identifier(r);this._csiHandlers[t]===void 0&&(this._csiHandlers[t]=[]);const a=this._csiHandlers[t];return a.push(e),{dispose:()=>{const m=a.indexOf(e);m!==-1&&a.splice(m,1)}}}clearCsiHandler(r){this._csiHandlers[this._identifier(r)]&&delete this._csiHandlers[this._identifier(r)]}setCsiHandlerFallback(r){this._csiHandlerFb=r}registerDcsHandler(r,e){return this._dcsParser.registerHandler(this._identifier(r),e)}clearDcsHandler(r){this._dcsParser.clearHandler(this._identifier(r))}setDcsHandlerFallback(r){this._dcsParser.setHandlerFallback(r)}registerOscHandler(r,e){return this._oscParser.registerHandler(r,e)}clearOscHandler(r){this._oscParser.clearHandler(r)}setOscHandlerFallback(r){this._oscParser.setHandlerFallback(r)}setErrorHandler(r){this._errorHandler=r}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(r,e,t,a,m){this._parseStack.state=r,this._parseStack.handlers=e,this._parseStack.handlerPos=t,this._parseStack.transition=a,this._parseStack.chunkPos=m}parse(r,e,t){let a,m=0,v=0,y=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,y=this._parseStack.chunkPos+1;else{if(t===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const d=this._parseStack.handlers;let C=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(t===!1&&C>-1){for(;C>=0&&(a=d[C](this._params),a!==!0);C--)if(a instanceof Promise)return this._parseStack.handlerPos=C,a}this._parseStack.handlers=[];break;case 4:if(t===!1&&C>-1){for(;C>=0&&(a=d[C](),a!==!0);C--)if(a instanceof Promise)return this._parseStack.handlerPos=C,a}this._parseStack.handlers=[];break;case 6:if(m=r[this._parseStack.chunkPos],a=this._dcsParser.unhook(m!==24&&m!==26,t),a)return a;m===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(m=r[this._parseStack.chunkPos],a=this._oscParser.end(m!==24&&m!==26,t),a)return a;m===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,y=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let d=y;d<e;++d){switch(m=r[d],v=this._transitions.table[this.currentState<<8|(m<160?m:S)],v>>4){case 2:for(let L=d+1;;++L){if(L>=e||(m=r[L])<32||m>126&&m<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<S){this._printHandler(r,d,L),d=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<S){this._printHandler(r,d,L),d=L-1;break}}break;case 3:this._executeHandlers[m]?this._executeHandlers[m]():this._executeHandlerFb(m),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:d,code:m,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const C=this._csiHandlers[this._collect<<8|m];let D=C?C.length-1:-1;for(;D>=0&&(a=C[D](this._params),a!==!0);D--)if(a instanceof Promise)return this._preserveStack(3,C,D,v,d),a;D<0&&this._csiHandlerFb(this._collect<<8|m,this._params),this.precedingJoinState=0;break;case 8:do switch(m){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(m-48)}while(++d<e&&(m=r[d])>47&&m<60);d--;break;case 9:this._collect<<=8,this._collect|=m;break;case 10:const T=this._escHandlers[this._collect<<8|m];let M=T?T.length-1:-1;for(;M>=0&&(a=T[M](),a!==!0);M--)if(a instanceof Promise)return this._preserveStack(4,T,M,v,d),a;M<0&&this._escHandlerFb(this._collect<<8|m),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|m,this._params);break;case 13:for(let L=d+1;;++L)if(L>=e||(m=r[L])===24||m===26||m===27||m>127&&m<S){this._dcsParser.put(r,d,L),d=L-1;break}break;case 14:if(a=this._dcsParser.unhook(m!==24&&m!==26),a)return this._preserveStack(6,[],0,v,d),a;m===27&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=d+1;;L++)if(L>=e||(m=r[L])<32||m>127&&m<S){this._oscParser.put(r,d,L),d=L-1;break}break;case 6:if(a=this._oscParser.end(m!==24&&m!==26),a)return this._preserveStack(5,[],0,v,d),a;m===27&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&v}}}i.EscapeSequenceParser=l},6242:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OscHandler=i.OscParser=void 0;const c=n(5770),p=n(482),o=[];i.OscParser=class{constructor(){this._state=0,this._active=o,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,g){this._handlers[f]===void 0&&(this._handlers[f]=[]);const S=this._handlers[f];return S.push(g),{dispose:()=>{const l=S.indexOf(g);l!==-1&&S.splice(l,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=o}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=o,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||o,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,g,S){if(this._active.length)for(let l=this._active.length-1;l>=0;l--)this._active[l].put(f,g,S);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(f,g,S))}start(){this.reset(),this._state=1}put(f,g,S){if(this._state!==3){if(this._state===1)for(;g<S;){const l=f[g++];if(l===59){this._state=2,this._start();break}if(l<48||57<l)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+l-48}this._state===2&&S-g>0&&this._put(f,g,S)}}end(f,g=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let S=!1,l=this._active.length-1,s=!1;if(this._stack.paused&&(l=this._stack.loopPosition-1,S=g,s=this._stack.fallThrough,this._stack.paused=!1),!s&&S===!1){for(;l>=0&&(S=this._active[l].end(f),S!==!0);l--)if(S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!1,S;l--}for(;l>=0;l--)if(S=this._active[l].end(!1),S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=l,this._stack.fallThrough=!0,S}else this._handlerFb(this._id,"END",f);this._active=o,this._id=-1,this._state=0}}},i.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,g,S){this._hitLimit||(this._data+=(0,p.utf32ToString)(f,g,S),this._data.length>c.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let g=!1;if(this._hitLimit)g=!1;else if(f&&(g=this._handler(this._data),g instanceof Promise))return g.then(S=>(this._data="",this._hitLimit=!1,S));return this._data="",this._hitLimit=!1,g}}},8742:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Params=void 0;const n=2147483647;class c{static fromArray(o){const f=new c;if(!o.length)return f;for(let g=Array.isArray(o[0])?1:0;g<o.length;++g){const S=o[g];if(Array.isArray(S))for(let l=0;l<S.length;++l)f.addSubParam(S[l]);else f.addParam(S)}return f}constructor(o=32,f=32){if(this.maxLength=o,this.maxSubParamsLength=f,f>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(o),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(o),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const o=new c(this.maxLength,this.maxSubParamsLength);return o.params.set(this.params),o.length=this.length,o._subParams.set(this._subParams),o._subParamsLength=this._subParamsLength,o._subParamsIdx.set(this._subParamsIdx),o._rejectDigits=this._rejectDigits,o._rejectSubDigits=this._rejectSubDigits,o._digitIsSub=this._digitIsSub,o}toArray(){const o=[];for(let f=0;f<this.length;++f){o.push(this.params[f]);const g=this._subParamsIdx[f]>>8,S=255&this._subParamsIdx[f];S-g>0&&o.push(Array.prototype.slice.call(this._subParams,g,S))}return o}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(o){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=o>n?n:o}}addSubParam(o){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(o<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=o>n?n:o,this._subParamsIdx[this.length-1]++}}hasSubParams(o){return(255&this._subParamsIdx[o])-(this._subParamsIdx[o]>>8)>0}getSubParams(o){const f=this._subParamsIdx[o]>>8,g=255&this._subParamsIdx[o];return g-f>0?this._subParams.subarray(f,g):null}getSubParamsAll(){const o={};for(let f=0;f<this.length;++f){const g=this._subParamsIdx[f]>>8,S=255&this._subParamsIdx[f];S-g>0&&(o[f]=this._subParams.slice(g,S))}return o}addDigit(o){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const g=this._digitIsSub?this._subParams:this.params,S=g[f-1];g[f-1]=~S?Math.min(10*S+o,n):o}}i.Params=c},5741:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AddonManager=void 0,i.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let n=this._addons.length-1;n>=0;n--)this._addons[n].instance.dispose()}loadAddon(n,c){const p={instance:c,dispose:c.dispose,isDisposed:!1};this._addons.push(p),c.dispose=()=>this._wrappedAddonDispose(p),c.activate(n)}_wrappedAddonDispose(n){if(n.isDisposed)return;let c=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===n){c=p;break}if(c===-1)throw new Error("Could not dispose an addon that has not been loaded");n.isDisposed=!0,n.dispose.apply(n.instance),this._addons.splice(c,1)}}},8771:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferApiView=void 0;const c=n(3785),p=n(511);i.BufferApiView=class{constructor(o,f){this._buffer=o,this.type=f}init(o){return this._buffer=o,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(o){const f=this._buffer.lines.get(o);if(f)return new c.BufferLineApiView(f)}getNullCell(){return new p.CellData}}},3785:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLineApiView=void 0;const c=n(511);i.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,o){if(!(p<0||p>=this._line.length))return o?(this._line.loadCell(p,o),o):this._line.loadCell(p,new c.CellData)}translateToString(p,o,f){return this._line.translateToString(p,o,f)}}},8285:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferNamespaceApi=void 0;const c=n(8771),p=n(8460),o=n(844);class f extends o.Disposable{constructor(S){super(),this._core=S,this._onBufferChange=this.register(new p.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new c.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new c.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}i.BufferNamespaceApi=f},7975:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ParserApi=void 0,i.ParserApi=class{constructor(n){this._core=n}registerCsiHandler(n,c){return this._core.registerCsiHandler(n,p=>c(p.toArray()))}addCsiHandler(n,c){return this.registerCsiHandler(n,c)}registerDcsHandler(n,c){return this._core.registerDcsHandler(n,(p,o)=>c(p,o.toArray()))}addDcsHandler(n,c){return this.registerDcsHandler(n,c)}registerEscHandler(n,c){return this._core.registerEscHandler(n,c)}addEscHandler(n,c){return this.registerEscHandler(n,c)}registerOscHandler(n,c){return this._core.registerOscHandler(n,c)}addOscHandler(n,c){return this.registerOscHandler(n,c)}}},7090:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeApi=void 0,i.UnicodeApi=class{constructor(n){this._core=n}register(n){this._core.unicodeService.register(n)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(n){this._core.unicodeService.activeVersion=n}}},744:function(x,i,n){var c=this&&this.__decorate||function(s,r,e,t){var a,m=arguments.length,v=m<3?r:t===null?t=Object.getOwnPropertyDescriptor(r,e):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,r,e,t);else for(var y=s.length-1;y>=0;y--)(a=s[y])&&(v=(m<3?a(v):m>3?a(r,e,v):a(r,e))||v);return m>3&&v&&Object.defineProperty(r,e,v),v},p=this&&this.__param||function(s,r){return function(e,t){r(e,t,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferService=i.MINIMUM_ROWS=i.MINIMUM_COLS=void 0;const o=n(8460),f=n(844),g=n(5295),S=n(2585);i.MINIMUM_COLS=2,i.MINIMUM_ROWS=1;let l=i.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(s){super(),this.isUserScrolling=!1,this._onResize=this.register(new o.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(s.rawOptions.cols||0,i.MINIMUM_COLS),this.rows=Math.max(s.rawOptions.rows||0,i.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(s,this))}resize(s,r){this.cols=s,this.rows=r,this.buffers.resize(s,r),this._onResize.fire({cols:s,rows:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(s,r=!1){const e=this.buffer;let t;t=this._cachedBlankLine,t&&t.length===this.cols&&t.getFg(0)===s.fg&&t.getBg(0)===s.bg||(t=e.getBlankLine(s,r),this._cachedBlankLine=t),t.isWrapped=r;const a=e.ybase+e.scrollTop,m=e.ybase+e.scrollBottom;if(e.scrollTop===0){const v=e.lines.isFull;m===e.lines.length-1?v?e.lines.recycle().copyFrom(t):e.lines.push(t.clone()):e.lines.splice(m+1,0,t.clone()),v?this.isUserScrolling&&(e.ydisp=Math.max(e.ydisp-1,0)):(e.ybase++,this.isUserScrolling||e.ydisp++)}else{const v=m-a+1;e.lines.shiftElements(a+1,v-1,-1),e.lines.set(m,t.clone())}this.isUserScrolling||(e.ydisp=e.ybase),this._onScroll.fire(e.ydisp)}scrollLines(s,r,e){const t=this.buffer;if(s<0){if(t.ydisp===0)return;this.isUserScrolling=!0}else s+t.ydisp>=t.ybase&&(this.isUserScrolling=!1);const a=t.ydisp;t.ydisp=Math.max(Math.min(t.ydisp+s,t.ybase),0),a!==t.ydisp&&(r||this._onScroll.fire(t.ydisp))}};i.BufferService=l=c([p(0,S.IOptionsService)],l)},7994:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CharsetService=void 0,i.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(n){this.glevel=n,this.charset=this._charsets[n]}setgCharset(n,c){this._charsets[n]=c,this.glevel===n&&(this.charset=c)}}},1753:function(x,i,n){var c=this&&this.__decorate||function(t,a,m,v){var y,d=arguments.length,C=d<3?a:v===null?v=Object.getOwnPropertyDescriptor(a,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(t,a,m,v);else for(var D=t.length-1;D>=0;D--)(y=t[D])&&(C=(d<3?y(C):d>3?y(a,m,C):y(a,m))||C);return d>3&&C&&Object.defineProperty(a,m,C),C},p=this&&this.__param||function(t,a){return function(m,v){a(m,v,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreMouseService=void 0;const o=n(2585),f=n(8460),g=n(844),S={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:t=>t.button!==4&&t.action===1&&(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)},VT200:{events:19,restrict:t=>t.action!==32},DRAG:{events:23,restrict:t=>t.action!==32||t.button!==3},ANY:{events:31,restrict:t=>!0}};function l(t,a){let m=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return t.button===4?(m|=64,m|=t.action):(m|=3&t.button,4&t.button&&(m|=64),8&t.button&&(m|=128),t.action===32?m|=32:t.action!==0||a||(m|=3)),m}const s=String.fromCharCode,r={DEFAULT:t=>{const a=[l(t,!1)+32,t.col+32,t.row+32];return a[0]>255||a[1]>255||a[2]>255?"":`\x1B[M${s(a[0])}${s(a[1])}${s(a[2])}`},SGR:t=>{const a=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${l(t,!0)};${t.col};${t.row}${a}`},SGR_PIXELS:t=>{const a=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${l(t,!0)};${t.x};${t.y}${a}`}};let e=i.CoreMouseService=class extends g.Disposable{constructor(t,a){super(),this._bufferService=t,this._coreService=a,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const m of Object.keys(S))this.addProtocol(m,S[m]);for(const m of Object.keys(r))this.addEncoding(m,r[m]);this.reset()}addProtocol(t,a){this._protocols[t]=a}addEncoding(t,a){this._encodings[t]=a}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(t){if(!this._protocols[t])throw new Error(`unknown protocol "${t}"`);this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(t){if(!this._encodings[t])throw new Error(`unknown encoding "${t}"`);this._activeEncoding=t}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows||t.button===4&&t.action===32||t.button===3&&t.action!==32||t.button!==4&&(t.action===2||t.action===3)||(t.col++,t.row++,t.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,t,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(t))return!1;const a=this._encodings[this._activeEncoding](t);return a&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(a):this._coreService.triggerDataEvent(a,!0)),this._lastEvent=t,!0}explainEvents(t){return{down:!!(1&t),up:!!(2&t),drag:!!(4&t),move:!!(8&t),wheel:!!(16&t)}}_equalEvents(t,a,m){if(m){if(t.x!==a.x||t.y!==a.y)return!1}else if(t.col!==a.col||t.row!==a.row)return!1;return t.button===a.button&&t.action===a.action&&t.ctrl===a.ctrl&&t.alt===a.alt&&t.shift===a.shift}};i.CoreMouseService=e=c([p(0,o.IBufferService),p(1,o.ICoreService)],e)},6975:function(x,i,n){var c=this&&this.__decorate||function(e,t,a,m){var v,y=arguments.length,d=y<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,a):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,t,a,m);else for(var C=e.length-1;C>=0;C--)(v=e[C])&&(d=(y<3?v(d):y>3?v(t,a,d):v(t,a))||d);return y>3&&d&&Object.defineProperty(t,a,d),d},p=this&&this.__param||function(e,t){return function(a,m){t(a,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreService=void 0;const o=n(1439),f=n(8460),g=n(844),S=n(2585),l=Object.freeze({insertMode:!1}),s=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let r=i.CoreService=class extends g.Disposable{constructor(e,t,a){super(),this._bufferService=e,this._logService=t,this._optionsService=a,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(s)}reset(){this.modes=(0,o.clone)(l),this.decPrivateModes=(0,o.clone)(s)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const a=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&a.ybase!==a.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(m=>m.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};i.CoreService=r=c([p(0,S.IBufferService),p(1,S.ILogService),p(2,S.IOptionsService)],r)},9074:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DecorationService=void 0;const c=n(8055),p=n(8460),o=n(844),f=n(6106);let g=0,S=0;class l extends o.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new f.SortedList(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this.register(new p.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new p.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,o.toDisposable)(()=>this.reset()))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new s(e);if(t){const a=t.marker.onDispose(()=>t.dispose());t.onDispose(()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),a.dispose())}),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,a){let m=0,v=0;for(const y of this._decorations.getKeyIterator(t))m=y.options.x??0,v=m+(y.options.width??1),e>=m&&e<v&&(!a||(y.options.layer??"bottom")===a)&&(yield y)}forEachDecorationAtCell(e,t,a,m){this._decorations.forEachByKey(t,v=>{g=v.options.x??0,S=g+(v.options.width??1),e>=g&&e<S&&(!a||(v.options.layer??"bottom")===a)&&m(v)})}}i.DecorationService=l;class s extends o.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=c.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=c.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new p.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new p.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InstantiationService=i.ServiceCollection=void 0;const c=n(2585),p=n(8343);class o{constructor(...g){this._entries=new Map;for(const[S,l]of g)this.set(S,l)}set(g,S){const l=this._entries.get(g);return this._entries.set(g,S),l}forEach(g){for(const[S,l]of this._entries.entries())g(S,l)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}}i.ServiceCollection=o,i.InstantiationService=class{constructor(){this._services=new o,this._services.set(c.IInstantiationService,this)}setService(f,g){this._services.set(f,g)}getService(f){return this._services.get(f)}createInstance(f,...g){const S=(0,p.getServiceDependencies)(f).sort((r,e)=>r.index-e.index),l=[];for(const r of S){const e=this._services.get(r.id);if(!e)throw new Error(`[createInstance] ${f.name} depends on UNKNOWN service ${r.id}.`);l.push(e)}const s=S.length>0?S[0].index:g.length;if(g.length!==s)throw new Error(`[createInstance] First service dependency of ${f.name} at position ${s+1} conflicts with ${g.length} static arguments`);return new f(...g,...l)}}},7866:function(x,i,n){var c=this&&this.__decorate||function(s,r,e,t){var a,m=arguments.length,v=m<3?r:t===null?t=Object.getOwnPropertyDescriptor(r,e):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,r,e,t);else for(var y=s.length-1;y>=0;y--)(a=s[y])&&(v=(m<3?a(v):m>3?a(r,e,v):a(r,e))||v);return m>3&&v&&Object.defineProperty(r,e,v),v},p=this&&this.__param||function(s,r){return function(e,t){r(e,t,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;const o=n(844),f=n(2585),g={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF};let S,l=i.LogService=class extends o.Disposable{get logLevel(){return this._logLevel}constructor(s){super(),this._optionsService=s,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),S=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(s){for(let r=0;r<s.length;r++)typeof s[r]=="function"&&(s[r]=s[r]())}_log(s,r,e){this._evalLazyOptionalParams(e),s.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+r,...e)}trace(s,...r){var e;this._logLevel<=f.LogLevelEnum.TRACE&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.trace.bind(this._optionsService.options.logger))??console.log,s,r)}debug(s,...r){var e;this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.debug.bind(this._optionsService.options.logger))??console.log,s,r)}info(s,...r){var e;this._logLevel<=f.LogLevelEnum.INFO&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.info.bind(this._optionsService.options.logger))??console.info,s,r)}warn(s,...r){var e;this._logLevel<=f.LogLevelEnum.WARN&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.warn.bind(this._optionsService.options.logger))??console.warn,s,r)}error(s,...r){var e;this._logLevel<=f.LogLevelEnum.ERROR&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.error.bind(this._optionsService.options.logger))??console.error,s,r)}};i.LogService=l=c([p(0,f.IOptionsService)],l),i.setTraceLogger=function(s){S=s},i.traceCall=function(s,r,e){if(typeof e.value!="function")throw new Error("not supported");const t=e.value;e.value=function(...a){if(S.logLevel!==f.LogLevelEnum.TRACE)return t.apply(this,a);S.trace(`GlyphRenderer#${t.name}(${a.map(v=>JSON.stringify(v)).join(", ")})`);const m=t.apply(this,a);return S.trace(`GlyphRenderer#${t.name} return`,m),m}}},7302:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionsService=i.DEFAULT_OPTIONS=void 0;const c=n(8460),p=n(844),o=n(6114);i.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:o.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const f=["normal","bold","100","200","300","400","500","600","700","800","900"];class g extends p.Disposable{constructor(l){super(),this._onOptionChange=this.register(new c.EventEmitter),this.onOptionChange=this._onOptionChange.event;const s={...i.DEFAULT_OPTIONS};for(const r in l)if(r in s)try{const e=l[r];s[r]=this._sanitizeAndValidateOption(r,e)}catch(e){console.error(e)}this.rawOptions=s,this.options={...s},this._setupOptions(),this.register((0,p.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(l,s){return this.onOptionChange(r=>{r===l&&s(this.rawOptions[l])})}onMultipleOptionChange(l,s){return this.onOptionChange(r=>{l.indexOf(r)!==-1&&s()})}_setupOptions(){const l=r=>{if(!(r in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);return this.rawOptions[r]},s=(r,e)=>{if(!(r in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);e=this._sanitizeAndValidateOption(r,e),this.rawOptions[r]!==e&&(this.rawOptions[r]=e,this._onOptionChange.fire(r))};for(const r in this.rawOptions){const e={get:l.bind(this,r),set:s.bind(this,r)};Object.defineProperty(this.options,r,e)}}_sanitizeAndValidateOption(l,s){switch(l){case"cursorStyle":if(s||(s=i.DEFAULT_OPTIONS[l]),!function(r){return r==="block"||r==="underline"||r==="bar"}(s))throw new Error(`"${s}" is not a valid value for ${l}`);break;case"wordSeparator":s||(s=i.DEFAULT_OPTIONS[l]);break;case"fontWeight":case"fontWeightBold":if(typeof s=="number"&&1<=s&&s<=1e3)break;s=f.includes(s)?s:i.DEFAULT_OPTIONS[l];break;case"cursorWidth":s=Math.floor(s);case"lineHeight":case"tabStopWidth":if(s<1)throw new Error(`${l} cannot be less than 1, value: ${s}`);break;case"minimumContrastRatio":s=Math.max(1,Math.min(21,Math.round(10*s)/10));break;case"scrollback":if((s=Math.min(s,4294967295))<0)throw new Error(`${l} cannot be less than 0, value: ${s}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(s<=0)throw new Error(`${l} cannot be less than or equal to 0, value: ${s}`);break;case"rows":case"cols":if(!s&&s!==0)throw new Error(`${l} must be numeric, value: ${s}`);break;case"windowsPty":s=s??{}}return s}}i.OptionsService=g},2660:function(x,i,n){var c=this&&this.__decorate||function(g,S,l,s){var r,e=arguments.length,t=e<3?S:s===null?s=Object.getOwnPropertyDescriptor(S,l):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")t=Reflect.decorate(g,S,l,s);else for(var a=g.length-1;a>=0;a--)(r=g[a])&&(t=(e<3?r(t):e>3?r(S,l,t):r(S,l))||t);return e>3&&t&&Object.defineProperty(S,l,t),t},p=this&&this.__param||function(g,S){return function(l,s){S(l,s,g)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkService=void 0;const o=n(2585);let f=i.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){const S=this._bufferService.buffer;if(g.id===void 0){const a=S.addMarker(S.ybase+S.y),m={data:g,id:this._nextId++,lines:[a]};return a.onDispose(()=>this._removeMarkerFromLink(m,a)),this._dataByLinkId.set(m.id,m),m.id}const l=g,s=this._getEntryIdKey(l),r=this._entriesWithId.get(s);if(r)return this.addLineToLink(r.id,S.ybase+S.y),r.id;const e=S.addMarker(S.ybase+S.y),t={id:this._nextId++,key:this._getEntryIdKey(l),data:l,lines:[e]};return e.onDispose(()=>this._removeMarkerFromLink(t,e)),this._entriesWithId.set(t.key,t),this._dataByLinkId.set(t.id,t),t.id}addLineToLink(g,S){const l=this._dataByLinkId.get(g);if(l&&l.lines.every(s=>s.line!==S)){const s=this._bufferService.buffer.addMarker(S);l.lines.push(s),s.onDispose(()=>this._removeMarkerFromLink(l,s))}}getLinkData(g){var S;return(S=this._dataByLinkId.get(g))==null?void 0:S.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,S){const l=g.lines.indexOf(S);l!==-1&&(g.lines.splice(l,1),g.lines.length===0&&(g.data.id!==void 0&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};i.OscLinkService=f=c([p(0,o.IBufferService)],f)},8343:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;const n="di$target",c="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(p){return p[c]||[]},i.createDecorator=function(p){if(i.serviceRegistry.has(p))return i.serviceRegistry.get(p);const o=function(f,g,S){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(l,s,r){s[n]===s?s[c].push({id:l,index:r}):(s[c]=[{id:l,index:r}],s[n]=s)})(o,f,S)};return o.toString=()=>p,i.serviceRegistry.set(p,o),o}},2585:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;const c=n(8343);var p;i.IBufferService=(0,c.createDecorator)("BufferService"),i.ICoreMouseService=(0,c.createDecorator)("CoreMouseService"),i.ICoreService=(0,c.createDecorator)("CoreService"),i.ICharsetService=(0,c.createDecorator)("CharsetService"),i.IInstantiationService=(0,c.createDecorator)("InstantiationService"),function(o){o[o.TRACE=0]="TRACE",o[o.DEBUG=1]="DEBUG",o[o.INFO=2]="INFO",o[o.WARN=3]="WARN",o[o.ERROR=4]="ERROR",o[o.OFF=5]="OFF"}(p||(i.LogLevelEnum=p={})),i.ILogService=(0,c.createDecorator)("LogService"),i.IOptionsService=(0,c.createDecorator)("OptionsService"),i.IOscLinkService=(0,c.createDecorator)("OscLinkService"),i.IUnicodeService=(0,c.createDecorator)("UnicodeService"),i.IDecorationService=(0,c.createDecorator)("DecorationService")},1480:(x,i,n)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeService=void 0;const c=n(8460),p=n(225);class o{static extractShouldJoin(g){return(1&g)!=0}static extractWidth(g){return g>>1&3}static extractCharKind(g){return g>>3}static createPropertyValue(g,S,l=!1){return(16777215&g)<<3|(3&S)<<1|(l?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new c.EventEmitter,this.onChange=this._onChange.event;const g=new p.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw new Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let S=0,l=0;const s=g.length;for(let r=0;r<s;++r){let e=g.charCodeAt(r);if(55296<=e&&e<=56319){if(++r>=s)return S+this.wcwidth(e);const m=g.charCodeAt(r);56320<=m&&m<=57343?e=1024*(e-55296)+m-56320+65536:S+=this.wcwidth(m)}const t=this.charProperties(e,l);let a=o.extractWidth(t);o.extractShouldJoin(t)&&(a-=o.extractWidth(l)),S+=a,l=t}return S}charProperties(g,S){return this._activeProvider.charProperties(g,S)}}i.UnicodeService=o}},b={};function w(x){var i=b[x];if(i!==void 0)return i.exports;var n=b[x]={exports:{}};return _[x].call(n.exports,n,n.exports,w),n.exports}var O={};return(()=>{var x=O;Object.defineProperty(x,"__esModule",{value:!0}),x.Terminal=void 0;const i=w(9042),n=w(3236),c=w(844),p=w(5741),o=w(8285),f=w(7975),g=w(7090),S=["cols","rows"];class l extends c.Disposable{constructor(r){super(),this._core=this.register(new n.Terminal(r)),this._addonManager=this.register(new p.AddonManager),this._publicOptions={...this._core.options};const e=a=>this._core.options[a],t=(a,m)=>{this._checkReadonlyOptions(a),this._core.options[a]=m};for(const a in this._core.options){const m={get:e.bind(this,a),set:t.bind(this,a)};Object.defineProperty(this._publicOptions,a,m)}}_checkReadonlyOptions(r){if(S.includes(r))throw new Error(`Option "${r}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new f.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new o.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const r=this._core.coreService.decPrivateModes;let e="none";switch(this._core.coreMouseService.activeProtocol){case"X10":e="x10";break;case"VT200":e="vt200";break;case"DRAG":e="drag";break;case"ANY":e="any"}return{applicationCursorKeysMode:r.applicationCursorKeys,applicationKeypadMode:r.applicationKeypad,bracketedPasteMode:r.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:e,originMode:r.origin,reverseWraparoundMode:r.reverseWraparound,sendFocusMode:r.sendFocus,wraparoundMode:r.wraparound}}get options(){return this._publicOptions}set options(r){for(const e in r)this._publicOptions[e]=r[e]}blur(){this._core.blur()}focus(){this._core.focus()}input(r,e=!0){this._core.input(r,e)}resize(r,e){this._verifyIntegers(r,e),this._core.resize(r,e)}open(r){this._core.open(r)}attachCustomKeyEventHandler(r){this._core.attachCustomKeyEventHandler(r)}attachCustomWheelEventHandler(r){this._core.attachCustomWheelEventHandler(r)}registerLinkProvider(r){return this._core.registerLinkProvider(r)}registerCharacterJoiner(r){return this._checkProposedApi(),this._core.registerCharacterJoiner(r)}deregisterCharacterJoiner(r){this._checkProposedApi(),this._core.deregisterCharacterJoiner(r)}registerMarker(r=0){return this._verifyIntegers(r),this._core.registerMarker(r)}registerDecoration(r){return this._checkProposedApi(),this._verifyPositiveIntegers(r.x??0,r.width??0,r.height??0),this._core.registerDecoration(r)}hasSelection(){return this._core.hasSelection()}select(r,e,t){this._verifyIntegers(r,e,t),this._core.select(r,e,t)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(r,e){this._verifyIntegers(r,e),this._core.selectLines(r,e)}dispose(){super.dispose()}scrollLines(r){this._verifyIntegers(r),this._core.scrollLines(r)}scrollPages(r){this._verifyIntegers(r),this._core.scrollPages(r)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(r){this._verifyIntegers(r),this._core.scrollToLine(r)}clear(){this._core.clear()}write(r,e){this._core.write(r,e)}writeln(r,e){this._core.write(r),this._core.write(`\r
`,e)}paste(r){this._core.paste(r)}refresh(r,e){this._verifyIntegers(r,e),this._core.refresh(r,e)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(r){this._addonManager.loadAddon(this,r)}static get strings(){return i}_verifyIntegers(...r){for(const e of r)if(e===1/0||isNaN(e)||e%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...r){for(const e of r)if(e&&(e===1/0||isNaN(e)||e%1!=0||e<0))throw new Error("This API only accepts positive integers")}}x.Terminal=l})(),O})())}(it)),it.exports}var ns=rs(),rt={exports:{}},wt;function os(){return wt||(wt=1,function(u,h){(function(_,b){u.exports=b()})(self,()=>(()=>{var _={};return(()=>{var b=_;Object.defineProperty(b,"__esModule",{value:!0}),b.FitAddon=void 0,b.FitAddon=class{activate(w){this._terminal=w}dispose(){}fit(){const w=this.proposeDimensions();if(!w||!this._terminal||isNaN(w.cols)||isNaN(w.rows))return;const O=this._terminal._core;this._terminal.rows===w.rows&&this._terminal.cols===w.cols||(O._renderService.clear(),this._terminal.resize(w.cols,w.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const w=this._terminal._core,O=w._renderService.dimensions;if(O.css.cell.width===0||O.css.cell.height===0)return;const x=this._terminal.options.scrollback===0?0:w.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),n=parseInt(i.getPropertyValue("height")),c=Math.max(0,parseInt(i.getPropertyValue("width"))),p=window.getComputedStyle(this._terminal.element),o=n-(parseInt(p.getPropertyValue("padding-top"))+parseInt(p.getPropertyValue("padding-bottom"))),f=c-(parseInt(p.getPropertyValue("padding-right"))+parseInt(p.getPropertyValue("padding-left")))-x;return{cols:Math.max(2,Math.floor(f/O.css.cell.width)),rows:Math.max(1,Math.floor(o/O.css.cell.height))}}}})(),_})())}(rt)),rt.exports}var as=os();const ve="system",Wt="user";function*Nt(u){const{length:h}=u;for(let _=0;_<h;++_)yield u.at(_)}var B;(function(u){u.null="null",u.boolean="boolean",u.integer="integer",u.string="string",u.name="name",u.mark="mark",u.operator="operator",u.array="array",u.dictionary="dictionary"})(B||(B={}));function*ut(u,h=0,_){const b=/%[^\n]*|(?:"([^"]*)")|\s|((?:-|\+)?\d+)|(\[|\]|{|}|<<|>>|Â«|Â»|[^[\]{}<>Â«Â»\s]+)/g;b.lastIndex=h;let w=b.exec(u);for(;w!==null;){const[O,x,i,n]=w,c={isReadOnly:!0};_!==void 0&&(c.debugSource={source:u,filename:_,pos:w.index,length:O.length}),x!==void 0?yield{...c,type:B.string,isExecutable:!1,string:x}:i!==void 0?yield{...c,type:B.integer,isExecutable:!1,integer:parseInt(i,10)}:n!==void 0&&(n.length>1&&n.startsWith("/")?yield{...c,type:B.name,isExecutable:!1,name:n.substring(1)}:yield{...c,type:B.name,isExecutable:!0,name:n}),w=b.exec(u)}}const dt={type:B.mark,isReadOnly:!0,isExecutable:!1},oe={type:B.null,isReadOnly:!0,isExecutable:!1};class kt extends Error{constructor(h,_){super(h),this.name="AssertionFailed",this.cause=_}}function G(u,h,_){if(typeof u!="boolean"){if(!u.success)throw new kt("Unexpected failed result",u.exception)}else if(!u)throw new kt(h??"assertion failed",_)}function ze(u,h){if(u.type!==B.integer)return{success:!1,exception:"typeCheck"};const{integer:_}=u;return _<0||_>=h?{success:!1,exception:"rangeCheck"}:{success:!0,value:_}}function cs(u){return typeof u=="object"&&u!==null}const ls={[B.string]:{isReadOnly:!0},[B.operator]:{isReadOnly:!0,isExecutable:!0}};function hs(u){const h=["isReadOnly","isExecutable"],_=ls[u.type];for(const b of h){const w=_&&_[b];if(w!==void 0){if(u[b]!==w)return!0}else if(typeof u[b]!="boolean")return!0}return!1}function us({isReadOnly:u,isExecutable:h},{isReadOnly:_,isExecutable:b}={}){return!(_!==void 0&&u!==_||b!==void 0&&h!==b)}function ds(u,h,_,b){return cs(h)&&h.type===u&&!hs(h)&&us(h,_)&&b(h)}function fs(u){return typeof u=="number"&&u%1===0}const Et=(u,h)=>typeof u=="function"&&u.length===h,_s=u=>fs(u)&&u>=0;function ps(u,h){return ds(B.array,u,h,({isReadOnly:_,array:b})=>b!==void 0&&_s(b.length)&&Et(b.at,1)&&(_||Et(b.set,2)))}function Je(u){let h=0;for(;h<u.length&&u.at(h).type!==B.mark;)++h;return h===u.length?{success:!1,exception:"unmatchedMark"}:{success:!0,value:h}}const me=Number.POSITIVE_INFINITY,ne=0,ue=-1,Se=Number.NEGATIVE_INFINITY;var ye;(function(u){u[u.constant=0]="constant",u[u.implementation=1]="implementation"})(ye||(ye={}));const gs="â",Fe="â»",Ee="â";function vs(u,h){let _=1,b=0,w=u.indexOf(`
`);for(;w!==-1&&b+h>w;)++w,h-=w-b,b=w,++_,w=u.indexOf(`
`,b);return{line:_,col:h+1}}function ms(u){const h=u.split(/(\\|\/)/).filter(_=>_.trim());return h.length<3?u:"â¦"+h.splice(-2).join("")}function Ss(u,h,_){let b;if(h!==void 0?b=`${u}@${h}`:b=u,_<1||b.length<=_)return b;let w="";if(h!==void 0){if(w=`@${ms(h)}`,b=`${u}${w}`,b.length<=_)return b;_<w.length?w="":_-=w.length}const O=u.indexOf(Fe),x=u.indexOf(Ee,O+1),i=x-O+1;if(O>-1&&x>-1&&i>0)if(_>i){let n=O-Math.ceil((_-i)/2);n+_>u.length&&(n=u.length-_+1),n>0&&(u="â¦"+u.substring(n))}else u="â¦"+u.substring(O-1);return u.length>_&&(u=u.substring(0,_-1)+"â¦"),w?`${u}${w}`:u}function be(u,h,{includeDebugSource:_=!1,maxWidth:b=0}){let w;if(h!==void 0&&_){const{filename:O,source:x}=h,{line:i,col:n}=vs(x,h.pos);w=`${O}:${i}:${n}`}return Ss(u,w,b)}const Ut={[B.null]:({debugSource:u},h)=>be(gs,u,h),[B.boolean]:({isSet:u,debugSource:h},_)=>be(u?"true":"false",h,_),[B.integer]:({integer:u,debugSource:h},_)=>be(u.toString(),h,_),[B.string]:({isExecutable:u,string:h,debugSource:_},b)=>{var O;let w;if(u){const{operatorState:x}=b;if(x!==void 0&&x>=ne){const[i]=ut(h,x,"toString"),n=(O=i==null?void 0:i.debugSource)==null?void 0:O.length;n!==void 0&&(w=h.substring(0,x)+Fe+h.substring(x,x+n)+Ee+h.substring(x+n))}w||(w=h)}else w=JSON.stringify(h);return be(w,_,b)},[B.name]:({isExecutable:u,name:h,debugSource:_},b)=>{let w=h.replace(/ /g,"â£");return u||(w=`/${w}`),be(w,_,b)},[B.mark]:({debugSource:u},h)=>be("--mark--",u,h),[B.operator]:({operator:u,debugSource:h},_)=>{let b=`-${u.name}-`;const{operatorState:w}=_;return w!==void 0&&w!==me&&(w>ne?b+=`${Fe}${w==null?void 0:w.toString()}`:w===ue?b+=Ee:w===Se?b+=`${Ee}${Ee}`:w<ue&&(b+=`${Ee}${w==null?void 0:w.toString()}`)),be(b,h,_)},[B.array]:({isExecutable:u,array:h,debugSource:_},b)=>{const w=[];u?w.push("{"):w.push("[");const{length:O}=h,{operatorState:x}=b;for(let i=0;i<O;++i){const n=h.at(i),c=Ut[n.type](n,Object.assign({},b,{includeDebugSource:!1,maxWidth:0,operatorState:me}));u&&x===i?w.push(Fe+c+Ee):w.push(c)}return u?w.push("}"):w.push("]"),be(w.join(" "),_,b)},[B.dictionary]:({dictionary:u,isReadOnly:h,debugSource:_},b)=>{let O=u.names.length.toString().toString();return h||(O+="/â"),be(`--dictionary(${O})--`,_,b)}};function qe(u,h){return Ut[u.type](u,h??{includeDebugSource:!1,maxWidth:0})}function ys(u,h){const{length:_}=u,b=[];for(let w=0;w<_;++w){const O=u.at(w),x=u.operatorStateAt(w);b.push(qe(O,Object.assign({},h,{operatorState:x})))}return b}function ce(u){return{type:B.boolean,isExecutable:!1,isReadOnly:!0,isSet:u}}function de(u){return u%1!==0||u<Number.MIN_SAFE_INTEGER||u>Number.MAX_SAFE_INTEGER?{success:!1,exception:"undefinedResult"}:{success:!0,value:{type:B.integer,isExecutable:!1,isReadOnly:!0,integer:u}}}function Te(u,{isExecutable:h=!1,tracker:_}={}){return _?{type:B.string,isExecutable:h,isReadOnly:!0,string:u,tracker:_}:{type:B.string,isExecutable:h,isReadOnly:!0,string:u}}function jt(u,{isExecutable:h=!1,tracker:_}={}){return _?{type:B.name,isExecutable:h,isReadOnly:!0,name:u,tracker:_}:{type:B.name,isExecutable:h,isReadOnly:!0,name:u}}const bs={[B.null]:()=>null,[B.boolean]:u=>u.isSet,[B.integer]:u=>u.integer,[B.string]:u=>u.string,[B.name]:u=>u.name,[B.mark]:()=>null,[B.operator]:u=>u.operator,[B.array]:u=>u.array,[B.dictionary]:u=>u.dictionary};function Cs(u){return bs[u.type](u)}function Ae(...u){return u.map(h=>Cs(h))}const De={};function X(u,h){var w;G(!De[u.name],`Operator ${u.name} is not defined`),Object.freeze(u);const _={type:ye.implementation,name:u.name,typeCheck:(w=u.signature)==null?void 0:w.input,implementation:h},b={type:B.operator,isExecutable:!0,isReadOnly:!0,operator:_};return De[u.name]={definition:u,value:b},u.aliases&&u.aliases.forEach(O=>{De[O]={definition:u,value:{...b,operator:{...b.operator,name:O}}}}),b}function Ye(u,h){const _={type:ye.constant,name:u.name,constant:h};De[u.name]={definition:u,value:{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:_}}}const xt="string",zt=4,ws=4,ks=32,nt=u=>new TextEncoder().encode(u).length+1,Rt=Symbol("MemoryTracker::MemoryPointer");function Ke(u,h){return{bytes:(u.bytes??0)+(h.bytes??0),integers:(u.integers??0)+(h.integers??0),pointers:(u.pointers??0)+(h.pointers??0),values:(u.values??0)+(h.values??0)}}function ot(u){const{bytes:h=0,integers:_=0,pointers:b=0,values:w=0}=u;return h+_*zt+b*ws+w*ks}class Be{constructor(h={}){Q(this,"_total",1/0);Q(this,"_used",0);Q(this,"_peak",0);Q(this,"_byType",{system:0,user:0,string:0});Q(this,"_containers",[]);Q(this,"_byContainers");Q(this,"_strings",new Map);const{total:_=1/0}=h;this._total=_,h.debug&&(this._byContainers=new WeakMap)}isAvailable(h,_){G(!!_);const b=ot(h);return G(b>0),this._used+b<=this._total?{success:!0,value:b}:{success:!1,exception:"vmOverflow"}}allocate(h,_,b){G(_!=="string");const w=this.isAvailable(h,_);if(!w.success)return w;const{value:O}=w;return this.register(O,_,b),{success:!0,value:{[Rt]:!0,bytes:O,type:_}}}release({bytes:h,type:_},b){this.register(-h,_,b)}register(h,_,b){if(h>0){if(this._used+h>this._total)return{success:!1,exception:"vmOverflow"}}else G(h<this._used);if(this._byType[_]+=h,this._used+=h,this._peak=Math.max(this._used,this._peak),this._byContainers&&b!==this){let w=this._byContainers.get(b);if(w===void 0){const O=new WeakRef(b);w={container:O,type:_,total:0,calls:[]},this._containers.push(O),this._byContainers.set(b,w)}if(G(w.type===_,"Unexpected memory type change",{bytes:h,type:_,container:b}),w.total+=h,G(w.total>=0,"Invalid memory registration",{bytes:h,type:_,container:b}),w.total!==0){let O;try{throw new Error}catch(x){O=x.stack}w.calls.push({bytes:h,type:_,stack:O})}else{const O=this._containers.findIndex(x=>x.deref()===b);this._containers.splice(O,1),this._byContainers.delete(b)}}return{success:!0,value:void 0}}*enumContainersAllocations(){if(this._byContainers!==void 0)for(const h of this._containers)yield this._byContainers.get(h.deref())}addStringRef(h){let _=this._strings.get(h)??0;if(_===0){const b=nt(h),w=this.register(ot({bytes:b,integers:1}),xt,this);if(!w.success)return w}return this._strings.set(h,++_),{success:!0,value:_}}releaseString(h){const _=this._strings.get(h);if(G(_!==void 0,"Unable to release string as it is not referenced",h),_===1){const b=nt(h);return this.release({[Rt]:!0,bytes:ot({bytes:b,integers:1}),type:xt},this),this._strings.delete(h),!1}return this._strings.set(h,_-1),!0}get used(){return this._used}get peak(){return this._peak}get total(){return this._total}get byType(){return this._byType}snapshot(){const h={used:this._used,peak:this._peak,total:this._total,byType:this._byType,string:[],system:[],user:[]};for(const[_,b]of this._strings.entries()){const w=nt(_);h.string.push({references:b,string:_,size:w,total:w+zt})}for(const{container:_,total:b,type:w,calls:O}of this.enumContainersAllocations()){const x={container:{class:"<unknown>"},total:b,calls:O},i=_.deref();i!==void 0&&(x.container.class=i.constructor.name),w===ve?h.system.push(x):h.user.push(x)}return h}addValueRef(h){const _=Ae(h)[0];G(typeof _=="string");const b=this.addStringRef(_);G(b),G(b.value!==1,"addValueRef must not be used to create a new string ref")}releaseValue(h){const _=Ae(h)[0];return G(typeof _=="string"),this.releaseString(_)}}const Lt=u=>{if(u.type===B.array)return u.array;if(u.type===B.dictionary)return u.dictionary;G(!1,"Invalid value type")};class xe{constructor(){Q(this,"_refCount");this._refCount=1}get refCount(){return this._refCount}addRef(){++this._refCount}release(){const h=--this._refCount;return h===0?(this._dispose(),!1):(G(h>0,"Superfluous release"),!0)}}Q(xe,"size",{integers:1}),Q(xe,"tracker",{addValueRef(h){Lt(h).addRef()},releaseValue(h){return Lt(h).release()}});class Ze extends xe{constructor(_,b,w,O=1){super();Q(this,"_memoryTracker");Q(this,"_memoryType");Q(this,"_initialCapacity");Q(this,"_capacityIncrement");Q(this,"_pointers",[]);Q(this,"_values",[]);this._memoryTracker=_,this._memoryType=b,this._initialCapacity=w,this._capacityIncrement=O,G(this._initialCapacity>0),G(this._capacityIncrement>=0);const x=this._memoryTracker.allocate(Ze.getSize(this._initialCapacity),this._memoryType,this);G(x),this._pointers.push(x.value)}_toValue({isReadOnly:_,isExecutable:b}){return{type:B.array,isReadOnly:_,isExecutable:b,tracker:xe.tracker,array:this}}toValue({isReadOnly:_=!0,isExecutable:b=!1}={}){return G(_&&!b,"Unsupported permissions"),this._toValue({isReadOnly:_,isExecutable:b})}static createInstance(_,b,w,O){G(w>0),G(O>=0);const x=_.isAvailable(this.getSize(w),b);if(!x.success)return x;const i=this;return{success:!0,value:new i(_,b,w,O)}}static getSize(_){return Ke(xe.size,{pointers:1,values:_})}getIncrementSize(_){return{pointers:1,values:_}}get memoryTracker(){return this._memoryTracker}get memoryType(){return this._memoryType}get length(){return this._values.length}at(_){return this._values[_]??oe}get capacity(){return this._initialCapacity+(this._pointers.length-1)*this._capacityIncrement}increaseCapacityIfNeeded(_){const b=_-this.capacity;if(b>0){if(this._capacityIncrement===0)return{success:!1,exception:"limitcheck"};let w=Math.ceil(b/this._capacityIncrement);for(;w>0;){const O=this._memoryTracker.allocate(this.getIncrementSize(this._capacityIncrement),this._memoryType,this);if(!O.success)return O;this._pointers.push(O.value),--w}}return{success:!0,value:void 0}}_push(_){var b;for(const w of _)(b=w.tracker)==null||b.addValueRef(w),this.pushImpl(w)}push(..._){const b=this.increaseCapacityIfNeeded(this._values.length+_.length);return b.success?(this._push(_),{success:!0,value:this._values.length}):b}reduceCapacityIfNeeded(_=this._values.length){for(;this._pointers.length>1&&this.capacity-this._capacityIncrement>=_;){const b=this._pointers.at(-1);this._pointers.pop(),this._memoryTracker.release(b,this)}}_pop(){var b;let _=this.popImpl();return _.type!==B.null&&((b=_.tracker)==null?void 0:b.releaseValue(_))===!1&&(_=oe),_}pop(){const _=this._pop();return this.reduceCapacityIfNeeded(),_}popush(_,b,...w){const{capacity:O}=this;let x;Array.isArray(b)?x=b.concat(w):b?x=[b].concat(w):x=[];const i=this.length-_+x.length;if(i>O){const n=this.increaseCapacityIfNeeded(i);if(!n.success)return n}for(;_>0;)this._pop(),--_;return this._push(x),this.reduceCapacityIfNeeded(),{success:!0,value:this.length}}clear(){for(;this.length>0;)this._pop();this.reduceCapacityIfNeeded()}_dispose(){this.clear(),this._memoryTracker.release(this._pointers[0],this)}}class vt extends Ze{static create(h,_,b,w){return super.createInstance(h,_,b,w)}get top(){const h=this._values[0];return h===void 0?oe:h}pushImpl(h){this._values.unshift(h)}popImpl(){const h=this.at(0);return this._values.shift(),h}}X({name:"aload",description:"loads all items of the array in the operand stack",labels:["array"],signature:{input:[{type:B.array}]},samples:[{in:"[ 1 2 3 ] aload pop",out:"1 2 3"}]},({operands:u},h)=>{const{array:_}=h;return u.popush(1,[...Nt(_)],h)});class ft extends Ze{static create(h,_,b,w){return super.createInstance(h,_,b,w)}toValue({isReadOnly:h=!0,isExecutable:_=!1}={}){return G(h||!_,"Unsupported permissions"),this._toValue({isReadOnly:h,isExecutable:_})}pushImpl(h){return this._values.push(h),{success:!0,value:void 0}}popImpl(){const h=this._values.at(-1)??oe;return this._values.pop(),h}set(h,_){var O,x;if(h<0)return{success:!1,exception:"rangeCheck"};let b=this._values[h]??oe;((O=b.tracker)==null?void 0:O.releaseValue(b))===!1&&(b=oe);const w=this.increaseCapacityIfNeeded(h+1);return w.success?((x=_.tracker)==null||x.addValueRef(_),this._values[h]=_,{success:!0,value:b}):w}}function mt({operands:u,calls:h}){return h.top.debugSource?u.push(Object.assign({debugSource:h.top.debugSource},dt)):u.push(dt)}function qt({operands:u,popCount:h,value:_,mark:b,closeOp:w}){return b.debugSource&&w.debugSource?u.popush(h,Object.assign({debugSource:{...b.debugSource,length:w.debugSource.pos-b.debugSource.pos+w.debugSource.length}},_)):u.popush(h,_)}const Dt="markpos",At="array",Ue=1,at=2;function Kt(u,{isExecutable:h}){const{operands:_,memoryTracker:b,calls:w}=u,{top:O}=w;if(w.topOperatorState===ne){const g=Je(_);if(!g.success)return g;const S=g.value,l=de(S);G(l);const s=w.def(Dt,l.value);return s.success&&(w.topOperatorState=Ue),s}const x=w.lookup(Dt);G(x.type===B.integer);const i=x.integer;if(w.topOperatorState===Ue){const g=ft.create(b,Wt,Math.max(i,1),1);if(!g.success)return g;const S=g.value,l=w.def(At,S.toValue({isReadOnly:h,isExecutable:h}));return l.success?w.topOperatorState=at:S.release(),l}const n=w.lookup(At);G(n.type===B.array);const c=n.array;G(c instanceof ft);const p=w.topOperatorState-at;if(p<i){w.topOperatorState=at+p+1;const g=c.set(i-p-1,_.at(p));return g.success||(c.release(),w.topOperatorState=Ue),g}const o=_.at(p),f=qt({operands:_,popCount:1+i,value:n,mark:o,closeOp:O});return f.success?w.topOperatorState=Se:w.topOperatorState=Ue,c.release(),f}X({name:"]",description:"finalizes an array",labels:["array","mark"],signature:{output:[{type:B.array,permissions:{isReadOnly:!1,isExecutable:!1}}]},samples:[{description:"builds an array and check length and type",in:"[ 1 2 3 ] dup length exch type",out:"3 /array"},{description:"allocates an empty array",in:"[] dup length exch type",out:"0 /array"},{description:"fails if the corresponding array start does not exist",in:" 1 2 3 ]",out:"1 2 3 unmatchedmark"}]},u=>Kt(u,{isExecutable:!1}));X({name:"[",description:"marks the beginning of an array",labels:["array","mark"],signature:{output:[{type:B.mark}]},samples:[{description:"builds an array and check length and type",in:"[ 1 2 3 ] dup length exch type",out:"3 /array"}]},mt);X({name:"and",description:"combines two booleans with and",labels:["boolean"],signature:{input:[{type:B.boolean},{type:B.boolean}],output:[{type:B.boolean}]},samples:[{in:"false false and",out:"false"},{in:"false true and",out:"false"},{in:"true false and",out:"false"},{in:"true true and",out:"true"}]},({operands:u},{isSet:h},{isSet:_})=>u.popush(2,ce(h&&_)));X({name:"or",description:"combines two booleans with or",labels:["boolean"],signature:{input:[{type:B.boolean},{type:B.boolean}],output:[{type:B.boolean}]},samples:[{in:"false false or",out:"false"},{in:"false true or",out:"true"},{in:"true false or",out:"true"},{in:"true true or",out:"true"}]},({operands:u},{isSet:h},{isSet:_})=>u.popush(2,ce(h||_)));X({name:"xor",description:"combines two booleans with exclusive or",labels:["boolean"],signature:{input:[{type:B.boolean},{type:B.boolean}],output:[{type:B.boolean}]},samples:[{in:"false false xor",out:"false"},{in:"false true xor",out:"true"},{in:"true false xor",out:"true"},{in:"true true xor",out:"false"}]},({operands:u},{isSet:h},{isSet:_})=>u.popush(2,ce(h&&!_||!h&&_)));class Re extends xe{constructor(_,b,w){super();Q(this,"_memoryTracker");Q(this,"_memoryType");Q(this,"_initialCapacity");Q(this,"_pointer");Q(this,"_slots",{});this._memoryTracker=_,this._memoryType=b,this._initialCapacity=w;const O=this._memoryTracker.allocate(Re.getSize(this._initialCapacity),this._memoryType,this);G(O),this._pointer=O.value}toValue({isReadOnly:_=!0,isExecutable:b}={}){return G(b!==!0,"Unsupported permissions"),{type:B.dictionary,isReadOnly:_,isExecutable:!1,tracker:xe.tracker,dictionary:this}}static getSize(_){return Ke(xe.size,{pointers:1+_,values:_})}static create(_,b,w){const O=_.isAvailable(Re.getSize(w),b);return O.success?{success:!0,value:new Re(_,b,w)}:O}get names(){return Object.keys(this._slots)}lookup(_){var b;return((b=this._slots[_])==null?void 0:b.value)??oe}_checkCapacityUsage(){let _=0;for(const b of Object.values(this._slots))b.pointer===this._pointer&&++_;return _}def(_,b){var x,i;let w=this._slots[_],O=(w==null?void 0:w.value)??oe;if(w!==void 0){if(((x=O.tracker)==null?void 0:x.releaseValue(O))===!1&&(O=oe),b.type===B.null)return w.pointer!==this._pointer&&this._memoryTracker.release(w.pointer,this),this._memoryTracker.releaseString(_),delete this._slots[_],{success:!0,value:O}}else if(b.type!==B.null){const n=this._memoryTracker.addStringRef(_);if(!n.success)return n;if(this._checkCapacityUsage()<this._initialCapacity)w={value:oe,pointer:this._pointer};else{const c=this._memoryTracker.allocate({values:1,pointers:3},this._memoryType,this);if(!c.success)return this._memoryTracker.releaseString(_),c;w={value:oe,pointer:c.value}}}return G(w!==void 0),w.value=b,(i=b.tracker)==null||i.addValueRef(b),this._slots[_]=w,{success:!0,value:O}}_dispose(){var _;for(const[b,w]of Object.entries(this._slots))this._memoryTracker.releaseString(b),(_=w.value.tracker)==null||_.releaseValue(w.value),w.pointer!==this._pointer&&this._memoryTracker.release(w.pointer,this);this._memoryTracker.release(this._pointer,this)}}X({name:">>",aliases:["Â»","dicttomark"],description:"finalizes a dictionary",labels:["dictionary","mark"],signature:{output:[{type:B.dictionary,permissions:{isExecutable:!1,isReadOnly:!1}}]},samples:[{description:"builds a dictionary check length and type",in:"<< /test 123 >> dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary check length and type",in:"Â« /test 123 Â» dup length exch type",out:"1 /dictionary"},{description:"builds a read/write dictionary",in:"Â« /test 123 Â» wcheck",out:"true"},{description:"builds a dictionary check length and type",in:"mark /test 123 dicttomark dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary with shared values, check length and type",in:"<< /test 123 /test_array [ ] /test_dictionary << >> >> dup length exch type",out:"3 /dictionary"},{description:"allocates an empty dictionary",in:"<<>> dup length exch type",out:"0 /dictionary"},{description:"fails if the corresponding dictionary start does not exist",in:"/test 123 >>",out:"/test 123 unmatchedmark"},{description:"fails if the dictionary definition is invalid (names must be strings)",in:"<< 123 /test >>",out:"mark 123 /test typecheck"},{description:"fails if the dictionary definition is invalid (missing name value pair)",in:"<< /test 123 /missing_value >>",out:"mark 123 /test /missing_value typecheck"}]},u=>{const{operands:h,memoryTracker:_,calls:b}=u,w=Je(h);if(!w.success)return w;const O=w.value;if(O%2!==0)return{success:!1,exception:"typeCheck"};for(let p=1;p<O;p+=2)if(h.at(p).type!==B.name)return{success:!1,exception:"typeCheck"};const{top:x}=b,i=Re.create(_,Wt,O/2);if(!i.success)return i;const n=i.value;for(let p=0;p<O;p+=2){const o=h.at(p),f=h.at(p+1),[g]=Ae(f),S=n.def(g,o);if(!S.success)return S}const c=qt({operands:h,popCount:O+1,value:n.toValue({isReadOnly:!1}),mark:h.at(O),closeOp:x});return n.release(),c});X({name:"<<",aliases:["Â«"],description:"marks the beginning of a dictionary",labels:["dictionary","mark"],signature:{output:[{type:B.mark}]},samples:[{description:"builds a dictionary check length and type",in:"<< /test 123 >> dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary check length and type",in:"Â« /test 123 Â» dup length exch type",out:"1 /dictionary"}]},u=>mt(u));X({name:"dictstackunderflow",description:"throws the exception : No custom dictionary left to unstack",labels:["exception"],signature:{exceptions:["dictstackunderflow"]},samples:[{in:"dictstackunderflow",out:"dictstackunderflow"}]},()=>({success:!1,exception:"dictStackUnderflow"}));X({name:"invalidaccess",description:"throws the exception : Object is read-only",labels:["exception"],signature:{exceptions:["invalidaccess"]},samples:[{in:"invalidaccess",out:"invalidaccess"}]},()=>({success:!1,exception:"invalidAccess"}));X({name:"limitcheck",description:"throws the exception : An implementation limit has been exceeded",labels:["exception"],signature:{exceptions:["limitcheck"]},samples:[{in:"limitcheck",out:"limitcheck"}]},()=>({success:!1,exception:"limitcheck"}));X({name:"rangecheck",description:"throws the exception : Operand is too big or too small",labels:["exception"],signature:{exceptions:["rangecheck"]},samples:[{in:"rangecheck",out:"rangecheck"}]},()=>({success:!1,exception:"rangeCheck"}));X({name:"stackunderflow",description:"throws the exception : Not enough operands on the stack to perform the operation",labels:["exception"],signature:{exceptions:["stackunderflow"]},samples:[{in:"stackunderflow",out:"stackunderflow"}]},()=>({success:!1,exception:"stackUnderflow"}));X({name:"stop",description:"throws the exception : Execution stopped",labels:["exception"],signature:{exceptions:["stop"]},samples:[{in:"stop",out:"stop"}]},()=>({success:!1,exception:"stop"}));X({name:"typecheck",description:"throws the exception : Operand is of the wrong type",labels:["exception"],signature:{exceptions:["typecheck"]},samples:[{in:"typecheck",out:"typecheck"}]},()=>({success:!1,exception:"typeCheck"}));X({name:"undefined",description:"throws the exception : Name is not defined in the dictionary stack",labels:["exception"],signature:{exceptions:["undefined"]},samples:[{in:"undefined",out:"undefined"}]},()=>({success:!1,exception:"undefined"}));X({name:"undefinedresult",description:"throws the exception : Result cannot be represented as a number",labels:["exception"],signature:{exceptions:["undefinedresult"]},samples:[{in:"undefinedresult",out:"undefinedresult"}]},()=>({success:!1,exception:"undefinedResult"}));X({name:"unmatchedmark",description:"throws the exception : Unmatched mark in the operand stack",labels:["exception"],signature:{exceptions:["unmatchedmark"]},samples:[{in:"unmatchedmark",out:"unmatchedmark"}]},()=>({success:!1,exception:"unmatchedMark"}));X({name:"vmoverflow",description:"throws the exception : Virtual memory exceeded",labels:["exception"],signature:{exceptions:["vmoverflow"]},samples:[{in:"vmoverflow",out:"vmoverflow"}]},()=>({success:!1,exception:"vmOverflow"}));X({name:"}",description:"finalizes a block",labels:["flow","mark"],signature:{output:[{type:B.array,permissions:{isExecutable:!0,isReadOnly:!0}}]},samples:[{description:"builds a block and check length and type",in:"{ 1 2 3 } dup length exch type",out:"3 /array"},{description:"allocated an empty block",in:"{} dup length exch type",out:"0 /array"},{description:"fails if the corresponding block start does not exist",in:"1 2 3 }",out:"1 2 3 unmatchedmark"}]},u=>(u.calls.topOperatorState===ne&&u.allowCall(),Kt(u,{isExecutable:!0})));const Es="Invalid operator state change";class $e extends vt{constructor(){super(...arguments);Q(this,"_dictionaries",[]);Q(this,"_steps",[])}static create(_,b,w,O){return G(b===ve),super.createInstance(_,b,w,O)}static getSize(_){return Ke(super.getSize(_),{integers:_,pointers:_})}getIncrementSize(_){return Ke(super.getIncrementSize(_),{integers:_,pointers:_})}pushImpl(_){super.pushImpl(_),this._dictionaries.unshift(void 0),this._steps.unshift(me)}popImpl(){const _=super.popImpl(),b=this._dictionaries[0];return b!==void 0&&b.release(),this._dictionaries.shift(),this._steps.shift(),_}snapshot(){const _=$e.create(this.memoryTracker,this.memoryType,this.length,0);if(!_.success)return _;const b=_.value;let w=this.length;for(;--w>=0;)b.push(this.at(w)),b._steps[0]=this.operatorStateAt(w);return{success:!0,value:b}}operatorStateAt(_){return this._steps[_]??me}get names(){return[]}lookup(_){const b=this._dictionaries[0];return b===void 0?oe:b.lookup(_)}def(_,b){if(this.length===0)return{success:!1,exception:"stackUnderflow"};let w=this._dictionaries[0];if(w===void 0){const O=Re.create(this.memoryTracker,ve,1);if(!O.success)return O;w=O.value,this._dictionaries[0]=w}return w.def(_,b)}get topOperatorState(){return G(this.length>0),this._steps[0]}set topOperatorState(_){const b=this.topOperatorState;(b===me&&_!==ne||b!==me&&_===ne||_===me||b===Se||_!==Se&&(b>ne&&_<ue||b<ue&&_>=ue||b===ue&&_>ne||b===ne&&_<ue))&&G(!1,Es),this._steps[0]=_}}const Tt="block",Bt="exception",Ot="stack",Mt=-2;X({name:"finally",description:"executes the final block whenever the command block is unstacked",labels:["flow"],signature:{input:[{type:B.array,permissions:{isExecutable:!0}},{type:B.array,permissions:{isExecutable:!0}}]},samples:[{description:"always executes the final block",in:"{ 1 2 } { 3 } finally",out:"1 2 3"},{description:"does not prevent exception but enables post processing",in:"{ 1 undefined 2 } { 3 } finally",out:"1 3 undefined"},{description:"throws the last error",in:"{ 1 stackunderflow 2 } { 3 undefined 4 } finally",out:"1 3 undefined"},{description:"fails on no code block",in:"[ 1 2 ] { 3 } finally",out:"[ 1 2 ] { 3 } typecheck"}]},(u,h,_)=>{const{operands:b,calls:w}=u,{topOperatorState:O}=w;if(O===ne){const x=w.def(Tt,_);if(!x.success)return x;w.topOperatorState=ue;const i=w.push(h);if(i.success){const n=b.popush(2);G(n)}return i}if(O===ue){if(w.topOperatorState=Mt,u.exception){const i=w.def(Bt,Te(u.exception));if(!i.success)return i;G(u.exceptionStack instanceof $e);const n=w.def(Ot,u.exceptionStack.toValue());if(!n.success)return n;u.clearException()}const x=w.lookup(Tt);return G(x.type!==B.null),w.push(x)}if(G(O===Mt),u.exception===void 0){const x=w.lookup(Bt);if(x!==oe){G(x.type===B.string);const i=w.lookup(Ot);G(i.type===B.array),u.raiseException(x.string,i.array)}}return w.topOperatorState=Se,{success:!0,value:void 0}});X({name:"if",description:"executes the operand based on a condition",labels:["flow"],signature:{input:[{type:B.boolean},{type:B.null}]},samples:[{in:"mark true { 123 } if",out:"mark 123"},{in:"mark false { 123 } if",out:"mark"},{description:"supports operand that is not a block",in:"mark true 123 if",out:"mark 123"}]},({operands:u,calls:h},{isSet:_},b)=>(u.popush(2),_?h.push(b):{success:!0,value:void 0}));X({name:"ifelse",description:"executes the operands based on a condition",labels:["flow"],signature:{input:[{type:B.boolean},{type:B.null},{type:B.null}]},samples:[{in:"mark true { 123 } { 456 } ifelse",out:"mark 123"},{in:"mark false { 123 } { 456 } ifelse",out:"mark 456"},{description:"supports operands that are not blocks",in:"mark true 123 456 ifelse",out:"mark 123"}]},({operands:u,calls:h},{isSet:_},b,w)=>(u.popush(3),_?h.push(b):h.push(w)));const It="block";X({name:"loop",description:"repeatedly executes proc until proc executes the stop operator",labels:["flow","loop"],signature:{input:[{type:B.array,permissions:{isExecutable:!0}}]},samples:[{description:"executes the block until stop",in:"{ 1 count 3 eq { stop } if } loop",out:"1 1 1"},{description:"does not catch errors",in:"{ 1 typecheck } loop",out:"1 typecheck"},{description:"fails on no code block",in:"[ 1 2 ] loop",out:"[ 1 2 ] typecheck"}]},(u,h)=>{const{operands:_,calls:b}=u,{topOperatorState:w}=b;if(w===ne)return b.topOperatorState=ue,b.def(It,h),_.pop(),b.push(h);if(G(w===ue),u.exception)return u.exception==="stop"&&u.clearException(),b.topOperatorState=Se,{success:!0,value:void 0};const O=b.lookup(It);return b.push(O)});X({name:"{",description:"marks the beginning of a block",labels:["flow","mark"],samples:[{description:"builds a block and check length and type",in:"{ 1 2 3 } dup length exch type",out:"3 /array"}]},u=>{const h=mt(u);return h.success&&u.preventCall(),h});X({name:"stopped",description:"executes the value. If execution was interrupted with stop, return true, return false otherwise",labels:["flow"],signature:{input:[{type:B.null}]},samples:[{in:"{ 1 2 3 } stopped",out:"1 2 3 false"},{in:"{ 1 2 stop 3 } stopped",out:"1 2 true"},{in:"{ 1 2 typecheck 3 } stopped",out:"1 2 typecheck"}]},(u,h)=>{const{operands:_,calls:b}=u,{topOperatorState:w}=b;if(w===ne){b.topOperatorState=ue;const O=b.push(h);return O.success&&_.pop(),O}return G(w===ue),b.topOperatorState=Se,u.exception?u.exception==="stop"?(u.clearException(),_.push(ce(!0))):{success:!0,value:void 0}:_.push(ce(!1))});X({name:"abs",description:"returns absolute values of an integer",labels:["integer","math"],signature:{input:[{type:B.integer}],output:[{type:B.integer}]},samples:[{in:"1 abs",out:"1"},{in:"-1 abs",out:"1"}]},(u,{integer:h})=>{const{operands:_}=u;if(h<0){const b=de(-h);return b.success?_.popush(1,b.value):b}return{success:!0,value:void 0}});X({name:"add",description:"adds two integers",labels:["integer","math"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.integer}]},samples:[{in:"1 2 add",out:"3"}]},(u,{integer:h},{integer:_})=>{const{operands:b}=u,w=de(h+_);return w.success?b.popush(2,w.value):w});X({name:"div",description:"realizes an euclidean division with two integers",labels:["integer","math"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.integer},{type:B.integer}]},samples:[{in:"5 3 div",out:"1 2"},{in:"5 0 div",out:"undefinedresult"}]},(u,{integer:h},{integer:_})=>{const{operands:b}=u;if(_===0)return{success:!1,exception:"undefinedResult"};const w=h%_,O=de(w);if(!O.success)return O;const x=de((h-w)/_);return x.success?b.popush(2,x.value,O.value):x});X({name:"gt",description:"compares two integers to see if greater than",labels:["integer","math","comparison"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"1 2 gt",out:"false"},{in:"2 1 gt",out:"true"}]},({operands:u},{integer:h},{integer:_})=>u.popush(2,ce(h>_)));X({name:"gte",description:"compares two integers to see if greater than or equal",labels:["integer","math","comparison"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"1 2 gte",out:"false"},{in:"2 1 gte",out:"true"},{in:"1 1 gte",out:"true"}]},({operands:u},{integer:h},{integer:_})=>u.popush(2,ce(h>=_)));X({name:"lt",description:"compares two integers to see if lower than",labels:["integer","math","comparison"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"1 2 lt",out:"true"},{in:"2 1 lt",out:"false"}]},({operands:u},{integer:h},{integer:_})=>u.popush(2,ce(h<_)));X({name:"lte",description:"compares two integers to see if lower than or equal",labels:["integer","math","comparison"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"1 2 lte",out:"true"},{in:"2 1 lte",out:"false"},{in:"1 1 lte",out:"true"}]},({operands:u},{integer:h},{integer:_})=>u.popush(2,ce(h<=_)));X({name:"mul",description:"multiplies two integers",labels:["integer","math"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"3 4 mul",out:"12"}]},(u,{integer:h},{integer:_})=>{const{operands:b}=u,w=de(h*_);return w.success?b.popush(2,w.value):w});X({name:"sub",description:"subtracts two integers",labels:["integer","math"],signature:{input:[{type:B.integer},{type:B.integer}],output:[{type:B.boolean}]},samples:[{in:"1 2 sub",out:"-1"}]},(u,{integer:h},{integer:_})=>{const{operands:b}=u,w=de(h-_);return w.success?b.popush(2,w.value):w});X({name:"countexecstack",description:"retrieves the number of dictionaries in the dictionary stack",labels:["callstack"],signature:{output:[{type:B.integer}]},samples:[{in:"countexecstack",out:"3"}]},({operands:u,calls:h})=>{const _=de(h.length);return G(_),u.push(_.value)});X({name:"begin",description:"pushes the dictionary on the dictionary stack, making it the current one",labels:["dictstack"],signature:{input:[{type:B.dictionary}]},samples:[{in:"<< /test 1 >> begin test end",out:"1"}]},({operands:u,dictionaries:h},_)=>{const b=h.push(_);return b.success&&u.pop(),b});const xs=X({name:"pop",description:"removes the top item of the operand stack",labels:["operand"],signature:{input:[{type:B.null}]},samples:[{in:"1 2 3 pop",out:"1 2"}]},({operands:u})=>u.pop()),Rs=X({name:"bind",description:"binds the block calls to their value by resolving the names from the dictionary stack",labels:["dictstack","flow"],signature:{input:[{type:B.array,permissions:{isExecutable:!0}}],output:[{type:B.array,permissions:{isExecutable:!0}}]},samples:[{in:"{ clear } bind 0 get",out:"systemdict /clear get"},{description:"does not fail on unknown names",in:"{ clear test_unknown bind } bind 2 get",out:"systemdict /bind get"},{description:"works recursively",in:"{ clear { bind } } bind 1 get 0 get",out:"systemdict /bind get"},{description:"works only on code blocks",in:"[ 1 2 ] bind",out:"[ 1 2 ] typecheck"},{description:"does nothing when no names are used",in:"{ {} 1 2 3 } bind",out:"{ {} 1 2 3 }"},{description:"works on mixed content",in:"{ 1 clear } bind 1 get",out:"systemdict /clear get"}]},u=>{const{operands:h,calls:_,dictionaries:b}=u,{topOperatorState:w}=_,O=h.top;G(ps(O));const{array:x}=O;if(G(x instanceof ft),w<x.length){const i=x.at(w);if(i&&i.isExecutable){if(i.type===B.name){const n=b.where(i.name);if(n!==null){const c=x.set(w,n.value);if(!c.success)return c}_.topOperatorState=w+1}else if(i.type===B.array){_.topOperatorState=w+1;const n=h.push(i);if(!n.success)return n;const c=_.push(xs);if(!c.success)return c;const p=_.push(Rs);if(!p.success)return p}}else _.topOperatorState=w+1}else _.topOperatorState=Se;return{success:!0,value:void 0}});X({name:"countdictstack",description:"retrieves the number of dictionaries in the dictionary stack",labels:["dictstack"],signature:{output:[{type:B.integer}]},samples:[{in:"countdictstack",out:"4"}]},({operands:u,dictionaries:h})=>{const _=de(h.length);return G(_.success),u.push(_.value)});X({name:"currentdict",description:"retrieves the top of the dictionary stack",labels:["dictstack"],signature:{output:[{type:B.dictionary}]},samples:[{in:"currentdict type",out:"/dictionary"}]},({operands:u,dictionaries:h})=>u.push(h.top));X({name:"def",description:"associates key with value in the current dictionary, the one on the top of the dictionary stack",labels:["dictstack"],signature:{input:[{type:B.name},{type:B.null}]},samples:[{in:"/test 1 def test",out:"/test 1 def 1"},{in:"systemdict begin /test 1 def test",out:"systemdict begin /test 1 invalidaccess"}]},({operands:u,dictionaries:h},{name:_},b)=>{if(h.top.isReadOnly)return{success:!1,exception:"invalidAccess"};const{dictionary:w}=h.top,O=w.def(_,b);return O.success?u.popush(2):O});X({name:"end",description:"pops the current dictionary off the dictionary stack, making the dictionary below it the current dictionary",labels:["dictstack"],samples:[{in:"<< /test 1 >> begin end test",out:"undefined"}]},({dictionaries:u})=>u.pop());X({name:"globaldict",description:"retrieves the global dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:B.dictionary}]},samples:[{in:"globaldict type",out:"/dictionary"}]},({operands:u,dictionaries:h})=>u.push(h.global));X({name:"systemdict",description:"retrieves the system dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:B.dictionary}]},samples:[{in:"systemdict type",out:"/dictionary"}]},({operands:u,dictionaries:h})=>u.push(h.system));X({name:"userdict",description:"retrieves the user dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:B.dictionary}]},samples:[{in:"userdict type",out:"/dictionary"}]},({operands:u,dictionaries:h})=>u.push(h.user));X({name:"clear",description:"clears the operand stack",labels:["operand"],samples:[{in:"1 2 3 clear",out:""}]},({operands:u})=>{for(;u.length;)u.pop()});X({name:"cleartomark",description:"clears the operand stack up to the first mark",labels:["operand","mark"],samples:[{in:"1 mark 2 3 cleartomark",out:"1"},{description:"fails if no mark is found",in:"1 2 3 cleartomark",out:"1 2 3 unmatchedmark"}]},({operands:u})=>{const h=Je(u);return h.success?u.popush(h.value+1):h});X({name:"count",description:"gives back the size of the operand stack",labels:["operand"],signature:{output:[{type:B.integer}]},samples:[{in:"1 2 3 count",out:"1 2 3 3"}]},({operands:u})=>{const h=de(u.length);return G(h.success),u.push(h.value)});X({name:"counttomark",description:"count the number of items in the operand stack up to the first mark",labels:["operand"],signature:{output:[{type:B.integer}]},samples:[{in:"1 mark 2 3 counttomark",out:"1 mark 2 3 2"},{description:"fails if no mark is found",in:"1 2 3 counttomark",out:"1 2 3 unmatchedmark"}]},({operands:u})=>{const h=Je(u);if(!h.success)return h;const _=de(h.value);return G(_.success),u.push(_.value)});X({name:"dup",description:"duplicates the top item of the operand stack",labels:["operand"],signature:{input:[{type:B.null}],output:[{type:B.null},{type:B.null}]},samples:[{in:"1 2 3 dup",out:"1 2 3 3"}]},({operands:u},h)=>u.push(h));X({name:"exch",description:"swaps the first two items of the operand stack",labels:["operand"],signature:{input:[{type:B.null},{type:B.null}],output:[{type:B.null},{type:B.null}]},samples:[{in:"1 2 3 exch",out:"1 3 2"}]},({operands:u},h,_)=>u.popush(2,_,h));X({name:"index",description:"duplicates the Nth item of the operand stack",labels:["operand"],signature:{input:[{type:B.integer}],output:[{type:B.null}]},samples:[{in:"1 2 3 1 index",out:"1 2 3 2"},{description:"throws stackunderflow if index is too big",in:"1 2 3 5 index",out:"1 2 3 5 stackunderflow"}]},({operands:u},{integer:h})=>h>u.length?{success:!1,exception:"stackUnderflow"}:u.popush(1,u.at(h+1)));X({name:"roll",description:"performs a circular shift of the values on the operand stack by a given amount",labels:["operand"],signature:{input:[{type:B.integer},{type:B.integer}]},samples:[{in:"100 200 300 3 -1 roll",out:"200 300 100"},{in:"100 200 300 3 1 roll",out:"300 100 200"},{in:"100 200 300 3 0 roll",out:"100 200 300"},{in:'"a" "b" "c" 3 2 roll',out:'"b" "c" "a"'},{description:"fails if the number of values to roll is invalid",in:"100 200 300 0 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 -1 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 4 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 50 0 roll",out:"100 200 300 0 0 rangecheck"}]},({operands:u},{integer:h},{integer:_})=>{var w,O;if(h<=0||h>u.length-2)return{success:!1,exception:"rangeCheck"};if(u.pop(),u.pop(),_=-_%h,_===0)return;_<0&&(_+=h);const b=[];try{for(let x=h;x>0;--x){const i=u.top;b.unshift(i),(w=i.tracker)==null||w.addValueRef(i),u.pop()}for(let x=0;x<h;++x){const i=b[(x+_)%h];u.push(i)}}finally{for(const x of b)(O=x.tracker)==null||O.releaseValue(x)}return{success:!0,value:void 0}});X({name:"cvi",description:"converts to integer",labels:["value","generic","conversion"],signature:{input:[{type:B.null}],output:[{type:B.integer}]},samples:[{in:"1 cvi",out:"1"},{in:'"1" cvi',out:"1"},{description:"fails if number goes beyond limit",in:'"9007199254740992" cvi',out:"undefinedresult"},{in:"/1 cvi",out:"typecheck"},{in:"<< >> cvi",out:"typecheck"}]},({operands:u},h)=>{if(h.type!==B.integer)if(h.type===B.string){const _=parseInt(h.string,10),b=de(_);return b.success?u.popush(1,b.value):b}else return{success:!1,exception:"typeCheck"};return{success:!0,value:void 0}});X({name:"cvlit",description:"removes executable flag",labels:["value","generic","conversion"],signature:{input:[{type:B.null}],output:[{type:B.null,permissions:{isExecutable:!1}}]},samples:[{in:"1 cvlit",out:"1"},{description:"converts a block to a read-only array",in:"{ 1 } cvlit dup xcheck exch wcheck",out:"false false"},{description:"converts a call to a name",in:"{ test } 0 get cvlit",out:"/test"}]},({operands:u},h)=>h.isExecutable?u.popush(1,{...h,isExecutable:!1}):{success:!0,value:void 0});X({name:"cvn",description:"converts to name",labels:["value","generic","conversion"],signature:{input:[{type:B.string}],output:[{type:B.name}]},samples:[{in:'"test" cvn',out:"/test"},{in:"/test cvn",out:"typecheck"},{in:"1 cvn",out:"typecheck"}]},({operands:u,memoryTracker:h},{string:_})=>{G(h instanceof Be);const b=h.addStringRef(_);if(!b.success)return b;const w=u.popush(1,jt(_,{tracker:h}));return h.releaseString(_),w});X({name:"eq",description:"compares two values and return true if they are strictly equal",labels:["generic","comparison"],signature:{input:[{type:B.null},{type:B.null}],output:[{type:B.boolean}]},samples:[{in:"1 1 eq",out:"true"},{in:"1 2 eq",out:"false"},{in:'1 "1" eq',out:"false"},{in:"[ ] [ ] eq",out:"false"},{in:"[ ] dup eq",out:"true"}]},({operands:u},h,_)=>{let b;if(h.type!==_.type)b=!1;else{const[w,O]=Ae(h,_);b=w===O}return u.popush(2,ce(b))});Ye({name:"false",description:"pushes false in the operand stack",labels:["value"],signature:{output:[{type:B.boolean}]},samples:[{in:"false type",out:"/boolean"}]},ce(!1));const Ls={[B.string]:({string:u,tracker:h},_)=>{G(h instanceof Be);const b=ze(_,u.length);if(!b.success)return b;const w=u.charAt(b.value),O=h.addStringRef(w);return O.success?{success:!0,value:Te(w,{tracker:h})}:O},[B.array]:({array:u},h)=>{var w;const _=ze(h,u.length);if(!_.success)return _;const b=u.at(_.value);return(w=b.tracker)==null||w.addValueRef(b),{success:!0,value:b}},[B.dictionary]:({dictionary:u},h)=>{var w;if(h.type!==B.name)return{success:!1,exception:"typeCheck"};const{name:_}=h;if(!u.names.includes(_))return{success:!1,exception:"undefined"};const b=u.lookup(_);return(w=b.tracker)==null||w.addValueRef(b),{success:!0,value:b}}};X({name:"get",description:"returns an indexed item from the value",labels:["generic"],signature:{input:[{type:B.null},{type:B.null}],output:[{type:B.null}]},samples:[{description:"returns the Nth item of an array",in:"[ 1 2 3 ] 1 get",out:"2"},{description:"returns the Nth item of an executable array",in:"{ 1 2 3 } 1 get",out:"2"},{description:"fails if invalid index for the array",in:"[ 1 2 3 ] /a get",out:"[ 1 2 3 ] /a typecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] -1 get",out:"[ 1 2 3 ] -1 rangecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] 3 get",out:"[ 1 2 3 ] -1 rangecheck"},{description:"returns the Nth character of a string",in:'"abc" 1 get',out:'"b"'},{description:"fails if invalid index for a string",in:'"abc" "a" get',out:'"abc" "a" typecheck'},{description:"fails if out of bound index for a string",in:'"abc" -1 get',out:'"abc" -1 rangecheck'},{description:"fails if out of bound index for a string",in:'"abc" 3 get',out:'"abc" 3 rangecheck'},{description:"returns the indexed item of a dictionary",in:"systemdict /get get",out:"{ get } bind 0 get"},{description:"returns the indexed item of a dictionary (handles reference counting)",in:'/test "abc" def userdict /test get',out:'/test "abc" def "abc"'},{description:"fails if invalid index for a dictionary",in:"systemdict 0 get",out:"systemdict 0 typecheck"},{description:"fails if unknown index for a dictionary",in:"systemdict /not_an_operator get",out:"systemdict /not_an_operator undefined"},{description:"fails if not a container",in:"1 1 get",out:"1 1 typecheck"},{description:"fails if not a container",in:"false 1 get",out:"false 1 typecheck"},{description:"fails if not a container",in:"mark 1 get",out:"mark 1 typecheck"}]},({operands:u},h,_)=>{var i;const b=Ls[h.type];if(b===void 0)return{success:!1,exception:"typeCheck"};const w=b(h,_);if(!w.success)return w;const{value:O}=w,x=u.popush(2,O);return(i=O.tracker)==null||i.releaseValue(O),x});const Ds={[B.string]:({string:u})=>u.length,[B.array]:({array:u})=>u.length,[B.dictionary]:({dictionary:u})=>u.names.length};X({name:"length",description:"returns the length of the value",labels:["generic"],signature:{input:[{type:B.null}],output:[{type:B.integer}]},samples:[{description:"returns the number of items in an array",in:"[ 1 2 3 ] length",out:"3"},{description:"returns the number of items in an executable array",in:"{ 1 2 3 } length",out:"3"},{description:"returns the size of a string",in:'"abc" length',out:"3"},{description:"returns the number of keys in a dictionary",in:"systemdict length 0 gt",out:"true"},{description:"fails if not a container",in:"1 length",out:"1 typecheck"},{description:"fails if not a container",in:"false length",out:"false typecheck"},{description:"fails if not a container",in:"mark length",out:"mark typecheck"}]},({operands:u},h)=>{const _=Ds[h.type];if(_===void 0)return{success:!1,exception:"typeCheck"};const b=de(_(h));return G(b.success),u.popush(1,b.value)});Ye({name:"mark",description:"pushes a mark in the operand stack",labels:["value","mark"],signature:{output:[{type:B.mark}]},samples:[{in:"1 2 mark",out:"1 2 mark"},{description:"marks part of the stack for operations",in:"1 2 mark 3 4 5 cleartomark",out:"1 2"}]},dt);X({name:"neq",description:"compares two values and return true if they are strictly different",labels:["generic","comparison"],signature:{input:[{type:B.null},{type:B.null}],output:[{type:B.boolean}]},samples:[{in:"1 1 neq",out:"false"},{in:"1 2 neq",out:"true"},{in:'1 "1" neq',out:"true"},{in:"[ ] [ ] neq",out:"true"},{in:"[ ] dup neq",out:"false"}]},({operands:u},h,_)=>{let b;if(h.type!==_.type)b=!0;else{const[w,O]=Ae(h,_);b=w!==O}return u.popush(2,ce(b))});const As={[B.string]:({string:u,tracker:h},_,b)=>{if(G(h instanceof Be),b.type!==B.integer)return{success:!1,exception:"typeCheck"};const{integer:w}=b;if(w<0||w>65535)return{success:!1,exception:"rangeCheck"};const O=ze(_,u.length);if(!O.success)return O;const x=u.substring(0,O.value)+String.fromCharCode(w)+u.substring(O.value+1),i=h.addStringRef(x);return i.success?{success:!0,value:Te(x,{tracker:h})}:i},[B.array]:(u,h,_)=>{var i;const{array:b,isReadOnly:w}=u;if(w)return{success:!1,exception:"invalidAccess"};const O=ze(h,b.length);if(!O.success)return O;const x=b.set(O.value,_);return x.success?((i=u.tracker)==null||i.addValueRef(u),{success:!0,value:u}):x},[B.dictionary]:(u,h,_)=>{var i;const{dictionary:b,isReadOnly:w}=u;if(w)return{success:!1,exception:"invalidAccess"};if(h.type!==B.name)return{success:!1,exception:"typeCheck"};const{name:O}=h,x=b.def(O,_);return x.success?((i=u.tracker)==null||i.addValueRef(u),{success:!0,value:u}):x}};X({name:"put",description:"sets an indexed item in the value",postScriptDeviation:"returns the modified object or a new string",labels:["generic"],signature:{input:[{type:B.null},{type:B.null},{type:B.null}],output:[{type:B.null}]},samples:[{description:"sets the Nth item of an array",in:"[ 1 2 3 ] 1 5 put",out:"[ 1 5 3 ]"},{description:"fails if the array is not writable",in:"{ 1 2 3 } 1 5 put",out:"{ 1 2 3 } 1 5 invalidaccess"},{description:"fails if invalid index for the array",in:'[ 1 2 3 ] "a" 5 put',out:'[ 1 2 3 ] "a" 5 typecheck'},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] -1 5 put",out:"[ 1 2 3 ] -1 5 rangecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] 3 5 put",out:"[ 1 2 3 ] 3 5 rangecheck"},{description:"sets the Nth character of a string (returns a new string, using ascii code)",in:'"abc" 1 66 put',out:'"aBc"'},{description:"fails if setting an invalid value",in:'"abc" 1 "B" put',out:'"abc" 1 "B" typecheck'},{description:"fails if setting an invalid value",in:'"abc" 1 -1 put',out:'"abc" 1 -1 rangecheck'},{description:"fails if setting an invalid value",in:'"abc" 1 65536 put',out:'"abc" 1 65536 rangecheck'},{description:"fails if invalid index for a string",in:'"abc" "a" 66 put',out:'"abc" "a" 66 typecheck'},{description:"fails if out of bound index for a string",in:'"abc" -1 66 put',out:'"abc" -1 66 rangecheck'},{description:"fails if out of bound index for a string",in:'"abc" 3 66 put',out:'"abc" 3 66 rangecheck'},{description:"sets an indexed item of a dictionary",in:"userdict /test 123 put pop test",out:"userdict /test 456 put pop 123"},{description:"fails if the dictionary is not writable",in:"systemdict /test 123 put",out:"systemdict /test 123 invalidaccess"},{description:"fails if invalid index for a dictionary",in:"userdict 0 123 put",out:"userdict 0 123 typecheck"},{description:"fails if not a container",in:"1 0 1 put",out:"1 0 1 typecheck"},{description:"fails if not a container",in:"false 0 1 put",out:"false 0 1 typecheck"},{description:"fails if not a container",in:"mark 0 1 put",out:"mark 0 1 typecheck"}]},({operands:u},h,_,b)=>{var n;const w=As[h.type];if(w===void 0)return{success:!1,exception:"typeCheck"};const O=w(h,_,b);if(!O.success)return O;const{value:x}=O,i=u.popush(3,x);return(n=h.tracker)==null||n.releaseValue(x),i});Ye({name:"true",description:"pushes true in the operand stack",labels:["value"],signature:{output:[{type:B.boolean}]},samples:[{in:"true type",out:"/boolean"}]},ce(!0));X({name:"type",description:"pushes the type of the value in the operand stack",labels:["value","generic"],signature:{input:[{type:B.null}],output:[{type:B.name}]},samples:[{in:"false type",out:"/boolean"},{in:"[ 1 2 3 ] type",out:"/array"},{in:'"" type',out:"/string"},{in:"/type type",out:"/name"}]},({operands:u,memoryTracker:h},_)=>{G(h instanceof Be);const{type:b}=_,w=h.addStringRef(b);if(!w.success)return w;const O=u.popush(1,jt(b,{tracker:h}));return h.releaseString(b),O});const Ts="@psbots/engine@0.0.1";Ye({name:"version",description:"returns a string that identifies the version of the engine",labels:["value"],signature:{output:[{type:B.string}]},samples:[{in:"version type",out:"/string"}]},Te(Ts));X({name:"wcheck",description:"checks if value is writable",labels:["value","generic","permission"],signature:{input:[{type:B.null}],output:[{type:B.boolean}]},samples:[{description:"returns false for blocks",in:"{ 1 2 } wcheck",out:"false"},{description:"returns true for arrays",in:"[ 1 2 ] wcheck",out:"true"}]},({operands:u},h)=>u.popush(1,ce(!h.isReadOnly)));X({name:"xcheck",description:"checks if value is executable",labels:["value","generic","permission"],signature:{input:[{type:B.null}],output:[{type:B.boolean}]},samples:[{description:"returns true for blocks",in:"{ 1 2 } xcheck",out:"true"},{description:"returns false for arrays",in:"[ 1 2 ] xcheck",out:"false"}]},({operands:u},h)=>u.popush(1,ce(h.isExecutable)));const Ge=class Ge{constructor(){}static get instance(){return this._instance??(this._instance=new Ge),this._instance}get names(){return Object.keys(De)}lookup(h){const _=De[h];return _!==void 0?_.value:oe}};Q(Ge,"_instance");let _t=Ge;const Xe=class Xe{constructor(){}static get instance(){return this._instance??(this._instance=new Xe),this._instance}get names(){return[]}lookup(){return oe}def(h,_){return G(!!h),G(!!_),{success:!1,exception:"invalidAccess"}}};Q(Xe,"_instance");let Le=Xe;const je=4,Pt=-1,Bs=-2,ct=-3,lt=-4;class Os extends vt{static create(h,_,b,w){return G(_===ve),G(b>4),super.createInstance(h,_,b,w)}constructor(h,_,b,w){super(h,_,b,w),this.begin({type:B.dictionary,isExecutable:!1,isReadOnly:!0,dictionary:Le.instance}),this.begin({type:B.dictionary,isExecutable:!1,isReadOnly:!0,dictionary:_t.instance}),this.begin({type:B.dictionary,isExecutable:!1,isReadOnly:!1,dictionary:Le.instance}),this.begin({type:B.dictionary,isExecutable:!1,isReadOnly:!1,dictionary:Le.instance})}getDictionaryValue(h){const _=this._values[this._values.length+h];return G(!!_&&_.type===B.dictionary),_}setHost(h){var _;this._values[je+Pt]=h,(_=h.tracker)==null||_.addValueRef(h)}setGlobal(h){var b;const _=this.getDictionaryValue(ct);G(_.dictionary===Le.instance),this._values[je+ct]=h,(b=h.tracker)==null||b.addValueRef(h)}setUser(h){var b;const _=this.getDictionaryValue(lt);G(_.dictionary===Le.instance),this._values[je+lt]=h,(b=h.tracker)==null||b.addValueRef(h)}get top(){return super.top}get host(){return this.getDictionaryValue(Pt)}get system(){return this.getDictionaryValue(Bs)}get global(){return this.getDictionaryValue(ct)}get user(){return this.getDictionaryValue(lt)}begin(h){return this.push(h)}end(){return this.length===je?{success:!1,exception:"dictStackUnderflow"}:(this.pop(),{success:!0,value:this.length})}where(h){for(const _ of this._values){const{dictionary:b}=_,w=b.lookup(h);if(w.type!==B.null)return{dictionary:b,value:w}}return null}lookup(h){const _=this.where(h);return _===null?{success:!1,exception:"undefined"}:{success:!0,value:_.value}}}function Vt(u,h){const{calls:_}=u,b=h.operator;if(_.topOperatorState>=ne||_.topOperatorState===Se)_.pop();else{const w=b.implementation(u);w&&w.success===!1&&u.raiseException(w.exception)}}function Ms(u,h){var n,c;const{operands:_,calls:b,memoryTracker:w}=u;if(G(w instanceof Be),b.topOperatorState<=ne){Vt(u,h);return}const{top:O}=b,x=b.topOperatorState===me;x&&(b.topOperatorState=ne);const i=h.operator;if(i.type===ye.constant)_.push(i.constant),b.pop();else{let p;const o=[];if(i.typeCheck!==void 0&&x){let{length:S}=i.typeCheck;if(_.length<S){u.raiseException("stackUnderflow");return}const l=w.allocate({values:S},ve,u);if(!l.success){u.raiseException(l.exception);return}p=l.value;for(const{type:s,permissions:r}of i.typeCheck){const e=_.at(--S),{isReadOnly:t,isExecutable:a}=r??{};if((s===B.null||s===e.type)&&(t===void 0||t===e.isReadOnly)&&(a===void 0||a===e.isExecutable))o.push(e);else{u.raiseException("typeCheck"),w.release(p,u);return}}for(const s of o)(n=s.tracker)==null||n.addValueRef(s)}const f=u.exception,g=i.implementation(u,...o);if(p!==void 0){for(const S of o)(c=S.tracker)==null||c.releaseValue(S);w.release(p,u)}if(g&&g.success===!1&&u.raiseException(g.exception),u.exception!==f)return;b.length&&b.top===O&&(b.topOperatorState===Se||b.topOperatorState===ne)&&b.pop()}}function Is(u,h){const{dictionaries:_,calls:b,callEnabled:w,operands:O}=u;if(b.topOperatorState===ne)b.pop();else if(w||["{","}","<<","Â«",">>","Â»"].includes(h.name)){b.topOperatorState=ne;const x=_.lookup(h.name);if(!x.success){u.raiseException(x.exception);return}const i=x.value;h.debugSource?b.push(Object.assign({debugSource:h.debugSource},i)):b.push(i)}else O.push(h),b.pop()}function Ps({calls:u,operands:h},{array:_}){const{length:b}=_;if(u.topOperatorState===me?u.topOperatorState=ne:u.topOperatorState++,u.topOperatorState===b)u.pop();else{const w=u.topOperatorState,O=_.at(w);!O.isExecutable||O.type===B.array?h.push(O):u.push(O)}}const ht="unknown";function Hs(u,h){var x,i,n;const{calls:_,operands:b}=u,w=u.memoryTracker;let O;if(_.topOperatorState===me){_.topOperatorState=ne;const[c]=ut(h.string,0,((x=h.debugSource)==null?void 0:x.filename)??ht);O=c}else{const[,c]=ut(h.string,_.topOperatorState,((i=h.debugSource)==null?void 0:i.filename)??ht);O=c}if(!O)_.pop();else{const{pos:c}=O.debugSource;if(c>0&&(_.topOperatorState=c),((n=O.debugSource)==null?void 0:n.filename)===ht){const{debugSource:f,...g}=O;O=g}let p;if(O.type===B.string||O.type===B.name){p=Ae(O)[0];const f=w.addStringRef(p);if(!f.success){u.raiseException(f.exception);return}Object.assign(O,{tracker:w})}let o;O.isExecutable?o=_.push(O):o=b.push(O),p!==void 0&&w.releaseString(p),o.success||u.raiseException(o.exception)}}class St{constructor(h,_,b,w){Q(this,"_memoryTracker");Q(this,"_dictionaries");Q(this,"_operands");Q(this,"_calls");Q(this,"_exception");Q(this,"_exceptionStack");Q(this,"_destroyed",!1);Q(this,"_callDisablingCount",0);this._memoryTracker=h,this._dictionaries=_,this._operands=b,this._calls=w}static create(h={}){const _=new Be({total:h.maxMemoryBytes,debug:h.debugMemory}),b=Os.create(_,ve,10,1);if(!b.success)return b;const w=b.value;h.hostDictionary&&w.setHost({type:B.dictionary,isReadOnly:!0,isExecutable:!1,dictionary:h.hostDictionary});const O=Re.create(_,ve,10);if(!O.success)return O;w.setGlobal(O.value.toValue({isReadOnly:!1})),O.value.release();const x=Re.create(_,ve,10);if(!x.success)return x;w.setUser(x.value.toValue({isReadOnly:!1})),x.value.release();const i=vt.create(_,ve,10,5);if(!i.success)return i;const n=$e.create(_,ve,10,5);return n.success?{success:!0,value:new St(_,w,i.value,n.value)}:n}get destroyed(){return this._destroyed}_checkIfDestroyed(){G(!this._destroyed,"State instance destroyed")}_resetException(){this._exception!==void 0&&(this._exception=void 0),this._exceptionStack!==void 0&&(this._exceptionStack.release(),this._exceptionStack=void 0)}get idle(){return this._checkIfDestroyed(),this._calls.length===0}get memoryTracker(){return this._memoryTracker}get operands(){return this._checkIfDestroyed(),this._operands}get dictionaries(){return this._checkIfDestroyed(),this._dictionaries}get callEnabled(){return this._callDisablingCount===0}get exception(){return this._checkIfDestroyed(),this._exception}get exceptionStack(){return this._checkIfDestroyed(),this._exceptionStack}exec(h){return this._checkIfDestroyed(),this.idle?(this._resetException(),this.calls.push(h),{success:!0,value:this.run()}):{success:!1,exception:"invalidAccess"}}destroy(){this._checkIfDestroyed(),this._resetException(),this._calls.release(),this._operands.release(),this._dictionaries.release(),this._destroyed=!0;const{used:h}=this._memoryTracker;G(h===0,"Memory leaks detected")}raiseException(h,_){if(this._resetException(),this._exception=h,_!==void 0)G(_ instanceof $e),this._exceptionStack=_,this._exceptionStack.addRef();else if(h!=="vmOverflow"){const b=this._calls.snapshot();G(b),this._exceptionStack=b.value}}clearException(){this._resetException()}get calls(){return this._calls}allowCall(){++this._callDisablingCount}preventCall(){--this._callDisablingCount}*run(){for(;this.calls.length!==0;)this.cycle(),yield}cycle(){const h=this._calls,{top:_}=h;this._exception?_.type===B.operator?Vt(this,_):h.pop():_.isExecutable?_.type===B.operator?Ms(this,_):_.type===B.name?Is(this,_):_.type===B.array?Ps(this,_):_.type===B.string?Hs(this,_):G(!1,"Unsupported executable value"):(this._operands.push(_),h.pop())}}function Gt(u){return St.create(u)}function Fs(){return Object.entries(De).reduce((u,[h,_])=>(u[h]=_.definition,u),{})}const fe="\x1B[31m",Xt="\x1B[32m",ae="\x1B[33m",Ve="\x1B[34m",Jt="\x1B[35m",he="\x1B[36m",te="\x1B[37m";function $s(u){return{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"exit",type:ye.implementation,implementation:()=>u.exit()}}}const Ws=[{factor:1024*1024,unit:"MB"},{factor:1024,unit:"kB"}];function Ce(u){for(const h of Ws)if(u>=h.factor)return`${(u/h.factor).toFixed(2)}${h.unit}`;return`${u}B`}function Yt(u){const{used:h,peak:_,total:b}=u.memoryTracker,w=Ce(h)+" (top:"+Ce(_)+")"+Ve+"/";return b===1/0?w+"â"+te:w+Ce(b)+te}function pt(u,h){if(h>u){const _=`+${h-u}`;return{length:_.length+1,formatted:` ${fe}${_}`}}else if(h<u){const _=`-${u-h}`;return{length:_.length+1,formatted:` ${fe}${_}`}}return{length:0,formatted:""}}function Zt(u,h){if(h>u){const _=`+${Ce(h-u)}`;return{length:_.length+1,formatted:` ${fe}${_}`}}else if(h<u){const _=`-${Ce(u-h)}`;return{length:_.length+1,formatted:` ${Xt}${_}`}}return{length:0,formatted:""}}function Ns(u,h){let _;_="cycles: ";const b=u.operands.length,w=pt(h.lastOperandsCount??b,b).formatted,O=u.memoryTracker.used,x=Zt(h.lastUsedMemory??O,O).formatted;let i="";return u.callEnabled||(i+=` ${fe}!call`),u.exception&&(i+=` ${fe}â${u.exception}`),[`${he}${_}${ae}${h.cycle}`,i,`${he} operands: ${ae}${u.operands.length}${w}`,`${he} memory: ${ae}${Yt(u)}${x}`,te,h.concat,te,`\r
`].join("")}function yt(u,h,_={includeDebugSource:!0,includeIndex:!0}){const{includeDebugSource:b,includeIndex:w}=_;let O=0;for(const x of Nt(h)){const i=O.toString();let n=u.width;w&&(n-=i.length+1);const c=qe(x,{includeDebugSource:b,maxWidth:n}),p=c.match(/^(.*)@([^:@]+:\d+:\d+)$/);let o=c,f="";p&&(o=p[1],f=`${Ve}@${p[2]}`),_.includeIndex?u.output(`${i} ${o}${f}${te}\r
`):u.output(`${o}${f}${te}\r
`),++O}}function Qt(u,h){u.output(`${he}operands: ${ae}${h.operands.length}${te}\r
`),yt(u,h.operands)}function Us(u,h){const _=h.dictionaries.length;u.output(`${he}memory: ${ae}${Yt(h)}${te}\r
`),u.output(`${he}dictionaries: ${ae}${_}${te}\r
`),yt(u,h.dictionaries),Qt(u,h)}function js(u){return{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"exit",type:ye.implementation,implementation:h=>{Us(u,h)}}}}function zs(u){return{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"help",type:ye.implementation,implementation:()=>{const h=Fs(),_=Object.keys(h).sort();for(const b of _){const w=h[b];u.output(`${ae}${b}${he} ${w==null?void 0:w.description}${te}\r
`)}}}}}function qs(u){return{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"pstack",type:ye.implementation,implementation:({operands:h})=>{yt(u,h,{includeDebugSource:!1,includeIndex:!1})}}}}function Ks(u){return{type:B.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"debug",type:ye.implementation,implementation:()=>u.debug()}}}class Vs{constructor(h){Q(this,"mappings",{});Q(this,"_exit",!1);Q(this,"_debug",!1);this.mappings.exit=$s(this),this.mappings.state=js(h),this.mappings.help=zs(h),this.mappings.pstack=qs(h),this.mappings.debug=Ks(this)}get names(){return Object.keys(this.mappings)}lookup(h){return this.mappings[h]??oe}get exitCalled(){return this._exit}exit(){this._exit=!0}get debugCalled(){return this._debug}debug(){this._debug=!0}}class bt extends Error{constructor(){super(),this.name=this.constructor.name}}class Gs extends bt{}class Xs extends bt{}function Js(u){const h=[];let _=Promise.resolve(),b=()=>{},w=x=>{};const O=(x,i=!1)=>{x.length&&(h[0]=h[0]+x),i&&h.unshift(""),b(),_=new Promise((n,c)=>{b=n,w=c})};return O("",!0),u.input(x=>{if(x.length>1){if(x.charAt(0)==="\x1B")return;let i;if(x.includes("\r")){const n=x.split("\r");i=n.pop(),n.forEach(c=>{u.output(c),u.output(`\r
`),O(c,!0)})}else i=x;i.length>0&&(u.output(i),O(i))}else if(x==="\r")u.output(`\r
`),O("",!0);else if(x==="\b"||x===""){const i=h[0];i&&i.length>0&&(u.output("\b \b"),h[0]=i.substring(0,i.length-1))}else x===""?w(new Gs):x==="\x1B"?w(new Xs):(x>=" "&&x<="~"||x>="Â ")&&(u.output(x),O(x,!1))}),{async waitForLines(){const x=async()=>{if(await _,h.length===1)return x();let i=!1;return await Promise.race([_.then(()=>{i=!0}),new Promise(n=>setTimeout(n,50))]),i?x():h.splice(1).reverse().join(`
`)};return x()},async waitForChar(){h.length===1&&h[0].length===0&&await _;const x=h.at(-1),i=x.charAt(0),n=x.substring(1);return n.length||h.length===1?h[h.length-1]=n:h.pop(),i}}}function gt(u,h,_={}){return h.success?!1:(_.message&&u.output(`${fe}${_.message}${te}\r
`),es(u,h.exception,_.stack),!0)}function es(u,h,_){u.output(`${fe}â ${h}${te}\r
`),_&&ys(_).forEach(b=>u.output(`${fe}${b}${te}\r
`))}function Ht(u,h){let _,b;h instanceof Error?(_=h.name,b=h.message):(_="Unknown error",b=JSON.stringify(h)),b.length&&(b=": "+b),u.output(`${fe}ð£ ${_}${b}${te}\r
`)}const pe=Jt,He=Xt;function Ft(u){return u.replace(new RegExp(Fe+".*"+Ee,"g"),h=>`${ae}${h}${te}`).replace(/@.*$/g,h=>`${Ve}${h}${te}`).replace(/â¦|âµ|â­²/g,h=>`${Ve}${h}${te}`)}async function Ys({replIO:u,state:h,iterator:_,waitForChar:b}){let w=h.operands.length,O=h.memoryTracker.used,x=h.calls.length,i=0;for(;;){const{width:n,height:c}=u;if(n<40||c<10)return u.output(`${fe}â ï¸ Output too small for debugger${te}
`),0;u.output("\x1B[1;1H\x1B[J");const o=8+i.toString().length,f=`${te}Cycle: #${ae}${i.toString()}`,g=n-3-o;u.output(`${pe}â${"".padStart(o,"â")}â¬${"".padStart(g,"â")}â`);const S=Zt(O,h.memoryTracker.used),l=Ce(h.memoryTracker.used);let s=8+l.length,r=`${He}M${te}emory: ${ae}${l}`;s+S.length<g&&(r+=S.formatted,s+=S.length);const e=` (user: ${Ce(h.memoryTracker.byType.user)}, strings: ${Ce(h.memoryTracker.byType.string)}, system: ${Ce(h.memoryTracker.byType.system)})`;s+e.length<=g&&(r+=`${te}${e}`,s+=e.length),u.output(`â${f}${pe}â${r}${"".padStart(g-s," ")}${pe}â`);const t=Math.floor((n-3)/2),a=n-3-t;u.output(`${pe}â${"".padStart(o,"â")}â´${"".padStart(t-o-1,"â")}â¬${"".padStart(a,"â")}â¤`);const m=pt(w,h.operands.length);let v=`${He}O${te}perands: ${ae}${h.operands.length}`,y=10+h.operands.length.toString().length;y+m.length<t&&(v+=m.formatted,y+=m.length),u.output(`${pe}â${v}${"".padStart(t-y," ")}`);const d=pt(x,h.calls.length);let C=`${te}C${He}a${te}ll stack: ${ae}${h.calls.length}`,D=12+h.calls.length.toString().length,T="",M=0;h.exception&&(T=` ${fe}â${h.exception}`,M=h.exception.length+2),D+d.length+M<a?(C+=d.formatted+T,D+=d.length+M):D+M<a?(C+=T,D+=M):h.exception&&D+2<a&&(C+=" â",D+=2),u.output(`${pe}â${C}${"".padStart(a-D," ")}${pe}â`);const L=h.calls;for(let U=0;U<5;++U){u.output(`${pe}â${te}`);const K=h.operands.at(U);if(K===null)u.output("".padStart(t," "));else{const j=qe(K,{maxWidth:t,includeDebugSource:!0});u.output(`${Ft(j)}${"".padStart(t-j.length," ")}`)}if(u.output(`${pe}â${te}`),U<L.length){const j=h.calls.at(U),k=h.calls.operatorStateAt(U),R=qe(j,{maxWidth:a,operatorState:k,includeDebugSource:!0}),A=R.length;u.output(`${Ft(R)}${"".padStart(a-A," ")}`)}else u.output("".padStart(a," "));u.output(`${pe}â`)}u.output(`${pe}â${"".padStart(t,"â")}â´${"".padStart(a,"â")}â`),u.output(`${He}c${te}ontinue ${He}q${te}uit`),w=h.operands.length,O=h.memoryTracker.used,x=h.calls.length;const H=await b();if(u.output("\b \b"),H==="o")Qt(u,h);else if(H==="q")break;++i;const{done:$}=_.next();if($)break}return u.output("\x1B[1;1H\x1B[J"),i}function Zs(u){const h=Gt();if(gt(u,h,{message:"Unable to allocate state"}))return!1;const{value:_}=h,b=_.exec(Te("version",{isExecutable:!0}));if(gt(u,b,{message:"Unable to execute version"}))return!1;[...b.value];const w=_.operands.at(0);return G(w.type===B.string),u.output(`${he}Welcome to ð¤${Jt}${w.string}${te}\r
`),!0}async function Qs(u,h){if(!Zs(u))return;const _=new Vs(u),b=Gt({hostDictionary:_,debugMemory:h});if(gt(u,b,{message:"Unable to allocate state"}))return;const{value:w}=b;u.output(`${he}Use '${ae}exit${he}'  to quit${te}\r
`),u.output(`${he}Use '${ae}state${he}' to print a state summary${te}\r
`),u.output(`${he}Use '${ae}help${he}'  to display help${te}\r
`);let O=0;const{waitForLines:x,waitForChar:i}=Js(u);for(;;){u.output("? ");try{const n=await x(),c=w.operands.length,p=w.memoryTracker.used;let o=0;const f=w.exec(Object.assign({debugSource:{filename:`repl${O++}`,pos:0,length:n.length,source:n}},Te(n,{isExecutable:!0})));G(f);const{value:g}=f;let{done:S}=g.next();for(;S===!1;)_.debugCalled?o+=await Ys({replIO:u,state:w,iterator:g,waitForChar:i}):++o,S=g.next().done;if(_.exitCalled)break;w.exception!==void 0&&es(u,w.exception,w.exceptionStack),u.output(Ns(w,{cycle:o,absolute:!1,lastOperandsCount:c,lastUsedMemory:p}))}catch(n){if(Ht(u,n),n instanceof bt)break}}u.output(`${fe}terminating...${te}\r
`);try{w.destroy()}catch(n){Ht(u,n)}u.output(`${fe}terminated.${te}\r
`)}async function ei(){const u=new ns.Terminal({cursorBlink:!0}),h=new as.FitAddon;u.loadAddon(h),u.open(document.getElementById("terminal")),h.fit(),window.addEventListener("resize",()=>h.fit()),await Qs({get width(){return u.cols},get height(){return u.rows},input(_){u.onData(_)},output(_){u.write(_)}}).catch(_=>{console.error(_)})}ei();
