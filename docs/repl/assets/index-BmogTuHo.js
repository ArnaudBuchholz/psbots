(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))S(C);new MutationObserver(C=>{for(const A of C)if(A.type==="childList")for(const x of A.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&S(x)}).observe(document,{childList:!0,subtree:!0});function u(C){const A={};return C.integrity&&(A.integrity=C.integrity),C.referrerPolicy&&(A.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?A.credentials="include":C.crossOrigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function S(C){if(C.ep)return;C.ep=!0;const A=u(C);fetch(C.href,A)}})();var st={exports:{}},bt;function is(){return bt||(bt=1,function(c,n){(function(u,S){c.exports=S()})(globalThis,()=>(()=>{var u={4567:function(x,i,o){var h=this&&this.__decorate||function(e,t,l,m){var v,b=arguments.length,f=b<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(e,t,l,m);else for(var w=e.length-1;w>=0;w--)(v=e[w])&&(f=(b<3?v(f):b>3?v(t,l,f):v(t,l))||f);return b>3&&f&&Object.defineProperty(t,l,f),f},p=this&&this.__param||function(e,t){return function(l,m){t(l,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibilityManager=void 0;const a=o(9042),_=o(9924),g=o(844),y=o(4725),d=o(2585),s=o(3656);let r=i.AccessibilityManager=class extends g.Disposable{constructor(e,t,l,m){super(),this._terminal=e,this._coreBrowserService=l,this._renderService=m,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let v=0;v<this._terminal.rows;v++)this._rowElements[v]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[v]);if(this._topBoundaryFocusListener=v=>this._handleBoundaryFocus(v,0),this._bottomBoundaryFocusListener=v=>this._handleBoundaryFocus(v,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new _.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(v=>this._handleResize(v.rows))),this.register(this._terminal.onRender(v=>this._refreshRows(v.start,v.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(v=>this._handleChar(v))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(v=>this._handleTab(v))),this.register(this._terminal.onKey(v=>this._handleKey(v.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this.register((0,s.addDisposableDomListener)(document,"selectionchange",()=>this._handleSelectionChange())),this.register(this._coreBrowserService.onDprChange(()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,g.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(e){for(let t=0;t<e;t++)this._handleChar(" ")}_handleChar(e){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==e&&(this._charsToAnnounce+=e):this._charsToAnnounce+=e,e===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=a.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(e){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(e)||this._charsToConsume.push(e)}_refreshRows(e,t){this._liveRegionDebouncer.refresh(e,t,this._terminal.rows)}_renderRows(e,t){const l=this._terminal.buffer,m=l.lines.length.toString();for(let v=e;v<=t;v++){const b=l.lines.get(l.ydisp+v),f=[],w=(b==null?void 0:b.translateToString(!0,void 0,void 0,f))||"",D=(l.ydisp+v+1).toString(),T=this._rowElements[v];T&&(w.length===0?(T.innerText="Â ",this._rowColumns.set(T,[0,1])):(T.textContent=w,this._rowColumns.set(T,f)),T.setAttribute("aria-posinset",D),T.setAttribute("aria-setsize",m))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(e,t){const l=e.target,m=this._rowElements[t===0?1:this._rowElements.length-2];if(l.getAttribute("aria-posinset")===(t===0?"1":`${this._terminal.buffer.lines.length}`)||e.relatedTarget!==m)return;let v,b;if(t===0?(v=l,b=this._rowElements.pop(),this._rowContainer.removeChild(b)):(v=this._rowElements.shift(),b=l,this._rowContainer.removeChild(v)),v.removeEventListener("focus",this._topBoundaryFocusListener),b.removeEventListener("focus",this._bottomBoundaryFocusListener),t===0){const f=this._createAccessibilityTreeNode();this._rowElements.unshift(f),this._rowContainer.insertAdjacentElement("afterbegin",f)}else{const f=this._createAccessibilityTreeNode();this._rowElements.push(f),this._rowContainer.appendChild(f)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(t===0?-1:1),this._rowElements[t===0?1:this._rowElements.length-2].focus(),e.preventDefault(),e.stopImmediatePropagation()}_handleSelectionChange(){var w;if(this._rowElements.length===0)return;const e=document.getSelection();if(!e)return;if(e.isCollapsed)return void(this._rowContainer.contains(e.anchorNode)&&this._terminal.clearSelection());if(!e.anchorNode||!e.focusNode)return void console.error("anchorNode and/or focusNode are null");let t={node:e.anchorNode,offset:e.anchorOffset},l={node:e.focusNode,offset:e.focusOffset};if((t.node.compareDocumentPosition(l.node)&Node.DOCUMENT_POSITION_PRECEDING||t.node===l.node&&t.offset>l.offset)&&([t,l]=[l,t]),t.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(t={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(t.node))return;const m=this._rowElements.slice(-1)[0];if(l.node.compareDocumentPosition(m)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(l={node:m,offset:((w=m.textContent)==null?void 0:w.length)??0}),!this._rowContainer.contains(l.node))return;const v=({node:D,offset:T})=>{const M=D instanceof Text?D.parentNode:D;let L=parseInt(M==null?void 0:M.getAttribute("aria-posinset"),10)-1;if(isNaN(L))return console.warn("row is invalid. Race condition?"),null;const H=this._rowColumns.get(M);if(!H)return console.warn("columns is null. Race condition?"),null;let $=T<H.length?H[T]:H.slice(-1)[0]+1;return $>=this._terminal.cols&&(++L,$=0),{row:L,column:$}},b=v(t),f=v(l);if(b&&f){if(b.row>f.row||b.row===f.row&&b.column>=f.column)throw new Error("invalid range");this._terminal.select(b.column,b.row,(f.row-b.row)*this._terminal.cols-b.column+f.column)}}_handleResize(e){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let t=this._rowContainer.children.length;t<this._terminal.rows;t++)this._rowElements[t]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[t]);for(;this._rowElements.length>e;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const e=this._coreBrowserService.mainDocument.createElement("div");return e.setAttribute("role","listitem"),e.tabIndex=-1,this._refreshRowDimensions(e),e}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let e=0;e<this._terminal.rows;e++)this._refreshRowDimensions(this._rowElements[e])}}_refreshRowDimensions(e){e.style.height=`${this._renderService.dimensions.css.cell.height}px`}};i.AccessibilityManager=r=h([p(1,d.IInstantiationService),p(2,y.ICoreBrowserService),p(3,y.IRenderService)],r)},3614:(x,i)=>{function o(_){return _.replace(/\r?\n/g,"\r")}function h(_,g){return g?"\x1B[200~"+_+"\x1B[201~":_}function p(_,g,y,d){_=h(_=o(_),y.decPrivateModes.bracketedPasteMode&&d.rawOptions.ignoreBracketedPasteMode!==!0),y.triggerDataEvent(_,!0),g.value=""}function a(_,g,y){const d=y.getBoundingClientRect(),s=_.clientX-d.left-10,r=_.clientY-d.top-10;g.style.width="20px",g.style.height="20px",g.style.left=`${s}px`,g.style.top=`${r}px`,g.style.zIndex="1000",g.focus()}Object.defineProperty(i,"__esModule",{value:!0}),i.rightClickHandler=i.moveTextAreaUnderMouseCursor=i.paste=i.handlePasteEvent=i.copyHandler=i.bracketTextForPaste=i.prepareTextForTerminal=void 0,i.prepareTextForTerminal=o,i.bracketTextForPaste=h,i.copyHandler=function(_,g){_.clipboardData&&_.clipboardData.setData("text/plain",g.selectionText),_.preventDefault()},i.handlePasteEvent=function(_,g,y,d){_.stopPropagation(),_.clipboardData&&p(_.clipboardData.getData("text/plain"),g,y,d)},i.paste=p,i.moveTextAreaUnderMouseCursor=a,i.rightClickHandler=function(_,g,y,d,s){a(_,g,y),s&&d.rightClickSelect(_),g.value=d.selectionText,g.select()}},7239:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorContrastCache=void 0;const h=o(1505);i.ColorContrastCache=class{constructor(){this._color=new h.TwoKeyMap,this._css=new h.TwoKeyMap}setCss(p,a,_){this._css.set(p,a,_)}getCss(p,a){return this._css.get(p,a)}setColor(p,a,_){this._color.set(p,a,_)}getColor(p,a){return this._color.get(p,a)}clear(){this._color.clear(),this._css.clear()}}},3656:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(o,h,p,a){o.addEventListener(h,p,a);let _=!1;return{dispose:()=>{_||(_=!0,o.removeEventListener(h,p,a))}}}},3551:function(x,i,o){var h=this&&this.__decorate||function(r,e,t,l){var m,v=arguments.length,b=v<3?e:l===null?l=Object.getOwnPropertyDescriptor(e,t):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(r,e,t,l);else for(var f=r.length-1;f>=0;f--)(m=r[f])&&(b=(v<3?m(b):v>3?m(e,t,b):m(e,t))||b);return v>3&&b&&Object.defineProperty(e,t,b),b},p=this&&this.__param||function(r,e){return function(t,l){e(t,l,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Linkifier=void 0;const a=o(3656),_=o(8460),g=o(844),y=o(2585),d=o(4725);let s=i.Linkifier=class extends g.Disposable{get currentLink(){return this._currentLink}constructor(r,e,t,l,m){super(),this._element=r,this._mouseService=e,this._renderService=t,this._bufferService=l,this._linkProviderService=m,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new _.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new _.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,g.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,g.toDisposable)(()=>{var v;this._lastMouseEvent=void 0,(v=this._activeProviderReplies)==null||v.clear()})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0})),this.register((0,a.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,a.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,a.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,a.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(r){this._lastMouseEvent=r;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);if(!e)return;this._isMouseOut=!1;const t=r.composedPath();for(let l=0;l<t.length;l++){const m=t[l];if(m.classList.contains("xterm"))break;if(m.classList.contains("xterm-hover"))return}this._lastBufferCell&&e.x===this._lastBufferCell.x&&e.y===this._lastBufferCell.y||(this._handleHover(e),this._lastBufferCell=e)}_handleHover(r){if(this._activeLine!==r.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(r,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,r)||(this._clearCurrentLink(),this._askForLink(r,!0))}_askForLink(r,e){var l,m;this._activeProviderReplies&&e||((l=this._activeProviderReplies)==null||l.forEach(v=>{v==null||v.forEach(b=>{b.link.dispose&&b.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=r.y);let t=!1;for(const[v,b]of this._linkProviderService.linkProviders.entries())e?(m=this._activeProviderReplies)!=null&&m.get(v)&&(t=this._checkLinkProviderResult(v,r,t)):b.provideLinks(r.y,f=>{var D,T;if(this._isMouseOut)return;const w=f==null?void 0:f.map(M=>({link:M}));(D=this._activeProviderReplies)==null||D.set(v,w),t=this._checkLinkProviderResult(v,r,t),((T=this._activeProviderReplies)==null?void 0:T.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(r.y,this._activeProviderReplies)})}_removeIntersectingLinks(r,e){const t=new Set;for(let l=0;l<e.size;l++){const m=e.get(l);if(m)for(let v=0;v<m.length;v++){const b=m[v],f=b.link.range.start.y<r?0:b.link.range.start.x,w=b.link.range.end.y>r?this._bufferService.cols:b.link.range.end.x;for(let D=f;D<=w;D++){if(t.has(D)){m.splice(v--,1);break}t.add(D)}}}}_checkLinkProviderResult(r,e,t){var v;if(!this._activeProviderReplies)return t;const l=this._activeProviderReplies.get(r);let m=!1;for(let b=0;b<r;b++)this._activeProviderReplies.has(b)&&!this._activeProviderReplies.get(b)||(m=!0);if(!m&&l){const b=l.find(f=>this._linkAtPosition(f.link,e));b&&(t=!0,this._handleNewLink(b))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!t)for(let b=0;b<this._activeProviderReplies.size;b++){const f=(v=this._activeProviderReplies.get(b))==null?void 0:v.find(w=>this._linkAtPosition(w.link,e));if(f){t=!0,this._handleNewLink(f);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(r){if(!this._currentLink)return;const e=this._positionFromMouseEvent(r,this._element,this._mouseService);e&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,e)&&this._currentLink.link.activate(r,this._currentLink.link.text)}_clearCurrentLink(r,e){this._currentLink&&this._lastMouseEvent&&(!r||!e||this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=e)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,g.disposeArray)(this._linkCacheDisposables))}_handleNewLink(r){if(!this._lastMouseEvent)return;const e=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);e&&this._linkAtPosition(r.link,e)&&(this._currentLink=r,this._currentLink.state={decorations:{underline:r.link.decorations===void 0||r.link.decorations.underline,pointerCursor:r.link.decorations===void 0||r.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,r.link,this._lastMouseEvent),r.link.decorations={},Object.defineProperties(r.link.decorations,{pointerCursor:{get:()=>{var t,l;return(l=(t=this._currentLink)==null?void 0:t.state)==null?void 0:l.decorations.pointerCursor},set:t=>{var l;(l=this._currentLink)!=null&&l.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",t))}},underline:{get:()=>{var t,l;return(l=(t=this._currentLink)==null?void 0:t.state)==null?void 0:l.decorations.underline},set:t=>{var l,m,v;(l=this._currentLink)!=null&&l.state&&((v=(m=this._currentLink)==null?void 0:m.state)==null?void 0:v.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(r.link,t))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;const l=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,m=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=l&&this._currentLink.link.range.end.y<=m&&(this._clearCurrentLink(l,m),this._lastMouseEvent)){const v=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);v&&this._askForLink(v,!1)}})))}_linkHover(r,e,t){var l;(l=this._currentLink)!=null&&l.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!0),this._currentLink.state.decorations.pointerCursor&&r.classList.add("xterm-cursor-pointer")),e.hover&&e.hover(t,e.text)}_fireUnderlineEvent(r,e){const t=r.range,l=this._bufferService.buffer.ydisp,m=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-l-1,t.end.x,t.end.y-l-1,void 0);(e?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(m)}_linkLeave(r,e,t){var l;(l=this._currentLink)!=null&&l.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(e,!1),this._currentLink.state.decorations.pointerCursor&&r.classList.remove("xterm-cursor-pointer")),e.leave&&e.leave(t,e.text)}_linkAtPosition(r,e){const t=r.range.start.y*this._bufferService.cols+r.range.start.x,l=r.range.end.y*this._bufferService.cols+r.range.end.x,m=e.y*this._bufferService.cols+e.x;return t<=m&&m<=l}_positionFromMouseEvent(r,e,t){const l=t.getCoords(r,e,this._bufferService.cols,this._bufferService.rows);if(l)return{x:l[0],y:l[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(r,e,t,l,m){return{x1:r,y1:e,x2:t,y2:l,cols:this._bufferService.cols,fg:m}}};i.Linkifier=s=h([p(1,d.IMouseService),p(2,d.IRenderService),p(3,y.IBufferService),p(4,d.ILinkProviderService)],s)},9042:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tooMuchOutput=i.promptLabel=void 0,i.promptLabel="Terminal input",i.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(x,i,o){var h=this&&this.__decorate||function(d,s,r,e){var t,l=arguments.length,m=l<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(d,s,r,e);else for(var v=d.length-1;v>=0;v--)(t=d[v])&&(m=(l<3?t(m):l>3?t(s,r,m):t(s,r))||m);return l>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(d,s){return function(r,e){s(r,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkProvider=void 0;const a=o(511),_=o(2585);let g=i.OscLinkProvider=class{constructor(d,s,r){this._bufferService=d,this._optionsService=s,this._oscLinkService=r}provideLinks(d,s){var w;const r=this._bufferService.buffer.lines.get(d-1);if(!r)return void s(void 0);const e=[],t=this._optionsService.rawOptions.linkHandler,l=new a.CellData,m=r.getTrimmedLength();let v=-1,b=-1,f=!1;for(let D=0;D<m;D++)if(b!==-1||r.hasContent(D)){if(r.loadCell(D,l),l.hasExtendedAttrs()&&l.extended.urlId){if(b===-1){b=D,v=l.extended.urlId;continue}f=l.extended.urlId!==v}else b!==-1&&(f=!0);if(f||b!==-1&&D===m-1){const T=(w=this._oscLinkService.getLinkData(v))==null?void 0:w.uri;if(T){const M={start:{x:b+1,y:d},end:{x:D+(f||D!==m-1?0:1),y:d}};let L=!1;if(!(t!=null&&t.allowNonHttpProtocols))try{const H=new URL(T);["http:","https:"].includes(H.protocol)||(L=!0)}catch{L=!0}L||e.push({text:T,range:M,activate:(H,$)=>t?t.activate(H,$,M):y(0,$),hover:(H,$)=>{var U;return(U=t==null?void 0:t.hover)==null?void 0:U.call(t,H,$,M)},leave:(H,$)=>{var U;return(U=t==null?void 0:t.leave)==null?void 0:U.call(t,H,$,M)}})}f=!1,l.hasExtendedAttrs()&&l.extended.urlId?(b=D,v=l.extended.urlId):(b=-1,v=-1)}}s(e)}};function y(d,s){if(confirm(`Do you want to navigate to ${s}?

WARNING: This link could potentially be dangerous`)){const r=window.open();if(r){try{r.opener=null}catch{}r.location.href=s}else console.warn("Opening link blocked as opener could not be cleared")}}i.OscLinkProvider=g=h([p(0,_.IBufferService),p(1,_.IOptionsService),p(2,_.IOscLinkService)],g)},6193:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderDebouncer=void 0,i.RenderDebouncer=class{constructor(o,h){this._renderCallback=o,this._coreBrowserService=h,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(o){return this._refreshCallbacks.push(o),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(o,h,p){this._rowCount=p,o=o!==void 0?o:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const o=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,h),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const o of this._refreshCallbacks)o(0);this._refreshCallbacks=[]}}},3236:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Terminal=void 0;const h=o(3614),p=o(3656),a=o(3551),_=o(9042),g=o(3730),y=o(1680),d=o(3107),s=o(5744),r=o(2950),e=o(1296),t=o(428),l=o(4269),m=o(5114),v=o(8934),b=o(3230),f=o(9312),w=o(4725),D=o(6731),T=o(8055),M=o(8969),L=o(8460),H=o(844),$=o(6114),U=o(8437),G=o(2584),j=o(7399),k=o(5941),R=o(9074),B=o(2585),I=o(5435),N=o(4567),z=o(779);class J extends M.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(P={}){super(P),this.browser=$,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new H.MutableDisposable),this._onCursorMove=this.register(new L.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new L.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new L.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new L.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new L.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new L.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new L.EventEmitter),this._onBlur=this.register(new L.EventEmitter),this._onA11yCharEmitter=this.register(new L.EventEmitter),this._onA11yTabEmitter=this.register(new L.EventEmitter),this._onWillOpen=this.register(new L.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(B.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(z.LinkProviderService),this._instantiationService.setService(w.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(g.OscLinkProvider)),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((E,W)=>this.refresh(E,W))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(E=>this._reportWindowsOptions(E))),this.register(this._inputHandler.onColor(E=>this._handleColorEvent(E))),this.register((0,L.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,L.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,L.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(E=>this._afterResize(E.cols,E.rows))),this.register((0,H.toDisposable)(()=>{var E,W;this._customKeyEventHandler=void 0,(W=(E=this.element)==null?void 0:E.parentNode)==null||W.removeChild(this.element)}))}_handleColorEvent(P){if(this._themeService)for(const E of P){let W,F="";switch(E.index){case 256:W="foreground",F="10";break;case 257:W="background",F="11";break;case 258:W="cursor",F="12";break;default:W="ansi",F="4;"+E.index}switch(E.type){case 0:const K=T.color.toColorRGB(W==="ansi"?this._themeService.colors.ansi[E.index]:this._themeService.colors[W]);this.coreService.triggerDataEvent(`${G.C0.ESC}]${F};${(0,k.toRgbString)(K)}${G.C1_ESCAPED.ST}`);break;case 1:if(W==="ansi")this._themeService.modifyColors(V=>V.ansi[E.index]=T.channels.toColor(...E.color));else{const V=W;this._themeService.modifyColors(Q=>Q[V]=T.channels.toColor(...E.color))}break;case 2:this._themeService.restoreColor(E.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(P){P?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(N.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(P){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(G.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var P;return(P=this.textarea)==null?void 0:P.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(G.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const P=this.buffer.ybase+this.buffer.y,E=this.buffer.lines.get(P);if(!E)return;const W=Math.min(this.buffer.x,this.cols-1),F=this._renderService.dimensions.css.cell.height,K=E.getWidth(W),V=this._renderService.dimensions.css.cell.width*K,Q=this.buffer.y*this._renderService.dimensions.css.cell.height,se=W*this._renderService.dimensions.css.cell.width;this.textarea.style.left=se+"px",this.textarea.style.top=Q+"px",this.textarea.style.width=V+"px",this.textarea.style.height=F+"px",this.textarea.style.lineHeight=F+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,p.addDisposableDomListener)(this.element,"copy",E=>{this.hasSelection()&&(0,h.copyHandler)(E,this._selectionService)}));const P=E=>(0,h.handlePasteEvent)(E,this.textarea,this.coreService,this.optionsService);this.register((0,p.addDisposableDomListener)(this.textarea,"paste",P)),this.register((0,p.addDisposableDomListener)(this.element,"paste",P)),$.isFirefox?this.register((0,p.addDisposableDomListener)(this.element,"mousedown",E=>{E.button===2&&(0,h.rightClickHandler)(E,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,p.addDisposableDomListener)(this.element,"contextmenu",E=>{(0,h.rightClickHandler)(E,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),$.isLinux&&this.register((0,p.addDisposableDomListener)(this.element,"auxclick",E=>{E.button===1&&(0,h.moveTextAreaUnderMouseCursor)(E,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,p.addDisposableDomListener)(this.textarea,"keyup",P=>this._keyUp(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keydown",P=>this._keyDown(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"keypress",P=>this._keyPress(P),!0)),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionupdate",P=>this._compositionHelper.compositionupdate(P))),this.register((0,p.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,p.addDisposableDomListener)(this.textarea,"input",P=>this._inputEvent(P),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(P){var W;if(!P)throw new Error("Terminal requires a parent element.");if(P.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((W=this.element)==null?void 0:W.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=P.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),P.appendChild(this.element);const E=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),E.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,p.addDisposableDomListener)(this.screenElement,"mousemove",F=>this.updateCursorStyle(F))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),E.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",_.promptLabel),$.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,P.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(w.ICoreBrowserService,this._coreBrowserService),this.register((0,p.addDisposableDomListener)(this.textarea,"focus",F=>this._handleTextAreaFocus(F))),this.register((0,p.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(t.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(w.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(D.ThemeService),this._instantiationService.setService(w.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(l.CharacterJoinerService),this._instantiationService.setService(w.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(b.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(w.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(F=>this._onRender.fire(F))),this.onResize(F=>this._renderService.resize(F.cols,F.rows)),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(r.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(v.MouseService),this._instantiationService.setService(w.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(a.Linkifier,this.screenElement)),this.element.appendChild(E);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(y.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(f.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(w.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(F=>this._renderService.handleSelectionChanged(F.start,F.end,F.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(F=>{this.textarea.value=F,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(F=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,p.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.register(this._instantiationService.createInstance(d.BufferDecorationRenderer,this.screenElement)),this.register((0,p.addDisposableDomListener)(this.element,"mousedown",F=>this._selectionService.handleMouseDown(F))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(N.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",F=>this._handleScreenReaderModeOptionChange(F))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",F=>{!this._overviewRulerRenderer&&F&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(s.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(e.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){const P=this,E=this.element;function W(V){const Q=P._mouseService.getMouseReportCoords(V,P.screenElement);if(!Q)return!1;let se,ie;switch(V.overrideType||V.type){case"mousemove":ie=32,V.buttons===void 0?(se=3,V.button!==void 0&&(se=V.button<3?V.button:3)):se=1&V.buttons?0:4&V.buttons?1:2&V.buttons?2:3;break;case"mouseup":ie=0,se=V.button<3?V.button:3;break;case"mousedown":ie=1,se=V.button<3?V.button:3;break;case"wheel":if(P._customWheelEventHandler&&P._customWheelEventHandler(V)===!1||P.viewport.getLinesScrolled(V)===0)return!1;ie=V.deltaY<0?0:1,se=4;break;default:return!1}return!(ie===void 0||se===void 0||se>4)&&P.coreMouseService.triggerMouseEvent({col:Q.col,row:Q.row,x:Q.x,y:Q.y,button:se,action:ie,ctrl:V.ctrlKey,alt:V.altKey,shift:V.shiftKey})}const F={mouseup:null,wheel:null,mousedrag:null,mousemove:null},K={mouseup:V=>(W(V),V.buttons||(this._document.removeEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.removeEventListener("mousemove",F.mousedrag)),this.cancel(V)),wheel:V=>(W(V),this.cancel(V,!0)),mousedrag:V=>{V.buttons&&W(V)},mousemove:V=>{V.buttons||W(V)}};this.register(this.coreMouseService.onProtocolChange(V=>{V?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(V)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&V?F.mousemove||(E.addEventListener("mousemove",K.mousemove),F.mousemove=K.mousemove):(E.removeEventListener("mousemove",F.mousemove),F.mousemove=null),16&V?F.wheel||(E.addEventListener("wheel",K.wheel,{passive:!1}),F.wheel=K.wheel):(E.removeEventListener("wheel",F.wheel),F.wheel=null),2&V?F.mouseup||(F.mouseup=K.mouseup):(this._document.removeEventListener("mouseup",F.mouseup),F.mouseup=null),4&V?F.mousedrag||(F.mousedrag=K.mousedrag):(this._document.removeEventListener("mousemove",F.mousedrag),F.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,p.addDisposableDomListener)(E,"mousedown",V=>{if(V.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(V))return W(V),F.mouseup&&this._document.addEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.addEventListener("mousemove",F.mousedrag),this.cancel(V)})),this.register((0,p.addDisposableDomListener)(E,"wheel",V=>{if(!F.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(V)===!1)return!1;if(!this.buffer.hasScrollback){const Q=this.viewport.getLinesScrolled(V);if(Q===0)return;const se=G.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(V.deltaY<0?"A":"B");let ie="";for(let ce=0;ce<Math.abs(Q);ce++)ie+=se;return this.coreService.triggerDataEvent(ie,!0),this.cancel(V,!0)}return this.viewport.handleWheel(V)?this.cancel(V):void 0}},{passive:!1})),this.register((0,p.addDisposableDomListener)(E,"touchstart",V=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(V),this.cancel(V)},{passive:!0})),this.register((0,p.addDisposableDomListener)(E,"touchmove",V=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(V)?void 0:this.cancel(V)},{passive:!1}))}refresh(P,E){var W;(W=this._renderService)==null||W.refreshRows(P,E)}updateCursorStyle(P){var E;(E=this._selectionService)!=null&&E.shouldColumnSelect(P)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(P,E,W=0){var F;W===1?(super.scrollLines(P,E,W),this.refresh(0,this.rows-1)):(F=this.viewport)==null||F.scrollLines(P)}paste(P){(0,h.paste)(P,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(P){this._customKeyEventHandler=P}attachCustomWheelEventHandler(P){this._customWheelEventHandler=P}registerLinkProvider(P){return this._linkProviderService.registerLinkProvider(P)}registerCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const E=this._characterJoinerService.register(P);return this.refresh(0,this.rows-1),E}deregisterCharacterJoiner(P){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(P)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(P){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+P)}registerDecoration(P){return this._decorationService.registerDecoration(P)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(P,E,W){this._selectionService.setSelection(P,E,W)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var P;(P=this._selectionService)==null||P.clearSelection()}selectAll(){var P;(P=this._selectionService)==null||P.selectAll()}selectLines(P,E){var W;(W=this._selectionService)==null||W.selectLines(P,E)}_keyDown(P){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;const E=this.browser.isMac&&this.options.macOptionIsMeta&&P.altKey;if(!E&&!this._compositionHelper.keydown(P))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;E||P.key!=="Dead"&&P.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const W=(0,j.evaluateKeyboardEvent)(P,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(P),W.type===3||W.type===2){const F=this.rows-1;return this.scrollLines(W.type===2?-F:F),this.cancel(P,!0)}return W.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,P)||(W.cancel&&this.cancel(P,!0),!W.key||!!(P.key&&!P.ctrlKey&&!P.altKey&&!P.metaKey&&P.key.length===1&&P.key.charCodeAt(0)>=65&&P.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(W.key!==G.C0.ETX&&W.key!==G.C0.CR||(this.textarea.value=""),this._onKey.fire({key:W.key,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(W.key,!0),!this.optionsService.rawOptions.screenReaderMode||P.altKey||P.ctrlKey?this.cancel(P,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(P,E){const W=P.isMac&&!this.options.macOptionIsMeta&&E.altKey&&!E.ctrlKey&&!E.metaKey||P.isWindows&&E.altKey&&E.ctrlKey&&!E.metaKey||P.isWindows&&E.getModifierState("AltGraph");return E.type==="keypress"?W:W&&(!E.keyCode||E.keyCode>47)}_keyUp(P){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1||(function(E){return E.keyCode===16||E.keyCode===17||E.keyCode===18}(P)||this.focus(),this.updateCursorStyle(P),this._keyPressHandled=!1)}_keyPress(P){let E;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(P)===!1)return!1;if(this.cancel(P),P.charCode)E=P.charCode;else if(P.which===null||P.which===void 0)E=P.keyCode;else{if(P.which===0||P.charCode===0)return!1;E=P.which}return!(!E||(P.altKey||P.ctrlKey||P.metaKey)&&!this._isThirdLevelShift(this.browser,P)||(E=String.fromCharCode(E),this._onKey.fire({key:E,domEvent:P}),this._showCursor(),this.coreService.triggerDataEvent(E,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(P){if(P.data&&P.inputType==="insertText"&&(!P.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const E=P.data;return this.coreService.triggerDataEvent(E,!0),this.cancel(P),!0}return!1}resize(P,E){P!==this.cols||E!==this.rows?super.resize(P,E):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(P,E){var W,F;(W=this._charSizeService)==null||W.measure(),(F=this.viewport)==null||F.syncScrollArea(!0)}clear(){var P;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let E=1;E<this.rows;E++)this.buffer.lines.push(this.buffer.getBlankLine(U.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(P=this.viewport)==null||P.reset(),this.refresh(0,this.rows-1)}}reset(){var E,W;this.options.rows=this.rows,this.options.cols=this.cols;const P=this._customKeyEventHandler;this._setup(),super.reset(),(E=this._selectionService)==null||E.reset(),this._decorationService.reset(),(W=this.viewport)==null||W.reset(),this._customKeyEventHandler=P,this.refresh(0,this.rows-1)}clearTextureAtlas(){var P;(P=this._renderService)==null||P.clearTextureAtlas()}_reportFocus(){var P;(P=this.element)!=null&&P.classList.contains("focus")?this.coreService.triggerDataEvent(G.C0.ESC+"[I"):this.coreService.triggerDataEvent(G.C0.ESC+"[O")}_reportWindowsOptions(P){if(this._renderService)switch(P){case I.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const E=this._renderService.dimensions.css.canvas.width.toFixed(0),W=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${G.C0.ESC}[4;${W};${E}t`);break;case I.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const F=this._renderService.dimensions.css.cell.width.toFixed(0),K=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${G.C0.ESC}[6;${K};${F}t`)}}cancel(P,E){if(this.options.cancelEvents||E)return P.preventDefault(),P.stopPropagation(),!1}}i.Terminal=J},9924:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TimeBasedDebouncer=void 0,i.TimeBasedDebouncer=class{constructor(o,h=1e3){this._renderCallback=o,this._debounceThresholdMS=h,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(o,h,p){this._rowCount=p,o=o!==void 0?o:0,h=h!==void 0?h:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,h):h;const a=Date.now();if(a-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=a,this._innerRefresh();else if(!this._additionalRefreshRequested){const _=a-this._lastRefreshMs,g=this._debounceThresholdMS-_;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},g)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const o=Math.max(this._rowStart,0),h=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,h)}}},1680:function(x,i,o){var h=this&&this.__decorate||function(r,e,t,l){var m,v=arguments.length,b=v<3?e:l===null?l=Object.getOwnPropertyDescriptor(e,t):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(r,e,t,l);else for(var f=r.length-1;f>=0;f--)(m=r[f])&&(b=(v<3?m(b):v>3?m(e,t,b):m(e,t))||b);return v>3&&b&&Object.defineProperty(e,t,b),b},p=this&&this.__param||function(r,e){return function(t,l){e(t,l,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Viewport=void 0;const a=o(3656),_=o(4725),g=o(8460),y=o(844),d=o(2585);let s=i.Viewport=class extends y.Disposable{constructor(r,e,t,l,m,v,b,f){super(),this._viewportElement=r,this._scrollArea=e,this._bufferService=t,this._optionsService=l,this._charSizeService=m,this._renderService=v,this._coreBrowserService=b,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new g.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,a.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(w=>this._activeBuffer=w.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(w=>this._renderDimensions=w)),this._handleThemeChange(f.colors),this.register(f.onChangeColors(w=>this._handleThemeChange(w))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(r){this._viewportElement.style.backgroundColor=r.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(r){if(r)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const e=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==e&&(this._lastRecordedBufferHeight=e,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const r=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==r&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=r),this._refreshAnimationFrame=null}syncScrollArea(r=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(r);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(r)}_handleScroll(r){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const e=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:e,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const r=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(r*(this._smoothScrollState.target-this._smoothScrollState.origin)),r<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(r,e){const t=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(e<0&&this._viewportElement.scrollTop!==0||e>0&&t<this._lastRecordedBufferHeight)||(r.cancelable&&r.preventDefault(),!1)}handleWheel(r){const e=this._getPixelsScrolled(r);return e!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+e:this._smoothScrollState.target+=e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}scrollLines(r){if(r!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const e=r*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+e,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:r,suppressScrollEvent:!1})}_getPixelsScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_LINE?e*=this._currentRowHeight:r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._currentRowHeight*this._bufferService.rows),e}getBufferElements(r,e){var f;let t,l="";const m=[],v=e??this._bufferService.buffer.lines.length,b=this._bufferService.buffer.lines;for(let w=r;w<v;w++){const D=b.get(w);if(!D)continue;const T=(f=b.get(w+1))==null?void 0:f.isWrapped;if(l+=D.translateToString(!T),!T||w===b.length-1){const M=document.createElement("div");M.textContent=l,m.push(M),l.length>0&&(t=M),l=""}}return{bufferElements:m,cursorElement:t}}getLinesScrolled(r){if(r.deltaY===0||r.shiftKey)return 0;let e=this._applyScrollModifier(r.deltaY,r);return r.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(e/=this._currentRowHeight+0,this._wheelPartialScroll+=e,e=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):r.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(e*=this._bufferService.rows),e}_applyScrollModifier(r,e){const t=this._optionsService.rawOptions.fastScrollModifier;return t==="alt"&&e.altKey||t==="ctrl"&&e.ctrlKey||t==="shift"&&e.shiftKey?r*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:r*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(r){this._lastTouchY=r.touches[0].pageY}handleTouchMove(r){const e=this._lastTouchY-r.touches[0].pageY;return this._lastTouchY=r.touches[0].pageY,e!==0&&(this._viewportElement.scrollTop+=e,this._bubbleScroll(r,e))}};i.Viewport=s=h([p(2,d.IBufferService),p(3,d.IOptionsService),p(4,_.ICharSizeService),p(5,_.IRenderService),p(6,_.ICoreBrowserService),p(7,_.IThemeService)],s)},3107:function(x,i,o){var h=this&&this.__decorate||function(d,s,r,e){var t,l=arguments.length,m=l<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(d,s,r,e);else for(var v=d.length-1;v>=0;v--)(t=d[v])&&(m=(l<3?t(m):l>3?t(s,r,m):t(s,r))||m);return l>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(d,s){return function(r,e){s(r,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferDecorationRenderer=void 0;const a=o(4725),_=o(844),g=o(2585);let y=i.BufferDecorationRenderer=class extends _.Disposable{constructor(d,s,r,e,t){super(),this._screenElement=d,this._bufferService=s,this._coreBrowserService=r,this._decorationService=e,this._renderService=t,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(l=>this._removeDecoration(l))),this.register((0,_.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const d of this._decorationService.decorations)this._renderDecoration(d);this._dimensionsChanged=!1}_renderDecoration(d){this._refreshStyle(d),this._dimensionsChanged&&this._refreshXPosition(d)}_createElement(d){var e;const s=this._coreBrowserService.mainDocument.createElement("div");s.classList.add("xterm-decoration"),s.classList.toggle("xterm-decoration-top-layer",((e=d==null?void 0:d.options)==null?void 0:e.layer)==="top"),s.style.width=`${Math.round((d.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,s.style.height=(d.options.height||1)*this._renderService.dimensions.css.cell.height+"px",s.style.top=(d.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",s.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const r=d.options.x??0;return r&&r>this._bufferService.cols&&(s.style.display="none"),this._refreshXPosition(d,s),s}_refreshStyle(d){const s=d.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)d.element&&(d.element.style.display="none",d.onRenderEmitter.fire(d.element));else{let r=this._decorationElements.get(d);r||(r=this._createElement(d),d.element=r,this._decorationElements.set(d,r),this._container.appendChild(r),d.onDispose(()=>{this._decorationElements.delete(d),r.remove()})),r.style.top=s*this._renderService.dimensions.css.cell.height+"px",r.style.display=this._altBufferIsActive?"none":"block",d.onRenderEmitter.fire(r)}}_refreshXPosition(d,s=d.element){if(!s)return;const r=d.options.x??0;(d.options.anchor||"left")==="right"?s.style.right=r?r*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=r?r*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(d){var s;(s=this._decorationElements.get(d))==null||s.remove(),this._decorationElements.delete(d),d.dispose()}};i.BufferDecorationRenderer=y=h([p(1,g.IBufferService),p(2,a.ICoreBrowserService),p(3,g.IDecorationService),p(4,a.IRenderService)],y)},5871:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorZoneStore=void 0,i.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(o){if(o.options.overviewRulerOptions){for(const h of this._zones)if(h.color===o.options.overviewRulerOptions.color&&h.position===o.options.overviewRulerOptions.position){if(this._lineIntersectsZone(h,o.marker.line))return;if(this._lineAdjacentToZone(h,o.marker.line,o.options.overviewRulerOptions.position))return void this._addLineToZone(h,o.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=o.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=o.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=o.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=o.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:o.options.overviewRulerOptions.color,position:o.options.overviewRulerOptions.position,startBufferLine:o.marker.line,endBufferLine:o.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(o){this._linePadding=o}_lineIntersectsZone(o,h){return h>=o.startBufferLine&&h<=o.endBufferLine}_lineAdjacentToZone(o,h,p){return h>=o.startBufferLine-this._linePadding[p||"full"]&&h<=o.endBufferLine+this._linePadding[p||"full"]}_addLineToZone(o,h){o.startBufferLine=Math.min(o.startBufferLine,h),o.endBufferLine=Math.max(o.endBufferLine,h)}}},5744:function(x,i,o){var h=this&&this.__decorate||function(t,l,m,v){var b,f=arguments.length,w=f<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(t,l,m,v);else for(var D=t.length-1;D>=0;D--)(b=t[D])&&(w=(f<3?b(w):f>3?b(l,m,w):b(l,m))||w);return f>3&&w&&Object.defineProperty(l,m,w),w},p=this&&this.__param||function(t,l){return function(m,v){l(m,v,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OverviewRulerRenderer=void 0;const a=o(5871),_=o(4725),g=o(844),y=o(2585),d={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},r={full:0,left:0,center:0,right:0};let e=i.OverviewRulerRenderer=class extends g.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(t,l,m,v,b,f,w){var T;super(),this._viewportElement=t,this._screenElement=l,this._bufferService=m,this._decorationService=v,this._renderService=b,this._optionsService=f,this._coreBrowserService=w,this._colorZoneStore=new a.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(T=this._viewportElement.parentElement)==null||T.insertBefore(this._canvas,this._viewportElement);const D=this._canvas.getContext("2d");if(!D)throw new Error("Ctx cannot be null");this._ctx=D,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,g.toDisposable)(()=>{var M;(M=this._canvas)==null||M.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register(this._coreBrowserService.onDprChange(()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const t=Math.floor(this._canvas.width/3),l=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=t,s.center=l,s.right=t,this._refreshDrawHeightConstants(),r.full=0,r.left=0,r.center=s.left,r.right=s.left+s.center}_refreshDrawHeightConstants(){d.full=Math.round(2*this._coreBrowserService.dpr);const t=this._canvas.height/this._bufferService.buffer.lines.length,l=Math.round(Math.max(Math.min(t,12),6)*this._coreBrowserService.dpr);d.left=l,d.center=l,d.right=l}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*d.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const l of this._decorationService.decorations)this._colorZoneStore.addDecoration(l);this._ctx.lineWidth=1;const t=this._colorZoneStore.zones;for(const l of t)l.position!=="full"&&this._renderColorZone(l);for(const l of t)l.position==="full"&&this._renderColorZone(l);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(t){this._ctx.fillStyle=t.color,this._ctx.fillRect(r[t.position||"full"],Math.round((this._canvas.height-1)*(t.startBufferLine/this._bufferService.buffers.active.lines.length)-d[t.position||"full"]/2),s[t.position||"full"],Math.round((this._canvas.height-1)*((t.endBufferLine-t.startBufferLine)/this._bufferService.buffers.active.lines.length)+d[t.position||"full"]))}_queueRefresh(t,l){this._shouldUpdateDimensions=t||this._shouldUpdateDimensions,this._shouldUpdateAnchor=l||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};i.OverviewRulerRenderer=e=h([p(2,y.IBufferService),p(3,y.IDecorationService),p(4,_.IRenderService),p(5,y.IOptionsService),p(6,_.ICoreBrowserService)],e)},2950:function(x,i,o){var h=this&&this.__decorate||function(d,s,r,e){var t,l=arguments.length,m=l<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(d,s,r,e);else for(var v=d.length-1;v>=0;v--)(t=d[v])&&(m=(l<3?t(m):l>3?t(s,r,m):t(s,r))||m);return l>3&&m&&Object.defineProperty(s,r,m),m},p=this&&this.__param||function(d,s){return function(r,e){s(r,e,d)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CompositionHelper=void 0;const a=o(4725),_=o(2585),g=o(2584);let y=i.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(d,s,r,e,t,l){this._textarea=d,this._compositionView=s,this._bufferService=r,this._optionsService=e,this._coreService=t,this._renderService=l,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(d){this._compositionView.textContent=d.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(d){if(this._isComposing||this._isSendingComposition){if(d.keyCode===229||d.keyCode===16||d.keyCode===17||d.keyCode===18)return!1;this._finalizeComposition(!1)}return d.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(d){if(this._compositionView.classList.remove("active"),this._isComposing=!1,d){const s={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let r;this._isSendingComposition=!1,s.start+=this._dataAlreadySent.length,r=this._isComposing?this._textarea.value.substring(s.start,s.end):this._textarea.value.substring(s.start),r.length>0&&this._coreService.triggerDataEvent(r,!0)}},0)}else{this._isSendingComposition=!1;const s=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(s,!0)}}_handleAnyTextareaChanges(){const d=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const s=this._textarea.value,r=s.replace(d,"");this._dataAlreadySent=r,s.length>d.length?this._coreService.triggerDataEvent(r,!0):s.length<d.length?this._coreService.triggerDataEvent(`${g.C0.DEL}`,!0):s.length===d.length&&s!==d&&this._coreService.triggerDataEvent(s,!0)}},0)}updateCompositionElements(d){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const s=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),r=this._renderService.dimensions.css.cell.height,e=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,t=s*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=t+"px",this._compositionView.style.top=e+"px",this._compositionView.style.height=r+"px",this._compositionView.style.lineHeight=r+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const l=this._compositionView.getBoundingClientRect();this._textarea.style.left=t+"px",this._textarea.style.top=e+"px",this._textarea.style.width=Math.max(l.width,1)+"px",this._textarea.style.height=Math.max(l.height,1)+"px",this._textarea.style.lineHeight=l.height+"px"}d||setTimeout(()=>this.updateCompositionElements(!0),0)}}};i.CompositionHelper=y=h([p(2,_.IBufferService),p(3,_.IOptionsService),p(4,_.ICoreService),p(5,a.IRenderService)],y)},9806:(x,i)=>{function o(h,p,a){const _=a.getBoundingClientRect(),g=h.getComputedStyle(a),y=parseInt(g.getPropertyValue("padding-left")),d=parseInt(g.getPropertyValue("padding-top"));return[p.clientX-_.left-y,p.clientY-_.top-d]}Object.defineProperty(i,"__esModule",{value:!0}),i.getCoords=i.getCoordsRelativeToElement=void 0,i.getCoordsRelativeToElement=o,i.getCoords=function(h,p,a,_,g,y,d,s,r){if(!y)return;const e=o(h,p,a);return e?(e[0]=Math.ceil((e[0]+(r?d/2:0))/d),e[1]=Math.ceil(e[1]/s),e[0]=Math.min(Math.max(e[0],1),_+(r?1:0)),e[1]=Math.min(Math.max(e[1],1),g),e):void 0}},9504:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.moveToCellSequence=void 0;const h=o(2584);function p(s,r,e,t){const l=s-a(s,e),m=r-a(r,e),v=Math.abs(l-m)-function(b,f,w){let D=0;const T=b-a(b,w),M=f-a(f,w);for(let L=0;L<Math.abs(T-M);L++){const H=_(b,f)==="A"?-1:1,$=w.buffer.lines.get(T+H*L);$!=null&&$.isWrapped&&D++}return D}(s,r,e);return d(v,y(_(s,r),t))}function a(s,r){let e=0,t=r.buffer.lines.get(s),l=t==null?void 0:t.isWrapped;for(;l&&s>=0&&s<r.rows;)e++,t=r.buffer.lines.get(--s),l=t==null?void 0:t.isWrapped;return e}function _(s,r){return s>r?"A":"B"}function g(s,r,e,t,l,m){let v=s,b=r,f="";for(;v!==e||b!==t;)v+=l?1:-1,l&&v>m.cols-1?(f+=m.buffer.translateBufferLineToString(b,!1,s,v),v=0,s=0,b++):!l&&v<0&&(f+=m.buffer.translateBufferLineToString(b,!1,0,s+1),v=m.cols-1,s=v,b--);return f+m.buffer.translateBufferLineToString(b,!1,s,v)}function y(s,r){const e=r?"O":"[";return h.C0.ESC+e+s}function d(s,r){s=Math.floor(s);let e="";for(let t=0;t<s;t++)e+=r;return e}i.moveToCellSequence=function(s,r,e,t){const l=e.buffer.x,m=e.buffer.y;if(!e.buffer.hasScrollback)return function(f,w,D,T,M,L){return p(w,T,M,L).length===0?"":d(g(f,w,f,w-a(w,M),!1,M).length,y("D",L))}(l,m,0,r,e,t)+p(m,r,e,t)+function(f,w,D,T,M,L){let H;H=p(w,T,M,L).length>0?T-a(T,M):w;const $=T,U=function(G,j,k,R,B,I){let N;return N=p(k,R,B,I).length>0?R-a(R,B):j,G<k&&N<=R||G>=k&&N<R?"C":"D"}(f,w,D,T,M,L);return d(g(f,H,D,$,U==="C",M).length,y(U,L))}(l,m,s,r,e,t);let v;if(m===r)return v=l>s?"D":"C",d(Math.abs(l-s),y(v,t));v=m>r?"D":"C";const b=Math.abs(m-r);return d(function(f,w){return w.cols-f}(m>r?s:l,e)+(b-1)*e.cols+1+((m>r?l:s)-1),y(v,t))}},1296:function(x,i,o){var h=this&&this.__decorate||function(L,H,$,U){var G,j=arguments.length,k=j<3?H:U===null?U=Object.getOwnPropertyDescriptor(H,$):U;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")k=Reflect.decorate(L,H,$,U);else for(var R=L.length-1;R>=0;R--)(G=L[R])&&(k=(j<3?G(k):j>3?G(H,$,k):G(H,$))||k);return j>3&&k&&Object.defineProperty(H,$,k),k},p=this&&this.__param||function(L,H){return function($,U){H($,U,L)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRenderer=void 0;const a=o(3787),_=o(2550),g=o(2223),y=o(6171),d=o(6052),s=o(4725),r=o(8055),e=o(8460),t=o(844),l=o(2585),m="xterm-dom-renderer-owner-",v="xterm-rows",b="xterm-fg-",f="xterm-bg-",w="xterm-focus",D="xterm-selection";let T=1,M=i.DomRenderer=class extends t.Disposable{constructor(L,H,$,U,G,j,k,R,B,I,N,z,J){super(),this._terminal=L,this._document=H,this._element=$,this._screenElement=U,this._viewportElement=G,this._helperContainer=j,this._linkifier2=k,this._charSizeService=B,this._optionsService=I,this._bufferService=N,this._coreBrowserService=z,this._themeService=J,this._terminalClass=T++,this._rowElements=[],this._selectionRenderModel=(0,d.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new e.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(v),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(D),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,y.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(Y=>this._injectCss(Y))),this._injectCss(this._themeService.colors),this._rowFactory=R.createInstance(a.DomRendererRowFactory,document),this._element.classList.add(m+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(Y=>this._handleLinkHover(Y))),this.register(this._linkifier2.onHideLinkUnderline(Y=>this._handleLinkLeave(Y))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(m+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new _.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const L=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*L,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*L),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/L),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/L),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const $ of this._rowElements)$.style.width=`${this.dimensions.css.canvas.width}px`,$.style.height=`${this.dimensions.css.cell.height}px`,$.style.lineHeight=`${this.dimensions.css.cell.height}px`,$.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const H=`${this._terminalSelector} .${v} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=H,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(L){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let H=`${this._terminalSelector} .${v} { color: ${L.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;H+=`${this._terminalSelector} .${v} .xterm-dim { color: ${r.color.multiplyOpacity(L.foreground,.5).css};}`,H+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;const $=`blink_underline_${this._terminalClass}`,U=`blink_bar_${this._terminalClass}`,G=`blink_block_${this._terminalClass}`;H+=`@keyframes ${$} { 50% {  border-bottom-style: hidden; }}`,H+=`@keyframes ${U} { 50% {  box-shadow: none; }}`,H+=`@keyframes ${G} { 0% {  background-color: ${L.cursor.css};  color: ${L.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${L.cursor.css}; }}`,H+=`${this._terminalSelector} .${v}.${w} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${$} 1s step-end infinite;}${this._terminalSelector} .${v}.${w} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${U} 1s step-end infinite;}${this._terminalSelector} .${v}.${w} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${G} 1s step-end infinite;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-block { background-color: ${L.cursor.css}; color: ${L.cursorAccent.css};}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${L.cursor.css} !important; color: ${L.cursorAccent.css} !important;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${L.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${L.cursor.css} inset;}${this._terminalSelector} .${v} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${L.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,H+=`${this._terminalSelector} .${D} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${D} div { position: absolute; background-color: ${L.selectionBackgroundOpaque.css};}${this._terminalSelector} .${D} div { position: absolute; background-color: ${L.selectionInactiveBackgroundOpaque.css};}`;for(const[j,k]of L.ansi.entries())H+=`${this._terminalSelector} .${b}${j} { color: ${k.css}; }${this._terminalSelector} .${b}${j}.xterm-dim { color: ${r.color.multiplyOpacity(k,.5).css}; }${this._terminalSelector} .${f}${j} { background-color: ${k.css}; }`;H+=`${this._terminalSelector} .${b}${g.INVERTED_DEFAULT_COLOR} { color: ${r.color.opaque(L.background).css}; }${this._terminalSelector} .${b}${g.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${r.color.multiplyOpacity(r.color.opaque(L.background),.5).css}; }${this._terminalSelector} .${f}${g.INVERTED_DEFAULT_COLOR} { background-color: ${L.foreground.css}; }`,this._themeStyleElement.textContent=H}_setDefaultSpacing(){const L=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${L}px`,this._rowFactory.defaultSpacing=L}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(L,H){for(let $=this._rowElements.length;$<=H;$++){const U=this._document.createElement("div");this._rowContainer.appendChild(U),this._rowElements.push(U)}for(;this._rowElements.length>H;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(L,H){this._refreshRowElements(L,H),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(w),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(w),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(L,H,$){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(L,H,$),this.renderRows(0,this._bufferService.rows-1),!L||!H)return;this._selectionRenderModel.update(this._terminal,L,H,$);const U=this._selectionRenderModel.viewportStartRow,G=this._selectionRenderModel.viewportEndRow,j=this._selectionRenderModel.viewportCappedStartRow,k=this._selectionRenderModel.viewportCappedEndRow;if(j>=this._bufferService.rows||k<0)return;const R=this._document.createDocumentFragment();if($){const B=L[0]>H[0];R.appendChild(this._createSelectionElement(j,B?H[0]:L[0],B?L[0]:H[0],k-j+1))}else{const B=U===j?L[0]:0,I=j===G?H[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(j,B,I));const N=k-j-1;if(R.appendChild(this._createSelectionElement(j+1,0,this._bufferService.cols,N)),j!==k){const z=G===k?H[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(k,0,z))}}this._selectionContainer.appendChild(R)}_createSelectionElement(L,H,$,U=1){const G=this._document.createElement("div"),j=H*this.dimensions.css.cell.width;let k=this.dimensions.css.cell.width*($-H);return j+k>this.dimensions.css.canvas.width&&(k=this.dimensions.css.canvas.width-j),G.style.height=U*this.dimensions.css.cell.height+"px",G.style.top=L*this.dimensions.css.cell.height+"px",G.style.left=`${j}px`,G.style.width=`${k}px`,G}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const L of this._rowElements)L.replaceChildren()}renderRows(L,H){const $=this._bufferService.buffer,U=$.ybase+$.y,G=Math.min($.x,this._bufferService.cols-1),j=this._optionsService.rawOptions.cursorBlink,k=this._optionsService.rawOptions.cursorStyle,R=this._optionsService.rawOptions.cursorInactiveStyle;for(let B=L;B<=H;B++){const I=B+$.ydisp,N=this._rowElements[B],z=$.lines.get(I);if(!N||!z)break;N.replaceChildren(...this._rowFactory.createRow(z,I,I===U,k,R,G,j,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${m}${this._terminalClass}`}_handleLinkHover(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!0)}_handleLinkLeave(L){this._setCellUnderline(L.x1,L.x2,L.y1,L.y2,L.cols,!1)}_setCellUnderline(L,H,$,U,G,j){$<0&&(L=0),U<0&&(H=0);const k=this._bufferService.rows-1;$=Math.max(Math.min($,k),0),U=Math.max(Math.min(U,k),0),G=Math.min(G,this._bufferService.cols);const R=this._bufferService.buffer,B=R.ybase+R.y,I=Math.min(R.x,G-1),N=this._optionsService.rawOptions.cursorBlink,z=this._optionsService.rawOptions.cursorStyle,J=this._optionsService.rawOptions.cursorInactiveStyle;for(let Y=$;Y<=U;++Y){const P=Y+R.ydisp,E=this._rowElements[Y],W=R.lines.get(P);if(!E||!W)break;E.replaceChildren(...this._rowFactory.createRow(W,P,P===B,z,J,I,N,this.dimensions.css.cell.width,this._widthCache,j?Y===$?L:0:-1,j?(Y===U?H:G)-1:-1))}}};i.DomRenderer=M=h([p(7,l.IInstantiationService),p(8,s.ICharSizeService),p(9,l.IOptionsService),p(10,l.IBufferService),p(11,s.ICoreBrowserService),p(12,s.IThemeService)],M)},3787:function(x,i,o){var h=this&&this.__decorate||function(v,b,f,w){var D,T=arguments.length,M=T<3?b:w===null?w=Object.getOwnPropertyDescriptor(b,f):w;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")M=Reflect.decorate(v,b,f,w);else for(var L=v.length-1;L>=0;L--)(D=v[L])&&(M=(T<3?D(M):T>3?D(b,f,M):D(b,f))||M);return T>3&&M&&Object.defineProperty(b,f,M),M},p=this&&this.__param||function(v,b){return function(f,w){b(f,w,v)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRendererRowFactory=void 0;const a=o(2223),_=o(643),g=o(511),y=o(2585),d=o(8055),s=o(4725),r=o(4269),e=o(6171),t=o(3734);let l=i.DomRendererRowFactory=class{constructor(v,b,f,w,D,T,M){this._document=v,this._characterJoinerService=b,this._optionsService=f,this._coreBrowserService=w,this._coreService=D,this._decorationService=T,this._themeService=M,this._workCell=new g.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(v,b,f){this._selectionStart=v,this._selectionEnd=b,this._columnSelectMode=f}createRow(v,b,f,w,D,T,M,L,H,$,U){const G=[],j=this._characterJoinerService.getJoinedCharacters(b),k=this._themeService.colors;let R,B=v.getNoBgTrimmedLength();f&&B<T+1&&(B=T+1);let I=0,N="",z=0,J=0,Y=0,P=!1,E=0,W=!1,F=0;const K=[],V=$!==-1&&U!==-1;for(let Q=0;Q<B;Q++){v.loadCell(Q,this._workCell);let se=this._workCell.getWidth();if(se===0)continue;let ie=!1,ce=Q,Z=this._workCell;if(j.length>0&&Q===j[0][0]){ie=!0;const te=j.shift();Z=new r.JoinedCellData(this._workCell,v.translateToString(!0,te[0],te[1]),te[1]-te[0]),ce=te[1]-1,se=Z.getWidth()}const Me=this._isCellInSelection(Q,b),Ze=f&&Q===T,Qe=V&&Q>=$&&Q<=U;let et=!1;this._decorationService.forEachDecorationAtCell(Q,b,void 0,te=>{et=!0});let We=Z.getChars()||_.WHITESPACE_CELL_CHAR;if(We===" "&&(Z.isUnderline()||Z.isOverline())&&(We="Â "),F=se*L-H.get(We,Z.isBold(),Z.isItalic()),R){if(I&&(Me&&W||!Me&&!W&&Z.bg===z)&&(Me&&W&&k.selectionForeground||Z.fg===J)&&Z.extended.ext===Y&&Qe===P&&F===E&&!Ze&&!ie&&!et){Z.isInvisible()?N+=_.WHITESPACE_CELL_CHAR:N+=We,I++;continue}I&&(R.textContent=N),R=this._document.createElement("span"),I=0,N=""}else R=this._document.createElement("span");if(z=Z.bg,J=Z.fg,Y=Z.extended.ext,P=Qe,E=F,W=Me,ie&&T>=Q&&T<=ce&&(T=Q),!this._coreService.isCursorHidden&&Ze&&this._coreService.isCursorInitialized){if(K.push("xterm-cursor"),this._coreBrowserService.isFocused)M&&K.push("xterm-cursor-blink"),K.push(w==="bar"?"xterm-cursor-bar":w==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(D)switch(D){case"outline":K.push("xterm-cursor-outline");break;case"block":K.push("xterm-cursor-block");break;case"bar":K.push("xterm-cursor-bar");break;case"underline":K.push("xterm-cursor-underline")}}if(Z.isBold()&&K.push("xterm-bold"),Z.isItalic()&&K.push("xterm-italic"),Z.isDim()&&K.push("xterm-dim"),N=Z.isInvisible()?_.WHITESPACE_CELL_CHAR:Z.getChars()||_.WHITESPACE_CELL_CHAR,Z.isUnderline()&&(K.push(`xterm-underline-${Z.extended.underlineStyle}`),N===" "&&(N="Â "),!Z.isUnderlineColorDefault()))if(Z.isUnderlineColorRGB())R.style.textDecorationColor=`rgb(${t.AttributeData.toColorRGB(Z.getUnderlineColor()).join(",")})`;else{let te=Z.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&Z.isBold()&&te<8&&(te+=8),R.style.textDecorationColor=k.ansi[te].css}Z.isOverline()&&(K.push("xterm-overline"),N===" "&&(N="Â ")),Z.isStrikethrough()&&K.push("xterm-strikethrough"),Qe&&(R.style.textDecoration="underline");let fe=Z.getFgColor(),Ie=Z.getFgColorMode(),pe=Z.getBgColor(),Pe=Z.getBgColorMode();const tt=!!Z.isInverse();if(tt){const te=fe;fe=pe,pe=te;const ss=Ie;Ie=Pe,Pe=ss}let we,Ue,ke,He=!1;switch(this._decorationService.forEachDecorationAtCell(Q,b,void 0,te=>{te.options.layer!=="top"&&He||(te.backgroundColorRGB&&(Pe=50331648,pe=te.backgroundColorRGB.rgba>>8&16777215,we=te.backgroundColorRGB),te.foregroundColorRGB&&(Ie=50331648,fe=te.foregroundColorRGB.rgba>>8&16777215,Ue=te.foregroundColorRGB),He=te.options.layer==="top")}),!He&&Me&&(we=this._coreBrowserService.isFocused?k.selectionBackgroundOpaque:k.selectionInactiveBackgroundOpaque,pe=we.rgba>>8&16777215,Pe=50331648,He=!0,k.selectionForeground&&(Ie=50331648,fe=k.selectionForeground.rgba>>8&16777215,Ue=k.selectionForeground)),He&&K.push("xterm-decoration-top"),Pe){case 16777216:case 33554432:ke=k.ansi[pe],K.push(`xterm-bg-${pe}`);break;case 50331648:ke=d.channels.toColor(pe>>16,pe>>8&255,255&pe),this._addStyle(R,`background-color:#${m((pe>>>0).toString(16),"0",6)}`);break;default:tt?(ke=k.foreground,K.push(`xterm-bg-${a.INVERTED_DEFAULT_COLOR}`)):ke=k.background}switch(we||Z.isDim()&&(we=d.color.multiplyOpacity(ke,.5)),Ie){case 16777216:case 33554432:Z.isBold()&&fe<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(fe+=8),this._applyMinimumContrast(R,ke,k.ansi[fe],Z,we,void 0)||K.push(`xterm-fg-${fe}`);break;case 50331648:const te=d.channels.toColor(fe>>16&255,fe>>8&255,255&fe);this._applyMinimumContrast(R,ke,te,Z,we,Ue)||this._addStyle(R,`color:#${m(fe.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(R,ke,k.foreground,Z,we,Ue)||tt&&K.push(`xterm-fg-${a.INVERTED_DEFAULT_COLOR}`)}K.length&&(R.className=K.join(" "),K.length=0),Ze||ie||et?R.textContent=N:I++,F!==this.defaultSpacing&&(R.style.letterSpacing=`${F}px`),G.push(R),Q=ce}return R&&I&&(R.textContent=N),G}_applyMinimumContrast(v,b,f,w,D,T){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,e.treatGlyphAsBackgroundColor)(w.getCode()))return!1;const M=this._getContrastCache(w);let L;if(D||T||(L=M.getColor(b.rgba,f.rgba)),L===void 0){const H=this._optionsService.rawOptions.minimumContrastRatio/(w.isDim()?2:1);L=d.color.ensureContrastRatio(D||b,T||f,H),M.setColor((D||b).rgba,(T||f).rgba,L??null)}return!!L&&(this._addStyle(v,`color:${L.css}`),!0)}_getContrastCache(v){return v.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(v,b){v.setAttribute("style",`${v.getAttribute("style")||""}${b};`)}_isCellInSelection(v,b){const f=this._selectionStart,w=this._selectionEnd;return!(!f||!w)&&(this._columnSelectMode?f[0]<=w[0]?v>=f[0]&&b>=f[1]&&v<w[0]&&b<=w[1]:v<f[0]&&b>=f[1]&&v>=w[0]&&b<=w[1]:b>f[1]&&b<w[1]||f[1]===w[1]&&b===f[1]&&v>=f[0]&&v<w[0]||f[1]<w[1]&&b===w[1]&&v<w[0]||f[1]<w[1]&&b===f[1]&&v>=f[0])}};function m(v,b,f){for(;v.length<f;)v=b+v;return v}i.DomRendererRowFactory=l=h([p(1,s.ICharacterJoinerService),p(2,y.IOptionsService),p(3,s.ICoreBrowserService),p(4,y.ICoreService),p(5,y.IDecorationService),p(6,s.IThemeService)],l)},2550:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WidthCache=void 0,i.WidthCache=class{constructor(o,h){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=o.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const p=o.createElement("span");p.classList.add("xterm-char-measure-element");const a=o.createElement("span");a.classList.add("xterm-char-measure-element"),a.style.fontWeight="bold";const _=o.createElement("span");_.classList.add("xterm-char-measure-element"),_.style.fontStyle="italic";const g=o.createElement("span");g.classList.add("xterm-char-measure-element"),g.style.fontWeight="bold",g.style.fontStyle="italic",this._measureElements=[p,a,_,g],this._container.appendChild(p),this._container.appendChild(a),this._container.appendChild(_),this._container.appendChild(g),h.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(o,h,p,a){o===this._font&&h===this._fontSize&&p===this._weight&&a===this._weightBold||(this._font=o,this._fontSize=h,this._weight=p,this._weightBold=a,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${p}`,this._measureElements[1].style.fontWeight=`${a}`,this._measureElements[2].style.fontWeight=`${p}`,this._measureElements[3].style.fontWeight=`${a}`,this.clear())}get(o,h,p){let a=0;if(!h&&!p&&o.length===1&&(a=o.charCodeAt(0))<256){if(this._flat[a]!==-9999)return this._flat[a];const y=this._measure(o,0);return y>0&&(this._flat[a]=y),y}let _=o;h&&(_+="B"),p&&(_+="I");let g=this._holey.get(_);if(g===void 0){let y=0;h&&(y|=1),p&&(y|=2),g=this._measure(o,y),g>0&&this._holey.set(_,g)}return g}_measure(o,h){const p=this._measureElements[h];return p.textContent=o.repeat(32),p.offsetWidth/32}}},2223:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;const h=o(6114);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=h.isFirefox||h.isLegacyEdge?"bottom":"ideographic"},6171:(x,i)=>{function o(p){return 57508<=p&&p<=57558}function h(p){return p>=128512&&p<=128591||p>=127744&&p<=128511||p>=128640&&p<=128767||p>=9728&&p<=9983||p>=9984&&p<=10175||p>=65024&&p<=65039||p>=129280&&p<=129535||p>=127462&&p<=127487}Object.defineProperty(i,"__esModule",{value:!0}),i.computeNextVariantOffset=i.createRenderDimensions=i.treatGlyphAsBackgroundColor=i.allowRescaling=i.isEmoji=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(p){if(!p)throw new Error("value must not be falsy");return p},i.isPowerlineGlyph=o,i.isRestrictedPowerlineGlyph=function(p){return 57520<=p&&p<=57527},i.isEmoji=h,i.allowRescaling=function(p,a,_,g){return a===1&&_>Math.ceil(1.5*g)&&p!==void 0&&p>255&&!h(p)&&!o(p)&&!function(y){return 57344<=y&&y<=63743}(p)},i.treatGlyphAsBackgroundColor=function(p){return o(p)||function(a){return 9472<=a&&a<=9631}(p)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},i.computeNextVariantOffset=function(p,a,_=0){return(p-(2*Math.round(a)-_))%(2*Math.round(a))}},6052:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createSelectionRenderModel=void 0;class o{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(p,a,_,g=!1){if(this.selectionStart=a,this.selectionEnd=_,!a||!_||a[0]===_[0]&&a[1]===_[1])return void this.clear();const y=p.buffers.active.ydisp,d=a[1]-y,s=_[1]-y,r=Math.max(d,0),e=Math.min(s,p.rows-1);r>=p.rows||e<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=g,this.viewportStartRow=d,this.viewportEndRow=s,this.viewportCappedStartRow=r,this.viewportCappedEndRow=e,this.startCol=a[0],this.endCol=_[0])}isCellSelected(p,a,_){return!!this.hasSelection&&(_-=p.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?a>=this.startCol&&_>=this.viewportCappedStartRow&&a<this.endCol&&_<=this.viewportCappedEndRow:a<this.startCol&&_>=this.viewportCappedStartRow&&a>=this.endCol&&_<=this.viewportCappedEndRow:_>this.viewportStartRow&&_<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&_===this.viewportStartRow&&a>=this.startCol&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportEndRow&&a<this.endCol||this.viewportStartRow<this.viewportEndRow&&_===this.viewportStartRow&&a>=this.startCol)}}i.createSelectionRenderModel=function(){return new o}},456:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionModel=void 0,i.SelectionModel=class{constructor(o){this._bufferService=o,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?o%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)-1]:[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[o,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[Math.max(o,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const o=this.selectionStart,h=this.selectionEnd;return!(!o||!h)&&(o[1]>h[1]||o[1]===h[1]&&o[0]>h[0])}handleTrim(o){return this.selectionStart&&(this.selectionStart[1]-=o),this.selectionEnd&&(this.selectionEnd[1]-=o),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(x,i,o){var h=this&&this.__decorate||function(e,t,l,m){var v,b=arguments.length,f=b<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(e,t,l,m);else for(var w=e.length-1;w>=0;w--)(v=e[w])&&(f=(b<3?v(f):b>3?v(t,l,f):v(t,l))||f);return b>3&&f&&Object.defineProperty(t,l,f),f},p=this&&this.__param||function(e,t){return function(l,m){t(l,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharSizeService=void 0;const a=o(2585),_=o(8460),g=o(844);let y=i.CharSizeService=class extends g.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,t,l){super(),this._optionsService=l,this.width=0,this.height=0,this._onCharSizeChange=this.register(new _.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new r(this._optionsService))}catch{this._measureStrategy=this.register(new s(e,t,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};i.CharSizeService=y=h([p(2,a.IOptionsService)],y);class d extends g.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(t,l){t!==void 0&&t>0&&l!==void 0&&l>0&&(this._result.width=t,this._result.height=l)}}class s extends d{constructor(t,l,m){super(),this._document=t,this._parentElement=l,this._optionsService=m,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class r extends d{constructor(t){super(),this._optionsService=t,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");const l=this._ctx.measureText("W");if(!("width"in l&&"fontBoundingBoxAscent"in l&&"fontBoundingBoxDescent"in l))throw new Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;const t=this._ctx.measureText("W");return this._validateAndSet(t.width,t.fontBoundingBoxAscent+t.fontBoundingBoxDescent),this._result}}},4269:function(x,i,o){var h=this&&this.__decorate||function(r,e,t,l){var m,v=arguments.length,b=v<3?e:l===null?l=Object.getOwnPropertyDescriptor(e,t):l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")b=Reflect.decorate(r,e,t,l);else for(var f=r.length-1;f>=0;f--)(m=r[f])&&(b=(v<3?m(b):v>3?m(e,t,b):m(e,t))||b);return v>3&&b&&Object.defineProperty(e,t,b),b},p=this&&this.__param||function(r,e){return function(t,l){e(t,l,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharacterJoinerService=i.JoinedCellData=void 0;const a=o(3734),_=o(643),g=o(511),y=o(2585);class d extends a.AttributeData{constructor(e,t,l){super(),this.content=0,this.combinedData="",this.fg=e.fg,this.bg=e.bg,this.combinedData=t,this._width=l}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(e){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.JoinedCellData=d;let s=i.CharacterJoinerService=class It{constructor(e){this._bufferService=e,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new g.CellData}register(e){const t={id:this._nextCharacterJoinerId++,handler:e};return this._characterJoiners.push(t),t.id}deregister(e){for(let t=0;t<this._characterJoiners.length;t++)if(this._characterJoiners[t].id===e)return this._characterJoiners.splice(t,1),!0;return!1}getJoinedCharacters(e){if(this._characterJoiners.length===0)return[];const t=this._bufferService.buffer.lines.get(e);if(!t||t.length===0)return[];const l=[],m=t.translateToString(!0);let v=0,b=0,f=0,w=t.getFg(0),D=t.getBg(0);for(let T=0;T<t.getTrimmedLength();T++)if(t.loadCell(T,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==w||this._workCell.bg!==D){if(T-v>1){const M=this._getJoinedRanges(m,f,b,t,v);for(let L=0;L<M.length;L++)l.push(M[L])}v=T,f=b,w=this._workCell.fg,D=this._workCell.bg}b+=this._workCell.getChars().length||_.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-v>1){const T=this._getJoinedRanges(m,f,b,t,v);for(let M=0;M<T.length;M++)l.push(T[M])}return l}_getJoinedRanges(e,t,l,m,v){const b=e.substring(t,l);let f=[];try{f=this._characterJoiners[0].handler(b)}catch(w){console.error(w)}for(let w=1;w<this._characterJoiners.length;w++)try{const D=this._characterJoiners[w].handler(b);for(let T=0;T<D.length;T++)It._mergeRanges(f,D[T])}catch(D){console.error(D)}return this._stringRangesToCellRanges(f,m,v),f}_stringRangesToCellRanges(e,t,l){let m=0,v=!1,b=0,f=e[m];if(f){for(let w=l;w<this._bufferService.cols;w++){const D=t.getWidth(w),T=t.getString(w).length||_.WHITESPACE_CELL_CHAR.length;if(D!==0){if(!v&&f[0]<=b&&(f[0]=w,v=!0),f[1]<=b){if(f[1]=w,f=e[++m],!f)break;f[0]<=b?(f[0]=w,v=!0):v=!1}b+=T}}f&&(f[1]=this._bufferService.cols)}}static _mergeRanges(e,t){let l=!1;for(let m=0;m<e.length;m++){const v=e[m];if(l){if(t[1]<=v[0])return e[m-1][1]=t[1],e;if(t[1]<=v[1])return e[m-1][1]=Math.max(t[1],v[1]),e.splice(m,1),e;e.splice(m,1),m--}else{if(t[1]<=v[0])return e.splice(m,0,t),e;if(t[1]<=v[1])return v[0]=Math.min(t[0],v[0]),e;t[0]<v[1]&&(v[0]=Math.min(t[0],v[0]),l=!0)}}return l?e[e.length-1][1]=t[1]:e.push(t),e}};i.CharacterJoinerService=s=h([p(0,y.IBufferService)],s)},5114:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreBrowserService=void 0;const h=o(844),p=o(8460),a=o(3656);class _ extends h.Disposable{constructor(d,s,r){super(),this._textarea=d,this._window=s,this.mainDocument=r,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new g(this._window),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new p.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange(e=>this._screenDprMonitor.setWindow(e))),this.register((0,p.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get window(){return this._window}set window(d){this._window!==d&&(this._window=d,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}i.CoreBrowserService=_;class g extends h.Disposable{constructor(d){super(),this._parentWindow=d,this._windowResizeListener=this.register(new h.MutableDisposable),this._onDprChange=this.register(new p.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,h.toDisposable)(()=>this.clearListener()))}setWindow(d){this._parentWindow=d,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,a.addDisposableDomListener)(this._parentWindow,"resize",()=>this._setDprAndFireIfDiffers())}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var d;this._outerListener&&((d=this._resolutionMediaMatchList)==null||d.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.LinkProviderService=void 0;const h=o(844);class p extends h.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,h.toDisposable)(()=>this.linkProviders.length=0))}registerLinkProvider(_){return this.linkProviders.push(_),{dispose:()=>{const g=this.linkProviders.indexOf(_);g!==-1&&this.linkProviders.splice(g,1)}}}}i.LinkProviderService=p},8934:function(x,i,o){var h=this&&this.__decorate||function(y,d,s,r){var e,t=arguments.length,l=t<3?d:r===null?r=Object.getOwnPropertyDescriptor(d,s):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(y,d,s,r);else for(var m=y.length-1;m>=0;m--)(e=y[m])&&(l=(t<3?e(l):t>3?e(d,s,l):e(d,s))||l);return t>3&&l&&Object.defineProperty(d,s,l),l},p=this&&this.__param||function(y,d){return function(s,r){d(s,r,y)}};Object.defineProperty(i,"__esModule",{value:!0}),i.MouseService=void 0;const a=o(4725),_=o(9806);let g=i.MouseService=class{constructor(y,d){this._renderService=y,this._charSizeService=d}getCoords(y,d,s,r,e){return(0,_.getCoords)(window,y,d,s,r,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,e)}getMouseReportCoords(y,d){const s=(0,_.getCoordsRelativeToElement)(window,y,d);if(this._charSizeService.hasValidSize)return s[0]=Math.min(Math.max(s[0],0),this._renderService.dimensions.css.canvas.width-1),s[1]=Math.min(Math.max(s[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(s[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(s[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(s[0]),y:Math.floor(s[1])}}};i.MouseService=g=h([p(0,a.IRenderService),p(1,a.ICharSizeService)],g)},3230:function(x,i,o){var h=this&&this.__decorate||function(e,t,l,m){var v,b=arguments.length,f=b<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(e,t,l,m);else for(var w=e.length-1;w>=0;w--)(v=e[w])&&(f=(b<3?v(f):b>3?v(t,l,f):v(t,l))||f);return b>3&&f&&Object.defineProperty(t,l,f),f},p=this&&this.__param||function(e,t){return function(l,m){t(l,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.RenderService=void 0;const a=o(6193),_=o(4725),g=o(8460),y=o(844),d=o(7226),s=o(2585);let r=i.RenderService=class extends y.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(e,t,l,m,v,b,f,w){super(),this._rowCount=e,this._charSizeService=m,this._renderer=this.register(new y.MutableDisposable),this._pausedResizeTask=new d.DebouncedIdleTask,this._observerDisposable=this.register(new y.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new g.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new g.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new g.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new g.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new a.RenderDebouncer((D,T)=>this._renderRows(D,T),f),this.register(this._renderDebouncer),this.register(f.onDprChange(()=>this.handleDevicePixelRatioChange())),this.register(b.onResize(()=>this._fullRefresh())),this.register(b.buffers.onBufferActivate(()=>{var D;return(D=this._renderer.value)==null?void 0:D.clear()})),this.register(l.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(v.onDecorationRegistered(()=>this._fullRefresh())),this.register(v.onDecorationRemoved(()=>this._fullRefresh())),this.register(l.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],()=>{this.clear(),this.handleResize(b.cols,b.rows),this._fullRefresh()})),this.register(l.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(b.buffer.y,b.buffer.y,!0))),this.register(w.onChangeColors(()=>this._fullRefresh())),this._registerIntersectionObserver(f.window,t),this.register(f.onWindowChange(D=>this._registerIntersectionObserver(D,t)))}_registerIntersectionObserver(e,t){if("IntersectionObserver"in e){const l=new e.IntersectionObserver(m=>this._handleIntersectionChange(m[m.length-1]),{threshold:0});l.observe(t),this._observerDisposable.value=(0,y.toDisposable)(()=>l.disconnect())}}_handleIntersectionChange(e){this._isPaused=e.isIntersecting===void 0?e.intersectionRatio===0:!e.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(e,t,l=!1){this._isPaused?this._needsFullRefresh=!0:(l||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(e,t,this._rowCount))}_renderRows(e,t){this._renderer.value&&(e=Math.min(e,this._rowCount-1),t=Math.min(t,this._rowCount-1),this._renderer.value.renderRows(e,t),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:e,end:t}),this._onRender.fire({start:e,end:t}),this._isNextRenderRedrawOnly=!0)}resize(e,t){this._rowCount=t,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(e){this._renderer.value=e,this._renderer.value&&(this._renderer.value.onRequestRedraw(t=>this.refreshRows(t.start,t.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(e){return this._renderDebouncer.addRefreshCallback(e)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var e,t;this._renderer.value&&((t=(e=this._renderer.value).clearTextureAtlas)==null||t.call(e),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(e,t){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>{var l;return(l=this._renderer.value)==null?void 0:l.handleResize(e,t)}):this._renderer.value.handleResize(e,t),this._fullRefresh())}handleCharSizeChanged(){var e;(e=this._renderer.value)==null||e.handleCharSizeChanged()}handleBlur(){var e;(e=this._renderer.value)==null||e.handleBlur()}handleFocus(){var e;(e=this._renderer.value)==null||e.handleFocus()}handleSelectionChanged(e,t,l){var m;this._selectionState.start=e,this._selectionState.end=t,this._selectionState.columnSelectMode=l,(m=this._renderer.value)==null||m.handleSelectionChanged(e,t,l)}handleCursorMove(){var e;(e=this._renderer.value)==null||e.handleCursorMove()}clear(){var e;(e=this._renderer.value)==null||e.clear()}};i.RenderService=r=h([p(2,s.IOptionsService),p(3,_.ICharSizeService),p(4,s.IDecorationService),p(5,s.IBufferService),p(6,_.ICoreBrowserService),p(7,_.IThemeService)],r)},9312:function(x,i,o){var h=this&&this.__decorate||function(f,w,D,T){var M,L=arguments.length,H=L<3?w:T===null?T=Object.getOwnPropertyDescriptor(w,D):T;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(f,w,D,T);else for(var $=f.length-1;$>=0;$--)(M=f[$])&&(H=(L<3?M(H):L>3?M(w,D,H):M(w,D))||H);return L>3&&H&&Object.defineProperty(w,D,H),H},p=this&&this.__param||function(f,w){return function(D,T){w(D,T,f)}};Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionService=void 0;const a=o(9806),_=o(9504),g=o(456),y=o(4725),d=o(8460),s=o(844),r=o(6114),e=o(4841),t=o(511),l=o(2585),m="Â ",v=new RegExp(m,"g");let b=i.SelectionService=class extends s.Disposable{constructor(f,w,D,T,M,L,H,$,U){super(),this._element=f,this._screenElement=w,this._linkifier=D,this._bufferService=T,this._coreService=M,this._mouseService=L,this._optionsService=H,this._renderService=$,this._coreBrowserService=U,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new t.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new d.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new d.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new d.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new d.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=G=>this._handleMouseMove(G),this._mouseUpListener=G=>this._handleMouseUp(G),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(G=>this._handleTrim(G)),this.register(this._bufferService.buffers.onBufferActivate(G=>this._handleBufferActivate(G))),this.enable(),this._model=new g.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,s.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const f=this._model.finalSelectionStart,w=this._model.finalSelectionEnd;return!(!f||!w||f[0]===w[0]&&f[1]===w[1])}get selectionText(){const f=this._model.finalSelectionStart,w=this._model.finalSelectionEnd;if(!f||!w)return"";const D=this._bufferService.buffer,T=[];if(this._activeSelectionMode===3){if(f[0]===w[0])return"";const M=f[0]<w[0]?f[0]:w[0],L=f[0]<w[0]?w[0]:f[0];for(let H=f[1];H<=w[1];H++){const $=D.translateBufferLineToString(H,!0,M,L);T.push($)}}else{const M=f[1]===w[1]?w[0]:void 0;T.push(D.translateBufferLineToString(f[1],!0,f[0],M));for(let L=f[1]+1;L<=w[1]-1;L++){const H=D.lines.get(L),$=D.translateBufferLineToString(L,!0);H!=null&&H.isWrapped?T[T.length-1]+=$:T.push($)}if(f[1]!==w[1]){const L=D.lines.get(w[1]),H=D.translateBufferLineToString(w[1],!0,0,w[0]);L&&L.isWrapped?T[T.length-1]+=H:T.push(H)}}return T.map(M=>M.replace(v," ")).join(r.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(f){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),r.isLinux&&f&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(f){const w=this._getMouseBufferCoords(f),D=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!!(D&&T&&w)&&this._areCoordsInSelection(w,D,T)}isCellInSelection(f,w){const D=this._model.finalSelectionStart,T=this._model.finalSelectionEnd;return!(!D||!T)&&this._areCoordsInSelection([f,w],D,T)}_areCoordsInSelection(f,w,D){return f[1]>w[1]&&f[1]<D[1]||w[1]===D[1]&&f[1]===w[1]&&f[0]>=w[0]&&f[0]<D[0]||w[1]<D[1]&&f[1]===D[1]&&f[0]<D[0]||w[1]<D[1]&&f[1]===w[1]&&f[0]>=w[0]}_selectWordAtCursor(f,w){var M,L;const D=(L=(M=this._linkifier.currentLink)==null?void 0:M.link)==null?void 0:L.range;if(D)return this._model.selectionStart=[D.start.x-1,D.start.y-1],this._model.selectionStartLength=(0,e.getRangeLength)(D,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const T=this._getMouseBufferCoords(f);return!!T&&(this._selectWordAt(T,w),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(f,w){this._model.clearSelection(),f=Math.max(f,0),w=Math.min(w,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,f],this._model.selectionEnd=[this._bufferService.cols,w],this.refresh(),this._onSelectionChange.fire()}_handleTrim(f){this._model.handleTrim(f)&&this.refresh()}_getMouseBufferCoords(f){const w=this._mouseService.getCoords(f,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(w)return w[0]--,w[1]--,w[1]+=this._bufferService.buffer.ydisp,w}_getMouseEventScrollAmount(f){let w=(0,a.getCoordsRelativeToElement)(this._coreBrowserService.window,f,this._screenElement)[1];const D=this._renderService.dimensions.css.canvas.height;return w>=0&&w<=D?0:(w>D&&(w-=D),w=Math.min(Math.max(w,-50),50),w/=50,w/Math.abs(w)+Math.round(14*w))}shouldForceSelection(f){return r.isMac?f.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:f.shiftKey}handleMouseDown(f){if(this._mouseDownTimeStamp=f.timeStamp,(f.button!==2||!this.hasSelection)&&f.button===0){if(!this._enabled){if(!this.shouldForceSelection(f))return;f.stopPropagation()}f.preventDefault(),this._dragScrollAmount=0,this._enabled&&f.shiftKey?this._handleIncrementalClick(f):f.detail===1?this._handleSingleClick(f):f.detail===2?this._handleDoubleClick(f):f.detail===3&&this._handleTripleClick(f),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(f){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(f))}_handleSingleClick(f){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(f)?3:0,this._model.selectionStart=this._getMouseBufferCoords(f),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const w=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);w&&w.length!==this._model.selectionStart[0]&&w.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(f){this._selectWordAtCursor(f,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(f){const w=this._getMouseBufferCoords(f);w&&(this._activeSelectionMode=2,this._selectLineAt(w[1]))}shouldColumnSelect(f){return f.altKey&&!(r.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(f){if(f.stopImmediatePropagation(),!this._model.selectionStart)return;const w=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(f),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(f),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const D=this._bufferService.buffer;if(this._model.selectionEnd[1]<D.lines.length){const T=D.lines.get(this._model.selectionEnd[1]);T&&T.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}w&&w[0]===this._model.selectionEnd[0]&&w[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const f=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(f.ydisp+this._bufferService.rows,f.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=f.ydisp),this.refresh()}}_handleMouseUp(f){const w=f.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&w<500&&f.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const D=this._mouseService.getCoords(f,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(D&&D[0]!==void 0&&D[1]!==void 0){const T=(0,_.moveToCellSequence)(D[0]-1,D[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(T,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const f=this._model.finalSelectionStart,w=this._model.finalSelectionEnd,D=!(!f||!w||f[0]===w[0]&&f[1]===w[1]);D?f&&w&&(this._oldSelectionStart&&this._oldSelectionEnd&&f[0]===this._oldSelectionStart[0]&&f[1]===this._oldSelectionStart[1]&&w[0]===this._oldSelectionEnd[0]&&w[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(f,w,D)):this._oldHasSelection&&this._fireOnSelectionChange(f,w,D)}_fireOnSelectionChange(f,w,D){this._oldSelectionStart=f,this._oldSelectionEnd=w,this._oldHasSelection=D,this._onSelectionChange.fire()}_handleBufferActivate(f){this.clearSelection(),this._trimListener.dispose(),this._trimListener=f.activeBuffer.lines.onTrim(w=>this._handleTrim(w))}_convertViewportColToCharacterIndex(f,w){let D=w;for(let T=0;w>=T;T++){const M=f.loadCell(T,this._workCell).getChars().length;this._workCell.getWidth()===0?D--:M>1&&w!==T&&(D+=M-1)}return D}setSelection(f,w,D){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[f,w],this._model.selectionStartLength=D,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(f){this._isClickInSelection(f)||(this._selectWordAtCursor(f,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(f,w,D=!0,T=!0){if(f[0]>=this._bufferService.cols)return;const M=this._bufferService.buffer,L=M.lines.get(f[1]);if(!L)return;const H=M.translateBufferLineToString(f[1],!1);let $=this._convertViewportColToCharacterIndex(L,f[0]),U=$;const G=f[0]-$;let j=0,k=0,R=0,B=0;if(H.charAt($)===" "){for(;$>0&&H.charAt($-1)===" ";)$--;for(;U<H.length&&H.charAt(U+1)===" ";)U++}else{let z=f[0],J=f[0];L.getWidth(z)===0&&(j++,z--),L.getWidth(J)===2&&(k++,J++);const Y=L.getString(J).length;for(Y>1&&(B+=Y-1,U+=Y-1);z>0&&$>0&&!this._isCharWordSeparator(L.loadCell(z-1,this._workCell));){L.loadCell(z-1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===0?(j++,z--):P>1&&(R+=P-1,$-=P-1),$--,z--}for(;J<L.length&&U+1<H.length&&!this._isCharWordSeparator(L.loadCell(J+1,this._workCell));){L.loadCell(J+1,this._workCell);const P=this._workCell.getChars().length;this._workCell.getWidth()===2?(k++,J++):P>1&&(B+=P-1,U+=P-1),U++,J++}}U++;let I=$+G-j+R,N=Math.min(this._bufferService.cols,U-$+j+k-R-B);if(w||H.slice($,U).trim()!==""){if(D&&I===0&&L.getCodePoint(0)!==32){const z=M.lines.get(f[1]-1);if(z&&L.isWrapped&&z.getCodePoint(this._bufferService.cols-1)!==32){const J=this._getWordAt([this._bufferService.cols-1,f[1]-1],!1,!0,!1);if(J){const Y=this._bufferService.cols-J.start;I-=Y,N+=Y}}}if(T&&I+N===this._bufferService.cols&&L.getCodePoint(this._bufferService.cols-1)!==32){const z=M.lines.get(f[1]+1);if(z!=null&&z.isWrapped&&z.getCodePoint(0)!==32){const J=this._getWordAt([0,f[1]+1],!1,!1,!0);J&&(N+=J.length)}}return{start:I,length:N}}}_selectWordAt(f,w){const D=this._getWordAt(f,w);if(D){for(;D.start<0;)D.start+=this._bufferService.cols,f[1]--;this._model.selectionStart=[D.start,f[1]],this._model.selectionStartLength=D.length}}_selectToWordAt(f){const w=this._getWordAt(f,!0);if(w){let D=f[1];for(;w.start<0;)w.start+=this._bufferService.cols,D--;if(!this._model.areSelectionValuesReversed())for(;w.start+w.length>this._bufferService.cols;)w.length-=this._bufferService.cols,D++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?w.start:w.start+w.length,D]}}_isCharWordSeparator(f){return f.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(f.getChars())>=0}_selectLineAt(f){const w=this._bufferService.buffer.getWrappedRangeForLine(f),D={start:{x:0,y:w.first},end:{x:this._bufferService.cols-1,y:w.last}};this._model.selectionStart=[0,w.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,e.getRangeLength)(D,this._bufferService.cols)}};i.SelectionService=b=h([p(3,l.IBufferService),p(4,l.ICoreService),p(5,y.IMouseService),p(6,l.IOptionsService),p(7,y.IRenderService),p(8,y.ICoreBrowserService)],b)},4725:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ILinkProviderService=i.IThemeService=i.ICharacterJoinerService=i.ISelectionService=i.IRenderService=i.IMouseService=i.ICoreBrowserService=i.ICharSizeService=void 0;const h=o(8343);i.ICharSizeService=(0,h.createDecorator)("CharSizeService"),i.ICoreBrowserService=(0,h.createDecorator)("CoreBrowserService"),i.IMouseService=(0,h.createDecorator)("MouseService"),i.IRenderService=(0,h.createDecorator)("RenderService"),i.ISelectionService=(0,h.createDecorator)("SelectionService"),i.ICharacterJoinerService=(0,h.createDecorator)("CharacterJoinerService"),i.IThemeService=(0,h.createDecorator)("ThemeService"),i.ILinkProviderService=(0,h.createDecorator)("LinkProviderService")},6731:function(x,i,o){var h=this&&this.__decorate||function(b,f,w,D){var T,M=arguments.length,L=M<3?f:D===null?D=Object.getOwnPropertyDescriptor(f,w):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")L=Reflect.decorate(b,f,w,D);else for(var H=b.length-1;H>=0;H--)(T=b[H])&&(L=(M<3?T(L):M>3?T(f,w,L):T(f,w))||L);return M>3&&L&&Object.defineProperty(f,w,L),L},p=this&&this.__param||function(b,f){return function(w,D){f(w,D,b)}};Object.defineProperty(i,"__esModule",{value:!0}),i.ThemeService=i.DEFAULT_ANSI_COLORS=void 0;const a=o(7239),_=o(8055),g=o(8460),y=o(844),d=o(2585),s=_.css.toColor("#ffffff"),r=_.css.toColor("#000000"),e=_.css.toColor("#ffffff"),t=_.css.toColor("#000000"),l={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};i.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const b=[_.css.toColor("#2e3436"),_.css.toColor("#cc0000"),_.css.toColor("#4e9a06"),_.css.toColor("#c4a000"),_.css.toColor("#3465a4"),_.css.toColor("#75507b"),_.css.toColor("#06989a"),_.css.toColor("#d3d7cf"),_.css.toColor("#555753"),_.css.toColor("#ef2929"),_.css.toColor("#8ae234"),_.css.toColor("#fce94f"),_.css.toColor("#729fcf"),_.css.toColor("#ad7fa8"),_.css.toColor("#34e2e2"),_.css.toColor("#eeeeec")],f=[0,95,135,175,215,255];for(let w=0;w<216;w++){const D=f[w/36%6|0],T=f[w/6%6|0],M=f[w%6];b.push({css:_.channels.toCss(D,T,M),rgba:_.channels.toRgba(D,T,M)})}for(let w=0;w<24;w++){const D=8+10*w;b.push({css:_.channels.toCss(D,D,D),rgba:_.channels.toRgba(D,D,D)})}return b})());let m=i.ThemeService=class extends y.Disposable{get colors(){return this._colors}constructor(b){super(),this._optionsService=b,this._contrastCache=new a.ColorContrastCache,this._halfContrastCache=new a.ColorContrastCache,this._onChangeColors=this.register(new g.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:s,background:r,cursor:e,cursorAccent:t,selectionForeground:void 0,selectionBackgroundTransparent:l,selectionBackgroundOpaque:_.color.blend(r,l),selectionInactiveBackgroundTransparent:l,selectionInactiveBackgroundOpaque:_.color.blend(r,l),ansi:i.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(b={}){const f=this._colors;if(f.foreground=v(b.foreground,s),f.background=v(b.background,r),f.cursor=v(b.cursor,e),f.cursorAccent=v(b.cursorAccent,t),f.selectionBackgroundTransparent=v(b.selectionBackground,l),f.selectionBackgroundOpaque=_.color.blend(f.background,f.selectionBackgroundTransparent),f.selectionInactiveBackgroundTransparent=v(b.selectionInactiveBackground,f.selectionBackgroundTransparent),f.selectionInactiveBackgroundOpaque=_.color.blend(f.background,f.selectionInactiveBackgroundTransparent),f.selectionForeground=b.selectionForeground?v(b.selectionForeground,_.NULL_COLOR):void 0,f.selectionForeground===_.NULL_COLOR&&(f.selectionForeground=void 0),_.color.isOpaque(f.selectionBackgroundTransparent)&&(f.selectionBackgroundTransparent=_.color.opacity(f.selectionBackgroundTransparent,.3)),_.color.isOpaque(f.selectionInactiveBackgroundTransparent)&&(f.selectionInactiveBackgroundTransparent=_.color.opacity(f.selectionInactiveBackgroundTransparent,.3)),f.ansi=i.DEFAULT_ANSI_COLORS.slice(),f.ansi[0]=v(b.black,i.DEFAULT_ANSI_COLORS[0]),f.ansi[1]=v(b.red,i.DEFAULT_ANSI_COLORS[1]),f.ansi[2]=v(b.green,i.DEFAULT_ANSI_COLORS[2]),f.ansi[3]=v(b.yellow,i.DEFAULT_ANSI_COLORS[3]),f.ansi[4]=v(b.blue,i.DEFAULT_ANSI_COLORS[4]),f.ansi[5]=v(b.magenta,i.DEFAULT_ANSI_COLORS[5]),f.ansi[6]=v(b.cyan,i.DEFAULT_ANSI_COLORS[6]),f.ansi[7]=v(b.white,i.DEFAULT_ANSI_COLORS[7]),f.ansi[8]=v(b.brightBlack,i.DEFAULT_ANSI_COLORS[8]),f.ansi[9]=v(b.brightRed,i.DEFAULT_ANSI_COLORS[9]),f.ansi[10]=v(b.brightGreen,i.DEFAULT_ANSI_COLORS[10]),f.ansi[11]=v(b.brightYellow,i.DEFAULT_ANSI_COLORS[11]),f.ansi[12]=v(b.brightBlue,i.DEFAULT_ANSI_COLORS[12]),f.ansi[13]=v(b.brightMagenta,i.DEFAULT_ANSI_COLORS[13]),f.ansi[14]=v(b.brightCyan,i.DEFAULT_ANSI_COLORS[14]),f.ansi[15]=v(b.brightWhite,i.DEFAULT_ANSI_COLORS[15]),b.extendedAnsi){const w=Math.min(f.ansi.length-16,b.extendedAnsi.length);for(let D=0;D<w;D++)f.ansi[D+16]=v(b.extendedAnsi[D],i.DEFAULT_ANSI_COLORS[D+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(b){this._restoreColor(b),this._onChangeColors.fire(this.colors)}_restoreColor(b){if(b!==void 0)switch(b){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[b]=this._restoreColors.ansi[b]}else for(let f=0;f<this._restoreColors.ansi.length;++f)this._colors.ansi[f]=this._restoreColors.ansi[f]}modifyColors(b){b(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function v(b,f){if(b!==void 0)try{return _.css.toColor(b)}catch{}return f}i.ThemeService=m=h([p(0,d.IOptionsService)],m)},6349:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CircularList=void 0;const h=o(8460),p=o(844);class a extends p.Disposable{constructor(g){super(),this._maxLength=g,this.onDeleteEmitter=this.register(new h.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new h.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new h.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(g){if(this._maxLength===g)return;const y=new Array(g);for(let d=0;d<Math.min(g,this.length);d++)y[d]=this._array[this._getCyclicIndex(d)];this._array=y,this._maxLength=g,this._startIndex=0}get length(){return this._length}set length(g){if(g>this._length)for(let y=this._length;y<g;y++)this._array[y]=void 0;this._length=g}get(g){return this._array[this._getCyclicIndex(g)]}set(g,y){this._array[this._getCyclicIndex(g)]=y}push(g){this._array[this._getCyclicIndex(this._length)]=g,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(g,y,...d){if(y){for(let s=g;s<this._length-y;s++)this._array[this._getCyclicIndex(s)]=this._array[this._getCyclicIndex(s+y)];this._length-=y,this.onDeleteEmitter.fire({index:g,amount:y})}for(let s=this._length-1;s>=g;s--)this._array[this._getCyclicIndex(s+d.length)]=this._array[this._getCyclicIndex(s)];for(let s=0;s<d.length;s++)this._array[this._getCyclicIndex(g+s)]=d[s];if(d.length&&this.onInsertEmitter.fire({index:g,amount:d.length}),this._length+d.length>this._maxLength){const s=this._length+d.length-this._maxLength;this._startIndex+=s,this._length=this._maxLength,this.onTrimEmitter.fire(s)}else this._length+=d.length}trimStart(g){g>this._length&&(g=this._length),this._startIndex+=g,this._length-=g,this.onTrimEmitter.fire(g)}shiftElements(g,y,d){if(!(y<=0)){if(g<0||g>=this._length)throw new Error("start argument out of range");if(g+d<0)throw new Error("Cannot shift elements in list beyond index 0");if(d>0){for(let r=y-1;r>=0;r--)this.set(g+r+d,this.get(g+r));const s=g+y+d-this._length;if(s>0)for(this._length+=s;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let s=0;s<y;s++)this.set(g+s+d,this.get(g+s))}}_getCyclicIndex(g){return(this._startIndex+g)%this._maxLength}}i.CircularList=a},1439:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.clone=void 0,i.clone=function o(h,p=5){if(typeof h!="object")return h;const a=Array.isArray(h)?[]:{};for(const _ in h)a[_]=p<=1?h[_]:h[_]&&o(h[_],p-1);return a}},8055:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;let o=0,h=0,p=0,a=0;var _,g,y,d,s;function r(t){const l=t.toString(16);return l.length<2?"0"+l:l}function e(t,l){return t<l?(l+.05)/(t+.05):(t+.05)/(l+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},function(t){t.toCss=function(l,m,v,b){return b!==void 0?`#${r(l)}${r(m)}${r(v)}${r(b)}`:`#${r(l)}${r(m)}${r(v)}`},t.toRgba=function(l,m,v,b=255){return(l<<24|m<<16|v<<8|b)>>>0},t.toColor=function(l,m,v,b){return{css:t.toCss(l,m,v,b),rgba:t.toRgba(l,m,v,b)}}}(_||(i.channels=_={})),function(t){function l(m,v){return a=Math.round(255*v),[o,h,p]=s.toChannels(m.rgba),{css:_.toCss(o,h,p,a),rgba:_.toRgba(o,h,p,a)}}t.blend=function(m,v){if(a=(255&v.rgba)/255,a===1)return{css:v.css,rgba:v.rgba};const b=v.rgba>>24&255,f=v.rgba>>16&255,w=v.rgba>>8&255,D=m.rgba>>24&255,T=m.rgba>>16&255,M=m.rgba>>8&255;return o=D+Math.round((b-D)*a),h=T+Math.round((f-T)*a),p=M+Math.round((w-M)*a),{css:_.toCss(o,h,p),rgba:_.toRgba(o,h,p)}},t.isOpaque=function(m){return(255&m.rgba)==255},t.ensureContrastRatio=function(m,v,b){const f=s.ensureContrastRatio(m.rgba,v.rgba,b);if(f)return _.toColor(f>>24&255,f>>16&255,f>>8&255)},t.opaque=function(m){const v=(255|m.rgba)>>>0;return[o,h,p]=s.toChannels(v),{css:_.toCss(o,h,p),rgba:v}},t.opacity=l,t.multiplyOpacity=function(m,v){return a=255&m.rgba,l(m,a*v/255)},t.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}}(g||(i.color=g={})),function(t){let l,m;try{const v=document.createElement("canvas");v.width=1,v.height=1;const b=v.getContext("2d",{willReadFrequently:!0});b&&(l=b,l.globalCompositeOperation="copy",m=l.createLinearGradient(0,0,1,1))}catch{}t.toColor=function(v){if(v.match(/#[\da-f]{3,8}/i))switch(v.length){case 4:return o=parseInt(v.slice(1,2).repeat(2),16),h=parseInt(v.slice(2,3).repeat(2),16),p=parseInt(v.slice(3,4).repeat(2),16),_.toColor(o,h,p);case 5:return o=parseInt(v.slice(1,2).repeat(2),16),h=parseInt(v.slice(2,3).repeat(2),16),p=parseInt(v.slice(3,4).repeat(2),16),a=parseInt(v.slice(4,5).repeat(2),16),_.toColor(o,h,p,a);case 7:return{css:v,rgba:(parseInt(v.slice(1),16)<<8|255)>>>0};case 9:return{css:v,rgba:parseInt(v.slice(1),16)>>>0}}const b=v.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(b)return o=parseInt(b[1]),h=parseInt(b[2]),p=parseInt(b[3]),a=Math.round(255*(b[5]===void 0?1:parseFloat(b[5]))),_.toColor(o,h,p,a);if(!l||!m)throw new Error("css.toColor: Unsupported css format");if(l.fillStyle=m,l.fillStyle=v,typeof l.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(l.fillRect(0,0,1,1),[o,h,p,a]=l.getImageData(0,0,1,1).data,a!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:_.toRgba(o,h,p,a),css:v}}}(y||(i.css=y={})),function(t){function l(m,v,b){const f=m/255,w=v/255,D=b/255;return .2126*(f<=.03928?f/12.92:Math.pow((f+.055)/1.055,2.4))+.7152*(w<=.03928?w/12.92:Math.pow((w+.055)/1.055,2.4))+.0722*(D<=.03928?D/12.92:Math.pow((D+.055)/1.055,2.4))}t.relativeLuminance=function(m){return l(m>>16&255,m>>8&255,255&m)},t.relativeLuminance2=l}(d||(i.rgb=d={})),function(t){function l(v,b,f){const w=v>>24&255,D=v>>16&255,T=v>>8&255;let M=b>>24&255,L=b>>16&255,H=b>>8&255,$=e(d.relativeLuminance2(M,L,H),d.relativeLuminance2(w,D,T));for(;$<f&&(M>0||L>0||H>0);)M-=Math.max(0,Math.ceil(.1*M)),L-=Math.max(0,Math.ceil(.1*L)),H-=Math.max(0,Math.ceil(.1*H)),$=e(d.relativeLuminance2(M,L,H),d.relativeLuminance2(w,D,T));return(M<<24|L<<16|H<<8|255)>>>0}function m(v,b,f){const w=v>>24&255,D=v>>16&255,T=v>>8&255;let M=b>>24&255,L=b>>16&255,H=b>>8&255,$=e(d.relativeLuminance2(M,L,H),d.relativeLuminance2(w,D,T));for(;$<f&&(M<255||L<255||H<255);)M=Math.min(255,M+Math.ceil(.1*(255-M))),L=Math.min(255,L+Math.ceil(.1*(255-L))),H=Math.min(255,H+Math.ceil(.1*(255-H))),$=e(d.relativeLuminance2(M,L,H),d.relativeLuminance2(w,D,T));return(M<<24|L<<16|H<<8|255)>>>0}t.blend=function(v,b){if(a=(255&b)/255,a===1)return b;const f=b>>24&255,w=b>>16&255,D=b>>8&255,T=v>>24&255,M=v>>16&255,L=v>>8&255;return o=T+Math.round((f-T)*a),h=M+Math.round((w-M)*a),p=L+Math.round((D-L)*a),_.toRgba(o,h,p)},t.ensureContrastRatio=function(v,b,f){const w=d.relativeLuminance(v>>8),D=d.relativeLuminance(b>>8);if(e(w,D)<f){if(D<w){const L=l(v,b,f),H=e(w,d.relativeLuminance(L>>8));if(H<f){const $=m(v,b,f);return H>e(w,d.relativeLuminance($>>8))?L:$}return L}const T=m(v,b,f),M=e(w,d.relativeLuminance(T>>8));if(M<f){const L=l(v,b,f);return M>e(w,d.relativeLuminance(L>>8))?T:L}return T}},t.reduceLuminance=l,t.increaseLuminance=m,t.toChannels=function(v){return[v>>24&255,v>>16&255,v>>8&255,255&v]}}(s||(i.rgba=s={})),i.toPaddedHex=r,i.contrastRatio=e},8969:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreTerminal=void 0;const h=o(844),p=o(2585),a=o(4348),_=o(7866),g=o(744),y=o(7302),d=o(6975),s=o(8460),r=o(1753),e=o(1480),t=o(7994),l=o(9282),m=o(5435),v=o(5981),b=o(2660);let f=!1;class w extends h.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new s.EventEmitter),this._onScroll.event(T=>{var M;(M=this._onScrollApi)==null||M.fire(T.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(T){for(const M in T)this.optionsService.options[M]=T[M]}constructor(T){super(),this._windowsWrappingHeuristics=this.register(new h.MutableDisposable),this._onBinary=this.register(new s.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new s.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new s.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new s.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new s.EventEmitter),this._instantiationService=new a.InstantiationService,this.optionsService=this.register(new y.OptionsService(T)),this._instantiationService.setService(p.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(g.BufferService)),this._instantiationService.setService(p.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(_.LogService)),this._instantiationService.setService(p.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(d.CoreService)),this._instantiationService.setService(p.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(r.CoreMouseService)),this._instantiationService.setService(p.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(e.UnicodeService)),this._instantiationService.setService(p.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(t.CharsetService),this._instantiationService.setService(p.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(b.OscLinkService),this._instantiationService.setService(p.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new m.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,s.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,s.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,s.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,s.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(M=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new v.WriteBuffer((M,L)=>this._inputHandler.parse(M,L))),this.register((0,s.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(T,M){this._writeBuffer.write(T,M)}writeSync(T,M){this._logService.logLevel<=p.LogLevelEnum.WARN&&!f&&(this._logService.warn("writeSync is unreliable and will be removed soon."),f=!0),this._writeBuffer.writeSync(T,M)}input(T,M=!0){this.coreService.triggerDataEvent(T,M)}resize(T,M){isNaN(T)||isNaN(M)||(T=Math.max(T,g.MINIMUM_COLS),M=Math.max(M,g.MINIMUM_ROWS),this._bufferService.resize(T,M))}scroll(T,M=!1){this._bufferService.scroll(T,M)}scrollLines(T,M,L){this._bufferService.scrollLines(T,M,L)}scrollPages(T){this.scrollLines(T*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(T){const M=T-this._bufferService.buffer.ydisp;M!==0&&this.scrollLines(M)}registerEscHandler(T,M){return this._inputHandler.registerEscHandler(T,M)}registerDcsHandler(T,M){return this._inputHandler.registerDcsHandler(T,M)}registerCsiHandler(T,M){return this._inputHandler.registerCsiHandler(T,M)}registerOscHandler(T,M){return this._inputHandler.registerOscHandler(T,M)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let T=!1;const M=this.optionsService.rawOptions.windowsPty;M&&M.buildNumber!==void 0&&M.buildNumber!==void 0?T=M.backend==="conpty"&&M.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(T=!0),T?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const T=[];T.push(this.onLineFeed(l.updateWindowsModeWrappedState.bind(null,this._bufferService))),T.push(this.registerCsiHandler({final:"H"},()=>((0,l.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,h.toDisposable)(()=>{for(const M of T)M.dispose()})}}}i.CoreTerminal=w},8460:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.runAndSubscribe=i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=o=>(this._listeners.push(o),{dispose:()=>{if(!this._disposed){for(let h=0;h<this._listeners.length;h++)if(this._listeners[h]===o)return void this._listeners.splice(h,1)}}})),this._event}fire(o,h){const p=[];for(let a=0;a<this._listeners.length;a++)p.push(this._listeners[a]);for(let a=0;a<p.length;a++)p[a].call(void 0,o,h)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(o,h){return o(p=>h.fire(p))},i.runAndSubscribe=function(o,h){return h(void 0),o(p=>h(p))}},5435:function(x,i,o){var h=this&&this.__decorate||function(j,k,R,B){var I,N=arguments.length,z=N<3?k:B===null?B=Object.getOwnPropertyDescriptor(k,R):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")z=Reflect.decorate(j,k,R,B);else for(var J=j.length-1;J>=0;J--)(I=j[J])&&(z=(N<3?I(z):N>3?I(k,R,z):I(k,R))||z);return N>3&&z&&Object.defineProperty(k,R,z),z},p=this&&this.__param||function(j,k){return function(R,B){k(R,B,j)}};Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=i.WindowsOptionsReportType=void 0;const a=o(2584),_=o(7116),g=o(2015),y=o(844),d=o(482),s=o(8437),r=o(8460),e=o(643),t=o(511),l=o(3734),m=o(2585),v=o(1480),b=o(6242),f=o(6351),w=o(5941),D={"(":0,")":1,"*":2,"+":3,"-":1,".":2},T=131072;function M(j,k){if(j>24)return k.setWinLines||!1;switch(j){case 1:return!!k.restoreWin;case 2:return!!k.minimizeWin;case 3:return!!k.setWinPosition;case 4:return!!k.setWinSizePixels;case 5:return!!k.raiseWin;case 6:return!!k.lowerWin;case 7:return!!k.refreshWin;case 8:return!!k.setWinSizeChars;case 9:return!!k.maximizeWin;case 10:return!!k.fullscreenWin;case 11:return!!k.getWinState;case 13:return!!k.getWinPosition;case 14:return!!k.getWinSizePixels;case 15:return!!k.getScreenSizePixels;case 16:return!!k.getCellSizePixels;case 18:return!!k.getWinSizeChars;case 19:return!!k.getScreenSizeChars;case 20:return!!k.getIconTitle;case 21:return!!k.getWinTitle;case 22:return!!k.pushTitle;case 23:return!!k.popTitle;case 24:return!!k.setWinLines}return!1}var L;(function(j){j[j.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",j[j.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(L||(i.WindowsOptionsReportType=L={}));let H=0;class $ extends y.Disposable{getAttrData(){return this._curAttrData}constructor(k,R,B,I,N,z,J,Y,P=new g.EscapeSequenceParser){super(),this._bufferService=k,this._charsetService=R,this._coreService=B,this._logService=I,this._optionsService=N,this._oscLinkService=z,this._coreMouseService=J,this._unicodeService=Y,this._parser=P,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new d.StringToUtf32,this._utf8Decoder=new d.Utf8ToUtf32,this._workCell=new t.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new r.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new r.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new r.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new r.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new r.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new r.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new r.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new r.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new r.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new r.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new r.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new r.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new r.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new U(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(E=>this._activeBuffer=E.activeBuffer)),this._parser.setCsiHandlerFallback((E,W)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(E),params:W.toArray()})}),this._parser.setEscHandlerFallback(E=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(E)})}),this._parser.setExecuteHandlerFallback(E=>{this._logService.debug("Unknown EXECUTE code: ",{code:E})}),this._parser.setOscHandlerFallback((E,W,F)=>{this._logService.debug("Unknown OSC code: ",{identifier:E,action:W,data:F})}),this._parser.setDcsHandlerFallback((E,W,F)=>{W==="HOOK"&&(F=F.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(E),action:W,payload:F})}),this._parser.setPrintHandler((E,W,F)=>this.print(E,W,F)),this._parser.registerCsiHandler({final:"@"},E=>this.insertChars(E)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},E=>this.scrollLeft(E)),this._parser.registerCsiHandler({final:"A"},E=>this.cursorUp(E)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},E=>this.scrollRight(E)),this._parser.registerCsiHandler({final:"B"},E=>this.cursorDown(E)),this._parser.registerCsiHandler({final:"C"},E=>this.cursorForward(E)),this._parser.registerCsiHandler({final:"D"},E=>this.cursorBackward(E)),this._parser.registerCsiHandler({final:"E"},E=>this.cursorNextLine(E)),this._parser.registerCsiHandler({final:"F"},E=>this.cursorPrecedingLine(E)),this._parser.registerCsiHandler({final:"G"},E=>this.cursorCharAbsolute(E)),this._parser.registerCsiHandler({final:"H"},E=>this.cursorPosition(E)),this._parser.registerCsiHandler({final:"I"},E=>this.cursorForwardTab(E)),this._parser.registerCsiHandler({final:"J"},E=>this.eraseInDisplay(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},E=>this.eraseInDisplay(E,!0)),this._parser.registerCsiHandler({final:"K"},E=>this.eraseInLine(E,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},E=>this.eraseInLine(E,!0)),this._parser.registerCsiHandler({final:"L"},E=>this.insertLines(E)),this._parser.registerCsiHandler({final:"M"},E=>this.deleteLines(E)),this._parser.registerCsiHandler({final:"P"},E=>this.deleteChars(E)),this._parser.registerCsiHandler({final:"S"},E=>this.scrollUp(E)),this._parser.registerCsiHandler({final:"T"},E=>this.scrollDown(E)),this._parser.registerCsiHandler({final:"X"},E=>this.eraseChars(E)),this._parser.registerCsiHandler({final:"Z"},E=>this.cursorBackwardTab(E)),this._parser.registerCsiHandler({final:"`"},E=>this.charPosAbsolute(E)),this._parser.registerCsiHandler({final:"a"},E=>this.hPositionRelative(E)),this._parser.registerCsiHandler({final:"b"},E=>this.repeatPrecedingCharacter(E)),this._parser.registerCsiHandler({final:"c"},E=>this.sendDeviceAttributesPrimary(E)),this._parser.registerCsiHandler({prefix:">",final:"c"},E=>this.sendDeviceAttributesSecondary(E)),this._parser.registerCsiHandler({final:"d"},E=>this.linePosAbsolute(E)),this._parser.registerCsiHandler({final:"e"},E=>this.vPositionRelative(E)),this._parser.registerCsiHandler({final:"f"},E=>this.hVPosition(E)),this._parser.registerCsiHandler({final:"g"},E=>this.tabClear(E)),this._parser.registerCsiHandler({final:"h"},E=>this.setMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"h"},E=>this.setModePrivate(E)),this._parser.registerCsiHandler({final:"l"},E=>this.resetMode(E)),this._parser.registerCsiHandler({prefix:"?",final:"l"},E=>this.resetModePrivate(E)),this._parser.registerCsiHandler({final:"m"},E=>this.charAttributes(E)),this._parser.registerCsiHandler({final:"n"},E=>this.deviceStatus(E)),this._parser.registerCsiHandler({prefix:"?",final:"n"},E=>this.deviceStatusPrivate(E)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},E=>this.softReset(E)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},E=>this.setCursorStyle(E)),this._parser.registerCsiHandler({final:"r"},E=>this.setScrollRegion(E)),this._parser.registerCsiHandler({final:"s"},E=>this.saveCursor(E)),this._parser.registerCsiHandler({final:"t"},E=>this.windowOptions(E)),this._parser.registerCsiHandler({final:"u"},E=>this.restoreCursor(E)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},E=>this.insertColumns(E)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},E=>this.deleteColumns(E)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},E=>this.selectProtected(E)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},E=>this.requestMode(E,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},E=>this.requestMode(E,!1)),this._parser.setExecuteHandler(a.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(a.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(a.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(a.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(a.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(a.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(a.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(a.C1.IND,()=>this.index()),this._parser.setExecuteHandler(a.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(a.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new b.OscHandler(E=>(this.setTitle(E),this.setIconName(E),!0))),this._parser.registerOscHandler(1,new b.OscHandler(E=>this.setIconName(E))),this._parser.registerOscHandler(2,new b.OscHandler(E=>this.setTitle(E))),this._parser.registerOscHandler(4,new b.OscHandler(E=>this.setOrReportIndexedColor(E))),this._parser.registerOscHandler(8,new b.OscHandler(E=>this.setHyperlink(E))),this._parser.registerOscHandler(10,new b.OscHandler(E=>this.setOrReportFgColor(E))),this._parser.registerOscHandler(11,new b.OscHandler(E=>this.setOrReportBgColor(E))),this._parser.registerOscHandler(12,new b.OscHandler(E=>this.setOrReportCursorColor(E))),this._parser.registerOscHandler(104,new b.OscHandler(E=>this.restoreIndexedColor(E))),this._parser.registerOscHandler(110,new b.OscHandler(E=>this.restoreFgColor(E))),this._parser.registerOscHandler(111,new b.OscHandler(E=>this.restoreBgColor(E))),this._parser.registerOscHandler(112,new b.OscHandler(E=>this.restoreCursorColor(E))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const E in _.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:E},()=>this.selectCharset("("+E)),this._parser.registerEscHandler({intermediates:")",final:E},()=>this.selectCharset(")"+E)),this._parser.registerEscHandler({intermediates:"*",final:E},()=>this.selectCharset("*"+E)),this._parser.registerEscHandler({intermediates:"+",final:E},()=>this.selectCharset("+"+E)),this._parser.registerEscHandler({intermediates:"-",final:E},()=>this.selectCharset("-"+E)),this._parser.registerEscHandler({intermediates:".",final:E},()=>this.selectCharset("."+E)),this._parser.registerEscHandler({intermediates:"/",final:E},()=>this.selectCharset("/"+E));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(E=>(this._logService.error("Parsing error: ",E),E)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new f.DcsHandler((E,W)=>this.requestStatusString(E,W)))}_preserveStack(k,R,B,I){this._parseStack.paused=!0,this._parseStack.cursorStartX=k,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=B,this._parseStack.position=I}_logSlowResolvingAsync(k){this._logService.logLevel<=m.LogLevelEnum.WARN&&Promise.race([k,new Promise((R,B)=>setTimeout(()=>B("#SLOW_TIMEOUT"),5e3))]).catch(R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(k,R){let B,I=this._activeBuffer.x,N=this._activeBuffer.y,z=0;const J=this._parseStack.paused;if(J){if(B=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(B),B;I=this._parseStack.cursorStartX,N=this._parseStack.cursorStartY,this._parseStack.paused=!1,k.length>T&&(z=this._parseStack.position+T)}if(this._logService.logLevel<=m.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof k=="string"?` "${k}"`:` "${Array.prototype.map.call(k,E=>String.fromCharCode(E)).join("")}"`),typeof k=="string"?k.split("").map(E=>E.charCodeAt(0)):k),this._parseBuffer.length<k.length&&this._parseBuffer.length<T&&(this._parseBuffer=new Uint32Array(Math.min(k.length,T))),J||this._dirtyRowTracker.clearRange(),k.length>T)for(let E=z;E<k.length;E+=T){const W=E+T<k.length?E+T:k.length,F=typeof k=="string"?this._stringDecoder.decode(k.substring(E,W),this._parseBuffer):this._utf8Decoder.decode(k.subarray(E,W),this._parseBuffer);if(B=this._parser.parse(this._parseBuffer,F))return this._preserveStack(I,N,F,E),this._logSlowResolvingAsync(B),B}else if(!J){const E=typeof k=="string"?this._stringDecoder.decode(k,this._parseBuffer):this._utf8Decoder.decode(k,this._parseBuffer);if(B=this._parser.parse(this._parseBuffer,E))return this._preserveStack(I,N,E,0),this._logSlowResolvingAsync(B),B}this._activeBuffer.x===I&&this._activeBuffer.y===N||this._onCursorMove.fire();const Y=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),P=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);P<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(P,this._bufferService.rows-1),Math.min(Y,this._bufferService.rows-1))}print(k,R,B){let I,N;const z=this._charsetService.charset,J=this._optionsService.rawOptions.screenReaderMode,Y=this._bufferService.cols,P=this._coreService.decPrivateModes.wraparound,E=this._coreService.modes.insertMode,W=this._curAttrData;let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&B-R>0&&F.getWidth(this._activeBuffer.x-1)===2&&F.setCellFromCodepoint(this._activeBuffer.x-1,0,1,W);let K=this._parser.precedingJoinState;for(let V=R;V<B;++V){if(I=k[V],I<127&&z){const ce=z[String.fromCharCode(I)];ce&&(I=ce.charCodeAt(0))}const Q=this._unicodeService.charProperties(I,K);N=v.UnicodeService.extractWidth(Q);const se=v.UnicodeService.extractShouldJoin(Q),ie=se?v.UnicodeService.extractWidth(K):0;if(K=Q,J&&this._onA11yChar.fire((0,d.stringFromCodePoint)(I)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+N-ie>Y){if(P){const ce=F;let Z=this._activeBuffer.x-ie;for(this._activeBuffer.x=ie,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),F=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),ie>0&&F instanceof s.BufferLine&&F.copyCellsFrom(ce,Z,0,ie,!1);Z<Y;)ce.setCellFromCodepoint(Z++,0,1,W)}else if(this._activeBuffer.x=Y-1,N===2)continue}if(se&&this._activeBuffer.x){const ce=F.getWidth(this._activeBuffer.x-1)?1:2;F.addCodepointToCell(this._activeBuffer.x-ce,I,N);for(let Z=N-ie;--Z>=0;)F.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}else if(E&&(F.insertCells(this._activeBuffer.x,N-ie,this._activeBuffer.getNullCell(W)),F.getWidth(Y-1)===2&&F.setCellFromCodepoint(Y-1,e.NULL_CELL_CODE,e.NULL_CELL_WIDTH,W)),F.setCellFromCodepoint(this._activeBuffer.x++,I,N,W),N>0)for(;--N;)F.setCellFromCodepoint(this._activeBuffer.x++,0,0,W)}this._parser.precedingJoinState=K,this._activeBuffer.x<Y&&B-R>0&&F.getWidth(this._activeBuffer.x)===0&&!F.hasContent(this._activeBuffer.x)&&F.setCellFromCodepoint(this._activeBuffer.x,0,1,W),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(k,R){return k.final!=="t"||k.prefix||k.intermediates?this._parser.registerCsiHandler(k,R):this._parser.registerCsiHandler(k,B=>!M(B.params[0],this._optionsService.rawOptions.windowOptions)||R(B))}registerDcsHandler(k,R){return this._parser.registerDcsHandler(k,new f.DcsHandler(R))}registerEscHandler(k,R){return this._parser.registerEscHandler(k,R)}registerOscHandler(k,R){return this._parser.registerOscHandler(k,new b.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var k;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((k=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&k.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const k=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-k),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(k=this._bufferService.cols-1){this._activeBuffer.x=Math.min(k,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(k,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=k,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=k,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(k,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+k,this._activeBuffer.y+R)}cursorUp(k){const R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,k.params[0]||1)):this._moveCursor(0,-(k.params[0]||1)),!0}cursorDown(k){const R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,k.params[0]||1)):this._moveCursor(0,k.params[0]||1),!0}cursorForward(k){return this._moveCursor(k.params[0]||1,0),!0}cursorBackward(k){return this._moveCursor(-(k.params[0]||1),0),!0}cursorNextLine(k){return this.cursorDown(k),this._activeBuffer.x=0,!0}cursorPrecedingLine(k){return this.cursorUp(k),this._activeBuffer.x=0,!0}cursorCharAbsolute(k){return this._setCursor((k.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(k){return this._setCursor(k.length>=2?(k.params[1]||1)-1:0,(k.params[0]||1)-1),!0}charPosAbsolute(k){return this._setCursor((k.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(k){return this._moveCursor(k.params[0]||1,0),!0}linePosAbsolute(k){return this._setCursor(this._activeBuffer.x,(k.params[0]||1)-1),!0}vPositionRelative(k){return this._moveCursor(0,k.params[0]||1),!0}hVPosition(k){return this.cursorPosition(k),!0}tabClear(k){const R=k.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(k){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=k.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(k){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=k.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(k){const R=k.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(k,R,B,I=!1,N=!1){const z=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);z.replaceCells(R,B,this._activeBuffer.getNullCell(this._eraseAttrData()),N),I&&(z.isWrapped=!1)}_resetBufferLine(k,R=!1){const B=this._activeBuffer.lines.get(this._activeBuffer.ybase+k);B&&(B.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+k),B.isWrapped=!1)}eraseInDisplay(k,R=!1){let B;switch(this._restrictCursor(this._bufferService.cols),k.params[0]){case 0:for(B=this._activeBuffer.y,this._dirtyRowTracker.markDirty(B),this._eraseInBufferLine(B++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);B<this._bufferService.rows;B++)this._resetBufferLine(B,R);this._dirtyRowTracker.markDirty(B);break;case 1:for(B=this._activeBuffer.y,this._dirtyRowTracker.markDirty(B),this._eraseInBufferLine(B,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(B+1).isWrapped=!1);B--;)this._resetBufferLine(B,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(B=this._bufferService.rows,this._dirtyRowTracker.markDirty(B-1);B--;)this._resetBufferLine(B,R);this._dirtyRowTracker.markDirty(0);break;case 3:const I=this._activeBuffer.lines.length-this._bufferService.rows;I>0&&(this._activeBuffer.lines.trimStart(I),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-I,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-I,0),this._onScroll.fire(0))}return!0}eraseInLine(k,R=!1){switch(this._restrictCursor(this._bufferService.cols),k.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(k){this._restrictCursor();let R=k.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=this._activeBuffer.ybase+this._activeBuffer.y,I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,N=this._bufferService.rows-1+this._activeBuffer.ybase-I+1;for(;R--;)this._activeBuffer.lines.splice(N-1,1),this._activeBuffer.lines.splice(B,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(k){this._restrictCursor();let R=k.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const B=this._activeBuffer.ybase+this._activeBuffer.y;let I;for(I=this._bufferService.rows-1-this._activeBuffer.scrollBottom,I=this._bufferService.rows-1+this._activeBuffer.ybase-I;R--;)this._activeBuffer.lines.splice(B,1),this._activeBuffer.lines.splice(I,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,k.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,k.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(k){let R=k.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(k){let R=k.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(s.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let B=this._activeBuffer.scrollTop;B<=this._activeBuffer.scrollBottom;++B){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+B);I.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let B=this._activeBuffer.scrollTop;B<=this._activeBuffer.scrollBottom;++B){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+B);I.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let B=this._activeBuffer.scrollTop;B<=this._activeBuffer.scrollBottom;++B){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+B);I.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(k){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=k.params[0]||1;for(let B=this._activeBuffer.scrollTop;B<=this._activeBuffer.scrollBottom;++B){const I=this._activeBuffer.lines.get(this._activeBuffer.ybase+B);I.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),I.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(k){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(k.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(k){const R=this._parser.precedingJoinState;if(!R)return!0;const B=k.params[0]||1,I=v.UnicodeService.extractWidth(R),N=this._activeBuffer.x-I,z=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(N),J=new Uint32Array(z.length*B);let Y=0;for(let E=0;E<z.length;){const W=z.codePointAt(E)||0;J[Y++]=W,E+=W>65535?2:1}let P=Y;for(let E=1;E<B;++E)J.copyWithin(P,0,Y),P+=Y;return this.print(J,0,P),!0}sendDeviceAttributesPrimary(k){return k.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(a.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(a.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(k){return k.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(a.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(a.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(k.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(a.C0.ESC+"[>83;40003;0c")),!0}_is(k){return(this._optionsService.rawOptions.termName+"").indexOf(k)===0}setMode(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),this._charsetService.setgCharset(1,_.DEFAULT_CHARSET),this._charsetService.setgCharset(2,_.DEFAULT_CHARSET),this._charsetService.setgCharset(3,_.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(k){for(let R=0;R<k.length;R++)switch(k.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),k.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(k,R){const B=this._coreService.decPrivateModes,{activeProtocol:I,activeEncoding:N}=this._coreMouseService,z=this._coreService,{buffers:J,cols:Y}=this._bufferService,{active:P,alt:E}=J,W=this._optionsService.rawOptions,F=se=>se?1:2,K=k.params[0];return V=K,Q=R?K===2?4:K===4?F(z.modes.insertMode):K===12?3:K===20?F(W.convertEol):0:K===1?F(B.applicationCursorKeys):K===3?W.windowOptions.setWinLines?Y===80?2:Y===132?1:0:0:K===6?F(B.origin):K===7?F(B.wraparound):K===8?3:K===9?F(I==="X10"):K===12?F(W.cursorBlink):K===25?F(!z.isCursorHidden):K===45?F(B.reverseWraparound):K===66?F(B.applicationKeypad):K===67?4:K===1e3?F(I==="VT200"):K===1002?F(I==="DRAG"):K===1003?F(I==="ANY"):K===1004?F(B.sendFocus):K===1005?4:K===1006?F(N==="SGR"):K===1015?4:K===1016?F(N==="SGR_PIXELS"):K===1048?1:K===47||K===1047||K===1049?F(P===E):K===2004?F(B.bracketedPasteMode):0,z.triggerDataEvent(`${a.C0.ESC}[${R?"":"?"}${V};${Q}$y`),!0;var V,Q}_updateAttrColor(k,R,B,I,N){return R===2?(k|=50331648,k&=-16777216,k|=l.AttributeData.fromColorRGB([B,I,N])):R===5&&(k&=-50331904,k|=33554432|255&B),k}_extractColor(k,R,B){const I=[0,0,-1,0,0,0];let N=0,z=0;do{if(I[z+N]=k.params[R+z],k.hasSubParams(R+z)){const J=k.getSubParams(R+z);let Y=0;do I[1]===5&&(N=1),I[z+Y+1+N]=J[Y];while(++Y<J.length&&Y+z+1+N<I.length);break}if(I[1]===5&&z+N>=2||I[1]===2&&z+N>=5)break;I[1]&&(N=1)}while(++z+R<k.length&&z+N<I.length);for(let J=2;J<I.length;++J)I[J]===-1&&(I[J]=0);switch(I[0]){case 38:B.fg=this._updateAttrColor(B.fg,I[1],I[3],I[4],I[5]);break;case 48:B.bg=this._updateAttrColor(B.bg,I[1],I[3],I[4],I[5]);break;case 58:B.extended=B.extended.clone(),B.extended.underlineColor=this._updateAttrColor(B.extended.underlineColor,I[1],I[3],I[4],I[5])}return z}_processUnderline(k,R){R.extended=R.extended.clone(),(!~k||k>5)&&(k=1),R.extended.underlineStyle=k,R.fg|=268435456,k===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(k){k.fg=s.DEFAULT_ATTR_DATA.fg,k.bg=s.DEFAULT_ATTR_DATA.bg,k.extended=k.extended.clone(),k.extended.underlineStyle=0,k.extended.underlineColor&=-67108864,k.updateExtended()}charAttributes(k){if(k.length===1&&k.params[0]===0)return this._processSGR0(this._curAttrData),!0;const R=k.length;let B;const I=this._curAttrData;for(let N=0;N<R;N++)B=k.params[N],B>=30&&B<=37?(I.fg&=-50331904,I.fg|=16777216|B-30):B>=40&&B<=47?(I.bg&=-50331904,I.bg|=16777216|B-40):B>=90&&B<=97?(I.fg&=-50331904,I.fg|=16777224|B-90):B>=100&&B<=107?(I.bg&=-50331904,I.bg|=16777224|B-100):B===0?this._processSGR0(I):B===1?I.fg|=134217728:B===3?I.bg|=67108864:B===4?(I.fg|=268435456,this._processUnderline(k.hasSubParams(N)?k.getSubParams(N)[0]:1,I)):B===5?I.fg|=536870912:B===7?I.fg|=67108864:B===8?I.fg|=1073741824:B===9?I.fg|=2147483648:B===2?I.bg|=134217728:B===21?this._processUnderline(2,I):B===22?(I.fg&=-134217729,I.bg&=-134217729):B===23?I.bg&=-67108865:B===24?(I.fg&=-268435457,this._processUnderline(0,I)):B===25?I.fg&=-536870913:B===27?I.fg&=-67108865:B===28?I.fg&=-1073741825:B===29?I.fg&=2147483647:B===39?(I.fg&=-67108864,I.fg|=16777215&s.DEFAULT_ATTR_DATA.fg):B===49?(I.bg&=-67108864,I.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):B===38||B===48||B===58?N+=this._extractColor(k,N,I):B===53?I.bg|=1073741824:B===55?I.bg&=-1073741825:B===59?(I.extended=I.extended.clone(),I.extended.underlineColor=-1,I.updateExtended()):B===100?(I.fg&=-67108864,I.fg|=16777215&s.DEFAULT_ATTR_DATA.fg,I.bg&=-67108864,I.bg|=16777215&s.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",B);return!0}deviceStatus(k){switch(k.params[0]){case 5:this._coreService.triggerDataEvent(`${a.C0.ESC}[0n`);break;case 6:const R=this._activeBuffer.y+1,B=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${a.C0.ESC}[${R};${B}R`)}return!0}deviceStatusPrivate(k){if(k.params[0]===6){const R=this._activeBuffer.y+1,B=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${a.C0.ESC}[?${R};${B}R`)}return!0}softReset(k){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(k){const R=k.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const B=R%2==1;return this._optionsService.options.cursorBlink=B,!0}setScrollRegion(k){const R=k.params[0]||1;let B;return(k.length<2||(B=k.params[1])>this._bufferService.rows||B===0)&&(B=this._bufferService.rows),B>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=B-1,this._setCursor(0,0)),!0}windowOptions(k){if(!M(k.params[0],this._optionsService.rawOptions.windowOptions))return!0;const R=k.length>1?k.params[1]:0;switch(k.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(L.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(L.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${a.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(k){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(k){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(k){return this._windowTitle=k,this._onTitleChange.fire(k),!0}setIconName(k){return this._iconName=k,!0}setOrReportIndexedColor(k){const R=[],B=k.split(";");for(;B.length>1;){const I=B.shift(),N=B.shift();if(/^\d+$/.exec(I)){const z=parseInt(I);if(G(z))if(N==="?")R.push({type:0,index:z});else{const J=(0,w.parseColor)(N);J&&R.push({type:1,index:z,color:J})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(k){const R=k.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(k,R){this._getCurrentLinkId()&&this._finishHyperlink();const B=k.split(":");let I;const N=B.findIndex(z=>z.startsWith("id="));return N!==-1&&(I=B[N].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:I,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(k,R){const B=k.split(";");for(let I=0;I<B.length&&!(R>=this._specialColors.length);++I,++R)if(B[I]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{const N=(0,w.parseColor)(B[I]);N&&this._onColor.fire([{type:1,index:this._specialColors[R],color:N}])}return!0}setOrReportFgColor(k){return this._setOrReportSpecialColor(k,0)}setOrReportBgColor(k){return this._setOrReportSpecialColor(k,1)}setOrReportCursorColor(k){return this._setOrReportSpecialColor(k,2)}restoreIndexedColor(k){if(!k)return this._onColor.fire([{type:2}]),!0;const R=[],B=k.split(";");for(let I=0;I<B.length;++I)if(/^\d+$/.exec(B[I])){const N=parseInt(B[I]);G(N)&&R.push({type:2,index:N})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(k){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(k){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(k){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,_.DEFAULT_CHARSET),!0}selectCharset(k){return k.length!==2?(this.selectDefaultCharset(),!0):(k[0]==="/"||this._charsetService.setgCharset(D[k[0]],_.CHARSETS[k[1]]||_.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const k=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,k,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=s.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=s.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(k){return this._charsetService.setgLevel(k),!0}screenAlignmentPattern(){const k=new t.CellData;k.content=4194373,k.fg=this._curAttrData.fg,k.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){const B=this._activeBuffer.ybase+this._activeBuffer.y+R,I=this._activeBuffer.lines.get(B);I&&(I.fill(k),I.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(k,R){const B=this._bufferService.buffer,I=this._optionsService.rawOptions;return(N=>(this._coreService.triggerDataEvent(`${a.C0.ESC}${N}${a.C0.ESC}\\`),!0))(k==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:k==='"p'?'P1$r61;1"p':k==="r"?`P1$r${B.scrollTop+1};${B.scrollBottom+1}r`:k==="m"?"P1$r0m":k===" q"?`P1$r${{block:2,underline:4,bar:6}[I.cursorStyle]-(I.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(k,R){this._dirtyRowTracker.markRangeDirty(k,R)}}i.InputHandler=$;let U=class{constructor(j){this._bufferService=j,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(j){j<this.start?this.start=j:j>this.end&&(this.end=j)}markRangeDirty(j,k){j>k&&(H=j,j=k,k=H),j<this.start&&(this.start=j),k>this.end&&(this.end=k)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function G(j){return 0<=j&&j<256}U=h([p(0,m.IBufferService)],U)},844:(x,i)=>{function o(h){for(const p of h)p.dispose();h.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const h of this._disposables)h.dispose();this._disposables.length=0}register(h){return this._disposables.push(h),h}unregister(h){const p=this._disposables.indexOf(h);p!==-1&&this._disposables.splice(p,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(h){var p;this._isDisposed||h===this._value||((p=this._value)==null||p.dispose(),this._value=h)}clear(){this.value=void 0}dispose(){var h;this._isDisposed=!0,(h=this._value)==null||h.dispose(),this._value=void 0}},i.toDisposable=function(h){return{dispose:h}},i.disposeArray=o,i.getDisposeArrayDisposable=function(h){return{dispose:()=>o(h)}}},1505:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class o{constructor(){this._data={}}set(p,a,_){this._data[p]||(this._data[p]={}),this._data[p][a]=_}get(p,a){return this._data[p]?this._data[p][a]:void 0}clear(){this._data={}}}i.TwoKeyMap=o,i.FourKeyMap=class{constructor(){this._data=new o}set(h,p,a,_,g){this._data.get(h,p)||this._data.set(h,p,new o),this._data.get(h,p).set(a,_,g)}get(h,p,a,_){var g;return(g=this._data.get(h,p))==null?void 0:g.get(a,_)}clear(){this._data.clear()}}},6114:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof process<"u"&&"title"in process;const o=i.isNode?"node":navigator.userAgent,h=i.isNode?"node":navigator.platform;i.isFirefox=o.includes("Firefox"),i.isLegacyEdge=o.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(o),i.getSafariVersion=function(){if(!i.isSafari)return 0;const p=o.match(/Version\/(\d+)/);return p===null||p.length<2?0:parseInt(p[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(h),i.isIpad=h==="iPad",i.isIphone=h==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(h),i.isLinux=h.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(o)},6106:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SortedList=void 0;let o=0;i.SortedList=class{constructor(h){this._getKey=h,this._array=[]}clear(){this._array.length=0}insert(h){this._array.length!==0?(o=this._search(this._getKey(h)),this._array.splice(o,0,h)):this._array.push(h)}delete(h){if(this._array.length===0)return!1;const p=this._getKey(h);if(p===void 0||(o=this._search(p),o===-1)||this._getKey(this._array[o])!==p)return!1;do if(this._array[o]===h)return this._array.splice(o,1),!0;while(++o<this._array.length&&this._getKey(this._array[o])===p);return!1}*getKeyIterator(h){if(this._array.length!==0&&(o=this._search(h),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===h))do yield this._array[o];while(++o<this._array.length&&this._getKey(this._array[o])===h)}forEachByKey(h,p){if(this._array.length!==0&&(o=this._search(h),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===h))do p(this._array[o]);while(++o<this._array.length&&this._getKey(this._array[o])===h)}values(){return[...this._array].values()}_search(h){let p=0,a=this._array.length-1;for(;a>=p;){let _=p+a>>1;const g=this._getKey(this._array[_]);if(g>h)a=_-1;else{if(!(g<h)){for(;_>0&&this._getKey(this._array[_-1])===h;)_--;return _}p=_+1}}return p}}},7226:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;const h=o(6114);class p{constructor(){this._tasks=[],this._i=0}enqueue(g){this._tasks.push(g),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(g){this._idleCallback=void 0;let y=0,d=0,s=g.timeRemaining(),r=0;for(;this._i<this._tasks.length;){if(y=Date.now(),this._tasks[this._i]()||this._i++,y=Math.max(1,Date.now()-y),d=Math.max(y,d),r=g.timeRemaining(),1.5*d>r)return s-y<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(s-y))}ms`),void this._start();s=r}this.clear()}}class a extends p{_requestCallback(g){return setTimeout(()=>g(this._createDeadline(16)))}_cancelCallback(g){clearTimeout(g)}_createDeadline(g){const y=Date.now()+g;return{timeRemaining:()=>Math.max(0,y-Date.now())}}}i.PriorityTaskQueue=a,i.IdleTaskQueue=!h.isNode&&"requestIdleCallback"in window?class extends p{_requestCallback(_){return requestIdleCallback(_)}_cancelCallback(_){cancelIdleCallback(_)}}:a,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(_){this._queue.clear(),this._queue.enqueue(_)}flush(){this._queue.flush()}}},9282:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.updateWindowsModeWrappedState=void 0;const h=o(643);i.updateWindowsModeWrappedState=function(p){const a=p.buffer.lines.get(p.buffer.ybase+p.buffer.y-1),_=a==null?void 0:a.get(p.cols-1),g=p.buffer.lines.get(p.buffer.ybase+p.buffer.y);g&&_&&(g.isWrapped=_[h.CHAR_DATA_CODE_INDEX]!==h.NULL_CELL_CODE&&_[h.CHAR_DATA_CODE_INDEX]!==h.WHITESPACE_CELL_CODE)}},3734:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class o{constructor(){this.fg=0,this.bg=0,this.extended=new h}static toColorRGB(a){return[a>>>16&255,a>>>8&255,255&a]}static fromColorRGB(a){return(255&a[0])<<16|(255&a[1])<<8|255&a[2]}clone(){const a=new o;return a.fg=this.fg,a.bg=this.bg,a.extended=this.extended.clone(),a}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}i.AttributeData=o;class h{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(a){this._ext=a}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(a){this._ext&=-469762049,this._ext|=a<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(a){this._ext&=-67108864,this._ext|=67108863&a}get urlId(){return this._urlId}set urlId(a){this._urlId=a}get underlineVariantOffset(){const a=(3758096384&this._ext)>>29;return a<0?4294967288^a:a}set underlineVariantOffset(a){this._ext&=536870911,this._ext|=a<<29&3758096384}constructor(a=0,_=0){this._ext=0,this._urlId=0,this._ext=a,this._urlId=_}clone(){return new h(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=h},9092:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Buffer=i.MAX_BUFFER_SIZE=void 0;const h=o(6349),p=o(7226),a=o(3734),_=o(8437),g=o(4634),y=o(511),d=o(643),s=o(4863),r=o(7116);i.MAX_BUFFER_SIZE=4294967295,i.Buffer=class{constructor(e,t,l){this._hasScrollback=e,this._optionsService=t,this._bufferService=l,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=_.DEFAULT_ATTR_DATA.clone(),this.savedCharset=r.DEFAULT_CHARSET,this.markers=[],this._nullCell=y.CellData.fromCharData([0,d.NULL_CELL_CHAR,d.NULL_CELL_WIDTH,d.NULL_CELL_CODE]),this._whitespaceCell=y.CellData.fromCharData([0,d.WHITESPACE_CELL_CHAR,d.WHITESPACE_CELL_WIDTH,d.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new p.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(e){return e?(this._nullCell.fg=e.fg,this._nullCell.bg=e.bg,this._nullCell.extended=e.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new a.ExtendedAttrs),this._nullCell}getWhitespaceCell(e){return e?(this._whitespaceCell.fg=e.fg,this._whitespaceCell.bg=e.bg,this._whitespaceCell.extended=e.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new a.ExtendedAttrs),this._whitespaceCell}getBlankLine(e,t){return new _.BufferLine(this._bufferService.cols,this.getNullCell(e),t)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const e=this.ybase+this.y-this.ydisp;return e>=0&&e<this._rows}_getCorrectBufferLength(e){if(!this._hasScrollback)return e;const t=e+this._optionsService.rawOptions.scrollback;return t>i.MAX_BUFFER_SIZE?i.MAX_BUFFER_SIZE:t}fillViewportRows(e){if(this.lines.length===0){e===void 0&&(e=_.DEFAULT_ATTR_DATA);let t=this._rows;for(;t--;)this.lines.push(this.getBlankLine(e))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new h.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(e,t){const l=this.getNullCell(_.DEFAULT_ATTR_DATA);let m=0;const v=this._getCorrectBufferLength(t);if(v>this.lines.maxLength&&(this.lines.maxLength=v),this.lines.length>0){if(this._cols<e)for(let f=0;f<this.lines.length;f++)m+=+this.lines.get(f).resize(e,l);let b=0;if(this._rows<t)for(let f=this._rows;f<t;f++)this.lines.length<t+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new _.BufferLine(e,l)):this.ybase>0&&this.lines.length<=this.ybase+this.y+b+1?(this.ybase--,b++,this.ydisp>0&&this.ydisp--):this.lines.push(new _.BufferLine(e,l)));else for(let f=this._rows;f>t;f--)this.lines.length>t+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(v<this.lines.maxLength){const f=this.lines.length-v;f>0&&(this.lines.trimStart(f),this.ybase=Math.max(this.ybase-f,0),this.ydisp=Math.max(this.ydisp-f,0),this.savedY=Math.max(this.savedY-f,0)),this.lines.maxLength=v}this.x=Math.min(this.x,e-1),this.y=Math.min(this.y,t-1),b&&(this.y+=b),this.savedX=Math.min(this.savedX,e-1),this.scrollTop=0}if(this.scrollBottom=t-1,this._isReflowEnabled&&(this._reflow(e,t),this._cols>e))for(let b=0;b<this.lines.length;b++)m+=+this.lines.get(b).resize(e,l);this._cols=e,this._rows=t,this._memoryCleanupQueue.clear(),m>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let e=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,e=!1);let t=0;for(;this._memoryCleanupPosition<this.lines.length;)if(t+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),t>100)return!0;return e}get _isReflowEnabled(){const e=this._optionsService.rawOptions.windowsPty;return e&&e.buildNumber?this._hasScrollback&&e.backend==="conpty"&&e.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(e,t){this._cols!==e&&(e>this._cols?this._reflowLarger(e,t):this._reflowSmaller(e,t))}_reflowLarger(e,t){const l=(0,g.reflowLargerGetLinesToRemove)(this.lines,this._cols,e,this.ybase+this.y,this.getNullCell(_.DEFAULT_ATTR_DATA));if(l.length>0){const m=(0,g.reflowLargerCreateNewLayout)(this.lines,l);(0,g.reflowLargerApplyNewLayout)(this.lines,m.layout),this._reflowLargerAdjustViewport(e,t,m.countRemoved)}}_reflowLargerAdjustViewport(e,t,l){const m=this.getNullCell(_.DEFAULT_ATTR_DATA);let v=l;for(;v-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<t&&this.lines.push(new _.BufferLine(e,m))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-l,0)}_reflowSmaller(e,t){const l=this.getNullCell(_.DEFAULT_ATTR_DATA),m=[];let v=0;for(let b=this.lines.length-1;b>=0;b--){let f=this.lines.get(b);if(!f||!f.isWrapped&&f.getTrimmedLength()<=e)continue;const w=[f];for(;f.isWrapped&&b>0;)f=this.lines.get(--b),w.unshift(f);const D=this.ybase+this.y;if(D>=b&&D<b+w.length)continue;const T=w[w.length-1].getTrimmedLength(),M=(0,g.reflowSmallerGetNewLineLengths)(w,this._cols,e),L=M.length-w.length;let H;H=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+L):Math.max(0,this.lines.length-this.lines.maxLength+L);const $=[];for(let B=0;B<L;B++){const I=this.getBlankLine(_.DEFAULT_ATTR_DATA,!0);$.push(I)}$.length>0&&(m.push({start:b+w.length+v,newLines:$}),v+=$.length),w.push(...$);let U=M.length-1,G=M[U];G===0&&(U--,G=M[U]);let j=w.length-L-1,k=T;for(;j>=0;){const B=Math.min(k,G);if(w[U]===void 0)break;if(w[U].copyCellsFrom(w[j],k-B,G-B,B,!0),G-=B,G===0&&(U--,G=M[U]),k-=B,k===0){j--;const I=Math.max(j,0);k=(0,g.getWrappedLineTrimmedLength)(w,I,this._cols)}}for(let B=0;B<w.length;B++)M[B]<e&&w[B].setCell(M[B],l);let R=L-H;for(;R-- >0;)this.ybase===0?this.y<t-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+v)-t&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+L,this.ybase+t-1)}if(m.length>0){const b=[],f=[];for(let U=0;U<this.lines.length;U++)f.push(this.lines.get(U));const w=this.lines.length;let D=w-1,T=0,M=m[T];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+v);let L=0;for(let U=Math.min(this.lines.maxLength-1,w+v-1);U>=0;U--)if(M&&M.start>D+L){for(let G=M.newLines.length-1;G>=0;G--)this.lines.set(U--,M.newLines[G]);U++,b.push({index:D+1,amount:M.newLines.length}),L+=M.newLines.length,M=m[++T]}else this.lines.set(U,f[D--]);let H=0;for(let U=b.length-1;U>=0;U--)b[U].index+=H,this.lines.onInsertEmitter.fire(b[U]),H+=b[U].amount;const $=Math.max(0,w+v-this.lines.maxLength);$>0&&this.lines.onTrimEmitter.fire($)}}translateBufferLineToString(e,t,l=0,m){const v=this.lines.get(e);return v?v.translateToString(t,l,m):""}getWrappedRangeForLine(e){let t=e,l=e;for(;t>0&&this.lines.get(t).isWrapped;)t--;for(;l+1<this.lines.length&&this.lines.get(l+1).isWrapped;)l++;return{first:t,last:l}}setupTabStops(e){for(e!=null?this.tabs[e]||(e=this.prevStop(e)):(this.tabs={},e=0);e<this._cols;e+=this._optionsService.rawOptions.tabStopWidth)this.tabs[e]=!0}prevStop(e){for(e==null&&(e=this.x);!this.tabs[--e]&&e>0;);return e>=this._cols?this._cols-1:e<0?0:e}nextStop(e){for(e==null&&(e=this.x);!this.tabs[++e]&&e<this._cols;);return e>=this._cols?this._cols-1:e<0?0:e}clearMarkers(e){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].line===e&&(this.markers[t].dispose(),this.markers.splice(t--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let e=0;e<this.markers.length;e++)this.markers[e].dispose(),this.markers.splice(e--,1);this._isClearing=!1}addMarker(e){const t=new s.Marker(e);return this.markers.push(t),t.register(this.lines.onTrim(l=>{t.line-=l,t.line<0&&t.dispose()})),t.register(this.lines.onInsert(l=>{t.line>=l.index&&(t.line+=l.amount)})),t.register(this.lines.onDelete(l=>{t.line>=l.index&&t.line<l.index+l.amount&&t.dispose(),t.line>l.index&&(t.line-=l.amount)})),t.register(t.onDispose(()=>this._removeMarker(t))),t}_removeMarker(e){this._isClearing||this.markers.splice(this.markers.indexOf(e),1)}}},8437:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLine=i.DEFAULT_ATTR_DATA=void 0;const h=o(3734),p=o(511),a=o(643),_=o(482);i.DEFAULT_ATTR_DATA=Object.freeze(new h.AttributeData);let g=0;class y{constructor(s,r,e=!1){this.isWrapped=e,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*s);const t=r||p.CellData.fromCharData([0,a.NULL_CELL_CHAR,a.NULL_CELL_WIDTH,a.NULL_CELL_CODE]);for(let l=0;l<s;++l)this.setCell(l,t);this.length=s}get(s){const r=this._data[3*s+0],e=2097151&r;return[this._data[3*s+1],2097152&r?this._combined[s]:e?(0,_.stringFromCodePoint)(e):"",r>>22,2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):e]}set(s,r){this._data[3*s+1]=r[a.CHAR_DATA_ATTR_INDEX],r[a.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[s]=r[1],this._data[3*s+0]=2097152|s|r[a.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*s+0]=r[a.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|r[a.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(s){return this._data[3*s+0]>>22}hasWidth(s){return 12582912&this._data[3*s+0]}getFg(s){return this._data[3*s+1]}getBg(s){return this._data[3*s+2]}hasContent(s){return 4194303&this._data[3*s+0]}getCodePoint(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s].charCodeAt(this._combined[s].length-1):2097151&r}isCombined(s){return 2097152&this._data[3*s+0]}getString(s){const r=this._data[3*s+0];return 2097152&r?this._combined[s]:2097151&r?(0,_.stringFromCodePoint)(2097151&r):""}isProtected(s){return 536870912&this._data[3*s+2]}loadCell(s,r){return g=3*s,r.content=this._data[g+0],r.fg=this._data[g+1],r.bg=this._data[g+2],2097152&r.content&&(r.combinedData=this._combined[s]),268435456&r.bg&&(r.extended=this._extendedAttrs[s]),r}setCell(s,r){2097152&r.content&&(this._combined[s]=r.combinedData),268435456&r.bg&&(this._extendedAttrs[s]=r.extended),this._data[3*s+0]=r.content,this._data[3*s+1]=r.fg,this._data[3*s+2]=r.bg}setCellFromCodepoint(s,r,e,t){268435456&t.bg&&(this._extendedAttrs[s]=t.extended),this._data[3*s+0]=r|e<<22,this._data[3*s+1]=t.fg,this._data[3*s+2]=t.bg}addCodepointToCell(s,r,e){let t=this._data[3*s+0];2097152&t?this._combined[s]+=(0,_.stringFromCodePoint)(r):2097151&t?(this._combined[s]=(0,_.stringFromCodePoint)(2097151&t)+(0,_.stringFromCodePoint)(r),t&=-2097152,t|=2097152):t=r|4194304,e&&(t&=-12582913,t|=e<<22),this._data[3*s+0]=t}insertCells(s,r,e){if((s%=this.length)&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length-s){const t=new p.CellData;for(let l=this.length-s-r-1;l>=0;--l)this.setCell(s+r+l,this.loadCell(s+l,t));for(let l=0;l<r;++l)this.setCell(s+l,e)}else for(let t=s;t<this.length;++t)this.setCell(t,e);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,e)}deleteCells(s,r,e){if(s%=this.length,r<this.length-s){const t=new p.CellData;for(let l=0;l<this.length-s-r;++l)this.setCell(s+l,this.loadCell(s+r+l,t));for(let l=this.length-r;l<this.length;++l)this.setCell(l,e)}else for(let t=s;t<this.length;++t)this.setCell(t,e);s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),this.getWidth(s)!==0||this.hasContent(s)||this.setCellFromCodepoint(s,0,1,e)}replaceCells(s,r,e,t=!1){if(t)for(s&&this.getWidth(s-1)===2&&!this.isProtected(s-1)&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&!this.isProtected(r)&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.isProtected(s)||this.setCell(s,e),s++;else for(s&&this.getWidth(s-1)===2&&this.setCellFromCodepoint(s-1,0,1,e),r<this.length&&this.getWidth(r-1)===2&&this.setCellFromCodepoint(r,0,1,e);s<r&&s<this.length;)this.setCell(s++,e)}resize(s,r){if(s===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const e=3*s;if(s>this.length){if(this._data.buffer.byteLength>=4*e)this._data=new Uint32Array(this._data.buffer,0,e);else{const t=new Uint32Array(e);t.set(this._data),this._data=t}for(let t=this.length;t<s;++t)this.setCell(t,r)}else{this._data=this._data.subarray(0,e);const t=Object.keys(this._combined);for(let m=0;m<t.length;m++){const v=parseInt(t[m],10);v>=s&&delete this._combined[v]}const l=Object.keys(this._extendedAttrs);for(let m=0;m<l.length;m++){const v=parseInt(l[m],10);v>=s&&delete this._extendedAttrs[v]}}return this.length=s,4*e*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const s=new Uint32Array(this._data.length);return s.set(this._data),this._data=s,1}return 0}fill(s,r=!1){if(r)for(let e=0;e<this.length;++e)this.isProtected(e)||this.setCell(e,s);else{this._combined={},this._extendedAttrs={};for(let e=0;e<this.length;++e)this.setCell(e,s)}}copyFrom(s){this.length!==s.length?this._data=new Uint32Array(s._data):this._data.set(s._data),this.length=s.length,this._combined={};for(const r in s._combined)this._combined[r]=s._combined[r];this._extendedAttrs={};for(const r in s._extendedAttrs)this._extendedAttrs[r]=s._extendedAttrs[r];this.isWrapped=s.isWrapped}clone(){const s=new y(0);s._data=new Uint32Array(this._data),s.length=this.length;for(const r in this._combined)s._combined[r]=this._combined[r];for(const r in this._extendedAttrs)s._extendedAttrs[r]=this._extendedAttrs[r];return s.isWrapped=this.isWrapped,s}getTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0])return s+(this._data[3*s+0]>>22);return 0}getNoBgTrimmedLength(){for(let s=this.length-1;s>=0;--s)if(4194303&this._data[3*s+0]||50331648&this._data[3*s+2])return s+(this._data[3*s+0]>>22);return 0}copyCellsFrom(s,r,e,t,l){const m=s._data;if(l)for(let b=t-1;b>=0;b--){for(let f=0;f<3;f++)this._data[3*(e+b)+f]=m[3*(r+b)+f];268435456&m[3*(r+b)+2]&&(this._extendedAttrs[e+b]=s._extendedAttrs[r+b])}else for(let b=0;b<t;b++){for(let f=0;f<3;f++)this._data[3*(e+b)+f]=m[3*(r+b)+f];268435456&m[3*(r+b)+2]&&(this._extendedAttrs[e+b]=s._extendedAttrs[r+b])}const v=Object.keys(s._combined);for(let b=0;b<v.length;b++){const f=parseInt(v[b],10);f>=r&&(this._combined[f-r+e]=s._combined[f])}}translateToString(s,r,e,t){r=r??0,e=e??this.length,s&&(e=Math.min(e,this.getTrimmedLength())),t&&(t.length=0);let l="";for(;r<e;){const m=this._data[3*r+0],v=2097151&m,b=2097152&m?this._combined[r]:v?(0,_.stringFromCodePoint)(v):a.WHITESPACE_CELL_CHAR;if(l+=b,t)for(let f=0;f<b.length;++f)t.push(r);r+=m>>22||1}return t&&t.push(r),l}}i.BufferLine=y},4841:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getRangeLength=void 0,i.getRangeLength=function(o,h){if(o.start.y>o.end.y)throw new Error(`Buffer range end (${o.end.x}, ${o.end.y}) cannot be before start (${o.start.x}, ${o.start.y})`);return h*(o.end.y-o.start.y)+(o.end.x-o.start.x+1)}},4634:(x,i)=>{function o(h,p,a){if(p===h.length-1)return h[p].getTrimmedLength();const _=!h[p].hasContent(a-1)&&h[p].getWidth(a-1)===1,g=h[p+1].getWidth(0)===2;return _&&g?a-1:a}Object.defineProperty(i,"__esModule",{value:!0}),i.getWrappedLineTrimmedLength=i.reflowSmallerGetNewLineLengths=i.reflowLargerApplyNewLayout=i.reflowLargerCreateNewLayout=i.reflowLargerGetLinesToRemove=void 0,i.reflowLargerGetLinesToRemove=function(h,p,a,_,g){const y=[];for(let d=0;d<h.length-1;d++){let s=d,r=h.get(++s);if(!r.isWrapped)continue;const e=[h.get(d)];for(;s<h.length&&r.isWrapped;)e.push(r),r=h.get(++s);if(_>=d&&_<s){d+=e.length-1;continue}let t=0,l=o(e,t,p),m=1,v=0;for(;m<e.length;){const f=o(e,m,p),w=f-v,D=a-l,T=Math.min(w,D);e[t].copyCellsFrom(e[m],v,l,T,!1),l+=T,l===a&&(t++,l=0),v+=T,v===f&&(m++,v=0),l===0&&t!==0&&e[t-1].getWidth(a-1)===2&&(e[t].copyCellsFrom(e[t-1],a-1,l++,1,!1),e[t-1].setCell(a-1,g))}e[t].replaceCells(l,a,g);let b=0;for(let f=e.length-1;f>0&&(f>t||e[f].getTrimmedLength()===0);f--)b++;b>0&&(y.push(d+e.length-b),y.push(b)),d+=e.length-1}return y},i.reflowLargerCreateNewLayout=function(h,p){const a=[];let _=0,g=p[_],y=0;for(let d=0;d<h.length;d++)if(g===d){const s=p[++_];h.onDeleteEmitter.fire({index:d-y,amount:s}),d+=s-1,y+=s,g=p[++_]}else a.push(d);return{layout:a,countRemoved:y}},i.reflowLargerApplyNewLayout=function(h,p){const a=[];for(let _=0;_<p.length;_++)a.push(h.get(p[_]));for(let _=0;_<a.length;_++)h.set(_,a[_]);h.length=p.length},i.reflowSmallerGetNewLineLengths=function(h,p,a){const _=[],g=h.map((r,e)=>o(h,e,p)).reduce((r,e)=>r+e);let y=0,d=0,s=0;for(;s<g;){if(g-s<a){_.push(g-s);break}y+=a;const r=o(h,d,p);y>r&&(y-=r,d++);const e=h[d].getWidth(y-1)===2;e&&y--;const t=e?a-1:a;_.push(t),s+=t}return _},i.getWrappedLineTrimmedLength=o},5295:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferSet=void 0;const h=o(8460),p=o(844),a=o(9092);class _ extends p.Disposable{constructor(y,d){super(),this._optionsService=y,this._bufferService=d,this._onBufferActivate=this.register(new h.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new a.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new a.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(y){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(y),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(y,d){this._normal.resize(y,d),this._alt.resize(y,d),this.setupTabStops(y)}setupTabStops(y){this._normal.setupTabStops(y),this._alt.setupTabStops(y)}}i.BufferSet=_},511:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;const h=o(482),p=o(643),a=o(3734);class _ extends a.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new a.ExtendedAttrs,this.combinedData=""}static fromCharData(y){const d=new _;return d.setFromCharData(y),d}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,h.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(y){this.fg=y[p.CHAR_DATA_ATTR_INDEX],this.bg=0;let d=!1;if(y[p.CHAR_DATA_CHAR_INDEX].length>2)d=!0;else if(y[p.CHAR_DATA_CHAR_INDEX].length===2){const s=y[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=s&&s<=56319){const r=y[p.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=r&&r<=57343?this.content=1024*(s-55296)+r-56320+65536|y[p.CHAR_DATA_WIDTH_INDEX]<<22:d=!0}else d=!0}else this.content=y[p.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|y[p.CHAR_DATA_WIDTH_INDEX]<<22;d&&(this.combinedData=y[p.CHAR_DATA_CHAR_INDEX],this.content=2097152|y[p.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=_},643:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},4863:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Marker=void 0;const h=o(8460),p=o(844);class a{get id(){return this._id}constructor(g){this.line=g,this.isDisposed=!1,this._disposables=[],this._id=a._nextId++,this._onDispose=this.register(new h.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,p.disposeArray)(this._disposables),this._disposables.length=0)}register(g){return this._disposables.push(g),g}}i.Marker=a,a._nextId=1},7116:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_CHARSET=i.CHARSETS=void 0,i.CHARSETS={},i.DEFAULT_CHARSET=i.CHARSETS.B,i.CHARSETS[0]={"`":"â",a:"â",b:"â",c:"â",d:"â",e:"â",f:"Â°",g:"Â±",h:"â¤",i:"â",j:"â",k:"â",l:"â",m:"â",n:"â¼",o:"âº",p:"â»",q:"â",r:"â¼",s:"â½",t:"â",u:"â¤",v:"â´",w:"â¬",x:"â",y:"â¤",z:"â¥","{":"Ï","|":"â ","}":"Â£","~":"Â·"},i.CHARSETS.A={"#":"Â£"},i.CHARSETS.B=void 0,i.CHARSETS[4]={"#":"Â£","@":"Â¾","[":"ij","\\":"Â½","]":"|","{":"Â¨","|":"f","}":"Â¼","~":"Â´"},i.CHARSETS.C=i.CHARSETS[5]={"[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},i.CHARSETS.R={"#":"Â£","@":"Ã ","[":"Â°","\\":"Ã§","]":"Â§","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Â¨"},i.CHARSETS.Q={"@":"Ã ","[":"Ã¢","\\":"Ã§","]":"Ãª","^":"Ã®","`":"Ã´","{":"Ã©","|":"Ã¹","}":"Ã¨","~":"Ã»"},i.CHARSETS.K={"@":"Â§","[":"Ã","\\":"Ã","]":"Ã","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã"},i.CHARSETS.Y={"#":"Â£","@":"Â§","[":"Â°","\\":"Ã§","]":"Ã©","`":"Ã¹","{":"Ã ","|":"Ã²","}":"Ã¨","~":"Ã¬"},i.CHARSETS.E=i.CHARSETS[6]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã¤","{":"Ã¦","|":"Ã¸","}":"Ã¥","~":"Ã¼"},i.CHARSETS.Z={"#":"Â£","@":"Â§","[":"Â¡","\\":"Ã","]":"Â¿","{":"Â°","|":"Ã±","}":"Ã§"},i.CHARSETS.H=i.CHARSETS[7]={"@":"Ã","[":"Ã","\\":"Ã","]":"Ã","^":"Ã","`":"Ã©","{":"Ã¤","|":"Ã¶","}":"Ã¥","~":"Ã¼"},i.CHARSETS["="]={"#":"Ã¹","@":"Ã ","[":"Ã©","\\":"Ã§","]":"Ãª","^":"Ã®",_:"Ã¨","`":"Ã´","{":"Ã¤","|":"Ã¶","}":"Ã¼","~":"Ã»"}},2584:(x,i)=>{var o,h,p;Object.defineProperty(i,"__esModule",{value:!0}),i.C1_ESCAPED=i.C1=i.C0=void 0,function(a){a.NUL="\0",a.SOH="",a.STX="",a.ETX="",a.EOT="",a.ENQ="",a.ACK="",a.BEL="\x07",a.BS="\b",a.HT="	",a.LF=`
`,a.VT="\v",a.FF="\f",a.CR="\r",a.SO="",a.SI="",a.DLE="",a.DC1="",a.DC2="",a.DC3="",a.DC4="",a.NAK="",a.SYN="",a.ETB="",a.CAN="",a.EM="",a.SUB="",a.ESC="\x1B",a.FS="",a.GS="",a.RS="",a.US="",a.SP=" ",a.DEL=""}(o||(i.C0=o={})),function(a){a.PAD="Â",a.HOP="Â",a.BPH="Â",a.NBH="Â",a.IND="Â",a.NEL="Â",a.SSA="Â",a.ESA="Â",a.HTS="Â",a.HTJ="Â",a.VTS="Â",a.PLD="Â",a.PLU="Â",a.RI="Â",a.SS2="Â",a.SS3="Â",a.DCS="Â",a.PU1="Â",a.PU2="Â",a.STS="Â",a.CCH="Â",a.MW="Â",a.SPA="Â",a.EPA="Â",a.SOS="Â",a.SGCI="Â",a.SCI="Â",a.CSI="Â",a.ST="Â",a.OSC="Â",a.PM="Â",a.APC="Â"}(h||(i.C1=h={})),function(a){a.ST=`${o.ESC}\\`}(p||(i.C1_ESCAPED=p={}))},7399:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateKeyboardEvent=void 0;const h=o(2584),p={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};i.evaluateKeyboardEvent=function(a,_,g,y){const d={type:0,cancel:!1,key:void 0},s=(a.shiftKey?1:0)|(a.altKey?2:0)|(a.ctrlKey?4:0)|(a.metaKey?8:0);switch(a.keyCode){case 0:a.key==="UIKeyInputUpArrow"?d.key=_?h.C0.ESC+"OA":h.C0.ESC+"[A":a.key==="UIKeyInputLeftArrow"?d.key=_?h.C0.ESC+"OD":h.C0.ESC+"[D":a.key==="UIKeyInputRightArrow"?d.key=_?h.C0.ESC+"OC":h.C0.ESC+"[C":a.key==="UIKeyInputDownArrow"&&(d.key=_?h.C0.ESC+"OB":h.C0.ESC+"[B");break;case 8:d.key=a.ctrlKey?"\b":h.C0.DEL,a.altKey&&(d.key=h.C0.ESC+d.key);break;case 9:if(a.shiftKey){d.key=h.C0.ESC+"[Z";break}d.key=h.C0.HT,d.cancel=!0;break;case 13:d.key=a.altKey?h.C0.ESC+h.C0.CR:h.C0.CR,d.cancel=!0;break;case 27:d.key=h.C0.ESC,a.altKey&&(d.key=h.C0.ESC+h.C0.ESC),d.cancel=!0;break;case 37:if(a.metaKey)break;s?(d.key=h.C0.ESC+"[1;"+(s+1)+"D",d.key===h.C0.ESC+"[1;3D"&&(d.key=h.C0.ESC+(g?"b":"[1;5D"))):d.key=_?h.C0.ESC+"OD":h.C0.ESC+"[D";break;case 39:if(a.metaKey)break;s?(d.key=h.C0.ESC+"[1;"+(s+1)+"C",d.key===h.C0.ESC+"[1;3C"&&(d.key=h.C0.ESC+(g?"f":"[1;5C"))):d.key=_?h.C0.ESC+"OC":h.C0.ESC+"[C";break;case 38:if(a.metaKey)break;s?(d.key=h.C0.ESC+"[1;"+(s+1)+"A",g||d.key!==h.C0.ESC+"[1;3A"||(d.key=h.C0.ESC+"[1;5A")):d.key=_?h.C0.ESC+"OA":h.C0.ESC+"[A";break;case 40:if(a.metaKey)break;s?(d.key=h.C0.ESC+"[1;"+(s+1)+"B",g||d.key!==h.C0.ESC+"[1;3B"||(d.key=h.C0.ESC+"[1;5B")):d.key=_?h.C0.ESC+"OB":h.C0.ESC+"[B";break;case 45:a.shiftKey||a.ctrlKey||(d.key=h.C0.ESC+"[2~");break;case 46:d.key=s?h.C0.ESC+"[3;"+(s+1)+"~":h.C0.ESC+"[3~";break;case 36:d.key=s?h.C0.ESC+"[1;"+(s+1)+"H":_?h.C0.ESC+"OH":h.C0.ESC+"[H";break;case 35:d.key=s?h.C0.ESC+"[1;"+(s+1)+"F":_?h.C0.ESC+"OF":h.C0.ESC+"[F";break;case 33:a.shiftKey?d.type=2:a.ctrlKey?d.key=h.C0.ESC+"[5;"+(s+1)+"~":d.key=h.C0.ESC+"[5~";break;case 34:a.shiftKey?d.type=3:a.ctrlKey?d.key=h.C0.ESC+"[6;"+(s+1)+"~":d.key=h.C0.ESC+"[6~";break;case 112:d.key=s?h.C0.ESC+"[1;"+(s+1)+"P":h.C0.ESC+"OP";break;case 113:d.key=s?h.C0.ESC+"[1;"+(s+1)+"Q":h.C0.ESC+"OQ";break;case 114:d.key=s?h.C0.ESC+"[1;"+(s+1)+"R":h.C0.ESC+"OR";break;case 115:d.key=s?h.C0.ESC+"[1;"+(s+1)+"S":h.C0.ESC+"OS";break;case 116:d.key=s?h.C0.ESC+"[15;"+(s+1)+"~":h.C0.ESC+"[15~";break;case 117:d.key=s?h.C0.ESC+"[17;"+(s+1)+"~":h.C0.ESC+"[17~";break;case 118:d.key=s?h.C0.ESC+"[18;"+(s+1)+"~":h.C0.ESC+"[18~";break;case 119:d.key=s?h.C0.ESC+"[19;"+(s+1)+"~":h.C0.ESC+"[19~";break;case 120:d.key=s?h.C0.ESC+"[20;"+(s+1)+"~":h.C0.ESC+"[20~";break;case 121:d.key=s?h.C0.ESC+"[21;"+(s+1)+"~":h.C0.ESC+"[21~";break;case 122:d.key=s?h.C0.ESC+"[23;"+(s+1)+"~":h.C0.ESC+"[23~";break;case 123:d.key=s?h.C0.ESC+"[24;"+(s+1)+"~":h.C0.ESC+"[24~";break;default:if(!a.ctrlKey||a.shiftKey||a.altKey||a.metaKey)if(g&&!y||!a.altKey||a.metaKey)!g||a.altKey||a.ctrlKey||a.shiftKey||!a.metaKey?a.key&&!a.ctrlKey&&!a.altKey&&!a.metaKey&&a.keyCode>=48&&a.key.length===1?d.key=a.key:a.key&&a.ctrlKey&&(a.key==="_"&&(d.key=h.C0.US),a.key==="@"&&(d.key=h.C0.NUL)):a.keyCode===65&&(d.type=1);else{const r=p[a.keyCode],e=r==null?void 0:r[a.shiftKey?1:0];if(e)d.key=h.C0.ESC+e;else if(a.keyCode>=65&&a.keyCode<=90){const t=a.ctrlKey?a.keyCode-64:a.keyCode+32;let l=String.fromCharCode(t);a.shiftKey&&(l=l.toUpperCase()),d.key=h.C0.ESC+l}else if(a.keyCode===32)d.key=h.C0.ESC+(a.ctrlKey?h.C0.NUL:" ");else if(a.key==="Dead"&&a.code.startsWith("Key")){let t=a.code.slice(3,4);a.shiftKey||(t=t.toLowerCase()),d.key=h.C0.ESC+t,d.cancel=!0}}else a.keyCode>=65&&a.keyCode<=90?d.key=String.fromCharCode(a.keyCode-64):a.keyCode===32?d.key=h.C0.NUL:a.keyCode>=51&&a.keyCode<=55?d.key=String.fromCharCode(a.keyCode-51+27):a.keyCode===56?d.key=h.C0.DEL:a.keyCode===219?d.key=h.C0.ESC:a.keyCode===220?d.key=h.C0.FS:a.keyCode===221&&(d.key=h.C0.GS)}return d}},482:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(o){return o>65535?(o-=65536,String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):String.fromCharCode(o)},i.utf32ToString=function(o,h=0,p=o.length){let a="";for(let _=h;_<p;++_){let g=o[_];g>65535?(g-=65536,a+=String.fromCharCode(55296+(g>>10))+String.fromCharCode(g%1024+56320)):a+=String.fromCharCode(g)}return a},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(o,h){const p=o.length;if(!p)return 0;let a=0,_=0;if(this._interim){const g=o.charCodeAt(_++);56320<=g&&g<=57343?h[a++]=1024*(this._interim-55296)+g-56320+65536:(h[a++]=this._interim,h[a++]=g),this._interim=0}for(let g=_;g<p;++g){const y=o.charCodeAt(g);if(55296<=y&&y<=56319){if(++g>=p)return this._interim=y,a;const d=o.charCodeAt(g);56320<=d&&d<=57343?h[a++]=1024*(y-55296)+d-56320+65536:(h[a++]=y,h[a++]=d)}else y!==65279&&(h[a++]=y)}return a}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(o,h){const p=o.length;if(!p)return 0;let a,_,g,y,d=0,s=0,r=0;if(this.interim[0]){let l=!1,m=this.interim[0];m&=(224&m)==192?31:(240&m)==224?15:7;let v,b=0;for(;(v=63&this.interim[++b])&&b<4;)m<<=6,m|=v;const f=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,w=f-b;for(;r<w;){if(r>=p)return 0;if(v=o[r++],(192&v)!=128){r--,l=!0;break}this.interim[b++]=v,m<<=6,m|=63&v}l||(f===2?m<128?r--:h[d++]=m:f===3?m<2048||m>=55296&&m<=57343||m===65279||(h[d++]=m):m<65536||m>1114111||(h[d++]=m)),this.interim.fill(0)}const e=p-4;let t=r;for(;t<p;){for(;!(!(t<e)||128&(a=o[t])||128&(_=o[t+1])||128&(g=o[t+2])||128&(y=o[t+3]));)h[d++]=a,h[d++]=_,h[d++]=g,h[d++]=y,t+=4;if(a=o[t++],a<128)h[d++]=a;else if((224&a)==192){if(t>=p)return this.interim[0]=a,d;if(_=o[t++],(192&_)!=128){t--;continue}if(s=(31&a)<<6|63&_,s<128){t--;continue}h[d++]=s}else if((240&a)==224){if(t>=p)return this.interim[0]=a,d;if(_=o[t++],(192&_)!=128){t--;continue}if(t>=p)return this.interim[0]=a,this.interim[1]=_,d;if(g=o[t++],(192&g)!=128){t--;continue}if(s=(15&a)<<12|(63&_)<<6|63&g,s<2048||s>=55296&&s<=57343||s===65279)continue;h[d++]=s}else if((248&a)==240){if(t>=p)return this.interim[0]=a,d;if(_=o[t++],(192&_)!=128){t--;continue}if(t>=p)return this.interim[0]=a,this.interim[1]=_,d;if(g=o[t++],(192&g)!=128){t--;continue}if(t>=p)return this.interim[0]=a,this.interim[1]=_,this.interim[2]=g,d;if(y=o[t++],(192&y)!=128){t--;continue}if(s=(7&a)<<18|(63&_)<<12|(63&g)<<6|63&y,s<65536||s>1114111)continue;h[d++]=s}}return d}}},225:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeV6=void 0;const h=o(1480),p=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],a=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let _;i.UnicodeV6=class{constructor(){if(this.version="6",!_){_=new Uint8Array(65536),_.fill(1),_[0]=0,_.fill(0,1,32),_.fill(0,127,160),_.fill(2,4352,4448),_[9001]=2,_[9002]=2,_.fill(2,11904,42192),_[12351]=1,_.fill(2,44032,55204),_.fill(2,63744,64256),_.fill(2,65040,65050),_.fill(2,65072,65136),_.fill(2,65280,65377),_.fill(2,65504,65511);for(let g=0;g<p.length;++g)_.fill(0,p[g][0],p[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?_[g]:function(y,d){let s,r=0,e=d.length-1;if(y<d[0][0]||y>d[e][1])return!1;for(;e>=r;)if(s=r+e>>1,y>d[s][1])r=s+1;else{if(!(y<d[s][0]))return!0;e=s-1}return!1}(g,a)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,y){let d=this.wcwidth(g),s=d===0&&y!==0;if(s){const r=h.UnicodeService.extractWidth(y);r===0?s=!1:r>d&&(d=r)}return h.UnicodeService.createPropertyValue(0,d,s)}}},5981:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WriteBuffer=void 0;const h=o(8460),p=o(844);class a extends p.Disposable{constructor(g){super(),this._action=g,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new h.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(g,y){if(y!==void 0&&this._syncCalls>y)return void(this._syncCalls=0);if(this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let d;for(this._isSyncWriting=!0;d=this._writeBuffer.shift();){this._action(d);const s=this._callbacks.shift();s&&s()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(g,y){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(y),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=g.length,this._writeBuffer.push(g),this._callbacks.push(y)}_innerWrite(g=0,y=!0){const d=g||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const s=this._writeBuffer[this._bufferOffset],r=this._action(s,y);if(r){const t=l=>Date.now()-d>=12?setTimeout(()=>this._innerWrite(0,l)):this._innerWrite(d,l);return void r.catch(l=>(queueMicrotask(()=>{throw l}),Promise.resolve(!1))).then(t)}const e=this._callbacks[this._bufferOffset];if(e&&e(),this._bufferOffset++,this._pendingData-=s.length,Date.now()-d>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}i.WriteBuffer=a},5941:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.toRgbString=i.parseColor=void 0;const o=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,h=/^[\da-f]+$/;function p(a,_){const g=a.toString(16),y=g.length<2?"0"+g:g;switch(_){case 4:return g[0];case 8:return y;case 12:return(y+y).slice(0,3);default:return y+y}}i.parseColor=function(a){if(!a)return;let _=a.toLowerCase();if(_.indexOf("rgb:")===0){_=_.slice(4);const g=o.exec(_);if(g){const y=g[1]?15:g[4]?255:g[7]?4095:65535;return[Math.round(parseInt(g[1]||g[4]||g[7]||g[10],16)/y*255),Math.round(parseInt(g[2]||g[5]||g[8]||g[11],16)/y*255),Math.round(parseInt(g[3]||g[6]||g[9]||g[12],16)/y*255)]}}else if(_.indexOf("#")===0&&(_=_.slice(1),h.exec(_)&&[3,6,9,12].includes(_.length))){const g=_.length/3,y=[0,0,0];for(let d=0;d<3;++d){const s=parseInt(_.slice(g*d,g*d+g),16);y[d]=g===1?s<<4:g===2?s:g===3?s>>4:s>>8}return y}},i.toRgbString=function(a,_=16){const[g,y,d]=a;return`rgb:${p(g,_)}/${p(y,_)}/${p(d,_)}`}},5770:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PAYLOAD_LIMIT=void 0,i.PAYLOAD_LIMIT=1e7},6351:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DcsHandler=i.DcsParser=void 0;const h=o(482),p=o(8742),a=o(5770),_=[];i.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=_,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=_}registerHandler(y,d){this._handlers[y]===void 0&&(this._handlers[y]=[]);const s=this._handlers[y];return s.push(d),{dispose:()=>{const r=s.indexOf(d);r!==-1&&s.splice(r,1)}}}clearHandler(y){this._handlers[y]&&delete this._handlers[y]}setHandlerFallback(y){this._handlerFb=y}reset(){if(this._active.length)for(let y=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;y>=0;--y)this._active[y].unhook(!1);this._stack.paused=!1,this._active=_,this._ident=0}hook(y,d){if(this.reset(),this._ident=y,this._active=this._handlers[y]||_,this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].hook(d);else this._handlerFb(this._ident,"HOOK",d)}put(y,d,s){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(y,d,s);else this._handlerFb(this._ident,"PUT",(0,h.utf32ToString)(y,d,s))}unhook(y,d=!0){if(this._active.length){let s=!1,r=this._active.length-1,e=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,s=d,e=this._stack.fallThrough,this._stack.paused=!1),!e&&s===!1){for(;r>=0&&(s=this._active[r].unhook(y),s!==!0);r--)if(s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,s;r--}for(;r>=0;r--)if(s=this._active[r].unhook(!1),s instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,s}else this._handlerFb(this._ident,"UNHOOK",y);this._active=_,this._ident=0}};const g=new p.Params;g.addParam(0),i.DcsHandler=class{constructor(y){this._handler=y,this._data="",this._params=g,this._hitLimit=!1}hook(y){this._params=y.length>1||y.params[0]?y.clone():g,this._data="",this._hitLimit=!1}put(y,d,s){this._hitLimit||(this._data+=(0,h.utf32ToString)(y,d,s),this._data.length>a.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(y){let d=!1;if(this._hitLimit)d=!1;else if(y&&(d=this._handler(this._data,this._params),d instanceof Promise))return d.then(s=>(this._params=g,this._data="",this._hitLimit=!1,s));return this._params=g,this._data="",this._hitLimit=!1,d}}},2015:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.EscapeSequenceParser=i.VT500_TRANSITION_TABLE=i.TransitionTable=void 0;const h=o(844),p=o(8742),a=o(6242),_=o(6351);class g{constructor(r){this.table=new Uint8Array(r)}setDefault(r,e){this.table.fill(r<<4|e)}add(r,e,t,l){this.table[e<<8|r]=t<<4|l}addMany(r,e,t,l){for(let m=0;m<r.length;m++)this.table[e<<8|r[m]]=t<<4|l}}i.TransitionTable=g;const y=160;i.VT500_TRANSITION_TABLE=function(){const s=new g(4095),r=Array.apply(null,Array(256)).map((b,f)=>f),e=(b,f)=>r.slice(b,f),t=e(32,127),l=e(0,24);l.push(25),l.push.apply(l,e(28,32));const m=e(0,14);let v;for(v in s.setDefault(1,0),s.addMany(t,0,2,0),m)s.addMany([24,26,153,154],v,3,0),s.addMany(e(128,144),v,3,0),s.addMany(e(144,152),v,3,0),s.add(156,v,0,0),s.add(27,v,11,1),s.add(157,v,4,8),s.addMany([152,158,159],v,0,7),s.add(155,v,11,3),s.add(144,v,11,9);return s.addMany(l,0,3,0),s.addMany(l,1,3,1),s.add(127,1,0,1),s.addMany(l,8,0,8),s.addMany(l,3,3,3),s.add(127,3,0,3),s.addMany(l,4,3,4),s.add(127,4,0,4),s.addMany(l,6,3,6),s.addMany(l,5,3,5),s.add(127,5,0,5),s.addMany(l,2,3,2),s.add(127,2,0,2),s.add(93,1,4,8),s.addMany(t,8,5,8),s.add(127,8,5,8),s.addMany([156,27,24,26,7],8,6,0),s.addMany(e(28,32),8,0,8),s.addMany([88,94,95],1,0,7),s.addMany(t,7,0,7),s.addMany(l,7,0,7),s.add(156,7,0,0),s.add(127,7,0,7),s.add(91,1,11,3),s.addMany(e(64,127),3,7,0),s.addMany(e(48,60),3,8,4),s.addMany([60,61,62,63],3,9,4),s.addMany(e(48,60),4,8,4),s.addMany(e(64,127),4,7,0),s.addMany([60,61,62,63],4,0,6),s.addMany(e(32,64),6,0,6),s.add(127,6,0,6),s.addMany(e(64,127),6,0,0),s.addMany(e(32,48),3,9,5),s.addMany(e(32,48),5,9,5),s.addMany(e(48,64),5,0,6),s.addMany(e(64,127),5,7,0),s.addMany(e(32,48),4,9,5),s.addMany(e(32,48),1,9,2),s.addMany(e(32,48),2,9,2),s.addMany(e(48,127),2,10,0),s.addMany(e(48,80),1,10,0),s.addMany(e(81,88),1,10,0),s.addMany([89,90,92],1,10,0),s.addMany(e(96,127),1,10,0),s.add(80,1,11,9),s.addMany(l,9,0,9),s.add(127,9,0,9),s.addMany(e(28,32),9,0,9),s.addMany(e(32,48),9,9,12),s.addMany(e(48,60),9,8,10),s.addMany([60,61,62,63],9,9,10),s.addMany(l,11,0,11),s.addMany(e(32,128),11,0,11),s.addMany(e(28,32),11,0,11),s.addMany(l,10,0,10),s.add(127,10,0,10),s.addMany(e(28,32),10,0,10),s.addMany(e(48,60),10,8,10),s.addMany([60,61,62,63],10,0,11),s.addMany(e(32,48),10,9,12),s.addMany(l,12,0,12),s.add(127,12,0,12),s.addMany(e(28,32),12,0,12),s.addMany(e(32,48),12,9,12),s.addMany(e(48,64),12,0,11),s.addMany(e(64,127),12,12,13),s.addMany(e(64,127),10,12,13),s.addMany(e(64,127),9,12,13),s.addMany(l,13,13,13),s.addMany(t,13,13,13),s.add(127,13,0,13),s.addMany([27,156,24,26],13,14,0),s.add(y,0,2,0),s.add(y,8,5,8),s.add(y,6,0,6),s.add(y,11,0,11),s.add(y,13,13,13),s}();class d extends h.Disposable{constructor(r=i.VT500_TRANSITION_TABLE){super(),this._transitions=r,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new p.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(e,t,l)=>{},this._executeHandlerFb=e=>{},this._csiHandlerFb=(e,t)=>{},this._escHandlerFb=e=>{},this._errorHandlerFb=e=>e,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,h.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new a.OscParser),this._dcsParser=this.register(new _.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(r,e=[64,126]){let t=0;if(r.prefix){if(r.prefix.length>1)throw new Error("only one byte as prefix supported");if(t=r.prefix.charCodeAt(0),t&&60>t||t>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(r.intermediates){if(r.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let m=0;m<r.intermediates.length;++m){const v=r.intermediates.charCodeAt(m);if(32>v||v>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");t<<=8,t|=v}}if(r.final.length!==1)throw new Error("final must be a single byte");const l=r.final.charCodeAt(0);if(e[0]>l||l>e[1])throw new Error(`final must be in range ${e[0]} .. ${e[1]}`);return t<<=8,t|=l,t}identToString(r){const e=[];for(;r;)e.push(String.fromCharCode(255&r)),r>>=8;return e.reverse().join("")}setPrintHandler(r){this._printHandler=r}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(r,e){const t=this._identifier(r,[48,126]);this._escHandlers[t]===void 0&&(this._escHandlers[t]=[]);const l=this._escHandlers[t];return l.push(e),{dispose:()=>{const m=l.indexOf(e);m!==-1&&l.splice(m,1)}}}clearEscHandler(r){this._escHandlers[this._identifier(r,[48,126])]&&delete this._escHandlers[this._identifier(r,[48,126])]}setEscHandlerFallback(r){this._escHandlerFb=r}setExecuteHandler(r,e){this._executeHandlers[r.charCodeAt(0)]=e}clearExecuteHandler(r){this._executeHandlers[r.charCodeAt(0)]&&delete this._executeHandlers[r.charCodeAt(0)]}setExecuteHandlerFallback(r){this._executeHandlerFb=r}registerCsiHandler(r,e){const t=this._identifier(r);this._csiHandlers[t]===void 0&&(this._csiHandlers[t]=[]);const l=this._csiHandlers[t];return l.push(e),{dispose:()=>{const m=l.indexOf(e);m!==-1&&l.splice(m,1)}}}clearCsiHandler(r){this._csiHandlers[this._identifier(r)]&&delete this._csiHandlers[this._identifier(r)]}setCsiHandlerFallback(r){this._csiHandlerFb=r}registerDcsHandler(r,e){return this._dcsParser.registerHandler(this._identifier(r),e)}clearDcsHandler(r){this._dcsParser.clearHandler(this._identifier(r))}setDcsHandlerFallback(r){this._dcsParser.setHandlerFallback(r)}registerOscHandler(r,e){return this._oscParser.registerHandler(r,e)}clearOscHandler(r){this._oscParser.clearHandler(r)}setOscHandlerFallback(r){this._oscParser.setHandlerFallback(r)}setErrorHandler(r){this._errorHandler=r}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(r,e,t,l,m){this._parseStack.state=r,this._parseStack.handlers=e,this._parseStack.handlerPos=t,this._parseStack.transition=l,this._parseStack.chunkPos=m}parse(r,e,t){let l,m=0,v=0,b=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,b=this._parseStack.chunkPos+1;else{if(t===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const f=this._parseStack.handlers;let w=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(t===!1&&w>-1){for(;w>=0&&(l=f[w](this._params),l!==!0);w--)if(l instanceof Promise)return this._parseStack.handlerPos=w,l}this._parseStack.handlers=[];break;case 4:if(t===!1&&w>-1){for(;w>=0&&(l=f[w](),l!==!0);w--)if(l instanceof Promise)return this._parseStack.handlerPos=w,l}this._parseStack.handlers=[];break;case 6:if(m=r[this._parseStack.chunkPos],l=this._dcsParser.unhook(m!==24&&m!==26,t),l)return l;m===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(m=r[this._parseStack.chunkPos],l=this._oscParser.end(m!==24&&m!==26,t),l)return l;m===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,b=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let f=b;f<e;++f){switch(m=r[f],v=this._transitions.table[this.currentState<<8|(m<160?m:y)],v>>4){case 2:for(let L=f+1;;++L){if(L>=e||(m=r[L])<32||m>126&&m<y){this._printHandler(r,f,L),f=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<y){this._printHandler(r,f,L),f=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<y){this._printHandler(r,f,L),f=L-1;break}if(++L>=e||(m=r[L])<32||m>126&&m<y){this._printHandler(r,f,L),f=L-1;break}}break;case 3:this._executeHandlers[m]?this._executeHandlers[m]():this._executeHandlerFb(m),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:f,code:m,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const w=this._csiHandlers[this._collect<<8|m];let D=w?w.length-1:-1;for(;D>=0&&(l=w[D](this._params),l!==!0);D--)if(l instanceof Promise)return this._preserveStack(3,w,D,v,f),l;D<0&&this._csiHandlerFb(this._collect<<8|m,this._params),this.precedingJoinState=0;break;case 8:do switch(m){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(m-48)}while(++f<e&&(m=r[f])>47&&m<60);f--;break;case 9:this._collect<<=8,this._collect|=m;break;case 10:const T=this._escHandlers[this._collect<<8|m];let M=T?T.length-1:-1;for(;M>=0&&(l=T[M](),l!==!0);M--)if(l instanceof Promise)return this._preserveStack(4,T,M,v,f),l;M<0&&this._escHandlerFb(this._collect<<8|m),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|m,this._params);break;case 13:for(let L=f+1;;++L)if(L>=e||(m=r[L])===24||m===26||m===27||m>127&&m<y){this._dcsParser.put(r,f,L),f=L-1;break}break;case 14:if(l=this._dcsParser.unhook(m!==24&&m!==26),l)return this._preserveStack(6,[],0,v,f),l;m===27&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let L=f+1;;L++)if(L>=e||(m=r[L])<32||m>127&&m<y){this._oscParser.put(r,f,L),f=L-1;break}break;case 6:if(l=this._oscParser.end(m!==24&&m!==26),l)return this._preserveStack(5,[],0,v,f),l;m===27&&(v|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&v}}}i.EscapeSequenceParser=d},6242:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OscHandler=i.OscParser=void 0;const h=o(5770),p=o(482),a=[];i.OscParser=class{constructor(){this._state=0,this._active=a,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(_,g){this._handlers[_]===void 0&&(this._handlers[_]=[]);const y=this._handlers[_];return y.push(g),{dispose:()=>{const d=y.indexOf(g);d!==-1&&y.splice(d,1)}}}clearHandler(_){this._handlers[_]&&delete this._handlers[_]}setHandlerFallback(_){this._handlerFb=_}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=a}reset(){if(this._state===2)for(let _=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;_>=0;--_)this._active[_].end(!1);this._stack.paused=!1,this._active=a,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||a,this._active.length)for(let _=this._active.length-1;_>=0;_--)this._active[_].start();else this._handlerFb(this._id,"START")}_put(_,g,y){if(this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].put(_,g,y);else this._handlerFb(this._id,"PUT",(0,p.utf32ToString)(_,g,y))}start(){this.reset(),this._state=1}put(_,g,y){if(this._state!==3){if(this._state===1)for(;g<y;){const d=_[g++];if(d===59){this._state=2,this._start();break}if(d<48||57<d)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+d-48}this._state===2&&y-g>0&&this._put(_,g,y)}}end(_,g=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let y=!1,d=this._active.length-1,s=!1;if(this._stack.paused&&(d=this._stack.loopPosition-1,y=g,s=this._stack.fallThrough,this._stack.paused=!1),!s&&y===!1){for(;d>=0&&(y=this._active[d].end(_),y!==!0);d--)if(y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!1,y;d--}for(;d>=0;d--)if(y=this._active[d].end(!1),y instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=d,this._stack.fallThrough=!0,y}else this._handlerFb(this._id,"END",_);this._active=a,this._id=-1,this._state=0}}},i.OscHandler=class{constructor(_){this._handler=_,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(_,g,y){this._hitLimit||(this._data+=(0,p.utf32ToString)(_,g,y),this._data.length>h.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(_){let g=!1;if(this._hitLimit)g=!1;else if(_&&(g=this._handler(this._data),g instanceof Promise))return g.then(y=>(this._data="",this._hitLimit=!1,y));return this._data="",this._hitLimit=!1,g}}},8742:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Params=void 0;const o=2147483647;class h{static fromArray(a){const _=new h;if(!a.length)return _;for(let g=Array.isArray(a[0])?1:0;g<a.length;++g){const y=a[g];if(Array.isArray(y))for(let d=0;d<y.length;++d)_.addSubParam(y[d]);else _.addParam(y)}return _}constructor(a=32,_=32){if(this.maxLength=a,this.maxSubParamsLength=_,_>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(a),this.length=0,this._subParams=new Int32Array(_),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(a),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const a=new h(this.maxLength,this.maxSubParamsLength);return a.params.set(this.params),a.length=this.length,a._subParams.set(this._subParams),a._subParamsLength=this._subParamsLength,a._subParamsIdx.set(this._subParamsIdx),a._rejectDigits=this._rejectDigits,a._rejectSubDigits=this._rejectSubDigits,a._digitIsSub=this._digitIsSub,a}toArray(){const a=[];for(let _=0;_<this.length;++_){a.push(this.params[_]);const g=this._subParamsIdx[_]>>8,y=255&this._subParamsIdx[_];y-g>0&&a.push(Array.prototype.slice.call(this._subParams,g,y))}return a}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(a){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(a<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=a>o?o:a}}addSubParam(a){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(a<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=a>o?o:a,this._subParamsIdx[this.length-1]++}}hasSubParams(a){return(255&this._subParamsIdx[a])-(this._subParamsIdx[a]>>8)>0}getSubParams(a){const _=this._subParamsIdx[a]>>8,g=255&this._subParamsIdx[a];return g-_>0?this._subParams.subarray(_,g):null}getSubParamsAll(){const a={};for(let _=0;_<this.length;++_){const g=this._subParamsIdx[_]>>8,y=255&this._subParamsIdx[_];y-g>0&&(a[_]=this._subParams.slice(g,y))}return a}addDigit(a){let _;if(this._rejectDigits||!(_=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const g=this._digitIsSub?this._subParams:this.params,y=g[_-1];g[_-1]=~y?Math.min(10*y+a,o):a}}i.Params=h},5741:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AddonManager=void 0,i.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let o=this._addons.length-1;o>=0;o--)this._addons[o].instance.dispose()}loadAddon(o,h){const p={instance:h,dispose:h.dispose,isDisposed:!1};this._addons.push(p),h.dispose=()=>this._wrappedAddonDispose(p),h.activate(o)}_wrappedAddonDispose(o){if(o.isDisposed)return;let h=-1;for(let p=0;p<this._addons.length;p++)if(this._addons[p]===o){h=p;break}if(h===-1)throw new Error("Could not dispose an addon that has not been loaded");o.isDisposed=!0,o.dispose.apply(o.instance),this._addons.splice(h,1)}}},8771:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferApiView=void 0;const h=o(3785),p=o(511);i.BufferApiView=class{constructor(a,_){this._buffer=a,this.type=_}init(a){return this._buffer=a,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(a){const _=this._buffer.lines.get(a);if(_)return new h.BufferLineApiView(_)}getNullCell(){return new p.CellData}}},3785:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLineApiView=void 0;const h=o(511);i.BufferLineApiView=class{constructor(p){this._line=p}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(p,a){if(!(p<0||p>=this._line.length))return a?(this._line.loadCell(p,a),a):this._line.loadCell(p,new h.CellData)}translateToString(p,a,_){return this._line.translateToString(p,a,_)}}},8285:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferNamespaceApi=void 0;const h=o(8771),p=o(8460),a=o(844);class _ extends a.Disposable{constructor(y){super(),this._core=y,this._onBufferChange=this.register(new p.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new h.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new h.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}i.BufferNamespaceApi=_},7975:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ParserApi=void 0,i.ParserApi=class{constructor(o){this._core=o}registerCsiHandler(o,h){return this._core.registerCsiHandler(o,p=>h(p.toArray()))}addCsiHandler(o,h){return this.registerCsiHandler(o,h)}registerDcsHandler(o,h){return this._core.registerDcsHandler(o,(p,a)=>h(p,a.toArray()))}addDcsHandler(o,h){return this.registerDcsHandler(o,h)}registerEscHandler(o,h){return this._core.registerEscHandler(o,h)}addEscHandler(o,h){return this.registerEscHandler(o,h)}registerOscHandler(o,h){return this._core.registerOscHandler(o,h)}addOscHandler(o,h){return this.registerOscHandler(o,h)}}},7090:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeApi=void 0,i.UnicodeApi=class{constructor(o){this._core=o}register(o){this._core.unicodeService.register(o)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(o){this._core.unicodeService.activeVersion=o}}},744:function(x,i,o){var h=this&&this.__decorate||function(s,r,e,t){var l,m=arguments.length,v=m<3?r:t===null?t=Object.getOwnPropertyDescriptor(r,e):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,r,e,t);else for(var b=s.length-1;b>=0;b--)(l=s[b])&&(v=(m<3?l(v):m>3?l(r,e,v):l(r,e))||v);return m>3&&v&&Object.defineProperty(r,e,v),v},p=this&&this.__param||function(s,r){return function(e,t){r(e,t,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferService=i.MINIMUM_ROWS=i.MINIMUM_COLS=void 0;const a=o(8460),_=o(844),g=o(5295),y=o(2585);i.MINIMUM_COLS=2,i.MINIMUM_ROWS=1;let d=i.BufferService=class extends _.Disposable{get buffer(){return this.buffers.active}constructor(s){super(),this.isUserScrolling=!1,this._onResize=this.register(new a.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new a.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(s.rawOptions.cols||0,i.MINIMUM_COLS),this.rows=Math.max(s.rawOptions.rows||0,i.MINIMUM_ROWS),this.buffers=this.register(new g.BufferSet(s,this))}resize(s,r){this.cols=s,this.rows=r,this.buffers.resize(s,r),this._onResize.fire({cols:s,rows:r})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(s,r=!1){const e=this.buffer;let t;t=this._cachedBlankLine,t&&t.length===this.cols&&t.getFg(0)===s.fg&&t.getBg(0)===s.bg||(t=e.getBlankLine(s,r),this._cachedBlankLine=t),t.isWrapped=r;const l=e.ybase+e.scrollTop,m=e.ybase+e.scrollBottom;if(e.scrollTop===0){const v=e.lines.isFull;m===e.lines.length-1?v?e.lines.recycle().copyFrom(t):e.lines.push(t.clone()):e.lines.splice(m+1,0,t.clone()),v?this.isUserScrolling&&(e.ydisp=Math.max(e.ydisp-1,0)):(e.ybase++,this.isUserScrolling||e.ydisp++)}else{const v=m-l+1;e.lines.shiftElements(l+1,v-1,-1),e.lines.set(m,t.clone())}this.isUserScrolling||(e.ydisp=e.ybase),this._onScroll.fire(e.ydisp)}scrollLines(s,r,e){const t=this.buffer;if(s<0){if(t.ydisp===0)return;this.isUserScrolling=!0}else s+t.ydisp>=t.ybase&&(this.isUserScrolling=!1);const l=t.ydisp;t.ydisp=Math.max(Math.min(t.ydisp+s,t.ybase),0),l!==t.ydisp&&(r||this._onScroll.fire(t.ydisp))}};i.BufferService=d=h([p(0,y.IOptionsService)],d)},7994:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CharsetService=void 0,i.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(o){this.glevel=o,this.charset=this._charsets[o]}setgCharset(o,h){this._charsets[o]=h,this.glevel===o&&(this.charset=h)}}},1753:function(x,i,o){var h=this&&this.__decorate||function(t,l,m,v){var b,f=arguments.length,w=f<3?l:v===null?v=Object.getOwnPropertyDescriptor(l,m):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(t,l,m,v);else for(var D=t.length-1;D>=0;D--)(b=t[D])&&(w=(f<3?b(w):f>3?b(l,m,w):b(l,m))||w);return f>3&&w&&Object.defineProperty(l,m,w),w},p=this&&this.__param||function(t,l){return function(m,v){l(m,v,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreMouseService=void 0;const a=o(2585),_=o(8460),g=o(844),y={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:t=>t.button!==4&&t.action===1&&(t.ctrl=!1,t.alt=!1,t.shift=!1,!0)},VT200:{events:19,restrict:t=>t.action!==32},DRAG:{events:23,restrict:t=>t.action!==32||t.button!==3},ANY:{events:31,restrict:t=>!0}};function d(t,l){let m=(t.ctrl?16:0)|(t.shift?4:0)|(t.alt?8:0);return t.button===4?(m|=64,m|=t.action):(m|=3&t.button,4&t.button&&(m|=64),8&t.button&&(m|=128),t.action===32?m|=32:t.action!==0||l||(m|=3)),m}const s=String.fromCharCode,r={DEFAULT:t=>{const l=[d(t,!1)+32,t.col+32,t.row+32];return l[0]>255||l[1]>255||l[2]>255?"":`\x1B[M${s(l[0])}${s(l[1])}${s(l[2])}`},SGR:t=>{const l=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${d(t,!0)};${t.col};${t.row}${l}`},SGR_PIXELS:t=>{const l=t.action===0&&t.button!==4?"m":"M";return`\x1B[<${d(t,!0)};${t.x};${t.y}${l}`}};let e=i.CoreMouseService=class extends g.Disposable{constructor(t,l){super(),this._bufferService=t,this._coreService=l,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new _.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const m of Object.keys(y))this.addProtocol(m,y[m]);for(const m of Object.keys(r))this.addEncoding(m,r[m]);this.reset()}addProtocol(t,l){this._protocols[t]=l}addEncoding(t,l){this._encodings[t]=l}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(t){if(!this._protocols[t])throw new Error(`unknown protocol "${t}"`);this._activeProtocol=t,this._onProtocolChange.fire(this._protocols[t].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(t){if(!this._encodings[t])throw new Error(`unknown encoding "${t}"`);this._activeEncoding=t}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(t){if(t.col<0||t.col>=this._bufferService.cols||t.row<0||t.row>=this._bufferService.rows||t.button===4&&t.action===32||t.button===3&&t.action!==32||t.button!==4&&(t.action===2||t.action===3)||(t.col++,t.row++,t.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,t,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(t))return!1;const l=this._encodings[this._activeEncoding](t);return l&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(l):this._coreService.triggerDataEvent(l,!0)),this._lastEvent=t,!0}explainEvents(t){return{down:!!(1&t),up:!!(2&t),drag:!!(4&t),move:!!(8&t),wheel:!!(16&t)}}_equalEvents(t,l,m){if(m){if(t.x!==l.x||t.y!==l.y)return!1}else if(t.col!==l.col||t.row!==l.row)return!1;return t.button===l.button&&t.action===l.action&&t.ctrl===l.ctrl&&t.alt===l.alt&&t.shift===l.shift}};i.CoreMouseService=e=h([p(0,a.IBufferService),p(1,a.ICoreService)],e)},6975:function(x,i,o){var h=this&&this.__decorate||function(e,t,l,m){var v,b=arguments.length,f=b<3?t:m===null?m=Object.getOwnPropertyDescriptor(t,l):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")f=Reflect.decorate(e,t,l,m);else for(var w=e.length-1;w>=0;w--)(v=e[w])&&(f=(b<3?v(f):b>3?v(t,l,f):v(t,l))||f);return b>3&&f&&Object.defineProperty(t,l,f),f},p=this&&this.__param||function(e,t){return function(l,m){t(l,m,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreService=void 0;const a=o(1439),_=o(8460),g=o(844),y=o(2585),d=Object.freeze({insertMode:!1}),s=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let r=i.CoreService=class extends g.Disposable{constructor(e,t,l){super(),this._bufferService=e,this._logService=t,this._optionsService=l,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new _.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new _.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new _.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new _.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,a.clone)(d),this.decPrivateModes=(0,a.clone)(s)}reset(){this.modes=(0,a.clone)(d),this.decPrivateModes=(0,a.clone)(s)}triggerDataEvent(e,t=!1){if(this._optionsService.rawOptions.disableStdin)return;const l=this._bufferService.buffer;t&&this._optionsService.rawOptions.scrollOnUserInput&&l.ybase!==l.ydisp&&this._onRequestScrollToBottom.fire(),t&&this._onUserInput.fire(),this._logService.debug(`sending data "${e}"`,()=>e.split("").map(m=>m.charCodeAt(0))),this._onData.fire(e)}triggerBinaryEvent(e){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${e}"`,()=>e.split("").map(t=>t.charCodeAt(0))),this._onBinary.fire(e))}};i.CoreService=r=h([p(0,y.IBufferService),p(1,y.ILogService),p(2,y.IOptionsService)],r)},9074:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DecorationService=void 0;const h=o(8055),p=o(8460),a=o(844),_=o(6106);let g=0,y=0;class d extends a.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new _.SortedList(e=>e==null?void 0:e.marker.line),this._onDecorationRegistered=this.register(new p.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new p.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,a.toDisposable)(()=>this.reset()))}registerDecoration(e){if(e.marker.isDisposed)return;const t=new s(e);if(t){const l=t.marker.onDispose(()=>t.dispose());t.onDispose(()=>{t&&(this._decorations.delete(t)&&this._onDecorationRemoved.fire(t),l.dispose())}),this._decorations.insert(t),this._onDecorationRegistered.fire(t)}return t}reset(){for(const e of this._decorations.values())e.dispose();this._decorations.clear()}*getDecorationsAtCell(e,t,l){let m=0,v=0;for(const b of this._decorations.getKeyIterator(t))m=b.options.x??0,v=m+(b.options.width??1),e>=m&&e<v&&(!l||(b.options.layer??"bottom")===l)&&(yield b)}forEachDecorationAtCell(e,t,l,m){this._decorations.forEachByKey(t,v=>{g=v.options.x??0,y=g+(v.options.width??1),e>=g&&e<y&&(!l||(v.options.layer??"bottom")===l)&&m(v)})}}i.DecorationService=d;class s extends a.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=h.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=h.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(e){super(),this.options=e,this.onRenderEmitter=this.register(new p.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new p.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=e.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InstantiationService=i.ServiceCollection=void 0;const h=o(2585),p=o(8343);class a{constructor(...g){this._entries=new Map;for(const[y,d]of g)this.set(y,d)}set(g,y){const d=this._entries.get(g);return this._entries.set(g,y),d}forEach(g){for(const[y,d]of this._entries.entries())g(y,d)}has(g){return this._entries.has(g)}get(g){return this._entries.get(g)}}i.ServiceCollection=a,i.InstantiationService=class{constructor(){this._services=new a,this._services.set(h.IInstantiationService,this)}setService(_,g){this._services.set(_,g)}getService(_){return this._services.get(_)}createInstance(_,...g){const y=(0,p.getServiceDependencies)(_).sort((r,e)=>r.index-e.index),d=[];for(const r of y){const e=this._services.get(r.id);if(!e)throw new Error(`[createInstance] ${_.name} depends on UNKNOWN service ${r.id}.`);d.push(e)}const s=y.length>0?y[0].index:g.length;if(g.length!==s)throw new Error(`[createInstance] First service dependency of ${_.name} at position ${s+1} conflicts with ${g.length} static arguments`);return new _(...g,...d)}}},7866:function(x,i,o){var h=this&&this.__decorate||function(s,r,e,t){var l,m=arguments.length,v=m<3?r:t===null?t=Object.getOwnPropertyDescriptor(r,e):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,r,e,t);else for(var b=s.length-1;b>=0;b--)(l=s[b])&&(v=(m<3?l(v):m>3?l(r,e,v):l(r,e))||v);return m>3&&v&&Object.defineProperty(r,e,v),v},p=this&&this.__param||function(s,r){return function(e,t){r(e,t,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;const a=o(844),_=o(2585),g={trace:_.LogLevelEnum.TRACE,debug:_.LogLevelEnum.DEBUG,info:_.LogLevelEnum.INFO,warn:_.LogLevelEnum.WARN,error:_.LogLevelEnum.ERROR,off:_.LogLevelEnum.OFF};let y,d=i.LogService=class extends a.Disposable{get logLevel(){return this._logLevel}constructor(s){super(),this._optionsService=s,this._logLevel=_.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),y=this}_updateLogLevel(){this._logLevel=g[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(s){for(let r=0;r<s.length;r++)typeof s[r]=="function"&&(s[r]=s[r]())}_log(s,r,e){this._evalLazyOptionalParams(e),s.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+r,...e)}trace(s,...r){var e;this._logLevel<=_.LogLevelEnum.TRACE&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.trace.bind(this._optionsService.options.logger))??console.log,s,r)}debug(s,...r){var e;this._logLevel<=_.LogLevelEnum.DEBUG&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.debug.bind(this._optionsService.options.logger))??console.log,s,r)}info(s,...r){var e;this._logLevel<=_.LogLevelEnum.INFO&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.info.bind(this._optionsService.options.logger))??console.info,s,r)}warn(s,...r){var e;this._logLevel<=_.LogLevelEnum.WARN&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.warn.bind(this._optionsService.options.logger))??console.warn,s,r)}error(s,...r){var e;this._logLevel<=_.LogLevelEnum.ERROR&&this._log(((e=this._optionsService.options.logger)==null?void 0:e.error.bind(this._optionsService.options.logger))??console.error,s,r)}};i.LogService=d=h([p(0,_.IOptionsService)],d),i.setTraceLogger=function(s){y=s},i.traceCall=function(s,r,e){if(typeof e.value!="function")throw new Error("not supported");const t=e.value;e.value=function(...l){if(y.logLevel!==_.LogLevelEnum.TRACE)return t.apply(this,l);y.trace(`GlyphRenderer#${t.name}(${l.map(v=>JSON.stringify(v)).join(", ")})`);const m=t.apply(this,l);return y.trace(`GlyphRenderer#${t.name} return`,m),m}}},7302:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionsService=i.DEFAULT_OPTIONS=void 0;const h=o(8460),p=o(844),a=o(6114);i.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:a.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const _=["normal","bold","100","200","300","400","500","600","700","800","900"];class g extends p.Disposable{constructor(d){super(),this._onOptionChange=this.register(new h.EventEmitter),this.onOptionChange=this._onOptionChange.event;const s={...i.DEFAULT_OPTIONS};for(const r in d)if(r in s)try{const e=d[r];s[r]=this._sanitizeAndValidateOption(r,e)}catch(e){console.error(e)}this.rawOptions=s,this.options={...s},this._setupOptions(),this.register((0,p.toDisposable)(()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null}))}onSpecificOptionChange(d,s){return this.onOptionChange(r=>{r===d&&s(this.rawOptions[d])})}onMultipleOptionChange(d,s){return this.onOptionChange(r=>{d.indexOf(r)!==-1&&s()})}_setupOptions(){const d=r=>{if(!(r in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);return this.rawOptions[r]},s=(r,e)=>{if(!(r in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${r}"`);e=this._sanitizeAndValidateOption(r,e),this.rawOptions[r]!==e&&(this.rawOptions[r]=e,this._onOptionChange.fire(r))};for(const r in this.rawOptions){const e={get:d.bind(this,r),set:s.bind(this,r)};Object.defineProperty(this.options,r,e)}}_sanitizeAndValidateOption(d,s){switch(d){case"cursorStyle":if(s||(s=i.DEFAULT_OPTIONS[d]),!function(r){return r==="block"||r==="underline"||r==="bar"}(s))throw new Error(`"${s}" is not a valid value for ${d}`);break;case"wordSeparator":s||(s=i.DEFAULT_OPTIONS[d]);break;case"fontWeight":case"fontWeightBold":if(typeof s=="number"&&1<=s&&s<=1e3)break;s=_.includes(s)?s:i.DEFAULT_OPTIONS[d];break;case"cursorWidth":s=Math.floor(s);case"lineHeight":case"tabStopWidth":if(s<1)throw new Error(`${d} cannot be less than 1, value: ${s}`);break;case"minimumContrastRatio":s=Math.max(1,Math.min(21,Math.round(10*s)/10));break;case"scrollback":if((s=Math.min(s,4294967295))<0)throw new Error(`${d} cannot be less than 0, value: ${s}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(s<=0)throw new Error(`${d} cannot be less than or equal to 0, value: ${s}`);break;case"rows":case"cols":if(!s&&s!==0)throw new Error(`${d} must be numeric, value: ${s}`);break;case"windowsPty":s=s??{}}return s}}i.OptionsService=g},2660:function(x,i,o){var h=this&&this.__decorate||function(g,y,d,s){var r,e=arguments.length,t=e<3?y:s===null?s=Object.getOwnPropertyDescriptor(y,d):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")t=Reflect.decorate(g,y,d,s);else for(var l=g.length-1;l>=0;l--)(r=g[l])&&(t=(e<3?r(t):e>3?r(y,d,t):r(y,d))||t);return e>3&&t&&Object.defineProperty(y,d,t),t},p=this&&this.__param||function(g,y){return function(d,s){y(d,s,g)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkService=void 0;const a=o(2585);let _=i.OscLinkService=class{constructor(g){this._bufferService=g,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(g){const y=this._bufferService.buffer;if(g.id===void 0){const l=y.addMarker(y.ybase+y.y),m={data:g,id:this._nextId++,lines:[l]};return l.onDispose(()=>this._removeMarkerFromLink(m,l)),this._dataByLinkId.set(m.id,m),m.id}const d=g,s=this._getEntryIdKey(d),r=this._entriesWithId.get(s);if(r)return this.addLineToLink(r.id,y.ybase+y.y),r.id;const e=y.addMarker(y.ybase+y.y),t={id:this._nextId++,key:this._getEntryIdKey(d),data:d,lines:[e]};return e.onDispose(()=>this._removeMarkerFromLink(t,e)),this._entriesWithId.set(t.key,t),this._dataByLinkId.set(t.id,t),t.id}addLineToLink(g,y){const d=this._dataByLinkId.get(g);if(d&&d.lines.every(s=>s.line!==y)){const s=this._bufferService.buffer.addMarker(y);d.lines.push(s),s.onDispose(()=>this._removeMarkerFromLink(d,s))}}getLinkData(g){var y;return(y=this._dataByLinkId.get(g))==null?void 0:y.data}_getEntryIdKey(g){return`${g.id};;${g.uri}`}_removeMarkerFromLink(g,y){const d=g.lines.indexOf(y);d!==-1&&(g.lines.splice(d,1),g.lines.length===0&&(g.data.id!==void 0&&this._entriesWithId.delete(g.key),this._dataByLinkId.delete(g.id)))}};i.OscLinkService=_=h([p(0,a.IBufferService)],_)},8343:(x,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;const o="di$target",h="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(p){return p[h]||[]},i.createDecorator=function(p){if(i.serviceRegistry.has(p))return i.serviceRegistry.get(p);const a=function(_,g,y){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(d,s,r){s[o]===s?s[h].push({id:d,index:r}):(s[h]=[{id:d,index:r}],s[o]=s)})(a,_,y)};return a.toString=()=>p,i.serviceRegistry.set(p,a),a}},2585:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;const h=o(8343);var p;i.IBufferService=(0,h.createDecorator)("BufferService"),i.ICoreMouseService=(0,h.createDecorator)("CoreMouseService"),i.ICoreService=(0,h.createDecorator)("CoreService"),i.ICharsetService=(0,h.createDecorator)("CharsetService"),i.IInstantiationService=(0,h.createDecorator)("InstantiationService"),function(a){a[a.TRACE=0]="TRACE",a[a.DEBUG=1]="DEBUG",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.OFF=5]="OFF"}(p||(i.LogLevelEnum=p={})),i.ILogService=(0,h.createDecorator)("LogService"),i.IOptionsService=(0,h.createDecorator)("OptionsService"),i.IOscLinkService=(0,h.createDecorator)("OscLinkService"),i.IUnicodeService=(0,h.createDecorator)("UnicodeService"),i.IDecorationService=(0,h.createDecorator)("DecorationService")},1480:(x,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeService=void 0;const h=o(8460),p=o(225);class a{static extractShouldJoin(g){return(1&g)!=0}static extractWidth(g){return g>>1&3}static extractCharKind(g){return g>>3}static createPropertyValue(g,y,d=!1){return(16777215&g)<<3|(3&y)<<1|(d?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new h.EventEmitter,this.onChange=this._onChange.event;const g=new p.UnicodeV6;this.register(g),this._active=g.version,this._activeProvider=g}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(g){if(!this._providers[g])throw new Error(`unknown Unicode version "${g}"`);this._active=g,this._activeProvider=this._providers[g],this._onChange.fire(g)}register(g){this._providers[g.version]=g}wcwidth(g){return this._activeProvider.wcwidth(g)}getStringCellWidth(g){let y=0,d=0;const s=g.length;for(let r=0;r<s;++r){let e=g.charCodeAt(r);if(55296<=e&&e<=56319){if(++r>=s)return y+this.wcwidth(e);const m=g.charCodeAt(r);56320<=m&&m<=57343?e=1024*(e-55296)+m-56320+65536:y+=this.wcwidth(m)}const t=this.charProperties(e,d);let l=a.extractWidth(t);a.extractShouldJoin(t)&&(l-=a.extractWidth(d)),y+=l,d=t}return y}charProperties(g,y){return this._activeProvider.charProperties(g,y)}}i.UnicodeService=a}},S={};function C(x){var i=S[x];if(i!==void 0)return i.exports;var o=S[x]={exports:{}};return u[x].call(o.exports,o,o.exports,C),o.exports}var A={};return(()=>{var x=A;Object.defineProperty(x,"__esModule",{value:!0}),x.Terminal=void 0;const i=C(9042),o=C(3236),h=C(844),p=C(5741),a=C(8285),_=C(7975),g=C(7090),y=["cols","rows"];class d extends h.Disposable{constructor(r){super(),this._core=this.register(new o.Terminal(r)),this._addonManager=this.register(new p.AddonManager),this._publicOptions={...this._core.options};const e=l=>this._core.options[l],t=(l,m)=>{this._checkReadonlyOptions(l),this._core.options[l]=m};for(const l in this._core.options){const m={get:e.bind(this,l),set:t.bind(this,l)};Object.defineProperty(this._publicOptions,l,m)}}_checkReadonlyOptions(r){if(y.includes(r))throw new Error(`Option "${r}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new _.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new g.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new a.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const r=this._core.coreService.decPrivateModes;let e="none";switch(this._core.coreMouseService.activeProtocol){case"X10":e="x10";break;case"VT200":e="vt200";break;case"DRAG":e="drag";break;case"ANY":e="any"}return{applicationCursorKeysMode:r.applicationCursorKeys,applicationKeypadMode:r.applicationKeypad,bracketedPasteMode:r.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:e,originMode:r.origin,reverseWraparoundMode:r.reverseWraparound,sendFocusMode:r.sendFocus,wraparoundMode:r.wraparound}}get options(){return this._publicOptions}set options(r){for(const e in r)this._publicOptions[e]=r[e]}blur(){this._core.blur()}focus(){this._core.focus()}input(r,e=!0){this._core.input(r,e)}resize(r,e){this._verifyIntegers(r,e),this._core.resize(r,e)}open(r){this._core.open(r)}attachCustomKeyEventHandler(r){this._core.attachCustomKeyEventHandler(r)}attachCustomWheelEventHandler(r){this._core.attachCustomWheelEventHandler(r)}registerLinkProvider(r){return this._core.registerLinkProvider(r)}registerCharacterJoiner(r){return this._checkProposedApi(),this._core.registerCharacterJoiner(r)}deregisterCharacterJoiner(r){this._checkProposedApi(),this._core.deregisterCharacterJoiner(r)}registerMarker(r=0){return this._verifyIntegers(r),this._core.registerMarker(r)}registerDecoration(r){return this._checkProposedApi(),this._verifyPositiveIntegers(r.x??0,r.width??0,r.height??0),this._core.registerDecoration(r)}hasSelection(){return this._core.hasSelection()}select(r,e,t){this._verifyIntegers(r,e,t),this._core.select(r,e,t)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(r,e){this._verifyIntegers(r,e),this._core.selectLines(r,e)}dispose(){super.dispose()}scrollLines(r){this._verifyIntegers(r),this._core.scrollLines(r)}scrollPages(r){this._verifyIntegers(r),this._core.scrollPages(r)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(r){this._verifyIntegers(r),this._core.scrollToLine(r)}clear(){this._core.clear()}write(r,e){this._core.write(r,e)}writeln(r,e){this._core.write(r),this._core.write(`\r
`,e)}paste(r){this._core.paste(r)}refresh(r,e){this._verifyIntegers(r,e),this._core.refresh(r,e)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(r){this._addonManager.loadAddon(this,r)}static get strings(){return i}_verifyIntegers(...r){for(const e of r)if(e===1/0||isNaN(e)||e%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...r){for(const e of r)if(e&&(e===1/0||isNaN(e)||e%1!=0||e<0))throw new Error("This API only accepts positive integers")}}x.Terminal=d})(),A})())}(st)),st.exports}var rs=is(),it={exports:{}},Ct;function ns(){return Ct||(Ct=1,function(c,n){(function(u,S){c.exports=S()})(self,()=>(()=>{var u={};return(()=>{var S=u;Object.defineProperty(S,"__esModule",{value:!0}),S.FitAddon=void 0,S.FitAddon=class{activate(C){this._terminal=C}dispose(){}fit(){const C=this.proposeDimensions();if(!C||!this._terminal||isNaN(C.cols)||isNaN(C.rows))return;const A=this._terminal._core;this._terminal.rows===C.rows&&this._terminal.cols===C.cols||(A._renderService.clear(),this._terminal.resize(C.cols,C.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const C=this._terminal._core,A=C._renderService.dimensions;if(A.css.cell.width===0||A.css.cell.height===0)return;const x=this._terminal.options.scrollback===0?0:C.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue("height")),h=Math.max(0,parseInt(i.getPropertyValue("width"))),p=window.getComputedStyle(this._terminal.element),a=o-(parseInt(p.getPropertyValue("padding-top"))+parseInt(p.getPropertyValue("padding-bottom"))),_=h-(parseInt(p.getPropertyValue("padding-right"))+parseInt(p.getPropertyValue("padding-left")))-x;return{cols:Math.max(2,Math.floor(_/A.css.cell.width)),rows:Math.max(1,Math.floor(a/A.css.cell.height))}}}})(),u})())}(it)),it.exports}var os=ns();const ve="system",Pt="user";function*Ht(c){const{length:n}=c;for(let u=0;u<n;++u)yield c.at(u)}var O;(function(c){c.null="null",c.boolean="boolean",c.integer="integer",c.string="string",c.name="name",c.mark="mark",c.operator="operator",c.array="array",c.dictionary="dictionary"})(O||(O={}));const ne={type:O.null,isReadOnly:!0,isExecutable:!1};class wt extends Error{constructor(n,u){super(n),this.name="AssertionFailed",this.cause=u}}function q(c,n,u){if(typeof c!="boolean"){if(!c.success)throw new wt("Unexpected failed result",c.exception)}else if(!c)throw new wt(n??"assertion failed",u)}function ge(c,{source:n,filename:u,pos:S,length:C}){return u===void 0?c:Object.assign({debugSource:{source:n,filename:u,pos:S,length:C},...c})}function*as(c){const{source:n,pos:u}=c,S=n.indexOf('"',u+1);return S===-1?(yield ge(ne,{...c,length:1}),n.length):(yield ge({type:O.string,isReadOnly:!0,isExecutable:!1,string:n.slice(u+1,S)},{...c,length:S-u+1}),S+1)}function*cs(c){const{source:n,pos:u}=c,S=n[u];q(S!==void 0);let C=u+1;for(;C<n.length&&"0123456789".includes(n[C]);)++C;return C===u+1&&"+-".includes(S)?(yield ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:S},{...c,length:1}),C):(yield ge({type:O.integer,isReadOnly:!0,isExecutable:!1,integer:Number.parseInt(n.slice(u,C))},{...c,length:C-u}),C)}function*ls(c){const{source:n,pos:u}=c,{length:S}=n,C=n[u];if(q(C!==void 0),"[]{}Â«Â»".includes(C))return yield ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:C},{...c,length:1}),u+1;if(u===S-1)return yield C==="/"?ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:""},{...c,length:1}):ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:C},{...c,length:1}),u+1;let A=u+1;const x=n[A];if(q(x!==void 0),C===x&&"<>".includes(C))return yield ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:C==="<"?"<<":">>"},{...c,length:2}),A+1;for(;A<S;){const i=n[A];if(q(i!==void 0),` 	\r
%[]{}Â«Â»<>`.includes(i))break;++A}return yield C==="/"?ge({type:O.name,isReadOnly:!0,isExecutable:!1,name:n.slice(u+1,A)},{...c,length:A-u}):ge({type:O.name,isReadOnly:!0,isExecutable:!0,name:n.slice(u,A)},{...c,length:A-u}),A}function*lt(c,n){n=n??{};const{filename:u}=n;let{pos:S=0}=n;const{length:C}=c;for(;S<C;){const A=c[S];if(q(A!==void 0),` 	\r
`.includes(A)){++S;continue}if(A==="%"){if(S=c.indexOf(`
`,S),S===-1)return;++S;continue}A==='"'?S=yield*as({source:c,filename:u,pos:S}):"-+0123456789".includes(A)?S=yield*cs({source:c,filename:u,pos:S}):S=yield*ls({source:c,filename:u,pos:S})}}const ht={type:O.mark,isReadOnly:!0,isExecutable:!1};function qe(c,n){if(c.type!==O.integer)return{success:!1,exception:"typeCheck"};const{integer:u}=c;return u<0||u>=n?{success:!1,exception:"rangeCheck"}:{success:!0,value:u}}function hs(c){return typeof c=="object"&&c!==null}const us={[O.string]:{isReadOnly:!0},[O.operator]:{isReadOnly:!0,isExecutable:!0}};function ds(c){const n=["isReadOnly","isExecutable"],u=us[c.type];for(const S of n){const C=u&&u[S];if(C!==void 0){if(c[S]!==C)return!0}else if(typeof c[S]!="boolean")return!0}return!1}function fs({isReadOnly:c,isExecutable:n},{isReadOnly:u,isExecutable:S}={}){return u!==void 0&&c!==u?!1:S===void 0||n===S}function _s(c,n,u,S){return hs(n)&&n.type===c&&!ds(n)&&fs(n,u)&&S(n)}function ps(c){return typeof c=="number"&&c%1===0}const kt=(c,n)=>typeof c=="function"&&c.length===n,gs=c=>ps(c)&&c>=0;function vs(c,n){return _s(O.array,c,n,({isReadOnly:u,array:S})=>S!==void 0&&gs(S.length)&&kt(S.at,1)&&(u||kt(S.set,2)))}function Xe(c){let n=0;for(;n<c.length&&c.at(n).type!==O.mark;)++n;return n===c.length?{success:!1,exception:"unmatchedMark"}:{success:!0,value:n}}const me=Number.POSITIVE_INFINITY,re=0,he=-1,Se=Number.NEGATIVE_INFINITY;var ye;(function(c){c[c.constant=0]="constant",c[c.implementation=1]="implementation"})(ye||(ye={}));const ms=1e3;function Ss(c,n){q(c);const{maxIterations:u=ms}={},S=c.value;let C=0;for(;C<u;){const{done:A}=S.next();if(++C,A===!0)break}return C}const ys="â",Fe="â»",Ee="â";function bs(c,n){let u=1,S=0,C=c.indexOf(`
`);for(;C!==-1&&S+n>C;)++C,n-=C-S,S=C,++u,C=c.indexOf(`
`,S);return{line:u,col:n+1}}function Cs(c){const n=c.lastIndexOf("/"),u=c.lastIndexOf("\\"),S=Math.max(n,u);return S===-1?c:"â¦"+c.slice(S)}function ws(c,n){const u=c.indexOf(Fe),S=c.indexOf(Ee,u+1),C=S-u+1;if(u>-1&&S>-1&&C>0)if(n>C){let A=u-Math.ceil((n-C)/2);if(A+n>c.length&&(A=c.length-n+1),A>0)return"â¦"+c.slice(Math.max(0,A))}else return"â¦"+c.slice(Math.max(0,u-1));return c}function ks(c,n,u){let S=n===void 0?c:`${c}@${n}`;if(u<1||S.length<=u)return S;let C="";if(n!==void 0){if(C=`@${Cs(n)}`,S=`${c}${C}`,S.length<=u)return S;u<C.length?C="":u-=C.length}return c=ws(c,u),c.length>u&&(c=c.slice(0,Math.max(0,u-1))+"â¦"),C?`${c}${C}`:c}function be(c,n,{includeDebugSource:u=!1,maxWidth:S=0}){let C;if(n!==void 0&&u){const{filename:A,source:x}=n,{line:i,col:o}=bs(x,n.pos);C=`${A}:${i}:${o}`}return ks(c,C,S)}const Ft={[O.null]:({debugSource:c},n)=>be(ys,c,n),[O.boolean]:({isSet:c,debugSource:n},u)=>be(c?"true":"false",n,u),[O.integer]:({integer:c,debugSource:n},u)=>be(c.toString(),n,u),[O.string]:({isExecutable:c,string:n,debugSource:u},S)=>{var A;let C;if(c){const{operatorState:x}=S;if(x!==void 0&&x>=re){const[i]=lt(n,{pos:x,filename:"toString"}),o=(A=i==null?void 0:i.debugSource)==null?void 0:A.length;o!==void 0&&(C=n.slice(0,Math.max(0,x))+Fe+n.slice(x,x+o)+Ee+n.slice(Math.max(0,x+o)))}C||(C=n)}else C=JSON.stringify(n);return be(C,u,S)},[O.name]:({isExecutable:c,name:n,debugSource:u},S)=>{let C=n.replaceAll(" ","â£");return c||(C=`/${C}`),be(C,u,S)},[O.mark]:({debugSource:c},n)=>be("--mark--",c,n),[O.operator]:({operator:c,debugSource:n},u)=>{let S=`-${c.name}-`;const{operatorState:C}=u;return C!==void 0&&C!==me&&(C>re?S+=`${Fe}${C==null?void 0:C.toString()}`:C===he?S+=Ee:C===Se?S+=`${Ee}${Ee}`:C<he&&(S+=`${Ee}${C==null?void 0:C.toString()}`)),be(S,n,u)},[O.array]:({isExecutable:c,array:n,debugSource:u},S)=>{const C=[];c?C.push("{"):C.push("[");const{length:A}=n,{operatorState:x}=S;for(let i=0;i<A;++i){const o=n.at(i),h=Ft[o.type](o,Object.assign({},S,{includeDebugSource:!1,maxWidth:0,operatorState:me}));c&&x===i?C.push(Fe+h+Ee):C.push(h)}return c?C.push("}"):C.push("]"),be(C.join(" "),u,S)},[O.dictionary]:({dictionary:c,isReadOnly:n,debugSource:u},S)=>{let A=c.names.length.toString().toString();return n||(A+="/â"),be(`--dictionary(${A})--`,u,S)}};function Ve(c,n){return Ft[c.type](c,n??{includeDebugSource:!1,maxWidth:0})}function Es(c,n){const{length:u}=c,S=[];for(let C=0;C<u;++C){const A=c.at(C),x=c.operatorStateAt(C);S.push(Ve(A,Object.assign({},n,{operatorState:x})))}return S}function ae(c){return{type:O.boolean,isExecutable:!1,isReadOnly:!0,isSet:c}}function ue(c){return c%1!==0||c<Number.MIN_SAFE_INTEGER||c>Number.MAX_SAFE_INTEGER?{success:!1,exception:"undefinedResult"}:{success:!0,value:{type:O.integer,isExecutable:!1,isReadOnly:!0,integer:c}}}function Oe(c,{isExecutable:n=!1,tracker:u}={}){return u?{type:O.string,isExecutable:n,isReadOnly:!0,string:c,tracker:u}:{type:O.string,isExecutable:n,isReadOnly:!0,string:c}}function $t(c,{isExecutable:n=!1,tracker:u}={}){return u?{type:O.name,isExecutable:n,isReadOnly:!0,name:c,tracker:u}:{type:O.name,isExecutable:n,isReadOnly:!0,name:c}}const xs={[O.null]:()=>null,[O.boolean]:c=>c.isSet,[O.integer]:c=>c.integer,[O.string]:c=>c.string,[O.name]:c=>c.name,[O.mark]:()=>null,[O.operator]:c=>c.operator,[O.array]:c=>c.array,[O.dictionary]:c=>c.dictionary};function Rs(c){return xs[c.type](c)}function Te(...c){return c.map(n=>Rs(n))}const Le={};function X(c,n){var C;q(!Le[c.name],`Operator ${c.name} is not defined`),Object.freeze(c);const u={type:ye.implementation,name:c.name,typeCheck:(C=c.signature)==null?void 0:C.input,implementation:n},S={type:O.operator,isExecutable:!0,isReadOnly:!0,operator:u};if(Le[c.name]={definition:c,value:S},c.aliases)for(const A of c.aliases)Le[A]={definition:c,value:{...S,operator:{...S.operator,name:A}}};return S}function Je(c,n){const u={type:ye.constant,name:c.name,constant:n};Le[c.name]={definition:c,value:{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:u}}}const Et="string",Nt=4,Ls=4,Ds=32,rt=c=>new TextEncoder().encode(c).length+1,xt=Symbol("MemoryTracker::MemoryPointer");function Ke(c,n){return{bytes:(c.bytes??0)+(n.bytes??0),integers:(c.integers??0)+(n.integers??0),pointers:(c.pointers??0)+(n.pointers??0),values:(c.values??0)+(n.values??0)}}function nt(c){const{bytes:n=0,integers:u=0,pointers:S=0,values:C=0}=c;return n+u*Nt+S*Ls+C*Ds}class De{_total=1/0;_used=0;_peak=0;_byType={system:0,user:0,string:0};_containers=[];_byContainers;constructor(n={}){const{total:u=1/0}=n;this._total=u,n.debug&&(this._byContainers=new WeakMap)}isAvailable(n,u){q(!!u);const S=nt(n);return q(S>0),this._used+S<=this._total?{success:!0,value:S}:{success:!1,exception:"vmOverflow"}}allocate(n,u,S){q(u!=="string");const C=this.isAvailable(n,u);if(!C.success)return C;const{value:A}=C;return this.register(A,u,S),{success:!0,value:{[xt]:!0,bytes:A,type:u}}}release({bytes:n,type:u},S){this.register(-n,u,S)}register(n,u,S){if(n>0){if(this._used+n>this._total)return{success:!1,exception:"vmOverflow"}}else q(n<this._used);if(this._byType[u]+=n,this._used+=n,this._peak=Math.max(this._used,this._peak),this._byContainers&&S!==this){let C=this._byContainers.get(S);if(C===void 0){const A=new WeakRef(S);C={container:A,type:u,total:0,calls:[]},this._containers.push(A),this._byContainers.set(S,C)}if(q(C.type===u,"Unexpected memory type change",{bytes:n,type:u,container:S}),C.total+=n,q(C.total>=0,"Invalid memory registration",{bytes:n,type:u,container:S}),C.total===0){const A=this._containers.findIndex(x=>x.deref()===S);this._containers.splice(A,1),this._byContainers.delete(S)}else{let A;try{throw new Error("Capture call stack")}catch(x){A=x.stack}C.calls.push({bytes:n,type:u,stack:A})}}return{success:!0,value:void 0}}*enumContainersAllocations(){if(this._byContainers!==void 0)for(const n of this._containers)yield this._byContainers.get(n.deref())}_strings=new Map;addStringRef(n){let u=this._strings.get(n)??0;if(u===0){const S=rt(n),C=this.register(nt({bytes:S,integers:1}),Et,this);if(!C.success)return C}return this._strings.set(n,++u),{success:!0,value:u}}releaseString(n){const u=this._strings.get(n);if(q(u!==void 0,"Unable to release string as it is not referenced",n),u===1){const S=rt(n);return this.release({[xt]:!0,bytes:nt({bytes:S,integers:1}),type:Et},this),this._strings.delete(n),!1}return this._strings.set(n,u-1),!0}get used(){return this._used}get peak(){return this._peak}get total(){return this._total}get byType(){return this._byType}snapshot(){const n={used:this._used,peak:this._peak,total:this._total,byType:this._byType,string:[],system:[],user:[]};for(const[u,S]of this._strings.entries()){const C=rt(u);n.string.push({references:S,string:u,size:C,total:C+Nt})}for(const{container:u,total:S,type:C,calls:A}of this.enumContainersAllocations()){const x={container:{class:"<unknown>"},total:S,calls:A},i=u.deref();i!==void 0&&(x.container.class=i.constructor.name),C===ve?n.system.push(x):n.user.push(x)}return n}addValueRef(n){const u=Te(n)[0];q(typeof u=="string");const S=this.addStringRef(u);q(S),q(S.value!==1,"addValueRef must not be used to create a new string ref")}releaseValue(n){const u=Te(n)[0];return q(typeof u=="string"),this.releaseString(u)}}const Rt=c=>{if(c.type===O.array)return c.array;if(c.type===O.dictionary)return c.dictionary;q(!1,"Invalid value type")};class Be{static size={integers:1};_refCount;static tracker={addValueRef(n){Rt(n).addRef()},releaseValue(n){return Rt(n).release()}};constructor(){this._refCount=1}get refCount(){return this._refCount}addRef(){++this._refCount}release(){const n=--this._refCount;return n===0?(this._dispose(),!1):(q(n>0,"Superfluous release"),!0)}}class Ye extends Be{_memoryTracker;_memoryType;_initialCapacity;_capacityIncrement;_toValue({isReadOnly:n,isExecutable:u}){return{type:O.array,isReadOnly:n,isExecutable:u,tracker:Be.tracker,array:this}}toValue({isReadOnly:n=!0,isExecutable:u=!1}={}){return q(n&&!u,"Unsupported permissions"),this._toValue({isReadOnly:n,isExecutable:u})}_pointers=[];_values=[];constructor(n,u,S,C=1){super(),this._memoryTracker=n,this._memoryType=u,this._initialCapacity=S,this._capacityIncrement=C,q(this._initialCapacity>0),q(this._capacityIncrement>=0);const A=this._memoryTracker.allocate(Ye.getSize(this._initialCapacity),this._memoryType,this);q(A),this._pointers.push(A.value)}static createInstance(n,u,S,C){q(S>0),q(C>=0);const A=n.isAvailable(this.getSize(S),u);if(!A.success)return A;const x=this;return{success:!0,value:new x(n,u,S,C)}}static getSize(n){return Ke(Be.size,{pointers:1,values:n})}getIncrementSize(n){return{pointers:1,values:n}}get memoryTracker(){return this._memoryTracker}get memoryType(){return this._memoryType}get length(){return this._values.length}at(n){return this._values[n]??ne}get capacity(){return this._initialCapacity+(this._pointers.length-1)*this._capacityIncrement}increaseCapacityIfNeeded(n){const u=n-this.capacity;if(u>0){if(this._capacityIncrement===0)return{success:!1,exception:"limitcheck"};let S=Math.ceil(u/this._capacityIncrement);for(;S>0;){const C=this._memoryTracker.allocate(this.getIncrementSize(this._capacityIncrement),this._memoryType,this);if(!C.success)return C;this._pointers.push(C.value),--S}}return{success:!0,value:void 0}}_push(n){var u;for(const S of n)(u=S.tracker)==null||u.addValueRef(S),this.pushImpl(S)}push(...n){const u=this.increaseCapacityIfNeeded(this._values.length+n.length);return u.success?(this._push(n),{success:!0,value:this._values.length}):u}reduceCapacityIfNeeded(n=this._values.length){for(;this._pointers.length>1&&this.capacity-this._capacityIncrement>=n;){const u=this._pointers.at(-1);this._pointers.pop(),this._memoryTracker.release(u,this)}}_pop(){var u;let n=this.popImpl();return n.type!==O.null&&((u=n.tracker)==null?void 0:u.releaseValue(n))===!1&&(n=ne),n}pop(){const n=this._pop();return this.reduceCapacityIfNeeded(),n}popush(n,u,...S){const{capacity:C}=this;let A;Array.isArray(u)?A=[...u,...S]:u?A=[u,...S]:A=[];const x=this.length-n+A.length;if(x>C){const i=this.increaseCapacityIfNeeded(x);if(!i.success)return i}for(;n>0;)this._pop(),--n;return this._push(A),this.reduceCapacityIfNeeded(),{success:!0,value:this.length}}clear(){for(;this.length>0;)this._pop();this.reduceCapacityIfNeeded()}_dispose(){this.clear(),this._memoryTracker.release(this._pointers[0],this)}}class _t extends Ye{static create(n,u,S,C){return super.createInstance(n,u,S,C)}get top(){const n=this._values[0];return n===void 0?ne:n}pushImpl(n){this._values.unshift(n)}popImpl(){const n=this.at(0);return this._values.shift(),n}}X({name:"aload",description:"loads all items of the array in the operand stack",labels:["array"],signature:{input:[{type:O.array}]},samples:[{in:"[ 1 2 3 ] aload pop",out:"1 2 3"}]},({operands:c},n)=>{const{array:u}=n;return c.popush(1,[...Ht(u)],n)});class ut extends Ye{static create(n,u,S,C){return super.createInstance(n,u,S,C)}toValue({isReadOnly:n=!0,isExecutable:u=!1}={}){return q(n||!u,"Unsupported permissions"),this._toValue({isReadOnly:n,isExecutable:u})}pushImpl(n){return this._values.push(n),{success:!0,value:void 0}}popImpl(){const n=this._values.at(-1)??ne;return this._values.pop(),n}set(n,u){var A,x;if(n<0)return{success:!1,exception:"rangeCheck"};let S=this._values[n]??ne;((A=S.tracker)==null?void 0:A.releaseValue(S))===!1&&(S=ne);const C=this.increaseCapacityIfNeeded(n+1);return C.success?((x=u.tracker)==null||x.addValueRef(u),this._values[n]=u,{success:!0,value:S}):C}}function pt({operands:c,calls:n}){return n.top.debugSource?c.push(Object.assign({debugSource:n.top.debugSource},ht)):c.push(ht)}function Wt({operands:c,popCount:n,value:u,mark:S,closeOp:C}){return S.debugSource&&C.debugSource?c.popush(n,Object.assign({debugSource:{...S.debugSource,length:C.debugSource.pos-S.debugSource.pos+C.debugSource.length}},u)):c.popush(n,u)}const Lt="markpos",Dt="array",je=1,ot=2;function Ut(c,{isExecutable:n}){const{operands:u,memoryTracker:S,calls:C}=c,{top:A}=C;if(C.topOperatorState===re){const g=Xe(u);if(!g.success)return g;const y=g.value,d=ue(y);q(d);const s=C.def(Lt,d.value);return s.success&&(C.topOperatorState=je),s}const x=C.lookup(Lt);q(x.type===O.integer);const i=x.integer;if(C.topOperatorState===je){const g=ut.create(S,Pt,Math.max(i,1),1);if(!g.success)return g;const y=g.value,d=C.def(Dt,y.toValue({isReadOnly:n,isExecutable:n}));return d.success?C.topOperatorState=ot:y.release(),d}const o=C.lookup(Dt);q(o.type===O.array);const h=o.array;q(h instanceof ut);const p=C.topOperatorState-ot;if(p<i){C.topOperatorState=ot+p+1;const g=h.set(i-p-1,u.at(p));return g.success||(h.release(),C.topOperatorState=je),g}const a=u.at(p),_=Wt({operands:u,popCount:1+i,value:o,mark:a,closeOp:A});return C.topOperatorState=_.success?Se:je,h.release(),_}X({name:"]",description:"finalizes an array",labels:["array","mark"],signature:{output:[{type:O.array,permissions:{isReadOnly:!1,isExecutable:!1}}]},samples:[{description:"builds an array and check length and type",in:"[ 1 2 3 ] dup length exch type",out:"3 /array"},{description:"allocates an empty array",in:"[] dup length exch type",out:"0 /array"},{description:"fails if the corresponding array start does not exist",in:" 1 2 3 ]",out:"1 2 3 unmatchedmark"}]},c=>Ut(c,{isExecutable:!1}));X({name:"[",description:"marks the beginning of an array",labels:["array","mark"],signature:{output:[{type:O.mark}]},samples:[{description:"builds an array and check length and type",in:"[ 1 2 3 ] dup length exch type",out:"3 /array"}]},pt);X({name:"and",description:"combines two booleans with and",labels:["boolean"],signature:{input:[{type:O.boolean},{type:O.boolean}],output:[{type:O.boolean}]},samples:[{in:"false false and",out:"false"},{in:"false true and",out:"false"},{in:"true false and",out:"false"},{in:"true true and",out:"true"}]},({operands:c},{isSet:n},{isSet:u})=>c.popush(2,ae(n&&u)));X({name:"or",description:"combines two booleans with or",labels:["boolean"],signature:{input:[{type:O.boolean},{type:O.boolean}],output:[{type:O.boolean}]},samples:[{in:"false false or",out:"false"},{in:"false true or",out:"true"},{in:"true false or",out:"true"},{in:"true true or",out:"true"}]},({operands:c},{isSet:n},{isSet:u})=>c.popush(2,ae(n||u)));X({name:"xor",description:"combines two booleans with exclusive or",labels:["boolean"],signature:{input:[{type:O.boolean},{type:O.boolean}],output:[{type:O.boolean}]},samples:[{in:"false false xor",out:"false"},{in:"false true xor",out:"true"},{in:"true false xor",out:"true"},{in:"true true xor",out:"false"}]},({operands:c},{isSet:n},{isSet:u})=>c.popush(2,ae(n&&!u||!n&&u)));class xe extends Be{_memoryTracker;_memoryType;_initialCapacity;toValue({isReadOnly:n=!0,isExecutable:u}={}){return q(u!==!0,"Unsupported permissions"),{type:O.dictionary,isReadOnly:n,isExecutable:!1,tracker:Be.tracker,dictionary:this}}_pointer;_slots={};constructor(n,u,S){super(),this._memoryTracker=n,this._memoryType=u,this._initialCapacity=S;const C=this._memoryTracker.allocate(xe.getSize(this._initialCapacity),this._memoryType,this);q(C),this._pointer=C.value}static getSize(n){return Ke(Be.size,{pointers:1+2*n,values:n})}static create(n,u,S){const C=n.isAvailable(xe.getSize(S),u);return C.success?{success:!0,value:new xe(n,u,S)}:C}get names(){return Object.keys(this._slots)}lookup(n){var u;return((u=this._slots[n])==null?void 0:u.value)??ne}_checkInitialCapacityUsage(){let n=0;for(const u of Object.values(this._slots))u.pointer===this._pointer&&++n;return n}_getNewValueSlot(n){const u=this._memoryTracker.addStringRef(n);if(!u.success)return u;if(this._checkInitialCapacityUsage()<this._initialCapacity)return{success:!0,value:{value:ne,pointer:this._pointer}};const S=this._memoryTracker.allocate({values:1,pointers:3},this._memoryType,this);return S.success?{success:!0,value:{value:ne,pointer:S.value}}:(this._memoryTracker.releaseString(n),S)}def(n,u){var A,x;let S=this._slots[n],C=(S==null?void 0:S.value)??ne;if(S!==void 0){if(((A=C.tracker)==null?void 0:A.releaseValue(C))===!1&&(C=ne),u.type===O.null)return S.pointer!==this._pointer&&this._memoryTracker.release(S.pointer,this),this._memoryTracker.releaseString(n),delete this._slots[n],{success:!0,value:C}}else if(u.type!==O.null){const i=this._getNewValueSlot(n);if(!i.success)return i;S=i.value}return q(S!==void 0),S.value=u,(x=u.tracker)==null||x.addValueRef(u),this._slots[n]=S,{success:!0,value:C}}_dispose(){var n;for(const[u,S]of Object.entries(this._slots))this._memoryTracker.releaseString(u),(n=S.value.tracker)==null||n.releaseValue(S.value),S.pointer!==this._pointer&&this._memoryTracker.release(S.pointer,this);this._memoryTracker.release(this._pointer,this)}}X({name:">>",aliases:["Â»","dicttomark"],description:"finalizes a dictionary",labels:["dictionary","mark"],signature:{output:[{type:O.dictionary,permissions:{isExecutable:!1,isReadOnly:!1}}]},samples:[{description:"builds a dictionary check length and type",in:"<< /test 123 >> dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary check length and type",in:"Â« /test 123 Â» dup length exch type",out:"1 /dictionary"},{description:"builds a read/write dictionary",in:"Â« /test 123 Â» wcheck",out:"true"},{description:"builds a dictionary check length and type",in:"mark /test 123 dicttomark dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary with shared values, check length and type",in:"<< /test 123 /test_array [ ] /test_dictionary << >> >> dup length exch type",out:"3 /dictionary"},{description:"allocates an empty dictionary",in:"<<>> dup length exch type",out:"0 /dictionary"},{description:"fails if the corresponding dictionary start does not exist",in:"/test 123 >>",out:"/test 123 unmatchedmark"},{description:"fails if the dictionary definition is invalid (names must be strings)",in:"<< 123 /test >>",out:"mark 123 /test typecheck"},{description:"fails if the dictionary definition is invalid (missing name value pair)",in:"<< /test 123 /missing_value >>",out:"mark 123 /test /missing_value typecheck"}]},c=>{const{operands:n,memoryTracker:u,calls:S}=c,C=Xe(n);if(!C.success)return C;const A=C.value;if(A%2!==0)return{success:!1,exception:"typeCheck"};for(let p=1;p<A;p+=2)if(n.at(p).type!==O.name)return{success:!1,exception:"typeCheck"};const{top:x}=S,i=xe.create(u,Pt,A/2);if(!i.success)return i;const o=i.value;for(let p=0;p<A;p+=2){const a=n.at(p),_=n.at(p+1),[g]=Te(_),y=o.def(g,a);if(!y.success)return y}const h=Wt({operands:n,popCount:A+1,value:o.toValue({isReadOnly:!1}),mark:n.at(A),closeOp:x});return o.release(),h});X({name:"<<",aliases:["Â«"],description:"marks the beginning of a dictionary",labels:["dictionary","mark"],signature:{output:[{type:O.mark}]},samples:[{description:"builds a dictionary check length and type",in:"<< /test 123 >> dup length exch type",out:"1 /dictionary"},{description:"builds a dictionary check length and type",in:"Â« /test 123 Â» dup length exch type",out:"1 /dictionary"}]},c=>pt(c));X({name:"dictstackunderflow",description:"throws the exception : No custom dictionary left to unstack",labels:["exception"],signature:{exceptions:["dictstackunderflow"]},samples:[{in:"dictstackunderflow",out:"dictstackunderflow"}]},()=>({success:!1,exception:"dictStackUnderflow"}));X({name:"invalidaccess",description:"throws the exception : Object is read-only",labels:["exception"],signature:{exceptions:["invalidaccess"]},samples:[{in:"invalidaccess",out:"invalidaccess"}]},()=>({success:!1,exception:"invalidAccess"}));X({name:"limitcheck",description:"throws the exception : An implementation limit has been exceeded",labels:["exception"],signature:{exceptions:["limitcheck"]},samples:[{in:"limitcheck",out:"limitcheck"}]},()=>({success:!1,exception:"limitcheck"}));X({name:"rangecheck",description:"throws the exception : Operand is too big or too small",labels:["exception"],signature:{exceptions:["rangecheck"]},samples:[{in:"rangecheck",out:"rangecheck"}]},()=>({success:!1,exception:"rangeCheck"}));X({name:"stackunderflow",description:"throws the exception : Not enough operands on the stack to perform the operation",labels:["exception"],signature:{exceptions:["stackunderflow"]},samples:[{in:"stackunderflow",out:"stackunderflow"}]},()=>({success:!1,exception:"stackUnderflow"}));X({name:"stop",description:"throws the exception : Execution stopped",labels:["exception"],signature:{exceptions:["stop"]},samples:[{in:"stop",out:"stop"}]},()=>({success:!1,exception:"stop"}));X({name:"typecheck",description:"throws the exception : Operand is of the wrong type",labels:["exception"],signature:{exceptions:["typecheck"]},samples:[{in:"typecheck",out:"typecheck"}]},()=>({success:!1,exception:"typeCheck"}));X({name:"undefined",description:"throws the exception : Name is not defined in the dictionary stack",labels:["exception"],signature:{exceptions:["undefined"]},samples:[{in:"undefined",out:"undefined"}]},()=>({success:!1,exception:"undefined"}));X({name:"undefinedresult",description:"throws the exception : Result cannot be represented as a number",labels:["exception"],signature:{exceptions:["undefinedresult"]},samples:[{in:"undefinedresult",out:"undefinedresult"}]},()=>({success:!1,exception:"undefinedResult"}));X({name:"unmatchedmark",description:"throws the exception : Unmatched mark in the operand stack",labels:["exception"],signature:{exceptions:["unmatchedmark"]},samples:[{in:"unmatchedmark",out:"unmatchedmark"}]},()=>({success:!1,exception:"unmatchedMark"}));X({name:"vmoverflow",description:"throws the exception : Virtual memory exceeded",labels:["exception"],signature:{exceptions:["vmoverflow"]},samples:[{in:"vmoverflow",out:"vmoverflow"}]},()=>({success:!1,exception:"vmOverflow"}));X({name:"}",description:"finalizes a block",labels:["flow","mark"],signature:{output:[{type:O.array,permissions:{isExecutable:!0,isReadOnly:!0}}]},samples:[{description:"builds a block and check length and type",in:"{ 1 2 3 } dup length exch type",out:"3 /array"},{description:"allocated an empty block",in:"{} dup length exch type",out:"0 /array"},{description:"fails if the corresponding block start does not exist",in:"1 2 3 }",out:"1 2 3 unmatchedmark"}]},c=>(c.calls.topOperatorState===re&&c.allowCall(),Ut(c,{isExecutable:!0})));const As="Invalid operator state change";class $e extends _t{static create(n,u,S,C){return q(u===ve),super.createInstance(n,u,S,C)}_dictionaries=[];_steps=[];static getSize(n){return Ke(super.getSize(n),{integers:n,pointers:n})}getIncrementSize(n){return Ke(super.getIncrementSize(n),{integers:n,pointers:n})}pushImpl(n){super.pushImpl(n),this._dictionaries.unshift(void 0),this._steps.unshift(me)}popImpl(){const n=super.popImpl(),u=this._dictionaries[0];return u!==void 0&&u.release(),this._dictionaries.shift(),this._steps.shift(),n}snapshot(){const n=$e.create(this.memoryTracker,this.memoryType,this.length,0);if(!n.success)return n;const u=n.value;let S=this.length;for(;--S>=0;)u.push(this.at(S)),u._steps[0]=this.operatorStateAt(S);return{success:!0,value:u}}operatorStateAt(n){return this._steps[n]??me}get names(){return[]}lookup(n){const u=this._dictionaries[0];return u===void 0?ne:u.lookup(n)}def(n,u){if(this.length===0)return{success:!1,exception:"stackUnderflow"};let S=this._dictionaries[0];if(S===void 0){const C=xe.create(this.memoryTracker,ve,1);if(!C.success)return C;S=C.value,this._dictionaries[0]=S}return S.def(n,u)}get topOperatorState(){return q(this.length>0),this._steps[0]}set topOperatorState(n){const u=this.topOperatorState;(u===me&&n!==re||u!==me&&n===re||n===me||u===Se||n!==Se&&(u>re&&n<he||u<he&&n>=he||u===he&&n>re||u===re&&n<he))&&q(!1,As),this._steps[0]=n}}const jt="block",zt="exception",qt="stack",Vt=-2;function Bs(c,n,u){const{operands:S,calls:C}=c,A=C.def(jt,u);if(!A.success)return A;C.topOperatorState=he;const x=C.push(n);if(x.success){const i=S.popush(2);q(i)}return x}function Ts(c){const{calls:n}=c;if(n.topOperatorState=Vt,c.exception){const S=n.def(zt,Oe(c.exception));if(!S.success)return S;q(c.exceptionStack instanceof $e);const C=n.def(qt,c.exceptionStack.toValue());if(!C.success)return C;c.clearException()}const u=n.lookup(jt);return q(u.type!==O.null),n.push(u)}function Os(c){const{calls:n}=c;if(c.exception===void 0){const u=n.lookup(zt);if(u!==ne){q(u.type===O.string);const S=n.lookup(qt);q(S.type===O.array),c.raiseException(u.string,S.array)}}return n.topOperatorState=Se,{success:!0,value:void 0}}X({name:"finally",description:"executes the final block whenever the command block is unstacked",labels:["flow"],signature:{input:[{type:O.array,permissions:{isExecutable:!0}},{type:O.array,permissions:{isExecutable:!0}}]},samples:[{description:"always executes the final block",in:"{ 1 2 } { 3 } finally",out:"1 2 3"},{description:"does not prevent exception but enables post processing",in:"{ 1 undefined 2 } { 3 } finally",out:"1 3 undefined"},{description:"throws the last error",in:"{ 1 stackunderflow 2 } { 3 undefined 4 } finally",out:"1 3 undefined"},{description:"fails on no code block",in:"[ 1 2 ] { 3 } finally",out:"[ 1 2 ] { 3 } typecheck"}]},(c,n,u)=>{const{topOperatorState:S}=c.calls;return S===re?Bs(c,n,u):S===he?Ts(c):(q(S===Vt),Os(c))});X({name:"if",description:"executes the operand based on a condition",labels:["flow"],signature:{input:[{type:O.boolean},{type:O.null}]},samples:[{in:"mark true { 123 } if",out:"mark 123"},{in:"mark false { 123 } if",out:"mark"},{description:"supports operand that is not a block",in:"mark true 123 if",out:"mark 123"}]},({operands:c,calls:n},{isSet:u},S)=>(c.popush(2),u?n.push(S):{success:!0,value:void 0}));X({name:"ifelse",description:"executes the operands based on a condition",labels:["flow"],signature:{input:[{type:O.boolean},{type:O.null},{type:O.null}]},samples:[{in:"mark true { 123 } { 456 } ifelse",out:"mark 123"},{in:"mark false { 123 } { 456 } ifelse",out:"mark 456"},{description:"supports operands that are not blocks",in:"mark true 123 456 ifelse",out:"mark 123"}]},({operands:c,calls:n},{isSet:u},S,C)=>(c.popush(3),u?n.push(S):n.push(C)));const At="block";X({name:"loop",description:"repeatedly executes proc until proc executes the stop operator",labels:["flow","loop"],signature:{input:[{type:O.array,permissions:{isExecutable:!0}}]},samples:[{description:"executes the block until stop",in:"{ 1 count 3 eq { stop } if } loop",out:"1 1 1"},{description:"does not catch errors",in:"{ 1 typecheck } loop",out:"1 typecheck"},{description:"fails on no code block",in:"[ 1 2 ] loop",out:"[ 1 2 ] typecheck"}]},(c,n)=>{const{operands:u,calls:S}=c,{topOperatorState:C}=S;if(C===re)return S.topOperatorState=he,S.def(At,n),u.pop(),S.push(n);if(q(C===he),c.exception)return c.exception==="stop"&&c.clearException(),S.topOperatorState=Se,{success:!0,value:void 0};const A=S.lookup(At);return S.push(A)});X({name:"{",description:"marks the beginning of a block",labels:["flow","mark"],samples:[{description:"builds a block and check length and type",in:"{ 1 2 3 } dup length exch type",out:"3 /array"}]},c=>{const n=pt(c);return n.success&&c.preventCall(),n});X({name:"stopped",description:"executes the value. If execution was interrupted with stop, return true, return false otherwise",labels:["flow"],signature:{input:[{type:O.null}]},samples:[{in:"{ 1 2 3 } stopped",out:"1 2 3 false"},{in:"{ 1 2 stop 3 } stopped",out:"1 2 true"},{in:"{ 1 2 typecheck 3 } stopped",out:"1 2 typecheck"}]},(c,n)=>{const{operands:u,calls:S}=c,{topOperatorState:C}=S;if(C===re){S.topOperatorState=he;const A=S.push(n);return A.success&&u.pop(),A}return q(C===he),S.topOperatorState=Se,c.exception?c.exception==="stop"?(c.clearException(),u.push(ae(!0))):{success:!0,value:void 0}:u.push(ae(!1))});X({name:"abs",description:"returns absolute values of an integer",labels:["integer","math"],signature:{input:[{type:O.integer}],output:[{type:O.integer}]},samples:[{in:"1 abs",out:"1"},{in:"-1 abs",out:"1"}]},(c,{integer:n})=>{const{operands:u}=c;if(n<0){const S=ue(-n);return S.success?u.popush(1,S.value):S}return{success:!0,value:void 0}});X({name:"add",description:"adds two integers",labels:["integer","math"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.integer}]},samples:[{in:"1 2 add",out:"3"}]},(c,{integer:n},{integer:u})=>{const{operands:S}=c,C=ue(n+u);return C.success?S.popush(2,C.value):C});X({name:"div",description:"realizes an euclidean division with two integers",labels:["integer","math"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.integer},{type:O.integer}]},samples:[{in:"5 3 div",out:"1 2"},{in:"5 0 div",out:"undefinedresult"}]},(c,{integer:n},{integer:u})=>{const{operands:S}=c;if(u===0)return{success:!1,exception:"undefinedResult"};const C=n%u,A=ue(C);if(!A.success)return A;const x=ue((n-C)/u);return x.success?S.popush(2,x.value,A.value):x});X({name:"gt",description:"compares two integers to see if greater than",labels:["integer","math","comparison"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"1 2 gt",out:"false"},{in:"2 1 gt",out:"true"}]},({operands:c},{integer:n},{integer:u})=>c.popush(2,ae(n>u)));X({name:"gte",description:"compares two integers to see if greater than or equal",labels:["integer","math","comparison"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"1 2 gte",out:"false"},{in:"2 1 gte",out:"true"},{in:"1 1 gte",out:"true"}]},({operands:c},{integer:n},{integer:u})=>c.popush(2,ae(n>=u)));X({name:"lt",description:"compares two integers to see if lower than",labels:["integer","math","comparison"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"1 2 lt",out:"true"},{in:"2 1 lt",out:"false"}]},({operands:c},{integer:n},{integer:u})=>c.popush(2,ae(n<u)));X({name:"lte",description:"compares two integers to see if lower than or equal",labels:["integer","math","comparison"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"1 2 lte",out:"true"},{in:"2 1 lte",out:"false"},{in:"1 1 lte",out:"true"}]},({operands:c},{integer:n},{integer:u})=>c.popush(2,ae(n<=u)));X({name:"mul",description:"multiplies two integers",labels:["integer","math"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"3 4 mul",out:"12"}]},(c,{integer:n},{integer:u})=>{const{operands:S}=c,C=ue(n*u);return C.success?S.popush(2,C.value):C});X({name:"sub",description:"subtracts two integers",labels:["integer","math"],signature:{input:[{type:O.integer},{type:O.integer}],output:[{type:O.boolean}]},samples:[{in:"1 2 sub",out:"-1"}]},(c,{integer:n},{integer:u})=>{const{operands:S}=c,C=ue(n-u);return C.success?S.popush(2,C.value):C});X({name:"countexecstack",description:"retrieves the number of dictionaries in the dictionary stack",labels:["callstack"],signature:{output:[{type:O.integer}]},samples:[{in:"countexecstack",out:"3"}]},({operands:c,calls:n})=>{const u=ue(n.length);return q(u),c.push(u.value)});X({name:"begin",description:"pushes the dictionary on the dictionary stack, making it the current one",labels:["dictstack"],signature:{input:[{type:O.dictionary}]},samples:[{in:"<< /test 1 >> begin test end",out:"1"}]},({operands:c,dictionaries:n},u)=>{const S=n.push(u);return S.success&&c.pop(),S});const Ms=X({name:"pop",description:"removes the top item of the operand stack",labels:["operand"],signature:{input:[{type:O.null}]},samples:[{in:"1 2 3 pop",out:"1 2"}]},({operands:c})=>c.pop());function Is(c,n,u,S){const{calls:C,dictionaries:A}=c,x=A.where(S);if(x!==null){const i=n.set(u,x.value);if(!i.success)return i}return C.topOperatorState=u+1,{success:!0,value:void 0}}function Ps(c,n,u,S){const{operands:C,calls:A}=c;A.topOperatorState=u+1;const x=C.push(S);if(!x.success)return x;const i=A.push(Ms);if(!i.success)return i;const o=A.push(Fs);return o.success?{success:!0,value:void 0}:o}function Hs(c,n,u){const{calls:S}=c,C=n.at(u);return C.isExecutable?C.type===O.name?Is(c,n,u,C.name):(q(C.type===O.array),Ps(c,n,u,C)):(S.topOperatorState=u+1,{success:!0,value:void 0})}const Fs=X({name:"bind",description:"binds the block calls to their value by resolving the names from the dictionary stack",labels:["dictstack","flow"],signature:{input:[{type:O.array,permissions:{isExecutable:!0}}],output:[{type:O.array,permissions:{isExecutable:!0}}]},samples:[{in:"{ clear } bind 0 get",out:"systemdict /clear get"},{description:"does not fail on unknown names",in:"{ clear test_unknown bind } bind 2 get",out:"systemdict /bind get"},{description:"works recursively",in:"{ clear { bind } } bind 1 get 0 get",out:"systemdict /bind get"},{description:"works only on code blocks",in:"[ 1 2 ] bind",out:"[ 1 2 ] typecheck"},{description:"does nothing when no names are used",in:"{ {} 1 2 3 } bind",out:"{ {} 1 2 3 }"},{description:"works on mixed content",in:"{ 1 clear } bind 1 get",out:"systemdict /clear get"}]},c=>{const{operands:n,calls:u}=c,{topOperatorState:S}=u,C=n.top;q(vs(C));const{array:A}=C;return q(A instanceof ut),S<A.length?Hs(c,A,S):(u.topOperatorState=Se,{success:!0,value:void 0})});X({name:"countdictstack",description:"retrieves the number of dictionaries in the dictionary stack",labels:["dictstack"],signature:{output:[{type:O.integer}]},samples:[{in:"countdictstack",out:"4"}]},({operands:c,dictionaries:n})=>{const u=ue(n.length);return q(u.success),c.push(u.value)});X({name:"currentdict",description:"retrieves the top of the dictionary stack",labels:["dictstack"],signature:{output:[{type:O.dictionary}]},samples:[{in:"currentdict type",out:"/dictionary"}]},({operands:c,dictionaries:n})=>c.push(n.top));X({name:"def",description:"associates key with value in the current dictionary, the one on the top of the dictionary stack",labels:["dictstack"],signature:{input:[{type:O.name},{type:O.null}]},samples:[{in:"/test 1 def test",out:"/test 1 def 1"},{in:"systemdict begin /test 1 def test",out:"systemdict begin /test 1 invalidaccess"}]},({operands:c,dictionaries:n},{name:u},S)=>{if(n.top.isReadOnly)return{success:!1,exception:"invalidAccess"};const{dictionary:C}=n.top,A=C.def(u,S);return A.success?c.popush(2):A});X({name:"end",description:"pops the current dictionary off the dictionary stack, making the dictionary below it the current dictionary",labels:["dictstack"],samples:[{in:"<< /test 1 >> begin end test",out:"undefined"}]},({dictionaries:c})=>c.pop());X({name:"globaldict",description:"retrieves the global dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:O.dictionary}]},samples:[{in:"globaldict type",out:"/dictionary"}]},({operands:c,dictionaries:n})=>c.push(n.global));X({name:"systemdict",description:"retrieves the system dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:O.dictionary}]},samples:[{in:"systemdict type",out:"/dictionary"}]},({operands:c,dictionaries:n})=>c.push(n.system));X({name:"userdict",description:"retrieves the user dictionary from the dictionary stack",labels:["dictstack"],signature:{output:[{type:O.dictionary}]},samples:[{in:"userdict type",out:"/dictionary"}]},({operands:c,dictionaries:n})=>c.push(n.user));X({name:"clear",description:"clears the operand stack",labels:["operand"],samples:[{in:"1 2 3 clear",out:""}]},({operands:c})=>{for(;c.length>0;)c.pop()});X({name:"cleartomark",description:"clears the operand stack up to the first mark",labels:["operand","mark"],samples:[{in:"1 mark 2 3 cleartomark",out:"1"},{description:"fails if no mark is found",in:"1 2 3 cleartomark",out:"1 2 3 unmatchedmark"}]},({operands:c})=>{const n=Xe(c);return n.success?c.popush(n.value+1):n});X({name:"count",description:"gives back the size of the operand stack",labels:["operand"],signature:{output:[{type:O.integer}]},samples:[{in:"1 2 3 count",out:"1 2 3 3"}]},({operands:c})=>{const n=ue(c.length);return q(n.success),c.push(n.value)});X({name:"counttomark",description:"count the number of items in the operand stack up to the first mark",labels:["operand"],signature:{output:[{type:O.integer}]},samples:[{in:"1 mark 2 3 counttomark",out:"1 mark 2 3 2"},{description:"fails if no mark is found",in:"1 2 3 counttomark",out:"1 2 3 unmatchedmark"}]},({operands:c})=>{const n=Xe(c);if(!n.success)return n;const u=ue(n.value);return q(u.success),c.push(u.value)});X({name:"dup",description:"duplicates the top item of the operand stack",labels:["operand"],signature:{input:[{type:O.null}],output:[{type:O.null},{type:O.null}]},samples:[{in:"1 2 3 dup",out:"1 2 3 3"}]},({operands:c},n)=>c.push(n));X({name:"exch",description:"swaps the first two items of the operand stack",labels:["operand"],signature:{input:[{type:O.null},{type:O.null}],output:[{type:O.null},{type:O.null}]},samples:[{in:"1 2 3 exch",out:"1 3 2"}]},({operands:c},n,u)=>c.popush(2,u,n));X({name:"index",description:"duplicates the Nth item of the operand stack",labels:["operand"],signature:{input:[{type:O.integer}],output:[{type:O.null}]},samples:[{in:"1 2 3 1 index",out:"1 2 3 2"},{description:"throws stackunderflow if index is too big",in:"1 2 3 5 index",out:"1 2 3 5 stackunderflow"}]},({operands:c},{integer:n})=>n>c.length?{success:!1,exception:"stackUnderflow"}:c.popush(1,c.at(n+1)));X({name:"roll",description:"performs a circular shift of the values on the operand stack by a given amount",labels:["operand"],signature:{input:[{type:O.integer},{type:O.integer}]},samples:[{in:"100 200 300 3 -1 roll",out:"200 300 100"},{in:"100 200 300 3 1 roll",out:"300 100 200"},{in:"100 200 300 3 0 roll",out:"100 200 300"},{in:'"a" "b" "c" 3 2 roll',out:'"b" "c" "a"'},{description:"fails if the number of values to roll is invalid",in:"100 200 300 0 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 -1 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 4 0 roll",out:"100 200 300 0 0 rangecheck"},{description:"fails if the number of values to roll is invalid",in:"100 200 300 50 0 roll",out:"100 200 300 0 0 rangecheck"}]},({operands:c},{integer:n},{integer:u})=>{var C,A;if(n<=0||n>c.length-2)return{success:!1,exception:"rangeCheck"};if(c.pop(),c.pop(),u=-u%n,u===0)return;u<0&&(u+=n);const S=[];try{for(let x=n;x>0;--x){const i=c.top;S.unshift(i),(C=i.tracker)==null||C.addValueRef(i),c.pop()}for(let x=0;x<n;++x){const i=S[(x+u)%n];c.push(i)}}finally{for(const x of S)(A=x.tracker)==null||A.releaseValue(x)}return{success:!0,value:void 0}});X({name:"cvi",description:"converts to integer",labels:["value","generic","conversion"],signature:{input:[{type:O.null}],output:[{type:O.integer}]},samples:[{in:"1 cvi",out:"1"},{in:'"1" cvi',out:"1"},{description:"fails if number goes beyond limit",in:'"9007199254740992" cvi',out:"undefinedresult"},{in:"/1 cvi",out:"typecheck"},{in:"<< >> cvi",out:"typecheck"}]},({operands:c},n)=>{if(n.type!==O.integer)if(n.type===O.string){const u=Number.parseInt(n.string,10),S=ue(u);return S.success?c.popush(1,S.value):S}else return{success:!1,exception:"typeCheck"};return{success:!0,value:void 0}});X({name:"cvlit",description:"removes executable flag",labels:["value","generic","conversion"],signature:{input:[{type:O.null}],output:[{type:O.null,permissions:{isExecutable:!1}}]},samples:[{in:"1 cvlit",out:"1"},{description:"converts a block to a read-only array",in:"{ 1 } cvlit dup xcheck exch wcheck",out:"false false"},{description:"converts a call to a name",in:"{ test } 0 get cvlit",out:"/test"}]},({operands:c},n)=>n.isExecutable?c.popush(1,{...n,isExecutable:!1}):{success:!0,value:void 0});X({name:"cvn",description:"converts to name",labels:["value","generic","conversion"],signature:{input:[{type:O.string}],output:[{type:O.name}]},samples:[{in:'"test" cvn',out:"/test"},{in:"/test cvn",out:"typecheck"},{in:"1 cvn",out:"typecheck"}]},({operands:c,memoryTracker:n},{string:u})=>{q(n instanceof De);const S=n.addStringRef(u);if(!S.success)return S;const C=c.popush(1,$t(u,{tracker:n}));return n.releaseString(u),C});X({name:"eq",description:"compares two values and return true if they are strictly equal",labels:["generic","comparison"],signature:{input:[{type:O.null},{type:O.null}],output:[{type:O.boolean}]},samples:[{in:"1 1 eq",out:"true"},{in:"1 2 eq",out:"false"},{in:'1 "1" eq',out:"false"},{in:"[ ] [ ] eq",out:"false"},{in:"[ ] dup eq",out:"true"}]},({operands:c},n,u)=>{let S;if(n.type===u.type){const[C,A]=Te(n,u);S=C===A}else S=!1;return c.popush(2,ae(S))});Je({name:"false",description:"pushes false in the operand stack",labels:["value"],signature:{output:[{type:O.boolean}]},samples:[{in:"false type",out:"/boolean"}]},ae(!1));const $s={[O.string]:({string:c,tracker:n},u)=>{q(n instanceof De);const S=qe(u,c.length);if(!S.success)return S;const C=c.charAt(S.value),A=n.addStringRef(C);return A.success?{success:!0,value:Oe(C,{tracker:n})}:A},[O.array]:({array:c},n)=>{var C;const u=qe(n,c.length);if(!u.success)return u;const S=c.at(u.value);return(C=S.tracker)==null||C.addValueRef(S),{success:!0,value:S}},[O.dictionary]:({dictionary:c},n)=>{var C;if(n.type!==O.name)return{success:!1,exception:"typeCheck"};const{name:u}=n;if(!c.names.includes(u))return{success:!1,exception:"undefined"};const S=c.lookup(u);return(C=S.tracker)==null||C.addValueRef(S),{success:!0,value:S}}};X({name:"get",description:"returns an indexed item from the value",labels:["generic"],signature:{input:[{type:O.null},{type:O.null}],output:[{type:O.null}]},samples:[{description:"returns the Nth item of an array",in:"[ 1 2 3 ] 1 get",out:"2"},{description:"returns the Nth item of an executable array",in:"{ 1 2 3 } 1 get",out:"2"},{description:"fails if invalid index for the array",in:"[ 1 2 3 ] /a get",out:"[ 1 2 3 ] /a typecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] -1 get",out:"[ 1 2 3 ] -1 rangecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] 3 get",out:"[ 1 2 3 ] -1 rangecheck"},{description:"returns the Nth character of a string",in:'"abc" 1 get',out:'"b"'},{description:"fails if invalid index for a string",in:'"abc" "a" get',out:'"abc" "a" typecheck'},{description:"fails if out of bound index for a string",in:'"abc" -1 get',out:'"abc" -1 rangecheck'},{description:"fails if out of bound index for a string",in:'"abc" 3 get',out:'"abc" 3 rangecheck'},{description:"returns the indexed item of a dictionary",in:"systemdict /get get",out:"{ get } bind 0 get"},{description:"returns the indexed item of a dictionary (handles reference counting)",in:'/test "abc" def userdict /test get',out:'/test "abc" def "abc"'},{description:"fails if invalid index for a dictionary",in:"systemdict 0 get",out:"systemdict 0 typecheck"},{description:"fails if unknown index for a dictionary",in:"systemdict /not_an_operator get",out:"systemdict /not_an_operator undefined"},{description:"fails if not a container",in:"1 1 get",out:"1 1 typecheck"},{description:"fails if not a container",in:"false 1 get",out:"false 1 typecheck"},{description:"fails if not a container",in:"mark 1 get",out:"mark 1 typecheck"}]},({operands:c},n,u)=>{var i;const S=$s[n.type];if(S===void 0)return{success:!1,exception:"typeCheck"};const C=S(n,u);if(!C.success)return C;const{value:A}=C,x=c.popush(2,A);return(i=A.tracker)==null||i.releaseValue(A),x});const Ns={[O.string]:({string:c})=>c.length,[O.array]:({array:c})=>c.length,[O.dictionary]:({dictionary:c})=>c.names.length};X({name:"length",description:"returns the length of the value",labels:["generic"],signature:{input:[{type:O.null}],output:[{type:O.integer}]},samples:[{description:"returns the number of items in an array",in:"[ 1 2 3 ] length",out:"3"},{description:"returns the number of items in an executable array",in:"{ 1 2 3 } length",out:"3"},{description:"returns the size of a string",in:'"abc" length',out:"3"},{description:"returns the number of keys in a dictionary",in:"systemdict length 0 gt",out:"true"},{description:"fails if not a container",in:"1 length",out:"1 typecheck"},{description:"fails if not a container",in:"false length",out:"false typecheck"},{description:"fails if not a container",in:"mark length",out:"mark typecheck"}]},({operands:c},n)=>{const u=Ns[n.type];if(u===void 0)return{success:!1,exception:"typeCheck"};const S=ue(u(n));return q(S.success),c.popush(1,S.value)});Je({name:"mark",description:"pushes a mark in the operand stack",labels:["value","mark"],signature:{output:[{type:O.mark}]},samples:[{in:"1 2 mark",out:"1 2 mark"},{description:"marks part of the stack for operations",in:"1 2 mark 3 4 5 cleartomark",out:"1 2"}]},ht);X({name:"neq",description:"compares two values and return true if they are strictly different",labels:["generic","comparison"],signature:{input:[{type:O.null},{type:O.null}],output:[{type:O.boolean}]},samples:[{in:"1 1 neq",out:"false"},{in:"1 2 neq",out:"true"},{in:'1 "1" neq',out:"true"},{in:"[ ] [ ] neq",out:"true"},{in:"[ ] dup neq",out:"false"}]},({operands:c},n,u)=>{let S;if(n.type===u.type){const[C,A]=Te(n,u);S=C!==A}else S=!0;return c.popush(2,ae(S))});const Ws={[O.string]:({string:c,tracker:n},u,S)=>{if(q(n instanceof De),S.type!==O.integer)return{success:!1,exception:"typeCheck"};const{integer:C}=S;if(C<0||C>65535)return{success:!1,exception:"rangeCheck"};const A=qe(u,c.length);if(!A.success)return A;const x=c.slice(0,Math.max(0,A.value))+String.fromCodePoint(C)+c.slice(Math.max(0,A.value+1)),i=n.addStringRef(x);return i.success?{success:!0,value:Oe(x,{tracker:n})}:i},[O.array]:(c,n,u)=>{var i;const{array:S,isReadOnly:C}=c;if(C)return{success:!1,exception:"invalidAccess"};const A=qe(n,S.length);if(!A.success)return A;const x=S.set(A.value,u);return x.success?((i=c.tracker)==null||i.addValueRef(c),{success:!0,value:c}):x},[O.dictionary]:(c,n,u)=>{var i;const{dictionary:S,isReadOnly:C}=c;if(C)return{success:!1,exception:"invalidAccess"};if(n.type!==O.name)return{success:!1,exception:"typeCheck"};const{name:A}=n,x=S.def(A,u);return x.success?((i=c.tracker)==null||i.addValueRef(c),{success:!0,value:c}):x}};X({name:"put",description:"sets an indexed item in the value",postScriptDeviation:"returns the modified object or a new string",labels:["generic"],signature:{input:[{type:O.null},{type:O.null},{type:O.null}],output:[{type:O.null}]},samples:[{description:"sets the Nth item of an array",in:"[ 1 2 3 ] 1 5 put",out:"[ 1 5 3 ]"},{description:"fails if the array is not writable",in:"{ 1 2 3 } 1 5 put",out:"{ 1 2 3 } 1 5 invalidaccess"},{description:"fails if invalid index for the array",in:'[ 1 2 3 ] "a" 5 put',out:'[ 1 2 3 ] "a" 5 typecheck'},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] -1 5 put",out:"[ 1 2 3 ] -1 5 rangecheck"},{description:"fails if out of bound index for the array",in:"[ 1 2 3 ] 3 5 put",out:"[ 1 2 3 ] 3 5 rangecheck"},{description:"sets the Nth character of a string (returns a new string, using ascii code)",in:'"abc" 1 66 put',out:'"aBc"'},{description:"fails if setting an invalid value",in:'"abc" 1 "B" put',out:'"abc" 1 "B" typecheck'},{description:"fails if setting an invalid value",in:'"abc" 1 -1 put',out:'"abc" 1 -1 rangecheck'},{description:"fails if setting an invalid value",in:'"abc" 1 65536 put',out:'"abc" 1 65536 rangecheck'},{description:"fails if invalid index for a string",in:'"abc" "a" 66 put',out:'"abc" "a" 66 typecheck'},{description:"fails if out of bound index for a string",in:'"abc" -1 66 put',out:'"abc" -1 66 rangecheck'},{description:"fails if out of bound index for a string",in:'"abc" 3 66 put',out:'"abc" 3 66 rangecheck'},{description:"sets an indexed item of a dictionary",in:"userdict /test 123 put pop test",out:"userdict /test 456 put pop 123"},{description:"fails if the dictionary is not writable",in:"systemdict /test 123 put",out:"systemdict /test 123 invalidaccess"},{description:"fails if invalid index for a dictionary",in:"userdict 0 123 put",out:"userdict 0 123 typecheck"},{description:"fails if not a container",in:"1 0 1 put",out:"1 0 1 typecheck"},{description:"fails if not a container",in:"false 0 1 put",out:"false 0 1 typecheck"},{description:"fails if not a container",in:"mark 0 1 put",out:"mark 0 1 typecheck"}]},({operands:c},n,u,S)=>{var o;const C=Ws[n.type];if(C===void 0)return{success:!1,exception:"typeCheck"};const A=C(n,u,S);if(!A.success)return A;const{value:x}=A,i=c.popush(3,x);return(o=n.tracker)==null||o.releaseValue(x),i});Je({name:"true",description:"pushes true in the operand stack",labels:["value"],signature:{output:[{type:O.boolean}]},samples:[{in:"true type",out:"/boolean"}]},ae(!0));X({name:"type",description:"pushes the type of the value in the operand stack",labels:["value","generic"],signature:{input:[{type:O.null}],output:[{type:O.name}]},samples:[{in:"false type",out:"/boolean"},{in:"[ 1 2 3 ] type",out:"/array"},{in:'"" type',out:"/string"},{in:"/type type",out:"/name"}]},({operands:c,memoryTracker:n},u)=>{q(n instanceof De);const{type:S}=u,C=n.addStringRef(S);if(!C.success)return C;const A=c.popush(1,$t(S,{tracker:n}));return n.releaseString(S),A});const Us="@psbots/engine@0.0.1";Je({name:"version",description:"returns a string that identifies the version of the engine",labels:["value"],signature:{output:[{type:O.string}]},samples:[{in:"version type",out:"/string"}]},Oe(Us));X({name:"wcheck",description:"checks if value is writable",labels:["value","generic","permission"],signature:{input:[{type:O.null}],output:[{type:O.boolean}]},samples:[{description:"returns false for blocks",in:"{ 1 2 } wcheck",out:"false"},{description:"returns true for arrays",in:"[ 1 2 ] wcheck",out:"true"}]},({operands:c},n)=>c.popush(1,ae(!n.isReadOnly)));X({name:"xcheck",description:"checks if value is executable",labels:["value","generic","permission"],signature:{input:[{type:O.null}],output:[{type:O.boolean}]},samples:[{description:"returns true for blocks",in:"{ 1 2 } xcheck",out:"true"},{description:"returns false for arrays",in:"[ 1 2 ] xcheck",out:"false"}]},({operands:c},n)=>c.popush(1,ae(n.isExecutable)));class gt{constructor(){}static _instance;static get instance(){return this._instance??=new gt,this._instance}get names(){return Object.keys(Le)}lookup(n){const u=Le[n];return u!==void 0?u.value:ne}}class Re{constructor(){}static _instance;static get instance(){return this._instance??=new Re,this._instance}get names(){return[]}lookup(){return ne}def(n,u){return q(!!n),q(!!u),{success:!1,exception:"invalidAccess"}}}const ze=4,Bt=-1,js=-2,at=-3,ct=-4;class zs extends _t{static create(n,u,S,C){return q(u===ve),q(S>4),super.createInstance(n,u,S,C)}constructor(n,u,S,C){super(n,u,S,C),this.begin({type:O.dictionary,isExecutable:!1,isReadOnly:!0,dictionary:Re.instance}),this.begin({type:O.dictionary,isExecutable:!1,isReadOnly:!0,dictionary:gt.instance}),this.begin({type:O.dictionary,isExecutable:!1,isReadOnly:!1,dictionary:Re.instance}),this.begin({type:O.dictionary,isExecutable:!1,isReadOnly:!1,dictionary:Re.instance})}getDictionaryValue(n){const u=this._values[this._values.length+n];return q(!!u&&u.type===O.dictionary),u}setHost(n){var u;this._values[ze+Bt]=n,(u=n.tracker)==null||u.addValueRef(n)}setGlobal(n){var S;const u=this.getDictionaryValue(at);q(u.dictionary===Re.instance),this._values[ze+at]=n,(S=n.tracker)==null||S.addValueRef(n)}setUser(n){var S;const u=this.getDictionaryValue(ct);q(u.dictionary===Re.instance),this._values[ze+ct]=n,(S=n.tracker)==null||S.addValueRef(n)}get top(){return super.top}get host(){return this.getDictionaryValue(Bt)}get system(){return this.getDictionaryValue(js)}get global(){return this.getDictionaryValue(at)}get user(){return this.getDictionaryValue(ct)}begin(n){return this.push(n)}end(){return this.length===ze?{success:!1,exception:"dictStackUnderflow"}:(this.pop(),{success:!0,value:this.length})}where(n){for(const u of this._values){const{dictionary:S}=u,C=S.lookup(n);if(C.type!==O.null)return{dictionary:S,value:C}}return null}lookup(n){const u=this.where(n);return u===null?{success:!1,exception:"undefined"}:{success:!0,value:u.value}}}function Kt(c,n){const{calls:u}=c,S=n.operator;if(u.topOperatorState>=re||u.topOperatorState===Se)u.pop();else{const C=S.implementation(c);C&&C.success===!1&&c.raiseException(C.exception)}}function qs(c,n){var o;const{operands:u,memoryTracker:S}=c;q(S instanceof De),q(n.typeCheck!==void 0);let{length:C}=n.typeCheck;if(u.length<C){c.raiseException("stackUnderflow");return}const A=S.allocate({values:C},ve,c);if(!A.success){c.raiseException(A.exception);return}const x=[],i=A.value;for(const{type:h,permissions:p}of n.typeCheck){const a=u.at(--C),{isReadOnly:_,isExecutable:g}=p??{};if((h===O.null||h===a.type)&&(_===void 0||_===a.isReadOnly)&&(g===void 0||g===a.isExecutable))x.push(a);else{c.raiseException("typeCheck"),S.release(i,c);return}}for(const h of x)(o=h.tracker)==null||o.addValueRef(h);return{valuesMemory:i,values:x}}function Vs(c,n){var p;const{calls:u,memoryTracker:S}=c;q(S instanceof De);const{top:C}=u,A=u.topOperatorState===me;A&&(u.topOperatorState=re);let x,i=[];if(n.typeCheck!==void 0&&A){const a=qs(c,n);if(a===void 0)return;x=a.valuesMemory,i=a.values}const o=c.exception,h=n.implementation(c,...i);if(x!==void 0){for(const a of i)(p=a.tracker)==null||p.releaseValue(a);S.release(x,c)}h&&h.success===!1&&c.raiseException(h.exception),c.exception===o&&u.length>0&&u.top===C&&(u.topOperatorState===Se||u.topOperatorState===re)&&u.pop()}function Ks(c,n){const{operands:u,calls:S}=c;if(S.topOperatorState<=re){Kt(c,n);return}const C=n.operator;C.type===ye.constant?(u.push(C.constant),S.pop()):Vs(c,C)}function Gs(c,n){const{dictionaries:u,calls:S,callEnabled:C,operands:A}=c;if(S.topOperatorState===re)S.pop();else if(C||["{","}","<<","Â«",">>","Â»"].includes(n.name)){S.topOperatorState=re;const x=u.lookup(n.name);if(!x.success){c.raiseException(x.exception);return}const i=x.value;n.debugSource?S.push(Object.assign({debugSource:n.debugSource},i)):S.push(i)}else A.push(n),S.pop()}function Xs({calls:c,operands:n},{array:u}){const{length:S}=u;if(c.topOperatorState===me?c.topOperatorState=re:c.topOperatorState++,c.topOperatorState===S)c.pop();else{const C=c.topOperatorState,A=u.at(C);!A.isExecutable||A.type===O.array?n.push(A):c.push(A)}}const dt="unknown";function Js(c,n){var S,C;const{calls:u}=c;if(u.topOperatorState===me){u.topOperatorState=re;const[A]=lt(n.string,{pos:0,filename:((S=n.debugSource)==null?void 0:S.filename)??dt});return A}else{const[,A]=lt(n.string,{pos:u.topOperatorState,filename:((C=n.debugSource)==null?void 0:C.filename)??dt});return A}}function Ys(c,n){var o;const{calls:u,operands:S}=c,C=c.memoryTracker,{pos:A}=n.debugSource;if(A>0&&(u.topOperatorState=A),((o=n.debugSource)==null?void 0:o.filename)===dt){const{debugSource:h,...p}=n;n=p}let x;if(n.type===O.string||n.type===O.name){x=Te(n)[0];const h=C.addStringRef(x);if(!h.success){c.raiseException(h.exception);return}Object.assign(n,{tracker:C})}const i=n.isExecutable?u.push(n):S.push(n);x!==void 0&&C.releaseString(x),i.success||c.raiseException(i.exception)}function Zs(c,n){const{calls:u}=c,S=Js(c,n);S?Ys(c,S):u.pop()}class vt{_memoryTracker;_dictionaries;_operands;_calls;_exception;_exceptionStack;_destroyed=!1;constructor(n,u,S,C){this._memoryTracker=n,this._dictionaries=u,this._operands=S,this._calls=C}static create(n={}){const u=new De({total:n.maxMemoryBytes,debug:n.debugMemory}),S=zs.create(u,ve,10,1);if(!S.success)return S;const C=S.value;n.hostDictionary&&C.setHost({type:O.dictionary,isReadOnly:!0,isExecutable:!1,dictionary:n.hostDictionary});const A=xe.create(u,ve,10);if(!A.success)return A;C.setGlobal(A.value.toValue({isReadOnly:!1})),A.value.release();const x=xe.create(u,ve,10);if(!x.success)return x;C.setUser(x.value.toValue({isReadOnly:!1})),x.value.release();const i=_t.create(u,ve,10,5);if(!i.success)return i;const o=$e.create(u,ve,10,5);return o.success?{success:!0,value:new vt(u,C,i.value,o.value)}:o}get destroyed(){return this._destroyed}_checkIfDestroyed(){q(!this._destroyed,"State instance destroyed")}_resetException(){this._exception!==void 0&&(this._exception=void 0),this._exceptionStack!==void 0&&(this._exceptionStack.release(),this._exceptionStack=void 0)}get idle(){return this._checkIfDestroyed(),this._calls.length===0}get memoryTracker(){return this._memoryTracker}get operands(){return this._checkIfDestroyed(),this._operands}get dictionaries(){return this._checkIfDestroyed(),this._dictionaries}_callDisablingCount=0;get callEnabled(){return this._callDisablingCount===0}get exception(){return this._checkIfDestroyed(),this._exception}get exceptionStack(){return this._checkIfDestroyed(),this._exceptionStack}exec(n){return this._checkIfDestroyed(),this.idle?(this._resetException(),this.calls.push(n),{success:!0,value:this.run()}):{success:!1,exception:"invalidAccess"}}destroy(){this._checkIfDestroyed(),this._resetException(),this._calls.release(),this._operands.release(),this._dictionaries.release(),this._destroyed=!0;const{used:n}=this._memoryTracker;q(n===0,"Memory leaks detected")}raiseException(n,u){if(this._resetException(),this._exception=n,u!==void 0)q(u instanceof $e),this._exceptionStack=u,this._exceptionStack.addRef();else if(n!=="vmOverflow"){const S=this._calls.snapshot();q(S),this._exceptionStack=S.value}}clearException(){this._resetException()}get calls(){return this._calls}allowCall(){++this._callDisablingCount}preventCall(){--this._callDisablingCount}*run(){for(;this.calls.length>0;)this.cycle(),yield}cycle(){const n=this._calls,{top:u}=n;this._exception?u.type===O.operator?Kt(this,u):n.pop():u.isExecutable?u.type===O.operator?Ks(this,u):u.type===O.name?Gs(this,u):u.type===O.array?Xs(this,u):u.type===O.string?Zs(this,u):q(!1,"Unsupported executable value"):(this._operands.push(u),n.pop())}}function Gt(c){return vt.create(c)}function Qs(){const c={};for(const[n,u]of Object.entries(Le))c[n]=u.definition;return c}const de="\x1B[31m",Xt="\x1B[32m",oe="\x1B[33m",Ge="\x1B[34m",Jt="\x1B[35m",le="\x1B[36m",ee="\x1B[37m";function ei(c){return{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"exit",type:ye.implementation,implementation:()=>c.exit()}}}const ti=[{factor:1024*1024,unit:"MB"},{factor:1024,unit:"kB"}];function Ce(c){for(const n of ti)if(c>=n.factor)return`${(c/n.factor).toFixed(2)}${n.unit}`;return`${c}B`}function Yt(c){const{used:n,peak:u,total:S}=c.memoryTracker,C=Ce(n)+" (top:"+Ce(u)+")"+Ge+"/";return S===1/0?C+"â"+ee:C+Ce(S)+ee}function ft(c,n){if(n>c){const u=`+${n-c}`;return{length:u.length+1,formatted:` ${de}${u}`}}else if(n<c){const u=`-${c-n}`;return{length:u.length+1,formatted:` ${de}${u}`}}return{length:0,formatted:""}}function Zt(c,n){if(n>c){const u=`+${Ce(n-c)}`;return{length:u.length+1,formatted:` ${de}${u}`}}else if(n<c){const u=`-${Ce(c-n)}`;return{length:u.length+1,formatted:` ${Xt}${u}`}}return{length:0,formatted:""}}function si(c,n){const u="cycles: ",S=c.operands.length,C=ft(n.lastOperandsCount??S,S).formatted,A=c.memoryTracker.used,x=Zt(n.lastUsedMemory??A,A).formatted;let i="";return c.callEnabled||(i+=` ${de}!call`),c.exception&&(i+=` ${de}â${c.exception}`),[`${le}${u}${oe}${n.cycle}`,i,`${le} operands: ${oe}${c.operands.length}${C}`,`${le} memory: ${oe}${Yt(c)}${x}`,ee,n.concat,ee,`\r
`].join("")}function mt(c,n,u){const{includeDebugSource:S,includeIndex:C}={includeDebugSource:!0,includeIndex:!0,...u};let A=0;for(const x of Ht(n)){const i=A.toString();let o=c.width;C&&(o-=i.length+1);const h=Ve(x,{includeDebugSource:S,maxWidth:o}),p=h.match(/^(.*)@([^:@]+:\d+:\d+)$/);let a=h,_="";p&&(a=p[1],_=`${Ge}@${p[2]}`),C?c.output(`${i} ${a}${_}${ee}\r
`):c.output(`${a}${_}${ee}\r
`),++A}}function Qt(c,n){c.output(`${le}operands: ${oe}${n.operands.length}${ee}\r
`),mt(c,n.operands)}function ii(c,n){const u=n.dictionaries.length;c.output(`${le}memory: ${oe}${Yt(n)}${ee}\r
`),c.output(`${le}dictionaries: ${oe}${u}${ee}\r
`),mt(c,n.dictionaries),Qt(c,n)}function ri(c){return{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"exit",type:ye.implementation,implementation:n=>{ii(c,n)}}}}function ni(c){return{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"help",type:ye.implementation,implementation:()=>{const n=Qs(),u=Object.keys(n).sort();for(const S of u){const C=n[S];c.output(`${oe}${S}${le} ${C==null?void 0:C.description}${ee}\r
`)}}}}}function oi(c){return{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"pstack",type:ye.implementation,implementation:({operands:n})=>{mt(c,n,{includeDebugSource:!1,includeIndex:!1})}}}}function ai(c){return{type:O.operator,isExecutable:!0,isReadOnly:!0,operator:{name:"debug",type:ye.implementation,implementation:()=>c.debug()}}}class ci{mappings={};constructor(n){this.mappings.exit=ei(this),this.mappings.state=ri(n),this.mappings.help=ni(n),this.mappings.pstack=oi(n),this.mappings.debug=ai(this)}get names(){return Object.keys(this.mappings)}lookup(n){return this.mappings[n]??ne}_exit=!1;get exitCalled(){return this._exit}exit(){this._exit=!0}_debug=!1;get debugIsOn(){return this._debug}debug(n=!0){this._debug=n}}class St extends Error{constructor(){super(),this.name=this.constructor.name}}class li extends St{}class hi extends St{}const Tt=()=>{},ui=(c,n,u)=>{if(u.charAt(0)==="\x1B")return;let S;if(u.includes("\r")){const C=u.split("\r");S=C.pop();for(const A of C)c.output(A),c.output(`\r
`),n(A,!0)}else S=u;S.length>0&&(c.output(S),n(S))};function di(c){const n=[];let u=Promise.resolve(),S=Tt,C=Tt;const A=(x,i=!1)=>{x.length>0&&(n[0]=n[0]+x),i&&n.unshift(""),S(),u=new Promise((o,h)=>{S=o,C=h})};return A("",!0),c.input(x=>{if(x.length>1)ui(c,A,x);else if(x==="\r")c.output(`\r
`),A("",!0);else if(x==="\b"||x===""){const i=n[0];i&&i.length>0&&(c.output("\b \b"),n[0]=i.slice(0,Math.max(0,i.length-1)))}else x===""?C(new li):x==="\x1B"?C(new hi):(x>=" "&&x<="~"||x>="Â ")&&(c.output(x),A(x,!1))}),{async waitForLines(){const x=async()=>{if(await u,n.length===1)return x();let i=!1;return await Promise.race([u.then(()=>{i=!0}),new Promise(o=>setTimeout(o,50))]),i?x():n.splice(1).reverse().join(`
`)};return x()},async waitForChar(){n.length===1&&n[0].length===0&&await u;const x=n.at(-1),i=x.charAt(0),o=x.slice(1);return o.length>0||n.length===1?n[n.length-1]=o:n.pop(),i}}}function es(c,n,u={}){return n.success?!1:(u.message&&c.output(`${de}${u.message}${ee}\r
`),ts(c,n.exception,u.stack),!0)}function ts(c,n,u){if(c.output(`${de}â ${n}${ee}\r
`),u)for(const S of Es(u))c.output(`${de}${S}${ee}\r
`)}function Ot(c,n){let u,S;n instanceof Error?(u=n.name,S=n.message):(u="Unknown error",S=JSON.stringify(n)),S.length>0&&(S=": "+S),c.output(`${de}ð£ ${u}${S}${ee}\r
`)}const _e=Jt,Ne=Xt;function Mt(c){const n=[...c],u=n.indexOf(Fe),S=n.indexOf(Ee,u);u!==-1&&S!==-1&&(n.splice(S+1,0,ee),n.splice(u,0,oe));const C=n.lastIndexOf("@");return C!==-1&&(n.splice(C,0,Ge),n.push(ee)),n.map(A=>"â¦âµâ­²".includes(A)?`${Ge}${A}${ee}`:A).join("")}function fi({replIO:c,state:n,cycle:u,width:S,lastUsedMemory:C}){const x=8+u.toString().length,i=`${ee}Cycle: #${oe}${u.toString()}`,o=S-3-x;c.output(`${_e}â${"".padStart(x,"â")}â¬${"".padStart(o,"â")}â`);const h=Zt(C,n.memoryTracker.used),p=Ce(n.memoryTracker.used);let a=8+p.length,_=`${Ne}M${ee}emory: ${oe}${p}`;a+h.length<o&&(_+=h.formatted,a+=h.length);const g=` (user: ${Ce(n.memoryTracker.byType.user)}, strings: ${Ce(n.memoryTracker.byType.string)}, system: ${Ce(n.memoryTracker.byType.system)})`;return a+g.length<=o&&(_+=`${ee}${g}`,a+=g.length),c.output(`â${i}${_e}â${_}${"".padStart(o-a," ")}${_e}â`),x}function _i({replIO:c,state:n,width:u,cycleInfoLength:S,lastOperandsCount:C,lastCallStackSize:A}){const x=Math.floor((u-3)/2),i=u-3-x;c.output(`${_e}â${"".padStart(S,"â")}â´${"".padStart(x-S-1,"â")}â¬${"".padStart(i,"â")}â¤`);const o=ft(C,n.operands.length);let h=`${Ne}O${ee}perands: ${oe}${n.operands.length}`,p=10+n.operands.length.toString().length;p+o.length<x&&(h+=o.formatted,p+=o.length),c.output(`${_e}â${h}${"".padStart(x-p," ")}`);const a=ft(A,n.calls.length);let _=`${ee}C${Ne}a${ee}ll stack: ${oe}${n.calls.length}`,g=12+n.calls.length.toString().length,y="",d=0;return n.exception&&(y=` ${de}â${n.exception}`,d=n.exception.length+2),g+a.length+d<i?(_+=a.formatted+y,g+=a.length+d):g+d<i?(_+=y,g+=d):n.exception&&g+2<i&&(_+=" â",g+=2),c.output(`${_e}â${_}${"".padStart(i-g," ")}${_e}â`),{operandsWidth:x,callStackWidth:i}}function pi({replIO:c,state:n,operandsWidth:u,callStackWidth:S}){const C=n.calls;for(let A=0;A<5;++A){c.output(`${_e}â${ee}`);const x=n.operands.at(A);if(x===null)c.output("".padStart(u," "));else{const i=Ve(x,{maxWidth:u,includeDebugSource:!0});c.output(`${Mt(i)}${"".padStart(u-i.length," ")}`)}if(c.output(`${_e}â${ee}`),A<C.length){const i=n.calls.at(A),o=n.calls.operatorStateAt(A),h=Ve(i,{maxWidth:S,operatorState:o,includeDebugSource:!0}),p=h.length;c.output(`${Mt(h)}${"".padStart(S-p," ")}`)}else c.output("".padStart(S," "));c.output(`${_e}â`)}c.output(`${_e}â${"".padStart(u,"â")}â´${"".padStart(S,"â")}â`)}async function gi({replIO:c,state:n,hostDictionary:u,iterator:S,waitForChar:C}){let A=n.operands.length,x=n.memoryTracker.used,i=n.calls.length,o=0;for(;u.debugIsOn;){const{width:h,height:p}=c;if(h<40||p<10)return c.output(`${de}â ï¸ Output too small for debugger${ee}
`),0;c.output("\x1B[1;1H\x1B[J");const a=fi({replIO:c,state:n,cycle:o,width:h,lastUsedMemory:x}),{operandsWidth:_,callStackWidth:g}=_i({replIO:c,state:n,width:h,cycleInfoLength:a,lastOperandsCount:A,lastCallStackSize:i});pi({replIO:c,state:n,operandsWidth:_,callStackWidth:g}),c.output(`${Ne}c${ee}ontinue ${Ne}q${ee}uit`),A=n.operands.length,x=n.memoryTracker.used,i=n.calls.length;const y=await C();if(c.output("\b \b"),y==="o")Qt(c,n);else if(y==="q"){u.debug(!1);break}++o;const{done:d}=S.next();if(d)break}return c.output("\x1B[1;1H\x1B[J"),o}function vi(c){const n=Gt();if(es(c,n,{message:"Unable to allocate state"}))return!1;const{value:u}=n;Ss(u.exec(Oe("version",{isExecutable:!0})));const S=u.operands.at(0);return q(S.type===O.string),c.output(`${le}Welcome to ð¤${Jt}${S.string}${ee}\r
`),!0}async function mi(c,n){if(!vi(c))return;const u=new ci(c),S=Gt({hostDictionary:u,debugMemory:n});if(es(c,S,{message:"Unable to allocate state"}))return;const{value:C}=S;c.output(`${le}Use '${oe}exit${le}'  to quit${ee}\r
`),c.output(`${le}Use '${oe}state${le}' to print a state summary${ee}\r
`),c.output(`${le}Use '${oe}help${le}'  to display help${ee}\r
`);let A=0;const{waitForLines:x,waitForChar:i}=di(c);for(;;){c.output("? ");try{const o=await x(),h=C.operands.length,p=C.memoryTracker.used;let a=0;const _=C.exec(Object.assign({debugSource:{filename:`repl${A++}`,pos:0,length:o.length,source:o}},Oe(o,{isExecutable:!0})));q(_);const{value:g}=_;let{done:y}=g.next();for(;y===!1;)u.debugIsOn?a+=await gi({replIO:c,state:C,hostDictionary:u,iterator:g,waitForChar:i}):++a,y=g.next().done;if(u.exitCalled)break;C.exception!==void 0&&ts(c,C.exception,C.exceptionStack),c.output(si(C,{cycle:a,absolute:!1,lastOperandsCount:h,lastUsedMemory:p}))}catch(o){if(Ot(c,o),o instanceof St)break}}c.output(`${de}terminating...${ee}\r
`);try{C.destroy()}catch(o){Ot(c,o)}c.output(`${de}terminated.${ee}\r
`)}const Ae=new rs.Terminal({cursorBlink:!0}),yt=new os.FitAddon;Ae.loadAddon(yt);Ae.open(document.querySelector("#terminal"));yt.fit();window.addEventListener("resize",()=>yt.fit());await mi({get width(){return Ae.cols},get height(){return Ae.rows},input(c){Ae.onData(c)},output(c){Ae.write(c)}}).catch(c=>{console.error(c)});
